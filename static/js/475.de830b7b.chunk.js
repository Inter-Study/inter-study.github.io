"use strict";(self.webpackChunkinter_study=self.webpackChunkinter_study||[]).push([[475],{8475:function(e,t,n){n.d(t,{aK:function(){return i0},Qr:function(){return T0},qB:function(){return d0}});var r=n(1413),a=n(4942),i=n(1120);function o(){return o="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=(0,i.Z)(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},o.apply(this,arguments)}var s=n(7326),u=n(8737),c=n(2963),l=n(136),p=n(9388),h=n(9439),d=n(4165),f=n(5861),m=n(5671),v=n(3144),g=n(3433),y=n(7762),b="/index.js",x=Object.defineProperty,k=n(6741),w=function(e,t){for(var n in t)x(e,n,{get:t[n],enumerable:!0})};w({},{Abs:function(){return rt},Acos:function(){return at},Acosh:function(){return it},AdadeltaOptimizer:function(){return Xd},AdagradOptimizer:function(){return Yd},AdamOptimizer:function(){return Jd},AdamaxOptimizer:function(){return Qd},Add:function(){return ot},AddN:function(){return st},All:function(){return ut},Any:function(){return ct},ArgMax:function(){return lt},ArgMin:function(){return pt},Asin:function(){return ht},Asinh:function(){return dt},Atan:function(){return ft},Atan2:function(){return vt},Atanh:function(){return mt},AvgPool:function(){return gt},AvgPool3D:function(){return bt},AvgPool3DGrad:function(){return xt},AvgPoolGrad:function(){return yt},BackendWasm:function(){return $Y},BatchMatMul:function(){return kt},BatchToSpaceND:function(){return wt},Bincount:function(){return It},BroadcastArgs:function(){return Nt},BroadcastTo:function(){return St},Callback:function(){return UT},CallbackList:function(){return bk},Cast:function(){return Tt},Ceil:function(){return Ct},ClipByValue:function(){return _t},Complex:function(){return Et},ComplexAbs:function(){return At},Concat:function(){return Rt},Conv2D:function(){return Ft},Conv2DBackpropFilter:function(){return Zt},Conv2DBackpropInput:function(){return Dt},Conv3D:function(){return Mt},Conv3DBackpropFilterV2:function(){return Ot},Conv3DBackpropInputV2:function(){return Lt},Cos:function(){return zt},Cosh:function(){return Pt},CropAndResize:function(){return Vt},Cumprod:function(){return Bt},Cumsum:function(){return Wt},CustomCallback:function(){return wk},DataStorage:function(){return $},DenseBincount:function(){return Ut},DepthToSpace:function(){return Gt},DepthwiseConv2dNative:function(){return Ht},DepthwiseConv2dNativeBackpropFilter:function(){return jt},DepthwiseConv2dNativeBackpropInput:function(){return qt},Diag:function(){return Kt},Dilation2D:function(){return Xt},Dilation2DBackpropFilter:function(){return Jt},Dilation2DBackpropInput:function(){return Yt},ENV:function(){return et},EarlyStopping:function(){return jT},Einsum:function(){return $t},Elu:function(){return en},EluGrad:function(){return tn},Environment:function(){return Ye},Equal:function(){return rn},Erf:function(){return nn},Exp:function(){return an},ExpandDims:function(){return on},Expm1:function(){return sn},FFT:function(){return un},Fill:function(){return cn},FlipLeftRight:function(){return ln},Floor:function(){return pn},FloorDiv:function(){return hn},FromPixels:function(){return ha},FusedBatchNorm:function(){return dn},FusedConv2D:function(){return ma},FusedDepthwiseConv2D:function(){return va},GPGPUContext:function(){return pP},GatherNd:function(){return mn},GatherV2:function(){return fn},GraphModel:function(){return eE},Greater:function(){return vn},GreaterEqual:function(){return gn},History:function(){return kk},IFFT:function(){return bn},Identity:function(){return yn},Imag:function(){return xn},InputSpec:function(){return bx},IsFinite:function(){return kn},IsInf:function(){return wn},IsNan:function(){return In},KernelBackend:function(){return ee},LRN:function(){return On},LRNGrad:function(){return Ln},LayerVariable:function(){return vx},LayersModel:function(){return Aw},LeakyRelu:function(){return Sn},Less:function(){return Nn},LessEqual:function(){return Tn},LinSpace:function(){return Cn},Log:function(){return _n},Log1p:function(){return En},LogSoftmax:function(){return Dn},LogicalAnd:function(){return An},LogicalNot:function(){return Rn},LogicalOr:function(){return Fn},LogicalXor:function(){return Zn},LowerBound:function(){return Mn},MathBackendWebGL:function(){return ZB},Max:function(){return zn},MaxPool:function(){return Bn},MaxPool3D:function(){return Vn},MaxPool3DGrad:function(){return Un},MaxPoolGrad:function(){return Wn},MaxPoolWithArgmax:function(){return Gn},Maximum:function(){return Pn},Mean:function(){return Hn},Min:function(){return jn},Minimum:function(){return qn},MirrorPad:function(){return Kn},Mod:function(){return Xn},MomentumOptimizer:function(){return ef},Multinomial:function(){return Yn},Multiply:function(){return Jn},Neg:function(){return Qn},NonMaxSuppressionV3:function(){return er},NonMaxSuppressionV4:function(){return tr},NonMaxSuppressionV5:function(){return nr},NotEqual:function(){return $n},OP_SCOPE_SUFFIX:function(){return ji},OneHot:function(){return ar},OnesLike:function(){return rr},Optimizer:function(){return Kd},OptimizerConstructors:function(){return pm},Pack:function(){return ir},PadV2:function(){return or},Pool:function(){return sr},Pow:function(){return ur},Prelu:function(){return cr},Prod:function(){return lr},RMSPropOptimizer:function(){return tf},RNN:function(){return WI},RaggedGather:function(){return pr},RaggedRange:function(){return hr},RaggedTensorToTensor:function(){return dr},Range:function(){return fr},Rank:function(){return mi},Real:function(){return mr},RealDiv:function(){return Qt},Reciprocal:function(){return vr},Reduction:function(){return bd},Relu:function(){return gr},Relu6:function(){return Ir},Reshape:function(){return yr},ResizeBilinear:function(){return kr},ResizeBilinearGrad:function(){return wr},ResizeNearestNeighbor:function(){return br},ResizeNearestNeighborGrad:function(){return xr},Reverse:function(){return Sr},RotateWithOffset:function(){return da},Round:function(){return Nr},Rsqrt:function(){return Tr},SGDOptimizer:function(){return $d},ScatterNd:function(){return Cr},SearchSorted:function(){return _r},Select:function(){return Er},Selu:function(){return Ar},Sequential:function(){return Pw},Sigmoid:function(){return Mr},Sign:function(){return Dr},Sin:function(){return Fr},Sinh:function(){return Zr},Slice:function(){return Rr},Softmax:function(){return Wr},Softplus:function(){return Or},SpaceToBatchND:function(){return Pr},SparseFillEmptyRows:function(){return Vr},SparseReshape:function(){return Ur},SparseSegmentMean:function(){return Gr},SparseSegmentSum:function(){return Hr},SparseToDense:function(){return jr},SplitV:function(){return Br},Sqrt:function(){return Lr},Square:function(){return Kr},SquaredDifference:function(){return qr},Step:function(){return pa},StridedSlice:function(){return Xr},StringNGrams:function(){return Yr},StringSplit:function(){return Jr},StringToHashBucketFast:function(){return Qr},Sub:function(){return $r},Sum:function(){return zr},SymbolicTensor:function(){return xx},Tan:function(){return ea},Tanh:function(){return ta},Tensor:function(){return hi},TensorBuffer:function(){return ci},Tile:function(){return na},TopK:function(){return ra},Transform:function(){return aa},Transpose:function(){return ia},Unique:function(){return oa},Unpack:function(){return sa},UnsortedSegmentSum:function(){return ua},UpperBound:function(){return ca},Variable:function(){return fi},ZerosLike:function(){return la},_FusedMatMul:function(){return fa},abs:function(){return Ls},acos:function(){return zs},acosh:function(){return Ps},add:function(){return Zs},addN:function(){return Bs},all:function(){return Ws},any:function(){return Vs},argMax:function(){return Us},argMin:function(){return Gs},asin:function(){return Hs},asinh:function(){return js},atan:function(){return qs},atan2:function(){return Ks},atanh:function(){return Xs},avgPool:function(){return hu},avgPool3d:function(){return du},backend:function(){return Rs},backend_util:function(){return vm},basicLSTMCell:function(){return bu},batchNorm:function(){return wu},batchNorm2d:function(){return Iu},batchNorm3d:function(){return Su},batchNorm4d:function(){return Nu},batchToSpaceND:function(){return xu},bincount:function(){return Tu},booleanMaskAsync:function(){return dh},broadcastArgs:function(){return Cu},broadcastTo:function(){return _u},broadcast_util:function(){return Qu},browser:function(){return Df},buffer:function(){return us},callbacks:function(){return XT},cast:function(){return cs},ceil:function(){return Eu},clipByValue:function(){return Ru},clone:function(){return ls},complex:function(){return Ki},concat:function(){return fu},concat1d:function(){return Fu},concat2d:function(){return Zu},concat3d:function(){return Du},concat4d:function(){return Mu},constraints:function(){return Mx},conv1d:function(){return Lu},conv2d:function(){return Ou},conv2dTranspose:function(){return Pu},conv3d:function(){return Bu},conv3dTranspose:function(){return Vu},copyRegisteredKernels:function(){return _a},cos:function(){return Uu},cosh:function(){return Gu},cosineWindow:function(){return Nh},cumprod:function(){return Hu},cumsum:function(){return ju},customGrad:function(){return $c},data:function(){return oE},denseBincount:function(){return qu},deprecationWarn:function(){return ms},depthToSpace:function(){return Ku},depthwiseConv2d:function(){return Xu},deregisterOp:function(){return $T},device_util:function(){return Oi},diag:function(){return Yu},dilation2d:function(){return Ju},disableDeprecationWarnings:function(){return fs},dispose:function(){return ks},disposeVariables:function(){return vs},div:function(){return Ms},divNoNan:function(){return ic},dot:function(){return oc},dropout:function(){return Ih},einsum:function(){return sc},elu:function(){return uc},enableDebugMode:function(){return ds},enableProdMode:function(){return hs},enclosingPowerOfTwo:function(){return Sh},engine:function(){return gs},env:function(){return Qe},equal:function(){return nc},erf:function(){return cc},euclideanNorm:function(){return Cc},exp:function(){return _c},expandDims:function(){return Ec},expm1:function(){return Ac},eye:function(){return Fc},fft:function(){return Pp},fill:function(){return Au},findBackend:function(){return _s},findBackendFactory:function(){return Es},floor:function(){return Zc},floorDiv:function(){return Ds},forceHalfFloat:function(){return MB},fused:function(){return _h},gather:function(){return Dc},gatherND:function(){return wh},gather_util:function(){return Vf},getBackend:function(){return Ts},getGradient:function(){return wa},getKernel:function(){return ka},getKernelsForBackend:function(){return Ia},getThreadsCount:function(){return mJ},gpgpu_util:function(){return Vz},grad:function(){return Kc},grads:function(){return Xc},greater:function(){return Mc},greaterEqual:function(){return Oc},ifft:function(){return Bp},imag:function(){return Lc},image:function(){return Pd},inTopKAsync:function(){return Ch},initializers:function(){return Yx},input:function(){return Vw},io:function(){return rf},irfft:function(){return Wp},isFinite:function(){return zc},isInf:function(){return Pc},isNaN:function(){return Bc},keep:function(){return ws},kernel_impls:function(){return wv},layers:function(){return dk},leakyRelu:function(){return Wc},less:function(){return Vc},lessEqual:function(){return Uc},linalg:function(){return Bd},linspace:function(){return Gc},loadGraphModel:function(){return tE},loadGraphModelSync:function(){return rE},loadLayersModel:function(){return Dw},localResponseNormalization:function(){return Hc},log:function(){return jc},log1p:function(){return qc},logSigmoid:function(){return rl},logSoftmax:function(){return il},logSumExp:function(){return ol},logicalAnd:function(){return sl},logicalNot:function(){return ul},logicalOr:function(){return cl},logicalXor:function(){return ll},losses:function(){return Wd},lowerBound:function(){return dl},matMul:function(){return mu},math:function(){return Rf},max:function(){return yc},maxPool:function(){return fl},maxPool3d:function(){return ml},maxPoolWithArgmax:function(){return vl},maximum:function(){return gl},mean:function(){return yl},memory:function(){return ys},meshgrid:function(){return kl},metrics:function(){return wT},min:function(){return bc},minimum:function(){return wl},mirrorPad:function(){return Il},mod:function(){return Sl},model:function(){return Bw},models:function(){return zT},moments:function(){return Nl},movingAverage:function(){return mh},mul:function(){return Os},multiRNNCell:function(){return Tl},multinomial:function(){return Cl},neg:function(){return tl},nextFrame:function(){return fm},norm:function(){return Tc},notEqual:function(){return _l},oneHot:function(){return El},ones:function(){return xl},onesLike:function(){return Al},op:function(){return qi},outerProduct:function(){return Rl},pad:function(){return Fl},pad1d:function(){return Zl},pad2d:function(){return Dl},pad3d:function(){return Ml},pad4d:function(){return Ol},pool:function(){return zl},pow:function(){return xc},prelu:function(){return Pl},print:function(){return ps},prod:function(){return Bl},profile:function(){return bs},raggedGather:function(){return Wl},raggedRange:function(){return Vl},raggedTensorToTensor:function(){return Ul},rand:function(){return Gl},randomGamma:function(){return pp},randomNormal:function(){return hp},randomStandardNormal:function(){return dp},randomUniform:function(){return fp},range:function(){return mp},ready:function(){return Ns},real:function(){return vp},reciprocal:function(){return gp},registerBackend:function(){return As},registerCallbackConstructor:function(){return Uw},registerGradient:function(){return Na},registerKernel:function(){return Sa},registerOp:function(){return JT},regularizers:function(){return PT},relu:function(){return yp},relu6:function(){return bp},removeBackend:function(){return Cs},reshape:function(){return pu},reverse:function(){return xp},reverse1d:function(){return kp},reverse2d:function(){return wp},reverse3d:function(){return Ip},reverse4d:function(){return Sp},rfft:function(){return Up},round:function(){return Np},rsqrt:function(){return Tp},scalar:function(){return kc},scatterND:function(){return xh},scatter_util:function(){return vh},searchSorted:function(){return hl},selu:function(){return Cp},separableConv2d:function(){return _p},sequential:function(){return Ww},serialization:function(){return Gd},setBackend:function(){return Ss},setPlatform:function(){return Fs},setThreadsCount:function(){return fJ},setWasmPath:function(){return lJ},setWasmPaths:function(){return pJ},setWebGLContext:function(){return sL},setdiff1dAsync:function(){return Ap},sigmoid:function(){return vu},sign:function(){return Rp},signal:function(){return zd},sin:function(){return Fp},sinh:function(){return Zp},slice:function(){return gu},slice1d:function(){return Dp},slice2d:function(){return Mp},slice3d:function(){return Op},slice4d:function(){return Lp},slice_util:function(){return Gf},softmax:function(){return zp},softplus:function(){return nl},spaceToBatchND:function(){return Ll},sparse:function(){return Vd},sparseToDense:function(){return kh},spectral:function(){return Ld},split:function(){return Vp},sqrt:function(){return wc},square:function(){return Ic},squaredDifference:function(){return Gp},squeeze:function(){return Hp},stack:function(){return jp},step:function(){return qp},stridedSlice:function(){return Kp},string:function(){return Ud},sub:function(){return al},sum:function(){return Sc},sumOutType:function(){return Ii},tan:function(){return Xp},tanh:function(){return yu},tensor:function(){return Yi},tensor1d:function(){return Yp},tensor2d:function(){return Jp},tensor3d:function(){return Qp},tensor4d:function(){return $p},tensor5d:function(){return eh},tensor6d:function(){return th},tensor_util:function(){return xi},test_util:function(){return jl},tidy:function(){return xs},tile:function(){return Rc},time:function(){return Is},topk:function(){return nh},train:function(){return hm},transpose:function(){return fh},truncatedNormal:function(){return rh},unique:function(){return ah},unregisterGradient:function(){return Ca},unregisterKernel:function(){return Ta},unsortedSegmentSum:function(){return ih},unstack:function(){return oh},upcastType:function(){return wi},upperBound:function(){return sh},util:function(){return Aa},valueAndGrad:function(){return Yc},valueAndGrads:function(){return Jc},variable:function(){return uh},variableGrads:function(){return Qc},version:function(){return yJ},version_converter:function(){return iE},version_core:function(){return lm},version_layers:function(){return rw},version_wasm:function(){return vJ},version_webgl:function(){return DB},webgl:function(){return OB},webgl_util:function(){return tL},where:function(){return rc},whereAsync:function(){return ph},zeros:function(){return bl},zerosLike:function(){return ac}});var I=Object.create,S=Object.defineProperty,N=Object.getOwnPropertyDescriptor,T=Object.getOwnPropertyNames,C=Object.getPrototypeOf,_=Object.prototype.hasOwnProperty,E=function(e,t){return function(){return t||e((t={exports:{}}).exports,t),t.exports}},A=function(e,t){for(var n in t)S(e,n,{get:t[n],enumerable:!0})},R=function(e,t,n){return n=null!=e?I(C(e)):{},function(e,t,n,r){if(t&&"object"==typeof t||"function"==typeof t){var a,i=(0,y.Z)(T(t));try{var o=function(){var i=a.value;!_.call(e,i)&&i!==n&&S(e,i,{get:function(){return t[i]},enumerable:!(r=N(t,i))||r.enumerable})};for(i.s();!(a=i.n()).done;)o()}catch(s){i.e(s)}finally{i.f()}}return e}(!t&&e&&e.__esModule?n:S(n,"default",{value:e,enumerable:!0}),e)},F=E((function(e,t){t.exports=r;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(T){}function r(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function a(e){return!0===(e&&e.__isLong__)}r.prototype.__isLong__,Object.defineProperty(r.prototype,"__isLong__",{value:!0}),r.isLong=a;var i={},o={};function s(e,t){var n,r,a;return t?(a=0<=(e>>>=0)&&e<256)&&(r=o[e])?r:(n=c(e,(0|e)<0?-1:0,!0),a&&(o[e]=n),n):(a=-128<=(e|=0)&&e<128)&&(r=i[e])?r:(n=c(e,e<0?-1:0,!1),a&&(i[e]=n),n)}function u(e,t){if(isNaN(e))return t?y:g;if(t){if(e<0)return y;if(e>=f)return I}else{if(e<=-m)return S;if(e+1>=m)return w}return e<0?u(-e,t).neg():c(e%d|0,e/d|0,t)}function c(e,t,n){return new r(e,t,n)}r.fromInt=s,r.fromNumber=u,r.fromBits=c;var l=Math.pow;function p(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return g;if("number"==typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return p(e.substring(1),t,n).neg();for(var a=u(l(n,8)),i=g,o=0;o<e.length;o+=8){var s=Math.min(8,e.length-o),c=parseInt(e.substring(o,o+s),n);if(s<8){var h=u(l(n,s));i=i.mul(h).add(u(c))}else i=(i=i.mul(a)).add(u(c))}return i.unsigned=t,i}function h(e,t){return"number"==typeof e?u(e,t):"string"==typeof e?p(e,t):c(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}r.fromString=p,r.fromValue=h;var d=4294967296,f=d*d,m=f/2,v=s(1<<24),g=s(0);r.ZERO=g;var y=s(0,!0);r.UZERO=y;var b=s(1);r.ONE=b;var x=s(1,!0);r.UONE=x;var k=s(-1);r.NEG_ONE=k;var w=c(-1,2147483647,!1);r.MAX_VALUE=w;var I=c(-1,-1,!0);r.MAX_UNSIGNED_VALUE=I;var S=c(0,-2147483648,!1);r.MIN_VALUE=S;var N=r.prototype;N.toInt=function(){return this.unsigned?this.low>>>0:this.low},N.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},N.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(S)){var t=u(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var a=u(l(e,6),this.unsigned),i=this,o="";;){var s=i.div(a),c=(i.sub(s.mul(a)).toInt()>>>0).toString(e);if((i=s).isZero())return c+o;for(;c.length<6;)c="0"+c;o=""+c+o}},N.getHighBits=function(){return this.high},N.getHighBitsUnsigned=function(){return this.high>>>0},N.getLowBits=function(){return this.low},N.getLowBitsUnsigned=function(){return this.low>>>0},N.getNumBitsAbs=function(){if(this.isNegative())return this.eq(S)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return 0!=this.high?t+33:t+1},N.isZero=function(){return 0===this.high&&0===this.low},N.eqz=N.isZero,N.isNegative=function(){return!this.unsigned&&this.high<0},N.isPositive=function(){return this.unsigned||this.high>=0},N.isOdd=function(){return 1===(1&this.low)},N.isEven=function(){return 0===(1&this.low)},N.equals=function(e){return a(e)||(e=h(e)),(this.unsigned===e.unsigned||this.high>>>31!==1||e.high>>>31!==1)&&(this.high===e.high&&this.low===e.low)},N.eq=N.equals,N.notEquals=function(e){return!this.eq(e)},N.neq=N.notEquals,N.ne=N.notEquals,N.lessThan=function(e){return this.comp(e)<0},N.lt=N.lessThan,N.lessThanOrEqual=function(e){return this.comp(e)<=0},N.lte=N.lessThanOrEqual,N.le=N.lessThanOrEqual,N.greaterThan=function(e){return this.comp(e)>0},N.gt=N.greaterThan,N.greaterThanOrEqual=function(e){return this.comp(e)>=0},N.gte=N.greaterThanOrEqual,N.ge=N.greaterThanOrEqual,N.compare=function(e){if(a(e)||(e=h(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},N.comp=N.compare,N.negate=function(){return!this.unsigned&&this.eq(S)?S:this.not().add(b)},N.neg=N.negate,N.add=function(e){a(e)||(e=h(e));var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,i=65535&this.low,o=e.high>>>16,s=65535&e.high,u=e.low>>>16,l=0,p=0,d=0,f=0;return d+=(f+=i+(65535&e.low))>>>16,p+=(d+=r+u)>>>16,l+=(p+=n+s)>>>16,l+=t+o,c((d&=65535)<<16|(f&=65535),(l&=65535)<<16|(p&=65535),this.unsigned)},N.subtract=function(e){return a(e)||(e=h(e)),this.add(e.neg())},N.sub=N.subtract,N.multiply=function(e){if(this.isZero())return g;if(a(e)||(e=h(e)),n)return c(n.mul(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned);if(e.isZero())return g;if(this.eq(S))return e.isOdd()?S:g;if(e.eq(S))return this.isOdd()?S:g;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(v)&&e.lt(v))return u(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,r=65535&this.high,i=this.low>>>16,o=65535&this.low,s=e.high>>>16,l=65535&e.high,p=e.low>>>16,d=65535&e.low,f=0,m=0,y=0,b=0;return y+=(b+=o*d)>>>16,m+=(y+=i*d)>>>16,y&=65535,m+=(y+=o*p)>>>16,f+=(m+=r*d)>>>16,m&=65535,f+=(m+=i*p)>>>16,m&=65535,f+=(m+=o*l)>>>16,f+=t*d+r*p+i*l+o*s,c((y&=65535)<<16|(b&=65535),(f&=65535)<<16|(m&=65535),this.unsigned)},N.mul=N.multiply,N.divide=function(e){if(a(e)||(e=h(e)),e.isZero())throw Error("division by zero");var t,r,i;if(n)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?c((this.unsigned?n.div_u:n.div_s)(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?y:g;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return y;if(e.gt(this.shru(1)))return x;i=y}else{if(this.eq(S))return e.eq(b)||e.eq(k)?S:e.eq(S)?b:(t=this.shr(1).div(e).shl(1)).eq(g)?e.isNegative()?b:k:(r=this.sub(e.mul(t)),i=t.add(r.div(e)));if(e.eq(S))return this.unsigned?y:g;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=g}for(r=this;r.gte(e);){t=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(t)/Math.LN2),s=o<=48?1:l(2,o-48),p=u(t),d=p.mul(e);d.isNegative()||d.gt(r);)d=(p=u(t-=s,this.unsigned)).mul(e);p.isZero()&&(p=b),i=i.add(p),r=r.sub(d)}return i},N.div=N.divide,N.modulo=function(e){return a(e)||(e=h(e)),n?c((this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},N.mod=N.modulo,N.rem=N.modulo,N.not=function(){return c(~this.low,~this.high,this.unsigned)},N.and=function(e){return a(e)||(e=h(e)),c(this.low&e.low,this.high&e.high,this.unsigned)},N.or=function(e){return a(e)||(e=h(e)),c(this.low|e.low,this.high|e.high,this.unsigned)},N.xor=function(e){return a(e)||(e=h(e)),c(this.low^e.low,this.high^e.high,this.unsigned)},N.shiftLeft=function(e){return a(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?c(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):c(0,this.low<<e-32,this.unsigned)},N.shl=N.shiftLeft,N.shiftRight=function(e){return a(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?c(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):c(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},N.shr=N.shiftRight,N.shiftRightUnsigned=function(e){if(a(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?c(this.low>>>e|t<<32-e,t>>>e,this.unsigned):c(32===e?t:t>>>e-32,0,this.unsigned)},N.shru=N.shiftRightUnsigned,N.shr_u=N.shiftRightUnsigned,N.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},N.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},N.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},N.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},N.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},r.fromBytes=function(e,t,n){return n?r.fromBytesLE(e,t):r.fromBytesBE(e,t)},r.fromBytesLE=function(e,t){return new r(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},r.fromBytesBE=function(e,t){return new r(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}})),Z=E((function(){})),D=E((function(){})),M=E((function(e,t){!function(e,t,n){function r(e){var t=this,n=function(){var e=4022871197,t=function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)};return t}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function a(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function i(e,t){var n=new r(e),i=t&&t.state,o=n.next;return o.int32=function(){return 4294967296*n.next()|0},o.double=function(){return o()+11102230246251565e-32*(2097152*o()|0)},o.quick=o,i&&("object"==typeof i&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.alea=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),O=E((function(e,t){!function(e,t,n){function r(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function i(e,t){var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&("object"==typeof i&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.xor128=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),L=E((function(e,t){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function i(e,t){var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&("object"==typeof i&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.xorwow=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),z=E((function(e,t){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function a(e,t){return t.x=e.x.slice(),t.i=e.i,t}function i(e,t){null==e&&(e=+new Date);var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&(i.x&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.xorshift7=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),P=E((function(e,t){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[i]=n^e,t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),a=0,i=-32;i<u;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=o+1640531527|0,a=0==(n=s[127&i]^=r+o)?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=s[a+34&127],n=s[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[a]=r^n;e.w=o,e.X=s,e.i=a}(t,e)}function a(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function i(e,t){null==e&&(e=+new Date);var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&(i.X&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.xor4096=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),B=E((function(e,t){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function i(e,t){var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&("object"==typeof i&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.tychei=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),W=E((function(){})),V=E((function(e,t){!function(e,r,a){var i,o=256,s=6,u="random",c=a.pow(o,s),l=a.pow(2,52),p=2*l,h=o-1;function d(t,n,h){var d=[],b=g(v((n=1==n?{entropy:!0}:n||{}).entropy?[t,y(r)]:null==t?function(){try{var t;return i&&(t=i.randomBytes)?t=t(o):(t=new Uint8Array(o),(e.crypto||e.msCrypto).getRandomValues(t)),y(t)}catch(d){var n=e.navigator,a=n&&n.plugins;return[+new Date,e,a,e.screen,y(r)]}}():t,3),d),x=new f(d),k=function(){for(var e=x.g(s),t=c,n=0;e<l;)e=(e+n)*o,t*=o,n=x.g(1);for(;e>=p;)e/=2,t/=2,n>>>=1;return(e+n)/t};return k.int32=function(){return 0|x.g(4)},k.quick=function(){return x.g(4)/4294967296},k.double=k,g(y(x.S),r),(n.pass||h||function(e,t,n,r){return r&&(r.S&&m(r,x),e.state=function(){return m(x,{})}),n?(a[u]=e,t):e})(k,b,"global"in n?n.global:this==a,n.state)}function f(e){var t,n=e.length,r=this,a=0,i=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);a<o;)s[a]=a++;for(a=0;a<o;a++)s[a]=s[i=h&i+e[a%n]+(t=s[a])],s[i]=t;(r.g=function(e){for(var t,n=0,a=r.i,i=r.j,s=r.S;e--;)t=s[a=h&a+1],n=n*o+s[h&(s[a]=s[i=h&i+t])+(s[i]=t)];return r.i=a,r.j=i,n})(o)}function m(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function v(e,t){var n,r=[],a=typeof e;if(t&&"object"==a)for(n in e)try{r.push(v(e[n],t-1))}catch(i){}return r.length?r:"string"==a?e:e+"\0"}function g(e,t){for(var n,r=e+"",a=0;a<r.length;)t[h&a]=h&(n^=19*t[h&a])+r.charCodeAt(a++);return y(t)}function y(e){return String.fromCharCode.apply(0,e)}if(g(a.random(),r),"object"==typeof t&&t.exports){t.exports=d;try{i=W()}catch(b){}}else"function"==typeof define&&n.amdO?define((function(){return d})):a["seed"+u]=d}("undefined"!=typeof self?self:e,[],Math)})),U=E((function(e,t){var n=M(),r=O(),a=L(),i=z(),o=P(),s=B(),u=V();u.alea=n,u.xor128=r,u.xorwow=a,u.xorshift7=i,u.xor4096=o,u.tychei=s,t.exports=u})),G=E((function(){})),H=E((function(){})),j=E((function(){})),q=E((function(){})),K=E((function(){})),X=E((function(){})),Y=E((function(e,t){var r=function(){var e="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0;return e=e||b,function(t){function r(){return D.buffer!=z&&Q(D.buffer),B}function a(){return D.buffer!=z&&Q(D.buffer),W}function i(){return D.buffer!=z&&Q(D.buffer),V}function o(){return D.buffer!=z&&Q(D.buffer),U}var s,u,c,l="undefined"!=typeof(t=t||{})?t:{};l.ready=new Promise((function(e,t){s=e,u=t})),"undefined"!=typeof process&&process.listeners&&(c={uncaughtException:process.listeners("uncaughtException"),unhandledRejection:process.listeners("unhandledRejection")});var p,h,d,f=Object.assign({},l),m=[],v=function(e,t){throw t},b="object"==typeof window,x="function"==typeof importScripts,k="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,w=l.ENVIRONMENT_IS_PTHREAD||!1,I="";function S(e){return l.locateFile?l.locateFile(e,I):I+e}if(k){var N,T=H(),C=j();I=x?C.dirname(I)+"/":"//",p=function(e,t){return e=me(e)?new URL(e):C.normalize(e),T.readFileSync(e,t?void 0:"utf8")},d=function(e){var t=p(e,!0);return t.buffer||(t=new Uint8Array(t)),t},h=function(e,t,n){e=me(e)?new URL(e):C.normalize(e),T.readFile(e,(function(e,r){e?n(e):t(r.buffer)}))},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),m=process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof ye))throw e})),process.on("unhandledRejection",(function(e){throw e})),v=function(e,t){if(ae())throw process.exitCode=e,t;(function(e){e instanceof ye||R("exiting due to exception: "+e)})(t),process.exit(e)},l.inspect=function(){return"[Emscripten Module object]"};try{N=q()}catch(st){throw console.error('The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?'),st}n.g.Worker=N.Worker}else(b||x)&&(x?I=self.location.href:"undefined"!=typeof document&&document.currentScript&&(I=document.currentScript.src),"undefined"!=typeof e&&e&&(I=e),I=0!==I.indexOf("blob:")?I.substr(0,I.replace(/[?#].*/,"").lastIndexOf("/")+1):"",k||(p=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},x&&(d=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),h=function(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)}),function(e){return document.title=e});k&&"undefined"==typeof performance&&(n.g.performance=K().performance);var _=console.log.bind(console),E=console.warn.bind(console);k&&(_=function(e){return T.writeSync(1,e+"\n")},E=function(e){return T.writeSync(2,e+"\n")});var A=l.print||_,R=l.printErr||E;Object.assign(l,f),f=null,l.arguments&&(m=l.arguments),l.thisProgram&&l.thisProgram,l.quit&&(v=l.quit);var F;Atomics.load,Atomics.store,Atomics.compareExchange;l.wasmBinary&&(F=l.wasmBinary);var Z=l.noExitRuntime||!0;"object"!=typeof WebAssembly&&pe("no native wasm support detected");var D,M,O,L=!1;var z,P,B,W,V,U,G="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function Y(e,t,n){for(var r=t+n,a=t;e[a]&&!(a>=r);)++a;if(a-t>16&&e.buffer&&G)return G.decode(e.buffer instanceof SharedArrayBuffer?e.slice(t,a):e.subarray(t,a));for(var i="";t<a;){var o=e[t++];if(128&o){var s=63&e[t++];if(192!=(224&o)){var u=63&e[t++];if((o=224==(240&o)?(15&o)<<12|s<<6|u:(7&o)<<18|s<<12|u<<6|63&e[t++])<65536)i+=String.fromCharCode(o);else{var c=o-65536;i+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else i+=String.fromCharCode((31&o)<<6|s)}else i+=String.fromCharCode(o)}return i}function J(e,t){return e?Y(r(),e,t):""}function Q(e){z=e,l.HEAP8=P=new Int8Array(e),l.HEAP16=new Int16Array(e),l.HEAP32=W=new Int32Array(e),l.HEAPU8=B=new Uint8Array(e),l.HEAPU16=new Uint16Array(e),l.HEAPU32=V=new Uint32Array(e),l.HEAPF32=new Float32Array(e),l.HEAPF64=U=new Float64Array(e)}w&&(z=l.buffer);var $=l.INITIAL_MEMORY||16777216;if(w)D=l.wasmMemory,z=l.buffer;else if(l.wasmMemory)D=l.wasmMemory;else if(!((D=new WebAssembly.Memory({initial:$/65536,maximum:32768,shared:!0})).buffer instanceof SharedArrayBuffer))throw R("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),k&&R("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and/or recent version)"),Error("bad memory");D&&(z=D.buffer),$=z.byteLength,Q(z);var ee,te=[],ne=[],re=[];function ae(){return Z}function ie(){!0,!w&&Se(ne)}function oe(e){te.unshift(e)}function se(e){re.unshift(e)}var ue=0,ce=null,le=null;function pe(e){l.onAbort&&l.onAbort(e),R(e="Aborted("+e+")"),L=!0,O=1,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw u(t),t}var he,de="data:application/octet-stream;base64,";function fe(e){return e.startsWith(de)}function me(e){return e.startsWith("file://")}function ve(e){try{if(e==he&&F)return new Uint8Array(F);if(d)return d(e);throw"both async and sync fetching of the wasm failed"}catch(st){pe(st)}}fe(he="tfjs-backend-wasm-threaded-simd.wasm")||(he=S(he));var ge={};function ye(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function be(e){var t=Ie.pthreads[e];(function(e,t){e||pe(t)})(t),Ie.returnWorkerToPool(t)}function xe(e){var t=Ie.getNewWorker();if(!t)return 6;Ie.runningWorkers.push(t),Ie.pthreads[e.pthread_ptr]=t,t.pthread_ptr=e.pthread_ptr;var n={cmd:"run",start_routine:e.startRoutine,arg:e.arg,pthread_ptr:e.pthread_ptr};return t.runPthread=function(){k&&t.ref(),t.postMessage(n,e.transferList),delete t.runPthread},t.loaded&&t.runPthread(),0}function ke(e){if(w)return Ze(1,1,e);O=e,ae()||(Ie.terminateAllThreads(),l.onExit&&l.onExit(e),L=!0),v(e,new ye(e))}var we=function(e,t){if(O=e,!t&&w)throw Ne(e),"unwind";ke(e)};var Ie={unusedWorkers:[],runningWorkers:[],tlsInitFunctions:[],pthreads:{},init:function(){w?Ie.initWorker():Ie.initMainThread()},initMainThread:function(){for(var e=8;e--;)Ie.allocateUnusedWorker()},initWorker:function(){Z=!1},setExitStatus:function(e){O=e},terminateAllThreads:function(){for(var e=0,t=Object.values(Ie.pthreads);e<t.length;e++){var n=t[e];Ie.returnWorkerToPool(n)}var r,a=(0,y.Z)(Ie.unusedWorkers);try{for(a.s();!(r=a.n()).done;){(n=r.value).terminate()}}catch(i){a.e(i)}finally{a.f()}Ie.unusedWorkers=[]},returnWorkerToPool:function(e){var t=e.pthread_ptr;delete Ie.pthreads[t],Ie.unusedWorkers.push(e),Ie.runningWorkers.splice(Ie.runningWorkers.indexOf(e),1),e.pthread_ptr=0,k&&e.unref(),$e(t)},receiveObjectTransfer:function(e){},threadInitTLS:function(){Ie.tlsInitFunctions.forEach((function(e){return e()}))},loadWasmModuleToWorker:function(t,n){t.onmessage=function(e){var r=e.data,a=r.cmd;if(t.pthread_ptr&&(Ie.currentProxiedOperationCallerThread=t.pthread_ptr),r.targetThread&&r.targetThread!=Xe()){var i=Ie.pthreads[r.targetThread];return i?i.postMessage(r,r.transferList):R('Internal error! Worker sent a message "'+a+'" to target pthread '+r.targetThread+", but that thread no longer exists!"),void(Ie.currentProxiedOperationCallerThread=void 0)}"processProxyingQueue"===a?Re(r.queue):"spawnThread"===a?xe(r):"cleanupThread"===a?be(r.thread):"killThread"===a?function(e){var t=Ie.pthreads[e];delete Ie.pthreads[e],t.terminate(),$e(e),Ie.runningWorkers.splice(Ie.runningWorkers.indexOf(t),1),t.pthread_ptr=0}(r.thread):"cancelThread"===a?function(e){Ie.pthreads[e].postMessage({cmd:"cancel"})}(r.thread):"loaded"===a?(t.loaded=!0,k&&t.unref(),n&&n(t),t.runPthread&&t.runPthread()):"print"===a?A("Thread "+r.threadId+": "+r.text):"printErr"===a?R("Thread "+r.threadId+": "+r.text):"alert"===a?alert("Thread "+r.threadId+": "+r.text):"setimmediate"===r.target?t.postMessage(r):"callHandler"===a?l[r.handler].apply(l,(0,g.Z)(r.args)):a&&R("worker sent an unknown command "+a),Ie.currentProxiedOperationCallerThread=void 0},t.onerror=function(e){throw R("worker sent an error! "+e.filename+":"+e.lineno+": "+e.message),e},k&&(t.on("message",(function(e){t.onmessage({data:e})})),t.on("error",(function(e){t.onerror(e)})),t.on("detachedExit",(function(){})));for(var r=[],a=0,i=["onExit","onAbort","print","printErr"];a<i.length;a++){var o=i[a];l.hasOwnProperty(o)&&r.push(o)}t.postMessage({cmd:"load",handlers:r,urlOrBlob:l.mainScriptUrlOrBlob||e,wasmMemory:D,wasmModule:M})},allocateUnusedWorker:function(){var e,t=S("tfjs-backend-wasm-threaded-simd.worker.js");e=new Worker(t),Ie.unusedWorkers.push(e)},getNewWorker:function(){return 0==Ie.unusedWorkers.length&&(Ie.allocateUnusedWorker(),Ie.loadWasmModuleToWorker(Ie.unusedWorkers[0])),Ie.unusedWorkers.pop()}};function Se(e){for(;e.length>0;)e.shift()(l)}function Ne(e){if(w)return Ze(2,0,e);try{we(e)}catch(st){!function(e){if(e instanceof ye||"unwind"==e)return O;v(1,e)}(st)}}l.PThread=Ie,l.establishStackSpace=function(){var e=Xe(),t=a()[e+52>>2],n=a()[e+56>>2];tt(t,t-n),rt(t)};var Te=[];function Ce(e,t,n,r){return w?Ze(3,1,e,t,n,r):_e(e,t,n,r)}function _e(e,t,n,r){if("undefined"==typeof SharedArrayBuffer)return R("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;var a=[];if(w&&0===a.length)return Ce(e,t,n,r);var i={startRoutine:n,pthread_ptr:e,arg:r,transferList:a};return w?(i.cmd="spawnThread",postMessage(i,a),0):xe(i)}l.invokeEntryPoint=function(e,t){var n=function(e){var t=Te[e];return t||(e>=Te.length&&(Te.length=e+1),Te[e]=t=ee.get(e)),t}(e)(t);ae()?Ie.setExitStatus(n):et(n)};var Ee,Ae=!0;function Re(e){Atomics.store(a(),e>>2,1),Xe()&&Qe(e),Atomics.compareExchange(a(),e>>2,1,0)}function Fe(e){Fe.shown||(Fe.shown={}),Fe.shown[e]||(Fe.shown[e]=1,k&&(e="warning: "+e),R(e))}function Ze(e,t){var n=arguments.length-2,r=arguments;return function(e){var t=nt(),n=e();return rt(t),n}((function(){for(var a=n,i=at(8*a),s=i>>3,u=0;u<n;u++){var c=r[2+u];o()[s+u]=c}return Je(e,a,i,t)}))}l.executeNotifiedProxyingQueue=Re,Ee=k?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:function(){return performance.timeOrigin+performance.now()};var De=[];function Me(e){try{return D.grow(e-z.byteLength+65535>>>16),Q(D.buffer),1}catch(st){}}function Oe(e){return w?Ze(4,1,e):52}function Le(e,t,n,r,a){return w?Ze(5,1,e,t,n,r,a):70}var ze=[null,[],[]];function Pe(e,t){var n=ze[e];0===t||10===t?((1===e?A:R)(Y(n,0)),n.length=0):n.push(t)}function Be(e,t,n,a){if(w)return Ze(6,1,e,t,n,a);for(var o=0,s=0;s<n;s++){var u=i()[t>>2],c=i()[t+4>>2];t+=8;for(var l=0;l<c;l++)Pe(e,r()[u+l]);o+=c}return i()[a>>2]=o,0}function We(e){return l["_"+e]}function Ve(e,t){(D.buffer!=z&&Q(D.buffer),P).set(e,t)}function Ue(e,t,n,a,i){var o={string:function(e){var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);(function(e,t,n){(function(e,t,n,r){if(!(r>0))return 0;for(var a=n,i=n+r-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o)),s<=127){if(n>=i)break;t[n++]=s}else if(s<=2047){if(n+1>=i)break;t[n++]=192|s>>6,t[n++]=128|63&s}else if(s<=65535){if(n+2>=i)break;t[n++]=224|s>>12,t[n++]=128|s>>6&63,t[n++]=128|63&s}else{if(n+3>=i)break;t[n++]=240|s>>18,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|63&s}}t[n]=0})(e,r(),t,n)})(e,t=at(n),n)}return t},array:function(e){var t=at(e.length);return Ve(e,t),t}};var s=We(e),u=[],c=0;if(a)for(var l=0;l<a.length;l++){var p=o[n[l]];p?(0===c&&(c=nt()),u[l]=p(a[l])):u[l]=a[l]}var h,d=s.apply(null,u);return h=d,0!==c&&rt(c),d=function(e){return"string"===t?J(e):"boolean"===t?Boolean(e):e}(h),d}Ie.init();var Ge,He,je,qe=[null,ke,Ne,Ce,Oe,Le,Be],Ke={__emscripten_init_main_thread_js:function(e){Ye(e,!x,1,!b),Ie.threadInitTLS()},__emscripten_thread_cleanup:function(e){w?postMessage({cmd:"cleanupThread",thread:e}):be(e)},__pthread_create_js:_e,_emscripten_default_pthread_stack_size:function(){return 65536},_emscripten_get_now_is_monotonic:function(){return Ae},_emscripten_notify_task_queue:function(e,t,n,r){if(e==t)setTimeout((function(){return Re(r)}));else if(w)postMessage({targetThread:e,cmd:"processProxyingQueue",queue:r});else{var a=Ie.pthreads[e];if(!a)return;a.postMessage({cmd:"processProxyingQueue",queue:r})}return 1},_emscripten_set_offscreencanvas_size:function(e,t,n){return-1},abort:function(){pe("")},emscripten_check_blocking_allowed:function(){k||x||Fe("Blocking on the main thread is very dangerous, see https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread")},emscripten_date_now:function(){return Date.now()},emscripten_get_heap_max:function(){return 2147483648},emscripten_get_now:Ee,emscripten_memcpy_big:function(e,t,n){r().copyWithin(e,t,t+n)},emscripten_num_logical_cores:function(){return k?X().cpus().length:navigator.hardwareConcurrency},emscripten_receive_on_main_thread_js:function(e,t,n){De.length=t;for(var r=n>>3,a=0;a<t;a++)De[a]=o()[r+a];return(e<0?ge[-e-1]:qe[e]).apply(null,De)},emscripten_resize_heap:function(e){var t=r().length;if((e>>>=0)<=t)return!1;var n=2147483648;if(e>n)return!1;for(var a,i,o=1;o<=4;o*=2){var s=t*(1+.2/o);if(s=Math.min(s,e+100663296),Me(Math.min(n,(a=Math.max(e,s))+((i=65536)-a%i)%i)))return!0}return!1},emscripten_unwind_to_js_event_loop:function(){throw"unwind"},exit:we,fd_close:Oe,fd_seek:Le,fd_write:Be,memory:D||l.wasmMemory},Xe=(function(){var e={env:Ke,wasi_snapshot_preview1:Ke};function t(e,t){var n=e.exports;if(l.asm=n,function(e){Ie.tlsInitFunctions.push(e)}(l.asm._emscripten_tls_init),ee=l.asm.__indirect_function_table,function(e){ne.unshift(e)}(l.asm.__wasm_call_ctors),M=t,!w){var r=Ie.unusedWorkers.length;Ie.unusedWorkers.forEach((function(e){Ie.loadWasmModuleToWorker(e,(function(){--r||function(e){if(ue--,l.monitorRunDependencies&&l.monitorRunDependencies(ue),0==ue&&(null!==ce&&(clearInterval(ce),ce=null),le)){var t=le;le=null,t()}}()}))}))}}function n(e){t(e.instance,e.module)}function r(t){return function(){if(!F&&(b||x)){if("function"==typeof fetch&&!me(he))return fetch(he,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+he+"'";return e.arrayBuffer()})).catch((function(){return ve(he)}));if(h)return new Promise((function(e,t){h(he,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return ve(he)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then((function(e){return e})).then(t,(function(e){R("failed to asynchronously prepare wasm: "+e),pe(e)}))}if(w||(ue++,l.monitorRunDependencies&&l.monitorRunDependencies(ue)),l.instantiateWasm)try{return l.instantiateWasm(e,t)}catch(a){R("Module.instantiateWasm callback failed with error: "+a),u(a)}(F||"function"!=typeof WebAssembly.instantiateStreaming||fe(he)||me(he)||k||"function"!=typeof fetch?r(n):fetch(he,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){return R("wasm streaming compile failed: "+e),R("falling back to ArrayBuffer instantiation"),r(n)}))}))).catch(u)}(),l.___wasm_call_ctors=function(){return(l.___wasm_call_ctors=l.asm.__wasm_call_ctors).apply(null,arguments)},l._init=function(){return(l._init=l.asm.init).apply(null,arguments)},l._init_with_threads_count=function(){return(l._init_with_threads_count=l.asm.init_with_threads_count).apply(null,arguments)},l._get_threads_count=function(){return(l._get_threads_count=l.asm.get_threads_count).apply(null,arguments)},l._register_tensor=function(){return(l._register_tensor=l.asm.register_tensor).apply(null,arguments)},l._dispose_data=function(){return(l._dispose_data=l.asm.dispose_data).apply(null,arguments)},l._dispose=function(){return(l._dispose=l.asm.dispose).apply(null,arguments)},l._Abs=function(){return(l._Abs=l.asm.Abs).apply(null,arguments)},l._Add=function(){return(l._Add=l.asm.Add).apply(null,arguments)},l._AddN=function(){return(l._AddN=l.asm.AddN).apply(null,arguments)},l._All=function(){return(l._All=l.asm.All).apply(null,arguments)},l._Any=function(){return(l._Any=l.asm.Any).apply(null,arguments)},l._ArgMax=function(){return(l._ArgMax=l.asm.ArgMax).apply(null,arguments)},l._AvgPool=function(){return(l._AvgPool=l.asm.AvgPool).apply(null,arguments)},l._BatchMatMul=function(){return(l._BatchMatMul=l.asm.BatchMatMul).apply(null,arguments)},l._Ceil=function(){return(l._Ceil=l.asm.Ceil).apply(null,arguments)},l._ClipByValue=function(){return(l._ClipByValue=l.asm.ClipByValue).apply(null,arguments)},l._Conv2D=function(){return(l._Conv2D=l.asm.Conv2D).apply(null,arguments)},l._Conv2DBackpropInput=function(){return(l._Conv2DBackpropInput=l.asm.Conv2DBackpropInput).apply(null,arguments)},l._Cos=function(){return(l._Cos=l.asm.Cos).apply(null,arguments)},l._Cosh=function(){return(l._Cosh=l.asm.Cosh).apply(null,arguments)},l._CropAndResize=function(){return(l._CropAndResize=l.asm.CropAndResize).apply(null,arguments)},l._Cumprod=function(){return(l._Cumprod=l.asm.Cumprod).apply(null,arguments)},l._Cumsum=function(){return(l._Cumsum=l.asm.Cumsum).apply(null,arguments)},l._DepthToSpace=function(){return(l._DepthToSpace=l.asm.DepthToSpace).apply(null,arguments)},l._DepthwiseConv2dNative=function(){return(l._DepthwiseConv2dNative=l.asm.DepthwiseConv2dNative).apply(null,arguments)},l._Elu=function(){return(l._Elu=l.asm.Elu).apply(null,arguments)},l._Equal=function(){return(l._Equal=l.asm.Equal).apply(null,arguments)},l._Exp=function(){return(l._Exp=l.asm.Exp).apply(null,arguments)},l._FlipLeftRight=function(){return(l._FlipLeftRight=l.asm.FlipLeftRight).apply(null,arguments)},l._Floor=function(){return(l._Floor=l.asm.Floor).apply(null,arguments)},l._FloorDiv=function(){return(l._FloorDiv=l.asm.FloorDiv).apply(null,arguments)},l._FusedBatchNorm=function(){return(l._FusedBatchNorm=l.asm.FusedBatchNorm).apply(null,arguments)},l._FusedConv2D=function(){return(l._FusedConv2D=l.asm.FusedConv2D).apply(null,arguments)},l._FusedDepthwiseConv2D=function(){return(l._FusedDepthwiseConv2D=l.asm.FusedDepthwiseConv2D).apply(null,arguments)},l._Gather=function(){return(l._Gather=l.asm.Gather).apply(null,arguments)},l._GatherNd=function(){return(l._GatherNd=l.asm.GatherNd).apply(null,arguments)},l._Greater=function(){return(l._Greater=l.asm.Greater).apply(null,arguments)},l._GreaterEqual=function(){return(l._GreaterEqual=l.asm.GreaterEqual).apply(null,arguments)},l._IsNan=function(){return(l._IsNan=l.asm.IsNan).apply(null,arguments)},l._LeakyRelu=function(){return(l._LeakyRelu=l.asm.LeakyRelu).apply(null,arguments)},l._Less=function(){return(l._Less=l.asm.Less).apply(null,arguments)},l._LessEqual=function(){return(l._LessEqual=l.asm.LessEqual).apply(null,arguments)},l._Log=function(){return(l._Log=l.asm.Log).apply(null,arguments)},l._LogicalAnd=function(){return(l._LogicalAnd=l.asm.LogicalAnd).apply(null,arguments)},l._LogicalNot=function(){return(l._LogicalNot=l.asm.LogicalNot).apply(null,arguments)},l._LogicalOr=function(){return(l._LogicalOr=l.asm.LogicalOr).apply(null,arguments)},l._LogicalXor=function(){return(l._LogicalXor=l.asm.LogicalXor).apply(null,arguments)},l._Max=function(){return(l._Max=l.asm.Max).apply(null,arguments)},l._MaxPool=function(){return(l._MaxPool=l.asm.MaxPool).apply(null,arguments)},l._Maximum=function(){return(l._Maximum=l.asm.Maximum).apply(null,arguments)},l._Mean=function(){return(l._Mean=l.asm.Mean).apply(null,arguments)},l._Min=function(){return(l._Min=l.asm.Min).apply(null,arguments)},l._Minimum=function(){return(l._Minimum=l.asm.Minimum).apply(null,arguments)},l._MirrorPad=function(){return(l._MirrorPad=l.asm.MirrorPad).apply(null,arguments)},l._Multiply=function(){return(l._Multiply=l.asm.Multiply).apply(null,arguments)},l._Neg=function(){return(l._Neg=l.asm.Neg).apply(null,arguments)},l._NonMaxSuppressionV3=function(){return(l._NonMaxSuppressionV3=l.asm.NonMaxSuppressionV3).apply(null,arguments)},l._NonMaxSuppressionV4=function(){return(l._NonMaxSuppressionV4=l.asm.NonMaxSuppressionV4).apply(null,arguments)},l._NonMaxSuppressionV5=function(){return(l._NonMaxSuppressionV5=l.asm.NonMaxSuppressionV5).apply(null,arguments)},l._NotEqual=function(){return(l._NotEqual=l.asm.NotEqual).apply(null,arguments)},l._OneHot=function(){return(l._OneHot=l.asm.OneHot).apply(null,arguments)},l._PadV2=function(){return(l._PadV2=l.asm.PadV2).apply(null,arguments)},l._Pow=function(){return(l._Pow=l.asm.Pow).apply(null,arguments)},l._Prelu=function(){return(l._Prelu=l.asm.Prelu).apply(null,arguments)},l._Prod=function(){return(l._Prod=l.asm.Prod).apply(null,arguments)},l._RealDiv=function(){return(l._RealDiv=l.asm.RealDiv).apply(null,arguments)},l._Reciprocal=function(){return(l._Reciprocal=l.asm.Reciprocal).apply(null,arguments)},l._Relu=function(){return(l._Relu=l.asm.Relu).apply(null,arguments)},l._Relu6=function(){return(l._Relu6=l.asm.Relu6).apply(null,arguments)},l._ResizeBilinear=function(){return(l._ResizeBilinear=l.asm.ResizeBilinear).apply(null,arguments)},l._ResizeNearestNeighbor=function(){return(l._ResizeNearestNeighbor=l.asm.ResizeNearestNeighbor).apply(null,arguments)},l._Reverse=function(){return(l._Reverse=l.asm.Reverse).apply(null,arguments)},l._RotateWithOffset=function(){return(l._RotateWithOffset=l.asm.RotateWithOffset).apply(null,arguments)},l._Round=function(){return(l._Round=l.asm.Round).apply(null,arguments)},l._Rsqrt=function(){return(l._Rsqrt=l.asm.Rsqrt).apply(null,arguments)},l._ScatterNd=function(){return(l._ScatterNd=l.asm.ScatterNd).apply(null,arguments)},l._SelectV2=function(){return(l._SelectV2=l.asm.SelectV2).apply(null,arguments)},l._Sigmoid=function(){return(l._Sigmoid=l.asm.Sigmoid).apply(null,arguments)},l._Sin=function(){return(l._Sin=l.asm.Sin).apply(null,arguments)},l._Softmax=function(){return(l._Softmax=l.asm.Softmax).apply(null,arguments)},l._SparseFillEmptyRows=function(){return(l._SparseFillEmptyRows=l.asm.SparseFillEmptyRows).apply(null,arguments)},l._SparseReshape=function(){return(l._SparseReshape=l.asm.SparseReshape).apply(null,arguments)},l._SparseSegmentReduction=function(){return(l._SparseSegmentReduction=l.asm.SparseSegmentReduction).apply(null,arguments)},l._Sqrt=function(){return(l._Sqrt=l.asm.Sqrt).apply(null,arguments)},l._Square=function(){return(l._Square=l.asm.Square).apply(null,arguments)},l._SquaredDifference=function(){return(l._SquaredDifference=l.asm.SquaredDifference).apply(null,arguments)},l._Step=function(){return(l._Step=l.asm.Step).apply(null,arguments)},l._StridedSlice=function(){return(l._StridedSlice=l.asm.StridedSlice).apply(null,arguments)},l._Sub=function(){return(l._Sub=l.asm.Sub).apply(null,arguments)},l._Sum=function(){return(l._Sum=l.asm.Sum).apply(null,arguments)},l._Tan=function(){return(l._Tan=l.asm.Tan).apply(null,arguments)},l._Tanh=function(){return(l._Tanh=l.asm.Tanh).apply(null,arguments)},l._Tile=function(){return(l._Tile=l.asm.Tile).apply(null,arguments)},l._TopK=function(){return(l._TopK=l.asm.TopK).apply(null,arguments)},l._Transform=function(){return(l._Transform=l.asm.Transform).apply(null,arguments)},l._Transpose=function(){return(l._Transpose=l.asm.Transpose).apply(null,arguments)},l.__FusedMatMul=function(){return(l.__FusedMatMul=l.asm._FusedMatMul).apply(null,arguments)},l._malloc=function(){return(l._malloc=l.asm.malloc).apply(null,arguments)},l._free=function(){return(l._free=l.asm.free).apply(null,arguments)},l.__emscripten_tls_init=function(){return(l.__emscripten_tls_init=l.asm._emscripten_tls_init).apply(null,arguments)},l._pthread_self=function(){return(Xe=l._pthread_self=l.asm.pthread_self).apply(null,arguments)}),Ye=(l.___errno_location=function(){return(l.___errno_location=l.asm.__errno_location).apply(null,arguments)},l.__emscripten_thread_init=function(){return(Ye=l.__emscripten_thread_init=l.asm._emscripten_thread_init).apply(null,arguments)}),Je=(l.__emscripten_thread_crashed=function(){return(l.__emscripten_thread_crashed=l.asm._emscripten_thread_crashed).apply(null,arguments)},l._emscripten_main_thread_process_queued_calls=function(){return(l._emscripten_main_thread_process_queued_calls=l.asm.emscripten_main_thread_process_queued_calls).apply(null,arguments)},l._emscripten_main_browser_thread_id=function(){return(l._emscripten_main_browser_thread_id=l.asm.emscripten_main_browser_thread_id).apply(null,arguments)},l._emscripten_run_in_main_runtime_thread_js=function(){return(Je=l._emscripten_run_in_main_runtime_thread_js=l.asm.emscripten_run_in_main_runtime_thread_js).apply(null,arguments)}),Qe=(l._emscripten_dispatch_to_thread_=function(){return(l._emscripten_dispatch_to_thread_=l.asm.emscripten_dispatch_to_thread_).apply(null,arguments)},l.__emscripten_proxy_execute_task_queue=function(){return(Qe=l.__emscripten_proxy_execute_task_queue=l.asm._emscripten_proxy_execute_task_queue).apply(null,arguments)}),$e=l.__emscripten_thread_free_data=function(){return($e=l.__emscripten_thread_free_data=l.asm._emscripten_thread_free_data).apply(null,arguments)},et=l.__emscripten_thread_exit=function(){return(et=l.__emscripten_thread_exit=l.asm._emscripten_thread_exit).apply(null,arguments)},tt=l._emscripten_stack_set_limits=function(){return(tt=l._emscripten_stack_set_limits=l.asm.emscripten_stack_set_limits).apply(null,arguments)},nt=l.stackSave=function(){return(nt=l.stackSave=l.asm.stackSave).apply(null,arguments)},rt=l.stackRestore=function(){return(rt=l.stackRestore=l.asm.stackRestore).apply(null,arguments)},at=l.stackAlloc=function(){return(at=l.stackAlloc=l.asm.stackAlloc).apply(null,arguments)};l.dynCall_iijjiiii=function(){return(l.dynCall_iijjiiii=l.asm.dynCall_iijjiiii).apply(null,arguments)},l.dynCall_jiji=function(){return(l.dynCall_jiji=l.asm.dynCall_jiji).apply(null,arguments)};function it(e){if(e=e||m,!(ue>0)){if(w)return s(l),ie(),void startWorker(l);(function(){if(l.preRun)for("function"==typeof l.preRun&&(l.preRun=[l.preRun]);l.preRun.length;)oe(l.preRun.shift());Se(te)})(),ue>0||(l.setStatus?(l.setStatus("Running..."),setTimeout((function(){setTimeout((function(){l.setStatus("")}),1),t()}),1)):t())}function t(){Ge||(Ge=!0,l.calledRun=!0,!L&&(ie(),s(l),l.onRuntimeInitialized&&l.onRuntimeInitialized(),function(){if(!w){if(l.postRun)for("function"==typeof l.postRun&&(l.postRun=[l.postRun]);l.postRun.length;)se(l.postRun.shift());Se(re)}}()))}}if(l.keepRuntimeAlive=ae,l.wasmMemory=D,l.cwrap=function(e,t,n,r){var a=(n=n||[]).every((function(e){return"number"===e||"boolean"===e}));return"string"!==t&&a&&!r?We(e):function(){return Ue(e,t,n,arguments)}},l.ExitStatus=ye,l.PThread=Ie,le=function e(){Ge||it(),Ge||(le=e)},l.preInit)for("function"==typeof l.preInit&&(l.preInit=[l.preInit]);l.preInit.length>0;)l.preInit.pop()();if(it(),c&&(He={uncaughtException:process.listeners("uncaughtException").filter((function(e){return!c.uncaughtException.indexOf(e)>-1})),unhandledRejection:process.listeners("unhandledRejection").filter((function(e){return!c.unhandledRejection.indexOf(e)>-1}))}),"undefined"!=typeof WasmBackendModule)je=WasmBackendModule;else{if("undefined"==typeof t)throw new Error("Could not find wasm module in post.js");je=t}if(He){var ot=je._dispose;je._dispose=function(){ot(),He.uncaughtException.forEach((function(e){process.removeListener("uncaughtException",e)})),He.unhandledRejection.forEach((function(e){process.removeListener("unhandledRejection",e)}))}}return t.ready}}();"object"==typeof e&&"object"==typeof t?t.exports=r:"function"==typeof define&&n.amdO?define([],(function(){return r})):"object"==typeof e&&(e.WasmBackendModuleThreadedSimd=r)})),J=E((function(e,t){t.exports.wasmWorkerContents='"use strict";var Module={};var ENVIRONMENT_IS_NODE=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string";if(ENVIRONMENT_IS_NODE){var nodeWorkerThreads=require("worker_threads");var parentPort=nodeWorkerThreads.parentPort;parentPort.on("message",data=>onmessage({data:data}));var fs=require("fs");Object.assign(global,{self:global,require:require,Module:Module,location:{href:__filename},Worker:nodeWorkerThreads.Worker,importScripts:function(f){(0,eval)(fs.readFileSync(f,"utf8")+"//# sourceURL="+f)},postMessage:function(msg){parentPort.postMessage(msg)},performance:global.performance||{now:function(){return Date.now()}}})}var initializedJS=false;var pendingNotifiedProxyingQueues=[];function threadPrintErr(){var text=Array.prototype.slice.call(arguments).join(" ");if(ENVIRONMENT_IS_NODE){fs.writeSync(2,text+"\n");return}console.error(text)}function threadAlert(){var text=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:text,threadId:Module["_pthread_self"]()})}var err=threadPrintErr;self.alert=threadAlert;Module["instantiateWasm"]=(info,receiveInstance)=>{var instance=new WebAssembly.Instance(Module["wasmModule"],info);receiveInstance(instance);Module["wasmModule"]=null;return instance.exports};self.onunhandledrejection=e=>{throw e.reason??e};self.startWorker=instance=>{Module=instance;postMessage({"cmd":"loaded"})};self.onmessage=e=>{try{if(e.data.cmd==="load"){Module["wasmModule"]=e.data.wasmModule;for(const handler of e.data.handlers){Module[handler]=function(){postMessage({cmd:"callHandler",handler:handler,args:[...arguments]})}}Module["wasmMemory"]=e.data.wasmMemory;Module["buffer"]=Module["wasmMemory"].buffer;Module["ENVIRONMENT_IS_PTHREAD"]=true;if(typeof e.data.urlOrBlob=="string"){importScripts(e.data.urlOrBlob)}else{var objectUrl=URL.createObjectURL(e.data.urlOrBlob);importScripts(objectUrl);URL.revokeObjectURL(objectUrl)}WasmBackendModuleThreadedSimd(Module)}else if(e.data.cmd==="run"){Module["__emscripten_thread_init"](e.data.pthread_ptr,0,0,1);Module["establishStackSpace"]();Module["PThread"].receiveObjectTransfer(e.data);Module["PThread"].threadInitTLS();if(!initializedJS){pendingNotifiedProxyingQueues.forEach(queue=>{Module["executeNotifiedProxyingQueue"](queue)});pendingNotifiedProxyingQueues=[];initializedJS=true}try{Module["invokeEntryPoint"](e.data.start_routine,e.data.arg)}catch(ex){if(ex!="unwind"){if(ex instanceof Module["ExitStatus"]){if(Module["keepRuntimeAlive"]()){}else{Module["__emscripten_thread_exit"](ex.status)}}else{throw ex}}}}else if(e.data.cmd==="cancel"){if(Module["_pthread_self"]()){Module["__emscripten_thread_exit"](-1)}}else if(e.data.target==="setimmediate"){}else if(e.data.cmd==="processProxyingQueue"){if(initializedJS){Module["executeNotifiedProxyingQueue"](e.data.queue)}else{pendingNotifiedProxyingQueues.push(e.data.queue)}}else if(e.data.cmd){err("worker.js received unknown command "+e.data.cmd);err(e.data)}}catch(ex){if(Module["__emscripten_thread_crashed"]){Module["__emscripten_thread_crashed"]()}throw ex}};'})),Q=E((function(e,t){var r=function(){var e="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0;return e=e||b,function(t){var n,r,a,i="undefined"!=typeof(t=t||{})?t:{};i.ready=new Promise((function(e,t){n=e,r=t})),"undefined"!=typeof process&&process.listeners&&(a={uncaughtException:process.listeners("uncaughtException"),unhandledRejection:process.listeners("unhandledRejection")});var o,s,u,c=Object.assign({},i),l=[],p="object"==typeof window,h="function"==typeof importScripts,d="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,f="";if(d){var m=H(),v=j();f=h?v.dirname(f)+"/":"//",o=function(e,t){return e=V(e)?new URL(e):v.normalize(e),m.readFileSync(e,t?void 0:"utf8")},u=function(e){var t=o(e,!0);return t.buffer||(t=new Uint8Array(t)),t},s=function(e,t,n){e=V(e)?new URL(e):v.normalize(e),m.readFile(e,(function(e,r){e?n(e):t(r.buffer)}))},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),l=process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof G))throw e})),process.on("unhandledRejection",(function(e){throw e})),function(e,t){if(x)throw process.exitCode=e,t;(function(e){e instanceof G||y("exiting due to exception: "+e)})(t),process.exit(e)},i.inspect=function(){return"[Emscripten Module object]"}}else(p||h)&&(h?f=self.location.href:"undefined"!=typeof document&&document.currentScript&&(f=document.currentScript.src),e&&(f=e),f=0!==f.indexOf("blob:")?f.substr(0,f.replace(/[?#].*/,"").lastIndexOf("/")+1):"",o=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},h&&(u=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),s=function(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)},function(e){return document.title=e});var g=i.print||console.log.bind(console),y=i.printErr||console.warn.bind(console);Object.assign(i,c),c=null,i.arguments&&(l=i.arguments),i.thisProgram&&i.thisProgram,i.quit&&i.quit;var b;i.wasmBinary&&(b=i.wasmBinary);var x=i.noExitRuntime||!0;"object"!=typeof WebAssembly&&L("no native wasm support detected");var k,w=!1;var I,S,N,T,C="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function _(e,t,n){for(var r=t+n,a=t;e[a]&&!(a>=r);)++a;if(a-t>16&&e.buffer&&C)return C.decode(e.subarray(t,a));for(var i="";t<a;){var o=e[t++];if(128&o){var s=63&e[t++];if(192!=(224&o)){var u=63&e[t++];if((o=224==(240&o)?(15&o)<<12|s<<6|u:(7&o)<<18|s<<12|u<<6|63&e[t++])<65536)i+=String.fromCharCode(o);else{var c=o-65536;i+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else i+=String.fromCharCode((31&o)<<6|s)}else i+=String.fromCharCode(o)}return i}function E(e,t){return e?_(N,e,t):""}function A(e){I=e,i.HEAP8=S=new Int8Array(e),i.HEAP16=new Int16Array(e),i.HEAP32=new Int32Array(e),i.HEAPU8=N=new Uint8Array(e),i.HEAPU16=new Uint16Array(e),i.HEAPU32=T=new Uint32Array(e),i.HEAPF32=new Float32Array(e),i.HEAPF64=new Float64Array(e)}i.INITIAL_MEMORY;var R=[],F=[],Z=[];var D=0,M=null,O=null;function L(e){i.onAbort&&i.onAbort(e),y(e="Aborted("+e+")"),w=!0,1,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw r(t),t}var z,P,B="data:application/octet-stream;base64,";function W(e){return e.startsWith(B)}function V(e){return e.startsWith("file://")}function U(e){try{if(e==z&&b)return new Uint8Array(b);if(u)return u(e);throw"both async and sync fetching of the wasm failed"}catch(t){L(t)}}function G(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function q(e){for(;e.length>0;)e.shift()(i)}function K(e){try{return k.grow(e-I.byteLength+65535>>>16),A(k.buffer),1}catch(t){}}W(z="tfjs-backend-wasm.wasm")||(P=z,z=i.locateFile?i.locateFile(P,f):f+P);var X=[null,[],[]];function Y(e,t){var n=X[e];0===t||10===t?((1===e?g:y)(_(n,0)),n.length=0):n.push(t)}function J(e){return i["_"+e]}function Q(e,t,n,r,a){var i={string:function(e){var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);(function(e,t,n){(function(e,t,n,r){if(!(r>0))return 0;for(var a=n,i=n+r-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o)),s<=127){if(n>=i)break;t[n++]=s}else if(s<=2047){if(n+1>=i)break;t[n++]=192|s>>6,t[n++]=128|63&s}else if(s<=65535){if(n+2>=i)break;t[n++]=224|s>>12,t[n++]=128|s>>6&63,t[n++]=128|63&s}else{if(n+3>=i)break;t[n++]=240|s>>18,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|63&s}}t[n]=0})(e,N,t,n)})(e,t=ie(n),n)}return t},array:function(e){var t=ie(e.length);return function(e,t){S.set(e,t)}(e,t),t}};var o=J(e),s=[],u=0;if(r)for(var c=0;c<r.length;c++){var l=i[n[c]];l?(0===u&&(u=re()),s[c]=l(r[c])):s[c]=r[c]}var p,h=o.apply(null,s);return p=h,0!==u&&ae(u),h=function(e){return"string"===t?E(e):"boolean"===t?Boolean(e):e}(p),h}var $,ee,te,ne={abort:function(){L("")},emscripten_get_heap_max:function(){return 2147483648},emscripten_memcpy_big:function(e,t,n){N.copyWithin(e,t,t+n)},emscripten_resize_heap:function(e){var t=N.length,n=2147483648;if((e>>>=0)>n)return!1;for(var r,a,i=1;i<=4;i*=2){var o=t*(1+.2/i);if(o=Math.min(o,e+100663296),K(Math.min(n,(r=Math.max(e,o))+((a=65536)-r%a)%a)))return!0}return!1},fd_close:function(e){return 52},fd_seek:function(e,t,n,r,a){return 70},fd_write:function(e,t,n,r){for(var a=0,i=0;i<n;i++){var o=T[t>>2],s=T[t+4>>2];t+=8;for(var u=0;u<s;u++)Y(e,N[o+u]);a+=s}return T[r>>2]=a,0}},re=(function(){var e={env:ne,wasi_snapshot_preview1:ne};function t(e,t){var n=e.exports;i.asm=n,A((k=i.asm.memory).buffer),i.asm.__indirect_function_table,function(e){F.unshift(e)}(i.asm.__wasm_call_ctors),function(e){if(D--,i.monitorRunDependencies&&i.monitorRunDependencies(D),0==D&&(null!==M&&(clearInterval(M),M=null),O)){var t=O;O=null,t()}}()}function n(e){t(e.instance)}function a(t){return function(){if(!b&&(p||h)){if("function"==typeof fetch&&!V(z))return fetch(z,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+z+"'";return e.arrayBuffer()})).catch((function(){return U(z)}));if(s)return new Promise((function(e,t){s(z,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return U(z)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then((function(e){return e})).then(t,(function(e){y("failed to asynchronously prepare wasm: "+e),L(e)}))}if(D++,i.monitorRunDependencies&&i.monitorRunDependencies(D),i.instantiateWasm)try{return i.instantiateWasm(e,t)}catch(o){y("Module.instantiateWasm callback failed with error: "+o),r(o)}(b||"function"!=typeof WebAssembly.instantiateStreaming||W(z)||V(z)||d||"function"!=typeof fetch?a(n):fetch(z,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){return y("wasm streaming compile failed: "+e),y("falling back to ArrayBuffer instantiation"),a(n)}))}))).catch(r)}(),i.___wasm_call_ctors=function(){return(i.___wasm_call_ctors=i.asm.__wasm_call_ctors).apply(null,arguments)},i._init=function(){return(i._init=i.asm.init).apply(null,arguments)},i._init_with_threads_count=function(){return(i._init_with_threads_count=i.asm.init_with_threads_count).apply(null,arguments)},i._get_threads_count=function(){return(i._get_threads_count=i.asm.get_threads_count).apply(null,arguments)},i._register_tensor=function(){return(i._register_tensor=i.asm.register_tensor).apply(null,arguments)},i._dispose_data=function(){return(i._dispose_data=i.asm.dispose_data).apply(null,arguments)},i._dispose=function(){return(i._dispose=i.asm.dispose).apply(null,arguments)},i._Abs=function(){return(i._Abs=i.asm.Abs).apply(null,arguments)},i._Add=function(){return(i._Add=i.asm.Add).apply(null,arguments)},i._AddN=function(){return(i._AddN=i.asm.AddN).apply(null,arguments)},i._All=function(){return(i._All=i.asm.All).apply(null,arguments)},i._Any=function(){return(i._Any=i.asm.Any).apply(null,arguments)},i._ArgMax=function(){return(i._ArgMax=i.asm.ArgMax).apply(null,arguments)},i._AvgPool=function(){return(i._AvgPool=i.asm.AvgPool).apply(null,arguments)},i._BatchMatMul=function(){return(i._BatchMatMul=i.asm.BatchMatMul).apply(null,arguments)},i._Ceil=function(){return(i._Ceil=i.asm.Ceil).apply(null,arguments)},i._ClipByValue=function(){return(i._ClipByValue=i.asm.ClipByValue).apply(null,arguments)},i._Conv2D=function(){return(i._Conv2D=i.asm.Conv2D).apply(null,arguments)},i._Conv2DBackpropInput=function(){return(i._Conv2DBackpropInput=i.asm.Conv2DBackpropInput).apply(null,arguments)},i._Cos=function(){return(i._Cos=i.asm.Cos).apply(null,arguments)},i._Cosh=function(){return(i._Cosh=i.asm.Cosh).apply(null,arguments)},i._CropAndResize=function(){return(i._CropAndResize=i.asm.CropAndResize).apply(null,arguments)},i._Cumprod=function(){return(i._Cumprod=i.asm.Cumprod).apply(null,arguments)},i._Cumsum=function(){return(i._Cumsum=i.asm.Cumsum).apply(null,arguments)},i._DepthToSpace=function(){return(i._DepthToSpace=i.asm.DepthToSpace).apply(null,arguments)},i._DepthwiseConv2dNative=function(){return(i._DepthwiseConv2dNative=i.asm.DepthwiseConv2dNative).apply(null,arguments)},i._Elu=function(){return(i._Elu=i.asm.Elu).apply(null,arguments)},i._Equal=function(){return(i._Equal=i.asm.Equal).apply(null,arguments)},i._Exp=function(){return(i._Exp=i.asm.Exp).apply(null,arguments)},i._FlipLeftRight=function(){return(i._FlipLeftRight=i.asm.FlipLeftRight).apply(null,arguments)},i._Floor=function(){return(i._Floor=i.asm.Floor).apply(null,arguments)},i._FloorDiv=function(){return(i._FloorDiv=i.asm.FloorDiv).apply(null,arguments)},i._FusedBatchNorm=function(){return(i._FusedBatchNorm=i.asm.FusedBatchNorm).apply(null,arguments)},i._FusedConv2D=function(){return(i._FusedConv2D=i.asm.FusedConv2D).apply(null,arguments)},i._FusedDepthwiseConv2D=function(){return(i._FusedDepthwiseConv2D=i.asm.FusedDepthwiseConv2D).apply(null,arguments)},i._Gather=function(){return(i._Gather=i.asm.Gather).apply(null,arguments)},i._GatherNd=function(){return(i._GatherNd=i.asm.GatherNd).apply(null,arguments)},i._Greater=function(){return(i._Greater=i.asm.Greater).apply(null,arguments)},i._GreaterEqual=function(){return(i._GreaterEqual=i.asm.GreaterEqual).apply(null,arguments)},i._IsNan=function(){return(i._IsNan=i.asm.IsNan).apply(null,arguments)},i._LeakyRelu=function(){return(i._LeakyRelu=i.asm.LeakyRelu).apply(null,arguments)},i._Less=function(){return(i._Less=i.asm.Less).apply(null,arguments)},i._LessEqual=function(){return(i._LessEqual=i.asm.LessEqual).apply(null,arguments)},i._Log=function(){return(i._Log=i.asm.Log).apply(null,arguments)},i._LogicalAnd=function(){return(i._LogicalAnd=i.asm.LogicalAnd).apply(null,arguments)},i._LogicalNot=function(){return(i._LogicalNot=i.asm.LogicalNot).apply(null,arguments)},i._LogicalOr=function(){return(i._LogicalOr=i.asm.LogicalOr).apply(null,arguments)},i._LogicalXor=function(){return(i._LogicalXor=i.asm.LogicalXor).apply(null,arguments)},i._Max=function(){return(i._Max=i.asm.Max).apply(null,arguments)},i._MaxPool=function(){return(i._MaxPool=i.asm.MaxPool).apply(null,arguments)},i._Maximum=function(){return(i._Maximum=i.asm.Maximum).apply(null,arguments)},i._Mean=function(){return(i._Mean=i.asm.Mean).apply(null,arguments)},i._Min=function(){return(i._Min=i.asm.Min).apply(null,arguments)},i._Minimum=function(){return(i._Minimum=i.asm.Minimum).apply(null,arguments)},i._MirrorPad=function(){return(i._MirrorPad=i.asm.MirrorPad).apply(null,arguments)},i._Multiply=function(){return(i._Multiply=i.asm.Multiply).apply(null,arguments)},i._Neg=function(){return(i._Neg=i.asm.Neg).apply(null,arguments)},i._NonMaxSuppressionV3=function(){return(i._NonMaxSuppressionV3=i.asm.NonMaxSuppressionV3).apply(null,arguments)},i._NonMaxSuppressionV4=function(){return(i._NonMaxSuppressionV4=i.asm.NonMaxSuppressionV4).apply(null,arguments)},i._NonMaxSuppressionV5=function(){return(i._NonMaxSuppressionV5=i.asm.NonMaxSuppressionV5).apply(null,arguments)},i._NotEqual=function(){return(i._NotEqual=i.asm.NotEqual).apply(null,arguments)},i._OneHot=function(){return(i._OneHot=i.asm.OneHot).apply(null,arguments)},i._PadV2=function(){return(i._PadV2=i.asm.PadV2).apply(null,arguments)},i._Pow=function(){return(i._Pow=i.asm.Pow).apply(null,arguments)},i._Prelu=function(){return(i._Prelu=i.asm.Prelu).apply(null,arguments)},i._Prod=function(){return(i._Prod=i.asm.Prod).apply(null,arguments)},i._RealDiv=function(){return(i._RealDiv=i.asm.RealDiv).apply(null,arguments)},i._Reciprocal=function(){return(i._Reciprocal=i.asm.Reciprocal).apply(null,arguments)},i._Relu=function(){return(i._Relu=i.asm.Relu).apply(null,arguments)},i._Relu6=function(){return(i._Relu6=i.asm.Relu6).apply(null,arguments)},i._ResizeBilinear=function(){return(i._ResizeBilinear=i.asm.ResizeBilinear).apply(null,arguments)},i._ResizeNearestNeighbor=function(){return(i._ResizeNearestNeighbor=i.asm.ResizeNearestNeighbor).apply(null,arguments)},i._Reverse=function(){return(i._Reverse=i.asm.Reverse).apply(null,arguments)},i._RotateWithOffset=function(){return(i._RotateWithOffset=i.asm.RotateWithOffset).apply(null,arguments)},i._Round=function(){return(i._Round=i.asm.Round).apply(null,arguments)},i._Rsqrt=function(){return(i._Rsqrt=i.asm.Rsqrt).apply(null,arguments)},i._ScatterNd=function(){return(i._ScatterNd=i.asm.ScatterNd).apply(null,arguments)},i._SelectV2=function(){return(i._SelectV2=i.asm.SelectV2).apply(null,arguments)},i._Sigmoid=function(){return(i._Sigmoid=i.asm.Sigmoid).apply(null,arguments)},i._Sin=function(){return(i._Sin=i.asm.Sin).apply(null,arguments)},i._Softmax=function(){return(i._Softmax=i.asm.Softmax).apply(null,arguments)},i._SparseFillEmptyRows=function(){return(i._SparseFillEmptyRows=i.asm.SparseFillEmptyRows).apply(null,arguments)},i._SparseReshape=function(){return(i._SparseReshape=i.asm.SparseReshape).apply(null,arguments)},i._SparseSegmentReduction=function(){return(i._SparseSegmentReduction=i.asm.SparseSegmentReduction).apply(null,arguments)},i._Sqrt=function(){return(i._Sqrt=i.asm.Sqrt).apply(null,arguments)},i._Square=function(){return(i._Square=i.asm.Square).apply(null,arguments)},i._SquaredDifference=function(){return(i._SquaredDifference=i.asm.SquaredDifference).apply(null,arguments)},i._Step=function(){return(i._Step=i.asm.Step).apply(null,arguments)},i._StridedSlice=function(){return(i._StridedSlice=i.asm.StridedSlice).apply(null,arguments)},i._Sub=function(){return(i._Sub=i.asm.Sub).apply(null,arguments)},i._Sum=function(){return(i._Sum=i.asm.Sum).apply(null,arguments)},i._Tan=function(){return(i._Tan=i.asm.Tan).apply(null,arguments)},i._Tanh=function(){return(i._Tanh=i.asm.Tanh).apply(null,arguments)},i._Tile=function(){return(i._Tile=i.asm.Tile).apply(null,arguments)},i._TopK=function(){return(i._TopK=i.asm.TopK).apply(null,arguments)},i._Transform=function(){return(i._Transform=i.asm.Transform).apply(null,arguments)},i._Transpose=function(){return(i._Transpose=i.asm.Transpose).apply(null,arguments)},i.__FusedMatMul=function(){return(i.__FusedMatMul=i.asm._FusedMatMul).apply(null,arguments)},i._malloc=function(){return(i._malloc=i.asm.malloc).apply(null,arguments)},i._free=function(){return(i._free=i.asm.free).apply(null,arguments)},i.___errno_location=function(){return(i.___errno_location=i.asm.__errno_location).apply(null,arguments)},i.stackSave=function(){return(re=i.stackSave=i.asm.stackSave).apply(null,arguments)}),ae=i.stackRestore=function(){return(ae=i.stackRestore=i.asm.stackRestore).apply(null,arguments)},ie=i.stackAlloc=function(){return(ie=i.stackAlloc=i.asm.stackAlloc).apply(null,arguments)};i.dynCall_iijjiiii=function(){return(i.dynCall_iijjiiii=i.asm.dynCall_iijjiiii).apply(null,arguments)},i.dynCall_jiji=function(){return(i.dynCall_jiji=i.asm.dynCall_jiji).apply(null,arguments)};function oe(e){function t(){$||($=!0,i.calledRun=!0,!w&&(!0,q(F),n(i),i.onRuntimeInitialized&&i.onRuntimeInitialized(),function(){if(i.postRun)for("function"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)e=i.postRun.shift(),Z.unshift(e);var e;q(Z)}()))}e=e||l,D>0||(function(){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)e=i.preRun.shift(),R.unshift(e);var e;q(R)}(),D>0)||(i.setStatus?(i.setStatus("Running..."),setTimeout((function(){setTimeout((function(){i.setStatus("")}),1),t()}),1)):t())}if(i.cwrap=function(e,t,n,r){var a=(n=n||[]).every((function(e){return"number"===e||"boolean"===e}));return"string"!==t&&a&&!r?J(e):function(){return Q(e,t,n,arguments)}},O=function e(){$||oe(),$||(O=e)},i.preInit)for("function"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();if(oe(),a&&(ee={uncaughtException:process.listeners("uncaughtException").filter((function(e){return!a.uncaughtException.indexOf(e)>-1})),unhandledRejection:process.listeners("unhandledRejection").filter((function(e){return!a.unhandledRejection.indexOf(e)>-1}))}),"undefined"!=typeof t)te=t;else{if("undefined"==typeof WasmBackendModuleThreadedSimd)throw new Error("Could not find wasm module in post.js");te=WasmBackendModuleThreadedSimd}if(ee){var se=te._dispose;te._dispose=function(){se(),ee.uncaughtException.forEach((function(e){process.removeListener("uncaughtException",e)})),ee.unhandledRejection.forEach((function(e){process.removeListener("unhandledRejection",e)}))}}return t.ready}}();"object"==typeof e&&"object"==typeof t?t.exports=r:"function"==typeof define&&n.amdO?define([],(function(){return r})):"object"==typeof e&&(e.WasmBackendModule=r)})),$=function(){function e(t,n){(0,m.Z)(this,e),this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return(0,v.Z)(e,[{key:"get",value:function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}},{key:"set",value:function(e,t){this.dataIdsCount++,this.data.set(e,t)}},{key:"has",value:function(e){return this.data.has(e)}},{key:"delete",value:function(e){return this.dataIdsCount--,this.data.delete(e)}},{key:"numDataIds",value:function(){return this.dataIdsCount}}]),e}(),ee=function(){function e(){(0,m.Z)(this,e)}return(0,v.Z)(e,[{key:"refCount",value:function(e){return te("refCount")}},{key:"incRef",value:function(e){return te("incRef")}},{key:"timerAvailable",value:function(){return!0}},{key:"time",value:function(e){return te("time")}},{key:"read",value:function(e){return te("read")}},{key:"readSync",value:function(e){return te("readSync")}},{key:"readToGPU",value:function(e,t){return te("readToGPU")}},{key:"numDataIds",value:function(){return te("numDataIds")}},{key:"disposeData",value:function(e,t){return te("disposeData")}},{key:"write",value:function(e,t,n){return te("write")}},{key:"move",value:function(e,t,n,r,a){return te("move")}},{key:"createTensorFromGPUData",value:function(e,t,n){return te("createTensorFromGPUData")}},{key:"memory",value:function(){return te("memory")}},{key:"floatPrecision",value:function(){return te("floatPrecision")}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"dispose",value:function(){return te("dispose")}}]),e}();function te(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen"))}function ne(e){for(var t=e.length,n=0;t>0;)n=Math.random()*t|0,oe(e,--t,n)}function re(e,t){if(e.length!==t.length)throw new Error("Array sizes must match to be shuffled together First array length was ".concat(e.length,"Second array length was ").concat(t.length));for(var n=e.length,r=0;n>0;)r=Math.random()*n|0,oe(e,--n,r),oe(t,n,r)}function ae(e,t,n){return Math.max(e,Math.min(t,n))}function ie(e){return e%2===0?e:e+1}function oe(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function se(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function ue(e,t){var n=Math.random();return t*n+(1-n)*e}function ce(e,t){for(var n=0,r=0;r<e.length;r++){var a=Number(e[r])-Number(t[r]);n+=a*a}return n}function le(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function pe(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";le(me(e,t),(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}function he(e){le(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function de(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function fe(e){return 0===e.length}function me(e,t){if(e===t)return!0;if(null==e||null==t||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function ve(e){return e%1===0}function ge(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function ye(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function be(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return ne(t),t}function xe(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function ke(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return 0},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return new Promise((function(a,i){var o=0;!function s(){if(e())a();else{o++;var u=t(o);null!=n&&o>=n?i():null!=r?r(s,u):setTimeout(s,u)}}()}))}function we(e,t){for(var n=1,r=-1,a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim ".concat(r," and dim ").concat(a));r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found ".concat(e[a]," at dim ").concat(a));if(-1===r){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when there are 0 elements"));if(t%n!==0)throw Error("The implicit shape can't be a fractional number. Got ".concat(t," / ").concat(n));var i=e.slice();return i[r]=t/n,i}function Ie(e,t){var n=t.length;return le((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-".concat(n,", ").concat(n,") but got axis ").concat(e)})),le(e.every((function(e){return ve(e)})),(function(){return"All values in axis param must be integers but got axis ".concat(e)})),e.map((function(e){return e<0?n+e:e}))}function Se(e,t){for(var n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:Ie(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=i){if(i[o]===s&&1!==e[s])throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(e[s],"' is not 1"));(null==i[o]||i[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),i[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function Ne(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type ".concat(e));n=new Uint8Array(t)}return n}function Te(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type ".concat(e));n=new Array(t)}return n}function Ce(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(r,"."))}}function _e(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function Ee(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)}function Ae(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype ".concat(e))}function Re(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}function Fe(e){return"string"==typeof e||e instanceof String}function Ze(e){return"boolean"==typeof e}function De(e){return"number"==typeof e}function Me(e){return Array.isArray(e)?Me(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":De(e)?"float32":Fe(e)?"string":Ze(e)?"bool":"float32"}function Oe(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Le(e,t){for(var n=t;n<e;++n)if(e%n===0)return n;return e}function ze(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function Pe(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=new Array;if(1===t.length)for(var i=t[0]*(r?2:1),o=0;o<i;o++)a[o]=n[e+o];else for(var s=t[0],u=t.slice(1),c=u.reduce((function(e,t){return e*t}))*(r?2:1),l=0;l<s;l++)a[l]=Pe(e+l*c,u,n,r);return a}function Be(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0===e.length)return t[0];var r=e.reduce((function(e,t){return e*t}))*(n?2:1);if(0===r)return[];if(r!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length).concat(n?" for a complex tensor":"","."));return Pe(0,e,t,n)}function We(e,t){if(Array.isArray(e))return e;if("float32"===t)return e instanceof Float32Array?e:new Float32Array(e);if("int32"===t)return e instanceof Int32Array?e:new Int32Array(e);if("bool"===t||"string"===t)return Uint8Array.from(new Int32Array(e));throw new Error("Unknown dtype ".concat(t))}function Ve(e,t){for(var n=Ue(e,t),r=0;r<n.length;r++)n[r]=1;return n}function Ue(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type ".concat(t))}function Ge(e,t){var n=e.reduce((function(e,t){return e*t}),1);if(null==t||"float32"===t)return Be(e,new Float32Array(n));if("int32"===t)return Be(e,new Int32Array(n));if("bool"===t)return Be(e,new Uint8Array(n));throw new Error("Unknown data type ".concat(t))}function He(e){e.forEach((function(t){le(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape [".concat(e,"].")}))}))}function je(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function qe(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}function Ke(e){return e&&e.then&&"function"==typeof e.then}var Xe="tfjsflags",Ye=function(){function e(t){(0,m.Z)(this,e),this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Je,this.populateURLFlags()}return(0,v.Z)(e,[{key:"setPlatform",value:function(e,t){null!=this.platform&&(Qe().getBool("IS_TEST")||Qe().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. Overwriting the platform with ").concat(e,"."))),this.platformName=e,this.platform=t}},{key:"registerFlag",value:function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];Qe().getBool("IS_TEST")||Qe().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(r,".")),this.set(e,r)}}},{key:"getAsync",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this.flags)){e.next=4;break}e.t0=this.flags[t],e.next=8;break;case 4:return e.next=6,this.evaluateFlag(t);case 6:this.flags[t]=e.sent,e.t0=this.flags[t];case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(Ke(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. Please use getAsync() instead."));return this.flags[e]=t,this.flags[e]}},{key:"getNumber",value:function(e){return this.get(e)}},{key:"getBool",value:function(e){return this.get(e)}},{key:"getFlags",value:function(){return this.flags}},{key:"features",get:function(){return this.flags}},{key:"set",value:function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}},{key:"evaluateFlag",value:function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}},{key:"setFlags",value:function(e){this.flags=Object.assign({},e)}},{key:"reset",value:function(){this.flags={},this.urlFlags={},this.populateURLFlags()}},{key:"populateURLFlags",value:function(){var e=this;if("undefined"!=typeof this.global&&"undefined"!=typeof this.global.location&&"undefined"!=typeof this.global.location.search){var t=this.getQueryParams(this.global.location.search);Xe in t&&t[Xe].split(",").forEach((function(t){var n=t.split(":"),r=(0,h.Z)(n,2),a=r[0],i=r[1];e.urlFlags[a]=function(e,t){if(t=t.toLowerCase(),"true"===t||"false"===t)return"true"===t;if("".concat(+t)===t)return+t;throw new Error("Could not parse value flag value ".concat(t," for flag ").concat(e,"."))}(a,i)}))}}}]),e}();function Je(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,r[0],r[1]),r.join("=")})),t}function Qe(){return et}var $e,et=null;function tt(){if(null==$e){var e;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof n.g)e=n.g;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}$e=e}return $e}function nt(e,t){var n=function(){var e=tt();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);var r=t();return n.set(e,r),n.get(e)}var rt="Abs",at="Acos",it="Acosh",ot="Add",st="AddN",ut="All",ct="Any",lt="ArgMax",pt="ArgMin",ht="Asin",dt="Asinh",ft="Atan",mt="Atanh",vt="Atan2",gt="AvgPool",yt="AvgPoolGrad",bt="AvgPool3D",xt="AvgPool3DGrad",kt="BatchMatMul",wt="BatchToSpaceND",It="Bincount",St="BroadcastTo",Nt="BroadcastArgs",Tt="Cast",Ct="Ceil",_t="ClipByValue",Et="Complex",At="ComplexAbs",Rt="Concat",Ft="Conv2D",Zt="Conv2DBackpropFilter",Dt="Conv2DBackpropInput",Mt="Conv3D",Ot="Conv3DBackpropFilterV2",Lt="Conv3DBackpropInputV2",zt="Cos",Pt="Cosh",Bt="Cumprod",Wt="Cumsum",Vt="CropAndResize",Ut="DenseBincount",Gt="DepthToSpace",Ht="DepthwiseConv2dNative",jt="DepthwiseConv2dNativeBackpropFilter",qt="DepthwiseConv2dNativeBackpropInput",Kt="Diag",Xt="Dilation2D",Yt="Dilation2DBackpropInput",Jt="Dilation2DBackpropFilter",Qt="RealDiv",$t="Einsum",en="Elu",tn="EluGrad",nn="Erf",rn="Equal",an="Exp",on="ExpandDims",sn="Expm1",un="FFT",cn="Fill",ln="FlipLeftRight",pn="Floor",hn="FloorDiv",dn="FusedBatchNorm",fn="GatherV2",mn="GatherNd",vn="Greater",gn="GreaterEqual",yn="Identity",bn="IFFT",xn="Imag",kn="IsFinite",wn="IsInf",In="IsNan",Sn="LeakyRelu",Nn="Less",Tn="LessEqual",Cn="LinSpace",_n="Log",En="Log1p",An="LogicalAnd",Rn="LogicalNot",Fn="LogicalOr",Zn="LogicalXor",Dn="LogSoftmax",Mn="LowerBound",On="LRN",Ln="LRNGrad",zn="Max",Pn="Maximum",Bn="MaxPool",Wn="MaxPoolGrad",Vn="MaxPool3D",Un="MaxPool3DGrad",Gn="MaxPoolWithArgmax",Hn="Mean",jn="Min",qn="Minimum",Kn="MirrorPad",Xn="Mod",Yn="Multinomial",Jn="Multiply",Qn="Neg",$n="NotEqual",er="NonMaxSuppressionV3",tr="NonMaxSuppressionV4",nr="NonMaxSuppressionV5",rr="OnesLike",ar="OneHot",ir="Pack",or="PadV2",sr="Pool",ur="Pow",cr="Prelu",lr="Prod",pr="RaggedGather",hr="RaggedRange",dr="RaggedTensorToTensor",fr="Range",mr="Real",vr="Reciprocal",gr="Relu",yr="Reshape",br="ResizeNearestNeighbor",xr="ResizeNearestNeighborGrad",kr="ResizeBilinear",wr="ResizeBilinearGrad",Ir="Relu6",Sr="Reverse",Nr="Round",Tr="Rsqrt",Cr="ScatterNd",_r="SearchSorted",Er="Select",Ar="Selu",Rr="Slice",Fr="Sin",Zr="Sinh",Dr="Sign",Mr="Sigmoid",Or="Softplus",Lr="Sqrt",zr="Sum",Pr="SpaceToBatchND",Br="SplitV",Wr="Softmax",Vr="SparseFillEmptyRows",Ur="SparseReshape",Gr="SparseSegmentMean",Hr="SparseSegmentSum",jr="SparseToDense",qr="SquaredDifference",Kr="Square",Xr="StridedSlice",Yr="StringNGrams",Jr="StringSplit",Qr="StringToHashBucketFast",$r="Sub",ea="Tan",ta="Tanh",na="Tile",ra="TopK",aa="Transform",ia="Transpose",oa="Unique",sa="Unpack",ua="UnsortedSegmentSum",ca="UpperBound",la="ZerosLike",pa="Step",ha="FromPixels",da="RotateWithOffset",fa="_FusedMatMul",ma="FusedConv2D",va="FusedDepthwiseConv2D";function ga(){var e;Qe().getBool("IS_TEST")||Qe().getBool("PROD")||(e=console).warn.apply(e,arguments)}function ya(){var e;Qe().getBool("IS_TEST")||Qe().getBool("PROD")||(e=console).log.apply(e,arguments)}var ba=nt("kernelRegistry",(function(){return new Map})),xa=nt("gradRegistry",(function(){return new Map}));function ka(e,t){var n=Ea(e,t);return ba.get(n)}function wa(e){return xa.get(e)}function Ia(e){for(var t=ba.entries(),n=[];;){var r=t.next(),a=r.done,i=r.value;if(a)break;var o=(0,h.Z)(i,2),s=o[0],u=o[1],c=s.split("_");(0,h.Z)(c,1)[0]===e&&n.push(u)}return n}function Sa(e){var t=e.kernelName,n=e.backendName,r=Ea(t,n);ba.has(r)&&ga("The kernel '".concat(t,"' for backend '").concat(n,"' is already registered")),ba.set(r,e)}function Na(e){var t=e.kernelName;xa.has(t)&&Qe().getBool("DEBUG")&&ga("Overriding the gradient for '".concat(t,"'")),xa.set(t,e)}function Ta(e,t){var n=Ea(e,t);if(!ba.has(n))throw new Error("The kernel '".concat(e,"' for backend '").concat(t,"' is not registered"));ba.delete(n)}function Ca(e){if(!xa.has(e))throw new Error("The gradient '".concat(e,"' for backend is not registered"));xa.delete(e)}function _a(e,t){Ia(e).forEach((function(e){Sa(Object.assign({},e,{backendName:t}))}))}function Ea(e,t){return"".concat(t,"_").concat(e)}var Aa={};A(Aa,{arraysEqual:function(){return me},assert:function(){return le},assertNonNegativeIntegerDimensions:function(){return He},assertNonNull:function(){return he},assertShapesMatch:function(){return pe},bytesFromStringArray:function(){return Re},bytesPerElement:function(){return Ae},checkConversionForErrors:function(){return Ce},clamp:function(){return ae},computeStrides:function(){return ze},convertBackendValuesAndArrayBuffer:function(){return We},createScalarValue:function(){return Ha},createShuffledIndices:function(){return be},decodeString:function(){return Ya},distSquared:function(){return ce},encodeString:function(){return Xa},fetch:function(){return Ka},fingerPrint64:function(){return Ga},flatten:function(){return Qa},getArrayFromDType:function(){return Te},getTypedArrayFromDType:function(){return Ne},hasEncodingLoss:function(){return Ee},hexToLong:function(){return Za},indexToLoc:function(){return qe},inferDtype:function(){return Me},inferFromImplicitShape:function(){return we},isBoolean:function(){return Ze},isFunction:function(){return Oe},isInt:function(){return ve},isNumber:function(){return De},isPromise:function(){return Ke},isScalarShape:function(){return fe},isString:function(){return Fe},isTypedArray:function(){return Ja},isValidDtype:function(){return _e},locToIndex:function(){return je},makeOnesTypedArray:function(){return Ve},makeZerosNestedTypedArray:function(){return Ge},makeZerosTypedArray:function(){return Ue},nearestDivisor:function(){return Le},nearestLargerEven:function(){return ie},now:function(){return qa},parseAxisParam:function(){return Ie},randUniform:function(){return ue},repeatedTry:function(){return ke},rightPad:function(){return xe},shuffle:function(){return ne},shuffleCombo:function(){return re},sizeFromShape:function(){return de},sizeToSquarishShape:function(){return ye},squeezeShape:function(){return Se},sum:function(){return se},swap:function(){return oe},tanh:function(){return ge},toNestedArray:function(){return Be},toTypedArray:function(){return ja}});var Ra=R(F()),Fa=Ra.default||Ra;function Za(e){return Fa.fromString(e,!0,16)}var Da=Za("c3a5c85c97cb3127"),Ma=Za("b492b66fbe98f273"),Oa=Za("9ae16a3b2f90404f");function La(e){return e.xor(e.shru(47))}function za(e,t,n){var r=e.slice(t,t+n);return Fa.fromBytes(Array.from(r),!0,!0)}function Pa(e,t){return za(e,t,8)}function Ba(e,t){return za(e,t,4)}function Wa(e,t){return 0===t?e:e.shru(t).or(e.shl(64-t))}function Va(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Za("9ddfea08eb382d69"),r=e.xor(t).mul(n);r=r.xor(r.shru(47));var a=t.xor(r).mul(n);return a=(a=a.xor(a.shru(47))).mul(n)}function Ua(e,t,n,r){return function(e,t,n,r,a,i){a=a.add(e),i=Wa(i.add(a).add(r),21);var o=a;return a=(a=a.add(t)).add(n),i=i.add(Wa(a,44)),[a.add(r),i.add(o)]}(Pa(e,t),Pa(e,t+8),Pa(e,t+16),Pa(e,t+24),n,r)}function Ga(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,r=Fa.fromNumber(81,!0);if(n<=32)return n<=16?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;if(t>=8){var n=Oa.add(2*t),r=Pa(e,0).add(Oa),a=Pa(e,t-8);return Va(Wa(a,37).mul(n).add(r),Wa(r,25).add(a).mul(n),n)}if(t>=4){var i=Oa.add(2*t);return Va(Ba(e,0).shl(3).add(t),Ba(e,t-4),i)}if(t>0){var o=e[0]+(e[t>>1]<<8),s=t+(e[t-1]<<2);return La(Oa.mul(o).xor(Da.mul(s))).mul(Oa)}return Oa}(e,n):function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=Oa.add(2*t),r=Pa(e,0).mul(Ma),a=Pa(e,8),i=Pa(e,t-8).mul(n),o=Pa(e,t-16).mul(Oa);return Va(Wa(r.add(a),43).add(Wa(i,30)).add(o),r.add(Wa(a.add(Oa),18)).add(i),n)}(e,n);if(n<=64)return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=Oa.add(2*t),r=Pa(e,0).mul(Oa),a=Pa(e,8),i=Pa(e,t-8).mul(n),o=Pa(e,t-16).mul(Oa),s=Wa(r.add(a),43).add(Wa(i,30)).add(o),u=Va(s,r.add(Wa(a.add(Oa),18)).add(i),n),c=Pa(e,16).mul(n),l=Pa(e,24),p=s.add(Pa(e,t-32)).mul(n),h=u.add(Pa(e,t-24)).mul(n);return Va(Wa(c.add(l),43).add(Wa(p,30)).add(h),c.add(Wa(l.add(r),18)).add(p),n)}(e,n);var a=r,i=r.mul(Ma).add(113),o=La(i.mul(Oa).add(113)).mul(Oa),s=[Fa.UZERO,Fa.UZERO],u=[Fa.UZERO,Fa.UZERO];a=a.mul(Oa).add(Pa(e,0));var c=0,l=64*(n-1>>6),p=l+(n-1&63)-63;do{var h;a=Wa(a.add(i).add(s[0]).add(Pa(e,c+8)),37).mul(Ma),i=Wa(i.add(s[1]).add(Pa(e,c+48)),42).mul(Ma),a=a.xor(u[1]),i=i.add(s[0]).add(Pa(e,c+40)),o=Wa(o.add(u[0]),33).mul(Ma),s=Ua(e,c,s[1].mul(Ma),a.add(u[0])),u=Ua(e,c+32,o.add(u[1]),i.add(Pa(e,c+16))),o=(h=[a,o])[0],a=h[1],c+=64}while(c!==l);var d=Ma.add(o.and(255).shl(1));return c=p,u[0]=u[0].add(n-1&63),s[0]=s[0].add(u[0]),u[0]=u[0].add(s[0]),a=Wa(a.add(i).add(s[0]).add(Pa(e,c+8)),37).mul(d),i=Wa(i.add(s[1]).add(Pa(e,c+48)),42).mul(d),a=a.xor(u[1].mul(9)),i=i.add(s[0].mul(9).add(Pa(e,c+40))),o=Wa(o.add(u[0]),33).mul(d),s=Ua(e,c,s[1].mul(d),a.add(u[0])),u=Ua(e,c+32,o.add(u[1]),i.add(Pa(e,c+16))),o=(t=[a,o])[0],a=t[1],Va(Va(s[0],u[0],d).add(La(i).mul(Da)).add(o),Va(s[1],u[1],d).add(a),d)}function Ha(e,t){return"string"===t?Xa(e):ja([e],t)}function ja(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=Qa(e)),Qe().getBool("DEBUG")&&Ce(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var n=new Uint8Array(e.length),r=0;r<n.length;++r)0!==Math.round(e[r])&&(n[r]=1);return n}throw new Error("Unknown data type ".concat(t))}function qa(){return Qe().platform.now()}function Ka(e,t){return Qe().platform.fetch(e,t)}function Xa(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",Qe().platform.encode(e,t)}function Ya(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",Qe().platform.decode(e,t)}function Ja(e){return Qe().platform.isTypedArray(e)}function Qa(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),"boolean"==typeof e||"number"==typeof e||"string"==typeof e||Ke(e)||null==e||Ja(e)&&n)t.push(e);else if(Array.isArray(e)||Ja(e))for(var r=0;r<e.length;++r)Qa(e[r],t,n);else{for(var a=-1,i=0,o=Object.keys(e);i<o.length;i++){var s=o[i];/^([1-9]+[0-9]*|0)$/.test(s)&&(a=Math.max(a,Number(s)))}for(var u=0;u<=a;u++)Qa(e[u],t,n)}return t}var $a=function(){function e(t,n){(0,m.Z)(this,e),this.backendTimer=t,this.logger=n,null==n&&(this.logger=new ei)}return(0,v.Z)(e,[{key:"profileKernel",value:function(e,t,n){var r,a,i=function(){r=n()},o=qa();if(this.backendTimer.timerAvailable())a=this.backendTimer.time(i);else{i();var s,u=(0,y.Z)(r);try{for(u.s();!(s=u.n()).done;){s.value.dataSync()}}catch(p){u.e(p)}finally{u.f()}a=Promise.resolve({kernelMs:qa()-o})}if(Qe().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var c=function(){var t=r[l];t.data().then((function(n){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var a=e[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(n,"'")),!0}}(n,t.dtype,e)}))},l=0;l<r.length;l++)c();return{kernelName:e,outputs:r,inputs:t,timeMs:a.then((function(e){return e.kernelMs})),extraInfo:a.then((function(e){return null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""}))}}},{key:"logKernelProfile",value:function(e){var t=this,n=e.kernelName,r=e.outputs,a=e.timeMs,i=e.inputs,o=e.extraInfo;r.forEach((function(e){Promise.all([e.data(),a,o]).then((function(r){t.logger.logKernelProfile(n,e,r[0],r[1],i,r[2])}))}))}}]),e}();var ei=function(){function e(){(0,m.Z)(this,e)}return(0,v.Z)(e,[{key:"logKernelProfile",value:function(e,t,n,r,a,i){var o="number"==typeof r?xe("".concat(r,"ms"),9):r.error,s=xe(e,25),u=t.rank,c=t.size,l=xe(t.shape.toString(),14),p="";for(var h in a){var d=a[h];if(null!=d){var f=d.shape||t.shape,m=f.length;p+="".concat(h,": ").concat(m,"D ").concat(m>0?f:""," ")}}console.log("%c".concat(s,"\t%c").concat(o,"\t%c").concat(u,"D ").concat(l,"\t%c").concat(c,"\t%c").concat(p,"\t%c").concat(i),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}]),e}();var ti=20,ni=3,ri=7;function ai(e,t,n,r){var a=ze(t),i=function(e,t,n,r){var a=de(t),i=r[r.length-1],o=new Array(i).fill(0),s=t.length,u="complex64"===n?ui(e):e;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,p=0;p<i;p++)o[p]=Math.max(o[p],ii(u[l+p],0,n).length);return o}(e,t,n,a),o=t.length,s=si(e,t,n,a,i),u=["Tensor"];return r&&(u.push("  dtype: ".concat(n)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(t,"]")),u.push("  values:")),u.push(s.map((function(e){return"    "+e})).join("\n")),u.join("\n")}function ii(e,t,n){return xe(Array.isArray(e)?"".concat(parseFloat(e[0].toFixed(ri))," + ").concat(parseFloat(e[1].toFixed(ri)),"j"):Fe(e)?"'".concat(e,"'"):"bool"===n?oi(e):parseFloat(e.toFixed(ri)).toString(),t)}function oi(e){return 0===e?"false":"true"}function si(e,t,n,r,a){var i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o="complex64"===n?2:1,s=t[0],u=t.length;if(0===u)return"complex64"===n?[ii(ui(e)[0],0,n)]:"bool"===n?[oi(e[0])]:[e[0].toString()];if(1===u){if(s>ti){var c=ni*o,l=Array.from(e.slice(0,c)),p=Array.from(e.slice((s-ni)*o,s*o));return"complex64"===n&&(l=ui(l),p=ui(p)),["["+l.map((function(e,t){return ii(e,a[t],n)})).join(", ")+", ..., "+p.map((function(e,t){return ii(e,a[s-ni+t],n)})).join(", ")+"]"]}return["["+("complex64"===n?ui(e):Array.from(e)).map((function(e,t){return ii(e,a[t],n)})).join(", ")+"]"]}var h=t.slice(1),d=r.slice(1),f=r[0]*o,m=[];if(s>ti){for(var v=0;v<ni;v++){var y=v*f,b=y+f;m.push.apply(m,(0,g.Z)(si(e.slice(y,b),h,n,d,a,!1)))}m.push("...");for(var x=s-ni;x<s;x++){var k=x*f,w=k+f;m.push.apply(m,(0,g.Z)(si(e.slice(k,w),h,n,d,a,x===s-1)))}}else for(var I=0;I<s;I++){var S=I*f,N=S+f;m.push.apply(m,(0,g.Z)(si(e.slice(S,N),h,n,d,a,I===s-1)))}var T=2===u?",":"";m[0]="["+(s>0?m[0]+T:"");for(var C=1;C<m.length-1;C++)m[C]=" "+m[C]+T;for(var _=",\n",E=2;E<u;E++)_+="\n";return m[m.length-1]=" "+m[m.length-1]+"]"+(i?"":_),m}function ui(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var ci=function(){function e(t,n,r){var a=this;if((0,m.Z)(this,e),this.dtype=n,this.shape=t.slice(),this.size=de(t),null!=r){var i=r.length;le(i===this.size,(function(){return"Length of values '".concat(i,"' does not match the size inferred by the shape '").concat(a.size,"'.")}))}if("complex64"===n)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Te(n,this.size),this.strides=ze(t)}return(0,v.Z)(e,[{key:"set",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];0===r.length&&(r=[0]),le(r.length===this.rank,(function(){return"The number of provided coordinates (".concat(r.length,") must match the rank (").concat(t.rank,")")}));var i=this.locToIndex(r);this.values[i]=e}},{key:"get",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);for(var r=0,a=0,i=t;a<i.length;a++){var o=i[a];if(o<0||o>=this.shape[r]){var s="Requested out of range element at ".concat(t,".   Buffer shape=").concat(this.shape);throw new Error(s)}r++}for(var u=t[t.length-1],c=0;c<t.length-1;++c)u+=this.strides[c]*t[c];return this.values[u]}},{key:"locToIndex",value:function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}},{key:"indexToLoc",value:function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}},{key:"rank",get:function(){return this.shape.length}},{key:"toTensor",value:function(){return li().makeTensor(this.values,this.shape,this.dtype)}}]),e}(),li=null,pi=null;var hi=function(){function e(t,n,r,a){(0,m.Z)(this,e),this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=de(t),this.strides=ze(t),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return(0,v.Z)(e,[{key:"rank",get:function(){return this.shape.length}},{key:"buffer",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",pi.buffer(this.shape,this.dtype,t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"bufferSync",value:function(){return pi.buffer(this.shape,this.dtype,this.dataSync())}},{key:"array",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",Be(this.shape,t,"complex64"===this.dtype));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"arraySync",value:function(){return Be(this.shape,this.dataSync(),"complex64"===this.dtype)}},{key:"data",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.throwIfDisposed(),t=li().read(this.dataId),"string"!==this.dtype){e.next=13;break}return e.next=5,t;case 5:return n=e.sent,e.prev=6,e.abrupt("return",n.map((function(e){return Ya(e)})));case 10:throw e.prev=10,e.t0=e.catch(6),new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().");case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[6,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"dataToGPU",value:function(e){return this.throwIfDisposed(),li().readToGPU(this.dataId,e)}},{key:"dataSync",value:function(){this.throwIfDisposed();var e=li().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return Ya(e)}))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}},{key:"bytes",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.throwIfDisposed(),e.next=3,li().read(this.dataId);case 3:return t=e.sent,e.abrupt("return","string"===this.dtype?t:new Uint8Array(t.buffer));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){this.isDisposed||(li().disposeTensor(this),this.isDisposedInternal=!0)}},{key:"isDisposed",get:function(){return this.isDisposedInternal}},{key:"throwIfDisposed",value:function(){if(this.isDisposed)throw new Error("Tensor is disposed.")}},{key:"print",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return pi.print(this,e)}},{key:"clone",value:function(){return this.throwIfDisposed(),pi.clone(this)}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return ai(this.dataSync(),this.shape,this.dtype,e)}},{key:"cast",value:function(e){return this.throwIfDisposed(),pi.cast(this,e)}},{key:"variable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),li().makeVariable(this,e,t,n)}}]),e}();function di(){return nt("Tensor",(function(){return hi}))}Object.defineProperty(hi,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}}),di();var fi=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r,a,i){var o;return(0,m.Z)(this,n),(o=t.call(this,e.shape,e.dtype,e.dataId,i)).trainable=r,o.name=a,o}return(0,v.Z)(n,[{key:"assign",value:function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and previous value (").concat(this.dtype,") must match"));if(!me(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and previous value (").concat(this.shape,") must match"));li().disposeTensor(this),this.dataId=e.dataId,li().incRef(this,null)}},{key:"dispose",value:function(){li().disposeVariable(this),this.isDisposedInternal=!0}}]),n}(hi);Object.defineProperty(fi,Symbol.hasInstance,{value:function(e){return e instanceof hi&&null!=e.assign&&e.assign instanceof Function}});var mi,vi,gi,yi,bi,xi={};A(xi,{assertTypesMatch:function(){return Ni},getTensorsInContainer:function(){return Ci},isTensorInList:function(){return Ti},makeTypesMatch:function(){return Si}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(mi||(mi={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(vi||(vi={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(gi||(gi={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(yi||(yi={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(bi||(bi={}));var ki={float32:yi,int32:vi,bool:gi,complex64:bi};function wi(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return ki[e][t]}function Ii(e){return wi(e,"int32")}function Si(e,t){if(e.dtype===t.dtype)return[e,t];var n=wi(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Ni(e,t){le(e.dtype===t.dtype,(function(){return"The dtypes of the first(".concat(e.dtype,") and second(").concat(t.dtype,") input must match")}))}function Ti(e,t){return t.some((function(t){return t.id===e.id}))}function Ci(e){var t=[];return _i(e,t,new Set),t}function _i(e,t,n){if(null!=e)if(e instanceof hi)t.push(e);else if(function(e){return Array.isArray(e)||"object"==typeof e}(e)){var r=e;for(var a in r){var i=r[a];n.has(i)||(n.add(i),_i(i,t,n))}}}function Ei(e){return null!=e.kernelName}var Ai=function(){function e(){(0,m.Z)(this,e),this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((function(e){return e.name}))))}}}return(0,v.Z)(e,[{key:"dispose",value:function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()}}]),e}(),Ri=function(){function e(t){(0,m.Z)(this,e),this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Ai}return(0,v.Z)(e,[{key:"ready",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n,r;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.pendingBackendInit){e.next=2;break}return e.abrupt("return",this.pendingBackendInit.then((function(){})));case 2:if(null==this.backendInstance){e.next=4;break}return e.abrupt("return");case 4:t=this.getSortedBackends(),n=0;case 6:if(!(n<t.length)){e.next=17;break}return r=t[n],e.next=10,this.initializeBackend(r).success;case 10:if(!e.sent){e.next=14;break}return e.next=13,this.setBackend(r);case 13:return e.abrupt("return");case 14:n++,e.next=6;break;case 17:throw new Error("Could not initialize any backends, all backend initializations failed.");case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"backend",get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods"));if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '".concat(t,"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods"));this.setBackend(t)}return this.backendInstance}},{key:"backendNames",value:function(){return Object.keys(this.registryFactory)}},{key:"findBackend",value:function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]}},{key:"findBackendFactory",value:function(e){return e in this.registryFactory?this.registryFactory[e].factory:null}},{key:"registerBackend",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(ga("".concat(e," backend was already registered. Reusing existing backend factory.")),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}},{key:"setBackend",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.registryFactory[t]){e.next=2;break}throw new Error("Backend name '".concat(t,"' not found in registry"));case 2:if(this.backendName=t,null!=this.registry[t]){e.next=14;break}if(this.backendInstance=null,n=this.initializeBackend(t),r=n.success,!n.asyncInit){e.next=11;break}return e.next=8,r;case 8:e.t0=e.sent,e.next=12;break;case 11:e.t0=r;case 12:if(e.t0){e.next=14;break}return e.abrupt("return",!1);case 14:return e.abrupt("return",(this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new $a(this.backendInstance),!0));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setupRegisteredKernels",value:function(){var e=this;Ia(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))}},{key:"disposeRegisteredKernels",value:function(e){var t=this;Ia(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))}},{key:"initializeBackend",value:function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var r=n.factory();if(!r||r instanceof ee||"function"!=typeof r.then)return this.registry[e]=r,{success:!0,asyncInit:!1};var a=++this.pendingBackendInitId,i=r.then((function(n){return!(a<t.pendingBackendInitId)&&(t.registry[e]=n,t.pendingBackendInit=null,!0)})).catch((function(n){return a<t.pendingBackendInitId||(t.pendingBackendInit=null,ga("Initialization of backend ".concat(e," failed")),ga(n.stack||n.message)),!1}));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}catch(r){return ga("Initialization of backend ".concat(e," failed")),ga(r.stack||r.message),{success:!1,asyncInit:!1}}}},{key:"removeBackend",value:function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}},{key:"getSortedBackends",value:function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))}},{key:"initializeBackendsAndReturnBest",value:function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),a=r.success,i=r.asyncInit;if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}},{key:"moveData",value:function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t),i=r.refCount(t);r.disposeData(t,!0),n.backend=e,e.move(t,a,n.shape,n.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}},{key:"tidy",value:function(e,t){var n,r=this,a=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun((function(){return r.startScope(a)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))}},{key:"scopedRun",value:function(e,t,n){e();try{var r=n();return t(),r}catch(r){throw t(),r}}},{key:"nextTensorId",value:function(){return e.nextTensorId++}},{key:"nextVariableId",value:function(){return e.nextVariableId++}},{key:"clone",value:function(e){var t=Zi.runKernel(yn,{x:e}),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function(){var t={x:e},n={dtype:"float32"};return Zi.runKernel(Tt,t,n)}}}),[],{}),t}},{key:"runKernel",value:function(e,t,n){if(null==this.backendName&&this.backend,null==ka(e,this.backendName))throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}},{key:"shouldCheckForMemLeaks",value:function(){return this.ENV.getBool("IS_TEST")}},{key:"checkKernelForMemLeak",value:function(e,t,n){var r=this.backend.numDataIds(),a=0;n.forEach((function(e){a+="complex64"===e.dtype?3:1}));var i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-a-i;if(o>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak (").concat(o," data ids) after running '").concat(e,"'"))}},{key:"runKernelFunc",value:function(e){var t,n,r=this,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;var u,c=Ei(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(Ei(e)){var l=e.kernelName,p=e.inputs,h=e.attrs;null==this.backendName&&this.backend;var d=ka(l,this.backendName);le(null!=d,(function(){return"Cannot find registered kernel '".concat(l,"' for backend '").concat(r.backendName,"'")})),n=function(){var e=r.backend.numDataIds();u=d.kernelFunc({inputs:p,attrs:h,backend:r.backend});var t=Array.isArray(u)?u:[u];r.shouldCheckForMemLeaks()&&r.checkKernelForMemLeak(l,e,t);var n=t.map((function(e){return null!=e.rank?e:r.makeTensorFromTensorInfo(e)}));if(i){var o=r.getTensorsForGradient(l,p,n);a=r.saveTensorsForBackwardMode(o)}return n}}else{var f=e.forwardFunc,m=function(e){i&&(a=e.map((function(e){return r.keep(r.clone(e))})))};n=function(){var e=r.backend.numDataIds();u=r.tidy((function(){return f(r.backend,m)}));var t=Array.isArray(u)?u:[u];return r.shouldCheckForMemLeaks()&&r.checkKernelForMemLeak(c,e,t),t}}var v,g=e.inputs,y=e.attrs,b=Ei(e)?null:e.backwardsFunc;return this.scopedRun((function(){return r.state.kernelDepth++}),(function(){return r.state.kernelDepth--}),(function(){r.ENV.getBool("DEBUG")||r.state.profiling?(v=r.profiler.profileKernel(c,g,(function(){return n()})),r.ENV.getBool("DEBUG")&&r.profiler.logKernelProfile(v),t=v.outputs):t=n()})),i&&this.addTapeNode(c,g,t,b,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map((function(e){return null!=g[e]?g[e].shape:null})),outputShapes:t.map((function(e){return e.shape})),kernelTimeMs:v.timeMs,extraInfo:v.extraInfo}),Array.isArray(u)?t:t[0]}},{key:"saveTensorsForBackwardMode",value:function(e){var t=this;return e.map((function(e){return t.keep(t.clone(e))}))}},{key:"getTensorsForGradient",value:function(e,t,n){var r=wa(e);if(null!=r){var a,i=r.inputsToSave||[],o=r.outputsToSave||[];r.saveAllInputs?(le(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),a=Object.keys(t).map((function(e){return t[e]}))):a=i.map((function(e){return t[e]}));var s=n.filter((function(e,t){return o[t]}));return a.concat(s)}return[]}},{key:"makeTensor",value:function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var a=e;"string"===n&&Fe(e[0])&&(a=e.map((function(e){return Xa(e)})));var i=r.write(a,t,n),o=new hi(t,n,i,this.nextTensorId());if(this.trackTensor(o,r),"string"===n){var s=this.state.tensorInfo.get(i),u=Re(a);this.state.numBytes+=u-s.bytes,s.bytes=u}return o}},{key:"makeTensorFromDataId",value:function(e,t,n,r){var a={dataId:e,shape:t,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(a,r)}},{key:"makeTensorFromTensorInfo",value:function(e,t){var n=e.dataId,r=e.shape,a=e.dtype,i=new hi(r,a,n,this.nextTensorId());return this.trackTensor(i,t),i}},{key:"makeVariable",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));var a=new fi(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name ".concat(a.name," was already registered"));return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}},{key:"trackTensor",value:function(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;var n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*Ae(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof fi||this.track(e)}},{key:"incRef",value:function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}},{key:"removeDataId",value:function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}},{key:"disposeTensor",value:function(e){if(this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){var n=e.size*Ae(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}}},{key:"disposeVariables",value:function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}}},{key:"disposeVariable",value:function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}},{key:"memory",value:function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}},{key:"profile",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r,a,i,o;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state.profiling=!0,n=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],e.next=5,t();case 5:this.state.activeProfile.result=e.sent,this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,(0,g.Z)(this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot})))),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r,a=(0,y.Z)(this.state.activeProfile.kernels),e.prev=11,a.s();case 13:if((i=a.n()).done){e.next=23;break}return o=i.value,e.next=17,o.kernelTimeMs;case 17:return o.kernelTimeMs=e.sent,e.next=20,o.extraInfo;case 20:o.extraInfo=e.sent;case 21:e.next=13;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(11),a.e(e.t0);case 28:return e.prev=28,a.f(),e.finish(28);case 31:return e.abrupt("return",this.state.activeProfile);case 32:case"end":return e.stop()}}),e,this,[[11,25,28,31]])})));return function(t){return e.apply(this,arguments)}}()},{key:"isTapeOn",value:function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}},{key:"addTapeNode",value:function(e,t,n,r,a,i){var o=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},u=wa(e);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],a=Ue(r.size,r.dtype);return o.makeTensor(a,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],a,i)}),this.state.activeTape.push(s)}},{key:"keep",value:function(e){return e.kept=!0,e}},{key:"startTape",value:function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}},{key:"endTape",value:function(){this.state.gradientDepth--}},{key:"startScope",value:function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}},{key:"endScope",value:function(e){for(var t=this,n=Ci(e),r=new Set(n.map((function(e){return e.id}))),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];!i.kept&&!r.has(i.id)&&i.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){!e.kept&&e.scopeId===o.id&&t.track(e)}))}},{key:"gradients",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(le(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var i=this.scopedRun((function(){return r.startTape()}),(function(){return r.endTape()}),(function(){return r.tidy("forward",e)}));le(i instanceof hi,(function(){return"The result y returned by f() must be a tensor."}));var o=function(e,t,n){for(var r={},a={},i=0;i<t.length;i++)r[t[i].id]=!0;for(var o=0;o<e.length;o++){var s=e[o],u=s.inputs;for(var c in u){for(var l=u[c],p=!1,h=0;h<t.length;h++)if(r[l.id]){s.outputs.forEach((function(e){return r[e.id]=!0})),p=!0,a[s.id]=!0;break}if(p)break}}var d={};d[n.id]=!0;for(var f={},m=e.length-1;m>=0;m--)for(var v=e[m],g=v.inputs,y=0;y<v.outputs.length;y++)if(d[v.outputs[y].id]){for(var b in g)d[g[b].id]=!0,f[v.id]=!0;break}for(var x=[],k=0;k<e.length;k++){var w=e[k];if(a[w.id]&&f[w.id]){var I={};for(var S in w.inputs){var N=w.inputs[S];r[N.id]&&(I[S]=N)}var T=Object.assign({},w);T.inputs=I,T.outputs=w.outputs,x.push(T)}}return x}(this.state.activeTape,t,i);if(!a&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e={};e[i.id]=null==n?function(e){var t=Ve(de(e),"float32");return Zi.makeTensor(t,e,"float32")}(i.shape):n,function(e,t,n,r){for(var a=function(){var a=t[i],o=[];if(a.outputs.forEach((function(t){var n=e[t.id];null!=n?o.push(n):o.push(null)})),null==a.gradient)throw new Error("Cannot compute gradient: gradient function not found for ".concat(a.kernelName,"."));var s=a.gradient(o),u=function(t){if(!(t in s))throw new Error("Cannot backprop through input ".concat(t,". Available gradients found: ").concat(Object.keys(s),"."));var i=n((function(){return s[t]()}));if("float32"!==i.dtype)throw new Error("Error in gradient for op ".concat(a.kernelName,". The gradient of input ").concat(t," must have 'float32' dtype, but has '").concat(i.dtype,"'"));var o=a.inputs[t];if(!me(i.shape,o.shape))throw new Error("Error in gradient for op ".concat(a.kernelName,". The gradient of input '").concat(t,"' has shape '").concat(i.shape,"', which does not match the shape of the input '").concat(o.shape,"'"));if(null==e[o.id])e[o.id]=i;else{var u=e[o.id];e[o.id]=r(u,i),u.dispose()}};for(var c in a.inputs)u(c)},i=t.length-1;i>=0;i--)a()}(e,o,(function(e){return r.tidy(e)}),Di);var a=t.map((function(t){return e[t.id]}));return 0===r.state.gradientDepth&&(r.state.activeTape.forEach((function(e){var t,n=(0,y.Z)(e.saved);try{for(n.s();!(t=n.n()).done;){t.value.dispose()}}catch(r){n.e(r)}finally{n.f()}})),r.state.activeTape=null),{value:i,grads:a}}))}},{key:"customGrad",value:function(e){var t=this;return le(Oe(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];le(r.every((function(e){return e instanceof hi})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var i,o={};r.forEach((function(e,t){o[t]=e}));return t.runKernelFunc({forwardFunc:function(t,n){return le((i=e.apply(void 0,r.concat([n]))).value instanceof hi,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),le(Oe(i.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),i.value},backwardsFunc:function(e,t){var n=i.gradFunc(e,t),a=Array.isArray(n)?n:[n];le(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),le(a.every((function(e){return e instanceof hi})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o},inputs:o})}}},{key:"readSync",value:function(e){return this.state.tensorInfo.get(e).backend.readSync(e)}},{key:"read",value:function(e){return this.state.tensorInfo.get(e).backend.read(e)}},{key:"readToGPU",value:function(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}},{key:"time",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=qa(),e.next=3,this.backend.time(t);case 3:return r=e.sent,e.abrupt("return",(r.wallMs=qa()-n,r));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"track",value:function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}},{key:"registeredVariables",get:function(){return this.state.registeredVariables}},{key:"reset",value:function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Ai,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}]),e}();function Fi(){var e=tt();if(null==e._tfengine){var t=new Ye(e);e._tfengine=new Ri(t)}return function(e){et=e}(e._tfengine.ENV),function(e){li=e}((function(){return e._tfengine})),e._tfengine}Ri.nextTensorId=0,Ri.nextVariableId=0;var Zi=Fi();function Di(e,t){var n={a:e,b:t};return Zi.runKernel(ot,n)}var Mi,Oi={};function Li(e){Mi=e}function zi(e){if(void 0!==Mi)return Mi;if(e||"undefined"!=typeof navigator&&null!=navigator){if(e||(e=navigator),"ReactNative"===e.product)return!0;var t=e.userAgent||e.vendor||("undefined"!=typeof window?window.opera:"");if(!t){var n=e;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function Pi(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}A(Oi,{isBrowser:function(){return Pi},isMobile:function(){return zi},mockIsMobile:function(){return Li}});var Bi=Qe();function Wi(e,t){var n=e;if(Ja(e))return"string"===t?[]:[e.length];if("object"==typeof e){if("texture"in e){var r=e.channels||"RGBA";return[e.height,e.width*r.length]}if("buffer"in e&&!(e.buffer instanceof ArrayBuffer))return[e.buffer.size/(null==t?4:Ae(t))]}if(!Array.isArray(e))return[];for(var a=[];Array.isArray(n)||Ja(n)&&"string"!==t;)a.push(n.length),n=n[0];return Array.isArray(e)&&Qe().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Vi(e,a,[]),a}function Vi(e,t,n){if(n=n||[],Array.isArray(e)||Ja(e)){le(t.length>0,(function(){return"Element arr[".concat(n.join("]["),"] should be a primitive, but is an array of ").concat(e.length," elements")})),le(e.length===t[0],(function(){return"Element arr[".concat(n.join("]["),"] should have ").concat(t[0]," elements, but has ").concat(e.length," elements")}));for(var r=t.slice(1),a=0;a<e.length;++a)Vi(e[a],r,n.concat(a))}else le(0===t.length,(function(){return"Element arr[".concat(n.join("]["),"] is a primitive, but should be an array/TypedArray of ").concat(t[0]," elements")}))}function Ui(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must be ").concat(e," tensor, but got ").concat(t," tensor"))}}function Gi(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof hi)return Ui(r,e.dtype,t,n),e;var a=Me(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),Ui(r,a,t,n),null==e||!Ja(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var i=null==e?"null":e.constructor.name;throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a Tensor or TensorLike, but got '").concat(i,"'"))}var o=Wi(e,a);!Ja(e)&&!Array.isArray(e)&&(e=[e]);var s="string"!==a?ja(e,a):Qa(e,[],!0);return Zi.makeTensor(s,o,a)}function Hi(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a `Tensor[]` or `TensorLike[]`"));return e.map((function(e,a){return Gi(e,"".concat(t,"[").concat(a,"]"),n,r)}))}Bi.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Bi.registerFlag("IS_BROWSER",(function(){return Pi()})),Bi.registerFlag("IS_NODE",(function(){return"undefined"!=typeof process&&"undefined"!=typeof process.versions&&"undefined"!=typeof process.versions.node})),Bi.registerFlag("IS_CHROME",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),Bi.registerFlag("PROD",(function(){return!1})),Bi.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return Bi.getBool("DEBUG")})),Bi.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),Bi.registerFlag("IS_TEST",(function(){return!1})),Bi.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(function(){return!0})),Bi.registerFlag("WRAP_TO_IMAGEBITMAP",(function(){return!1})),Bi.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",(function(){return!1})),Bi.registerFlag("USE_SETTIMEOUTCUSTOM",(function(){return!1}));var ji="__op";function qi(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with ".concat(t.length," keys."));var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+=ji;var a=function(){Zi.startScope(n);try{var e=r.apply(void 0,arguments);return Ke(e)&&console.error("Cannot return a Promise inside of tidy."),Zi.endScope(e),e}catch(e){throw Zi.endScope(null),e}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}var Ki=qi({complex_:function(e,t){var n=Gi(e,"real","complex"),r=Gi(t,"imag","complex");pe(n.shape,r.shape,"real and imag shapes, ".concat(n.shape," and ").concat(r.shape,", must match in call to tf.complex()."));var a={real:n,imag:r};return Zi.runKernel(Et,a)}});function Xi(e,t,n,r){if(null==r)r=Me(e);else if("complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if("object"==typeof e&&("texture"in e||"buffer"in e&&!(e.buffer instanceof ArrayBuffer))){if("float32"!==r&&"int32"!==r)throw new Error("Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ".concat(r,"."));return Zi.backend.createTensorFromGPUData(e,t||n,r)}if(!Ja(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){He(t);var a=de(t),i=de(n);le(a===i,(function(){return"Based on the provided shape, [".concat(t,"], the tensor should have ").concat(a," values but has ").concat(i)}));for(var o=0;o<n.length;++o){var s=n[o],u=o!==n.length-1||s!==de(t.slice(o));le(n[o]===t[o]||!u,(function(){return"Error creating a new Tensor. Inferred shape (".concat(n,") does not match the provided shape (").concat(t,"). ")}))}}return!Ja(e)&&!Array.isArray(e)&&(e=[e]),t=t||n,e="string"!==r?ja(e,r):Qa(e,[],!0),Zi.makeTensor(e,t,r)}function Yi(e,t,n){return Xi(e,t,Wi(e,n),n)}var Ji={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8},Qi=4;function $i(e,t){return eo.apply(this,arguments)}function eo(){return eo=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i,o,s,u;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],a=[],i=Array.isArray(t)?t.map((function(e){return e.name})):Object.keys(t),o=(0,d.Z)().mark((function e(){var o,u,c,l;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=i[s],"float32"===(u=Array.isArray(t)?t[s].tensor:t[o]).dtype||"int32"===u.dtype||"bool"===u.dtype||"string"===u.dtype||"complex64"===u.dtype){e.next=3;break}throw new Error("Unsupported dtype in weight '".concat(o,"': ").concat(u.dtype));case 3:c={name:o,shape:u.shape,dtype:u.dtype},"string"===u.dtype?(l=new Promise(function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r,a,i,o,s,c;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.bytes();case 2:for(n=e.sent,r=n.reduce((function(e,t){return e+t.length}),0)+Qi*n.length,a=new Uint8Array(r),i=0,o=0;o<n.length;o++)s=n[o],c=new Uint8Array(new Uint32Array([s.length]).buffer),a.set(c,i),i+=Qi,a.set(s,i),i+=s.length;t(a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.push(l)):a.push(u.data()),null!=n&&(c.group=n),r.push(c);case 6:case"end":return e.stop()}}),e)})),s=0;case 3:if(!(s<i.length)){e.next=8;break}return e.delegateYield(o(),"t0",5);case 5:++s,e.next=3;break;case 8:return e.next=10,Promise.all(a);case 10:return u=e.sent,e.abrupt("return",{data:no(u),specs:r});case 12:case"end":return e.stop()}}),e)}))),eo.apply(this,arguments)}function to(e,t){var n,r,a={},i=0,o=(0,y.Z)(t);try{for(o.s();!(r=o.n()).done;){var s=r.value,u=s.name,c=s.dtype,l=s.shape,p=de(l),h=void 0;if("quantization"in s){var d=s.quantization;if("uint8"===d.dtype||"uint16"===d.dtype){if(!("min"in d)||!("scale"in d))throw new Error("Weight ".concat(s.name," with quantization ").concat(d.dtype," doesn't have corresponding metadata min and scale."))}else{if("float16"!==d.dtype)throw new Error("Weight ".concat(s.name," has unknown quantization dtype ").concat(d.dtype,". Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'."));if("float32"!==c)throw new Error("Weight ".concat(s.name," is quantized with ").concat(d.dtype," which only supports weights of type float32 not ").concat(c,"."))}var f=Ji[d.dtype],m=e.slice(i,i+p*f),v="uint8"===d.dtype?new Uint8Array(m):new Uint16Array(m);if("float32"===c)if("uint8"===d.dtype||"uint16"===d.dtype){h=new Float32Array(v.length);for(var g=0;g<v.length;g++){var b=v[g];h[g]=b*d.scale+d.min}}else{if("float16"!==d.dtype)throw new Error("Unsupported quantization type ".concat(d.dtype," for weight type float32."));void 0===n&&(n=vo()),h=n(v)}else{if("int32"!==c)throw new Error("Unsupported dtype in weight '".concat(u,"': ").concat(c));if("uint8"!==d.dtype&&"uint16"!==d.dtype)throw new Error("Unsupported quantization type ".concat(d.dtype," for weight type int32."));h=new Int32Array(v.length);for(var x=0;x<v.length;x++){var k=v[x];h[x]=Math.round(k*d.scale+d.min)}}i+=p*f}else if("string"===c){var w=de(s.shape);h=[];for(var I=0;I<w;I++){var S=new Uint32Array(e.slice(i,i+Qi))[0];i+=Qi;var N=new Uint8Array(e.slice(i,i+S));h.push(N),i+=S}}else{var T=Ji[c],C=e.slice(i,i+p*T);if("float32"===c)h=new Float32Array(C);else if("int32"===c)h=new Int32Array(C);else if("bool"===c)h=new Uint8Array(C);else{if("complex64"!==c)throw new Error("Unsupported dtype in weight '".concat(u,"': ").concat(c));h=new Float32Array(C);for(var _=new Float32Array(h.length/2),E=new Float32Array(h.length/2),A=0;A<_.length;A++)_[A]=h[2*A],E[A]=h[2*A+1];var R=Yi(_,l,"float32"),F=Yi(E,l,"float32");a[u]=Ki(R,F),R.dispose(),F.dispose()}i+=p*T}"complex64"!==c&&(a[u]=Yi(h,l,c))}}catch(Z){o.e(Z)}finally{o.f()}return a}function no(e){if(null===e)throw new Error("Invalid input value: ".concat(JSON.stringify(e)));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(e.constructor.name))}));var r=new Uint8Array(t),a=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),a),a+=e.byteLength})),r.buffer}var ro="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function ao(e){return ro?Buffer.byteLength(e):new Blob([e]).size}function io(e){if(ro)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}function oo(e){if(ro){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),a=0;a<n.length;++a)r.set([n.charCodeAt(a)],a);return r.buffer}function so(e){if(1===e.length)return e[0];var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function uo(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function co(e,t){var n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(n.initializerSignature=e.initializerSignature),null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),n}function lo(e,t,n){var r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(null!=e.trainingConfig&&(r.trainingConfig=e.trainingConfig),null!=e.weightsManifest){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=t,r.weightData=n}return null!=e.signature&&(r.signature=e.signature),null!=e.userDefinedMetadata&&(r.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(r.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(r.initializerSignature=e.initializerSignature),r}function po(e,t){return ho.apply(this,arguments)}function ho(){return ho=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i,o;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=t.weightsManifest,!e.t0){e.next=9;break}return e.next=4,n(t.weightsManifest);case 4:r=e.sent,a=(0,h.Z)(r,2),i=a[0],o=a[1];case 9:return e.abrupt("return",lo(t,i,o));case 10:case"end":return e.stop()}}),e)}))),ho.apply(this,arguments)}function fo(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:ao(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:ao(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}function mo(e){var t,n=[],r=(0,y.Z)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push.apply(n,(0,g.Z)(a.weights))}}catch(i){r.e(i)}finally{r.f()}return n}function vo(){var e=function(){var e=function(e){for(var t=e<<13,n=0;!(8388608&t);)n-=8388608,t<<=1;return(t&=-8388609)|n+947912704},t=new Uint32Array(2048);t[0]=0;for(var n=1;n<1024;n++)t[n]=e(n);for(var r=1024;r<2048;r++)t[r]=939524096+(r-1024<<13);return t}(),t=function(){var e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(var t=1;t<31;t++)e[t]=t<<23;for(var n=33;n<63;n++)e[n]=2147483648+(n-32<<23);return e}(),n=function(){for(var e=new Uint32Array(64),t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return function(r){for(var a=new ArrayBuffer(4*r.length),i=new Uint32Array(a),o=0;o<r.length;o++){var s=r[o],u=e[n[s>>10]+(1023&s)]+t[s>>10];i[o]=u}return new Float32Array(a)}}var go=function(){function e(){(0,m.Z)(this,e),this.saveRouters=[],this.loadRouters=[]}return(0,v.Z)(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerSaveRouter",value:function(t){e.getInstance().saveRouters.push(t)}},{key:"registerLoadRouter",value:function(t){e.getInstance().loadRouters.push(t)}},{key:"getSaveHandlers",value:function(t){return e.getHandlers(t,"save")}},{key:"getLoadHandlers",value:function(t,n){return e.getHandlers(t,"load",n)}},{key:"getHandlers",value:function(t,n,r){var a=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&a.push(n)})),a}}]),e}(),yo=function(e){return go.registerSaveRouter(e)},bo=function(e){return go.registerLoadRouter(e)},xo=function(e){return go.getSaveHandlers(e)},ko=function(e,t){return go.getLoadHandlers(e,t)},wo="tensorflowjs",Io="models_store",So="model_info_store";function No(){if(!Qe().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e="undefined"==typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function To(e){var t=e.result;t.createObjectStore(Io,{keyPath:"modelPath"}),t.createObjectStore(So,{keyPath:"modelPath"})}var Co=function(){function e(t){if((0,m.Z)(this,e),this.indexedDB=No(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return(0,v.Z)(e,[{key:"save",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return e.abrupt("return",this.databaseAction(this.modelPath,t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.databaseAction(this.modelPath));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"databaseAction",value:function(e,t){var n=this;return new Promise((function(e,r){var a=n.indexedDB.open(wo,1);a.onupgradeneeded=function(){return To(a)},a.onsuccess=function(){var i=a.result;if(null==t){var o=i.transaction(Io,"readonly"),s=o.objectStore(Io).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '".concat(n.modelPath,"' in IndexedDB.")));e(s.result.modelArtifacts)},s.onerror=function(e){return i.close(),r(s.error)},o.oncomplete=function(){return i.close()}}else{var u,c=fo(t),l=i.transaction(So,"readwrite"),p=l.objectStore(So),h=p.put({modelPath:n.modelPath,modelArtifactsInfo:c});h.onsuccess=function(){var a=(u=i.transaction(Io,"readwrite")).objectStore(Io).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:c});a.onsuccess=function(){return e({modelArtifactsInfo:c})},a.onerror=function(e){var t=(p=l.objectStore(So)).delete(n.modelPath);t.onsuccess=function(){return i.close(),r(a.error)},t.onerror=function(e){return i.close(),r(a.error)}}},h.onerror=function(e){return i.close(),r(h.error)},l.oncomplete=function(){null==u?i.close():u.oncomplete=function(){return i.close()}}}},a.onerror=function(e){return r(a.error)}}))}}]),e}();Co.URL_SCHEME="indexeddb://";var _o=function(e){return Qe().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Co.URL_SCHEME)?function(e){return new Co(e)}(e.slice(Co.URL_SCHEME.length)):null};function Eo(e){return e.startsWith(Co.URL_SCHEME)?e.slice(Co.URL_SCHEME.length):e}go.registerSaveRouter(_o),go.registerLoadRouter(_o);var Ao=function(){function e(){(0,m.Z)(this,e),this.indexedDB=No()}return(0,v.Z)(e,[{key:"listModels",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t.indexedDB.open(wo,1);r.onupgradeneeded=function(){return To(r)},r.onsuccess=function(){var t=r.result,a=t.transaction(So,"readonly"),i=a.objectStore(So).getAll();i.onsuccess=function(){var t,n={},r=(0,y.Z)(i.result);try{for(r.s();!(t=r.n()).done;){var a=t.value;n[a.modelPath]=a.modelArtifactsInfo}}catch(o){r.e(o)}finally{r.f()}e(n)},i.onerror=function(e){return t.close(),n(i.error)},a.oncomplete=function(){return t.close()}},r.onerror=function(e){return n(r.error)}})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=Eo(t),new Promise((function(e,r){var a=n.indexedDB.open(wo,1);a.onupgradeneeded=function(){return To(a)},a.onsuccess=function(){var n,i=a.result,o=i.transaction(So,"readwrite"),s=o.objectStore(So),u=s.get(t);u.onsuccess=function(){if(null==u.result)return i.close(),r(new Error("Cannot find model with path '".concat(t,"' in IndexedDB.")));var a=s.delete(t),o=function(){var a=(n=i.transaction(Io,"readwrite")).objectStore(Io).delete(t);a.onsuccess=function(){return e(u.result.modelArtifactsInfo)},a.onerror=function(e){return r(u.error)}};a.onsuccess=o,a.onerror=function(e){return o(),i.close(),r(u.error)}},u.onerror=function(e){return i.close(),r(u.error)},o.oncomplete=function(){null==n?i.close():n.oncomplete=function(){return i.close()}}},a.onerror=function(e){return r(a.error)}}))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Ro="/",Fo="tensorflowjs_models",Zo="info",Do="model_topology",Mo="weight_specs",Oo="weight_data",Lo="model_metadata";function zo(e){return{info:[Fo,e,Zo].join(Ro),topology:[Fo,e,Do].join(Ro),weightSpecs:[Fo,e,Mo].join(Ro),weightData:[Fo,e,Oo].join(Ro),modelMetadata:[Fo,e,Lo].join(Ro)}}function Po(e){for(var t=0,n=Object.values(e);t<n.length;t++){var r=n[t];window.localStorage.removeItem(r)}}function Bo(e){var t=e.split(Ro);if(t.length<3)throw new Error("Invalid key format: ".concat(e));return t.slice(1,t.length-1).join(Ro)}function Wo(e){return e.startsWith(Vo.URL_SCHEME)?e.slice(Vo.URL_SCHEME.length):e}var Vo=function(){function e(t){if((0,m.Z)(this,e),!Qe().getBool("IS_BROWSER")||"undefined"==typeof window||"undefined"==typeof window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=zo(this.modelPath)}return(0,v.Z)(e,[{key:"save",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r,a,i;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),a=fo(t),e.prev=3,this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,io(t.weightData)),i={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,initializerSignature:null!=t.initializerSignature?t.initializerSignature:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0},e.abrupt("return",(this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:a}));case 9:throw e.prev=9,e.t0=e.catch(3),Po(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=").concat(a.modelTopologyBytes,", weightSpecsBytes=").concat(a.weightSpecsBytes,", weightDataBytes=").concat(a.weightDataBytes,"."));case 12:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n,r,a,i,o,s;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(t=JSON.parse(this.LS.getItem(this.keys.info)))){e.next=3;break}throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));case 3:if("JSON"===t.modelTopologyType){e.next=5;break}throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");case 5:if(n={},null!=(r=JSON.parse(this.LS.getItem(this.keys.topology)))){e.next=8;break}throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' is missing."));case 8:if(n.modelTopology=r,null!=(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))){e.next=12;break}throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' are missing."));case 12:if(n.weightSpecs=a,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(o=JSON.parse(i),n.format=o.format,n.generatedBy=o.generatedBy,n.convertedBy=o.convertedBy,null!=o.signature&&(n.signature=o.signature),null!=o.userDefinedMetadata&&(n.userDefinedMetadata=o.userDefinedMetadata),null!=o.modelInitializer&&(n.modelInitializer=o.modelInitializer),null!=o.initializerSignature&&(n.initializerSignature=o.initializerSignature),null!=o.trainingConfig&&(n.trainingConfig=o.trainingConfig)),null!=(s=this.LS.getItem(this.keys.weightData))){e.next=18;break}throw new Error("In local storage, the binary weight values of model '".concat(this.modelPath,"' are missing."));case 18:return e.abrupt("return",(n.weightData=oo(s),n));case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();Vo.URL_SCHEME="localstorage://";var Uo=function(e){return Qe().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Vo.URL_SCHEME)?function(e){return new Vo(e)}(e.slice(Vo.URL_SCHEME.length)):null};go.registerSaveRouter(Uo),go.registerLoadRouter(Uo);var Go=function(){function e(){(0,m.Z)(this,e),le(Qe().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),le("undefined"==typeof window||"undefined"!=typeof window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return(0,v.Z)(e,[{key:"listModels",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n,r,a,i,o;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t={},n=Fo+Ro,r=Ro+Zo,a=0;a<this.LS.length;++a)(i=this.LS.key(a)).startsWith(n)&&i.endsWith(r)&&(o=Bo(i),t[o]=JSON.parse(this.LS.getItem(i)));return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Wo(t),n=zo(t),null!=this.LS.getItem(n.info)){e.next=4;break}throw new Error("Cannot find model at path '".concat(t,"'"));case 4:return r=JSON.parse(this.LS.getItem(n.info)),e.abrupt("return",(Po(n),r));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Ho="://",jo=function(){function e(){(0,m.Z)(this,e),this.managers={}}return(0,v.Z)(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerManager",value:function(t,n){le(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith(Ho)&&(t=t.slice(0,t.indexOf(Ho))),le(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();le(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '".concat(t,"'.")})),r.managers[t]=n}},{key:"getManager",value:function(t){var n=e.getInstance().managers[t];if(null==n)throw new Error("Cannot find model manager for scheme '".concat(t,"'"));return n}},{key:"getSchemes",value:function(){return Object.keys(e.getInstance().managers)}}]),e}();function qo(e){if(-1===e.indexOf(Ho))throw new Error("The url string provided does not contain a scheme. Supported schemes are: ".concat(jo.getSchemes().join(",")));return{scheme:e.split(Ho)[0],path:e.split(Ho)[1]}}function Ko(e,t){return Xo.apply(this,arguments)}function Xo(){return Xo=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,h,f=arguments;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=f.length>2&&void 0!==f[2]&&f[2],le(t!==n,(function(){return"Old path and new path are the same: '".concat(t,"'")})),le((a=go.getLoadHandlers(t)).length>0,(function(){return"Copying failed because no load handler is found for source URL ".concat(t,".")})),le(a.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") load handlers for source URL ").concat(t,".")})),i=a[0],le((o=go.getSaveHandlers(n)).length>0,(function(){return"Copying failed because no save handler is found for destination URL ".concat(n,".")})),le(o.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") save handlers for destination URL ").concat(n,".")})),s=o[0],u=qo(t).scheme,c=qo(t).path,l=u===qo(t).scheme,e.next=12,i.load();case 12:if(p=e.sent,e.t0=r&&l,!e.t0){e.next=17;break}return e.next=17,jo.getManager(u).removeModel(c);case 17:return e.next=19,s.save(p);case 19:if(h=e.sent,e.t1=r&&!l,!e.t1){e.next=24;break}return e.next=24,jo.getManager(u).removeModel(c);case 24:return e.abrupt("return",h.modelArtifactsInfo);case 25:case"end":return e.stop()}}),e)}))),Xo.apply(this,arguments)}function Yo(){return Jo.apply(this,arguments)}function Jo(){return Jo=(0,f.Z)((0,d.Z)().mark((function e(){var t,n,r,a,i,o,s;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=jo.getSchemes(),n={},r=(0,y.Z)(t),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=12;break}return i=a.value,e.next=8,jo.getManager(i).listModels();case 8:for(s in o=e.sent)n[i+Ho+s]=o[s];case 10:e.next=4;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),r.e(e.t0);case 17:return e.prev=17,r.f(),e.finish(17);case 20:return e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,null,[[2,14,17,20]])}))),Jo.apply(this,arguments)}function Qo(e){return $o.apply(this,arguments)}function $o(){return $o=(0,f.Z)((0,d.Z)().mark((function e(t){var n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=qo(t),e.abrupt("return",jo.getManager(n.scheme).removeModel(n.path));case 2:case"end":return e.stop()}}),e)}))),$o.apply(this,arguments)}function es(e,t){return ts.apply(this,arguments)}function ts(){return ts=(0,f.Z)((0,d.Z)().mark((function e(t,n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ko(t,n,!1));case 1:case"end":return e.stop()}}),e)}))),ts.apply(this,arguments)}function ns(e,t){return rs.apply(this,arguments)}function rs(){return rs=(0,f.Z)((0,d.Z)().mark((function e(t,n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ko(t,n,!0));case 1:case"end":return e.stop()}}),e)}))),rs.apply(this,arguments)}var as=function(){function e(){(0,m.Z)(this,e),this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}return(0,v.Z)(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){return fetch(e,t)}))},{key:"now",value:function(){return performance.now()}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return new TextDecoder(t).decode(e)}},{key:"setTimeoutCustom",value:function(e,t){var n=this;"undefined"!=typeof window&&Qe().getBool("USE_SETTIMEOUTCUSTOM")?(this.functionRefs.push(e),setTimeout((function(){window.postMessage({name:n.messageName,index:n.functionRefs.length-1},"*")}),t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",(function(e){e.source===window&&e.data.name===n.messageName&&(e.stopPropagation(),(0,n.functionRefs[e.data.index])(),n.handledMessageCount++,n.handledMessageCount===n.functionRefs.length&&(n.functionRefs=[],n.handledMessageCount=0))}),!0))):setTimeout(e,t)}},{key:"isTypedArray",value:function(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}}]),e}();if(Qe().get("IS_BROWSER")){Qe().setPlatform("browser",new as);try{jo.registerManager(Vo.URL_SCHEME,new Go)}catch(C0){}try{jo.registerManager(Co.URL_SCHEME,new Ao)}catch(C0){}}var is,os=function(){return Z()},ss=function(){function e(){(0,m.Z)(this,e),this.util=D(),this.textEncoder=new this.util.TextEncoder}return(0,v.Z)(e,[{key:"fetch",value:function(e,t){return null!=Qe().global.fetch?Qe().global.fetch(e,t):(null==is&&(is=os()),is(e,t))}},{key:"now",value:function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}},{key:"isTypedArray",value:function(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}]),e}();function us(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",He(e),new ci(e,t,n)}Qe().get("IS_NODE")&&!Qe().get("IS_BROWSER")&&Qe().setPlatform("node",new ss);var cs=qi({cast_:function(e,t){var n=Gi(e,"x","cast");if(!_e(t))throw new Error("Failed to cast to unknown dtype ".concat(t));if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={x:n},a={dtype:t};return Zi.runKernel(Tt,r,a)}});var ls=qi({clone_:function(e){var t={x:Gi(e,"x","clone","string_or_numeric")};return Zi.runKernel(yn,t)}});function ps(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}function hs(){Qe().set("PROD",!0)}function ds(){Qe().set("DEBUG",!0)}function fs(){Qe().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function ms(e){Qe().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function vs(){Zi.disposeVariables()}function gs(){return Zi}function ys(){return Zi.memory()}function bs(e){return Zi.profile(e)}function xs(e,t){return Zi.tidy(e,t)}function ks(e){Ci(e).forEach((function(e){return e.dispose()}))}function ws(e){return Zi.keep(e)}function Is(e){return Zi.time(e)}function Ss(e){return Zi.setBackend(e)}function Ns(){return Zi.ready()}function Ts(){return Zi.backendName}function Cs(e){Zi.removeBackend(e)}function _s(e){return Zi.findBackend(e)}function Es(e){return Zi.findBackendFactory(e)}function As(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Zi.registerBackend(e,t,n)}function Rs(){return Zi.backend}function Fs(e,t){Qe().setPlatform(e,t)}Fi(),function(e){pi=e}({buffer:us,cast:cs,clone:ls,print:ps}),function(e){e}(ms);var Zs=qi({add_:function(e,t){var n=Gi(e,"a","add"),r=Gi(t,"b","add"),a=Si(n,r),i=(0,h.Z)(a,2),o={a:n=i[0],b:r=i[1]};return Zi.runKernel(ot,o)}});var Ds=qi({floorDiv_:function(e,t){var n=Gi(e,"a","floorDiv"),r=Gi(t,"b","floorDiv"),a=Si(n,r),i=(0,h.Z)(a,2),o={a:n=i[0],b:r=i[1]};return Zi.runKernel(hn,o)}});var Ms=qi({div_:function(e,t){var n,r,a=Gi(e,"a","div"),i=Gi(t,"b","div");if(n=Si(a,i),a=(r=(0,h.Z)(n,2))[0],i=r[1],"int32"===a.dtype&&"int32"===i.dtype)return Ds(a,i);var o={a:a,b:i};return Zi.runKernel(Qt,o,{})}});var Os=qi({mul_:function(e,t){var n=Gi(e,"a","mul"),r=Gi(t,"b","mul"),a=Si(n,r),i=(0,h.Z)(a,2),o={a:n=i[0],b:r=i[1]};return Zi.runKernel(Jn,o)}});var Ls=qi({abs_:function(e){var t=Gi(e,"x","abs");if("complex64"===t.dtype){var n={x:t};return Zi.runKernel(At,n)}var r={x:t};return Zi.runKernel(rt,r)}});var zs=qi({acos_:function(e){var t={x:Gi(e,"x","acos")};return Zi.runKernel(at,t)}});var Ps=qi({acosh_:function(e){var t={x:Gi(e,"x","acosh")};return Zi.runKernel(it,t)}});var Bs=qi({addN_:function(e){le(Array.isArray(e),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),le(e.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got ".concat(e.length)}));var t=e.map((function(e,t){return Gi(e,"tensors".concat(t),"addN")})),n=t[0];t.forEach((function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((function(e){if(!me(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=t;return Zi.runKernel(st,r)}});var Ws=qi({all_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:Gi(e,"x","all","bool")},a={axis:t,keepDims:n};return Zi.runKernel(ut,r,a)}});var Vs=qi({any_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:Gi(e,"x","any","bool")},a={axis:t,keepDims:n};return Zi.runKernel(ct,r,a)}});var Us=qi({argMax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:Gi(e,"x","argMax")},r={axis:t};return Zi.runKernel(lt,n,r)}});var Gs=qi({argMin_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:Gi(e,"x","argMin")},r={axis:t};return Zi.runKernel(pt,n,r)}});var Hs=qi({asin_:function(e){var t={x:Gi(e,"x","asin")};return Zi.runKernel(ht,t)}});var js=qi({asinh_:function(e){var t={x:Gi(e,"x","asinh")};return Zi.runKernel(dt,t)}});var qs=qi({atan_:function(e){var t={x:Gi(e,"x","atan")};return Zi.runKernel(ft,t)}});var Ks=qi({atan2_:function(e,t){var n=Gi(e,"a","atan2"),r=Gi(t,"b","atan2"),a=Si(n,r),i=(0,h.Z)(a,2),o={a:n=i[0],b:r=i[1]};return Zi.runKernel(vt,o)}});var Xs=qi({atanh_:function(e){var t={x:Gi(e,"x","atanh")};return Zi.runKernel(mt,t)}});function Ys(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5?arguments[5]:void 0,o=e[3];return $s(e,[].concat((0,g.Z)(t),[o]),n,i,r,null,null,cu(a))}function Js(e,t,n,r,a,i){var o,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",u=nu(t),c=(0,h.Z)(u,2),l=c[0],p=c[1];if("channelsLast"===s)o=[l,p,e[3],e[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));o=[l,p,e[1],e[1]]}return $s(e,o,n,r,a,i,!1,s)}function Qs(e,t,n,r,a,i){var o,s,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC",c=ru(t),l=(0,h.Z)(c,3),p=l[0],d=l[1],f=l[2];if("NDHWC"===u)s="channelsLast",o=[p,d,f,e[4],e[4]];else{if("NCDHW"!==u)throw new Error("Unknown dataFormat ".concat(u));s="channelsFirst",o=[p,d,f,e[1],e[1]]}return eu(e,o,n,r,a,!1,s,i)}function $s(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",u=-1,c=-1,l=-1,p=-1;if("channelsLast"===s){var d=(0,h.Z)(e,4);u=d[0],c=d[1],l=d[2],p=d[3]}else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));var f=(0,h.Z)(e,4);u=f[0],p=f[1],c=f[2],l=f[3]}var m,v=(0,h.Z)(t,4),g=v[0],y=v[1],b=v[3],x=nu(n),k=(0,h.Z)(x,2),w=k[0],I=k[1],S=nu(r),N=(0,h.Z)(S,2),T=N[0],C=N[1],_=au(g,T),E=au(y,C),A=function(e,t,n,r,a,i,o,s,u){var c,l,p;if("number"==typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var h=function(e,t,n,r,a){null==r&&(r=tu(e,t,n));var i=e[0],o=e[1],s=iu((i-t+2*r)/n+1,a),u=iu((o-t+2*r)/n+1,a);return[s,u]}([t,n],i,r,e,s);l=h[0],p=h[1]}else if("same"===e){l=Math.ceil(t/r),p=Math.ceil(n/a);var d=Math.max(0,(l-1)*r+i-t),f=Math.max(0,(p-1)*a+o-n),m=Math.floor(d/2),v=d-m,g=Math.floor(f/2);c={top:m,bottom:v,left:g,right:f-g,type:"SAME"}}else if("valid"===e)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-i+1)/r),p=Math.ceil((n-o+1)/a);else{if("object"!=typeof e)throw Error("Unknown padding parameter: ".concat(e));var y="channelsLast"===u?e[1][0]:e[2][0],b="channelsLast"===u?e[1][1]:e[2][1],x="channelsLast"===u?e[2][0]:e[3][0],k="channelsLast"===u?e[2][1]:e[3][1];c={top:y,bottom:b,left:x,right:k,type:0===y&&0===b&&0===x&&0===k?"VALID":"EXPLICIT"},l=iu((t-i+y+b)/r+1,s),p=iu((n-o+x+k)/a+1,s)}return{padInfo:c,outHeight:l,outWidth:p}}(a,c,l,w,I,_,E,i,s),R=A.padInfo,F=A.outHeight,Z=A.outWidth,D=o?b*p:b;return"channelsFirst"===s?m=[u,D,F,Z]:"channelsLast"===s&&(m=[u,F,Z,D]),{batchSize:u,dataFormat:s,inHeight:c,inWidth:l,inChannels:p,outHeight:F,outWidth:Z,outChannels:D,padInfo:R,strideHeight:w,strideWidth:I,filterHeight:g,filterWidth:y,effectiveFilterHeight:_,effectiveFilterWidth:E,dilationHeight:T,dilationWidth:C,inShape:e,outShape:m,filterShape:t}}function eu(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",s=arguments.length>7?arguments[7]:void 0,u=-1,c=-1,l=-1,p=-1,d=-1;if("channelsLast"===o){var f=(0,h.Z)(e,5);u=f[0],c=f[1],l=f[2],p=f[3],d=f[4]}else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat ".concat(o));var m=(0,h.Z)(e,5);u=m[0],d=m[1],c=m[2],l=m[3],p=m[4]}var v,g=(0,h.Z)(t,5),y=g[0],b=g[1],x=g[2],k=g[4],w=ru(n),I=(0,h.Z)(w,3),S=I[0],N=I[1],T=I[2],C=ru(r),_=(0,h.Z)(C,3),E=_[0],A=_[1],R=_[2],F=au(y,E),Z=au(b,A),D=au(x,R),M=function(e,t,n,r,a,i,o,s,u,c,l){var p,h,d,f;if("valid"===e&&(e=0),"number"==typeof e){p={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var m=function(e,t,n,r,a,i){null==a&&(a=tu(e,t[0],r[0]));for(var o=[0,0,0,n],s=0;s<3;s++)e[s]+2*a>=t[s]&&(o[s]=iu((e[s]-t[s]+2*a)/r[s]+1,i));return o}([t,n,r,1],[s,u,c],1,[a,i,o],e,l);h=m[0],d=m[1],f=m[2]}else{if("same"!==e)throw Error("Unknown padding parameter: ".concat(e));var v=((h=Math.ceil(t/a))-1)*a+s-t,g=((d=Math.ceil(n/i))-1)*i+u-n,y=((f=Math.ceil(r/o))-1)*o+c-r,b=Math.floor(v/2),x=v-b,k=Math.floor(g/2),w=g-k,I=Math.floor(y/2);p={top:k,bottom:w,left:I,right:y-I,front:b,back:x,type:"SAME"}}return{padInfo:p,outDepth:h,outHeight:d,outWidth:f}}(a,c,l,p,S,N,T,F,Z,D,s),O=M.padInfo,L=M.outDepth,z=M.outHeight,P=M.outWidth,B=i?k*d:k;return"channelsFirst"===o?v=[u,B,L,z,P]:"channelsLast"===o&&(v=[u,L,z,P,B]),{batchSize:u,dataFormat:o,inDepth:c,inHeight:l,inWidth:p,inChannels:d,outDepth:L,outHeight:z,outWidth:P,outChannels:B,padInfo:O,strideDepth:S,strideHeight:N,strideWidth:T,filterDepth:y,filterHeight:b,filterWidth:x,effectiveFilterDepth:F,effectiveFilterHeight:Z,effectiveFilterWidth:D,dilationDepth:E,dilationHeight:A,dilationWidth:R,inShape:e,outShape:v,filterShape:t}}function tu(e,t,n){var r=au(t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1);return Math.floor((e[0]*(n-1)-n+r)/2)}function nu(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function ru(e){return"number"==typeof e?[e,e,e]:e}function au(e,t){return t<=1?e:e+(e-1)*(t-1)}function iu(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode ".concat(t))}}function ou(e){var t=nu(e),n=(0,h.Z)(t,3),r=n[0],a=n[1],i=n[2];return 1===r&&1===a&&1===i}function su(e,t){return ou(e)||ou(t)}function uu(e){return nu(e).every((function(e){return e>0}))}function cu(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat ".concat(e))}function lu(e,t,n){if(null!=n){if("string"==typeof t)throw Error("Error in ".concat(e,": pad must be an integer when using dimRoundingMode ").concat(n," but got pad ").concat(t,"."));if("number"==typeof t)le(ve(t),(function(){return"Error in ".concat(e,": pad must be an integer when using dimRoundingMode ").concat(n," but got pad ").concat(t,".")}));else{if("object"!=typeof t)throw Error("Error in ".concat(e,": Unknown padding parameter: ").concat(t));t.forEach((function(t){t.forEach((function(t){le(ve(t),(function(){return"Error in ".concat(e,": pad must be an integer when using dimRoundingMode ").concat(n," but got pad ").concat(t,".")}))}))}))}}}var pu=qi({reshape_:function(e,t){var n={x:Gi(e,"x","reshape","string_or_numeric")},r={shape:t};return Zi.runKernel(yr,n,r)}});var hu=qi({avgPool_:function(e,t,n,r,a){var i=Gi(e,"x","avgPool","float32");le(su(n,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(1,"'")}));var o=i,s=!1;3===i.rank&&(s=!0,o=pu(i,[1,i.shape[0],i.shape[1],i.shape[2]])),le(4===o.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(o.rank,".")})),lu("avgPool",r,a);var u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},l=Zi.runKernel(gt,u,c);return l=cs(l,i.dtype),s?pu(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var du=qi({avgPool3d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=Gi(e,"x","avgPool3d","float32"),s=o,u=!1;4===o.rank&&(u=!0,s=pu(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),le(5===s.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,".")})),le("NDHWC"===i,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ".concat(i)})),le("number"==typeof n&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,(function(){return"Error in avgPool3d: Stride must be > 0, but got '".concat(n,"'")})),lu("avgPool3d",r,a);var c={x:s},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},p=Zi.runKernel(bt,c,l);return p=cs(p,s.dtype),u?pu(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}});var fu=qi({concat_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;le(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=Hi(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))})),1===n.length)return ls(n[0]);var r=n,a={axis:t};return Zi.runKernel(Rt,r,a)}});var mu=qi({matMul_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Gi(e,"a","matMul"),i=Gi(t,"b","matMul"),o=Si(a,i),s=(0,h.Z)(o,2),u={a:a=s[0],b:i=s[1]},c={transposeA:n,transposeB:r};return Zi.runKernel(kt,u,c)}});var vu=qi({sigmoid_:function(e){var t={x:Gi(e,"x","sigmoid","float32")};return Zi.runKernel(Mr,t)}});var gu=qi({slice_:function(e,t,n){var r=Gi(e,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");var a={x:r},i={begin:t,size:n};return Zi.runKernel(Rr,a,i)}});var yu=qi({tanh_:function(e){var t={x:Gi(e,"x","tanh","float32")};return Zi.runKernel(ta,t)}});var bu=qi({basicLSTMCell_:function(e,t,n,r,a,i){var o=Gi(e,"forgetBias","basicLSTMCell"),s=Gi(t,"lstmKernel","basicLSTMCell"),u=Gi(n,"lstmBias","basicLSTMCell"),c=Gi(r,"data","basicLSTMCell"),l=Gi(a,"c","basicLSTMCell"),p=Gi(i,"h","basicLSTMCell"),h=fu([c,p],1),d=mu(h,s),f=Zs(d,u),m=f.shape[0],v=f.shape[1]/4,g=[m,v],y=gu(f,[0,0],g),b=gu(f,[0,v],g),x=gu(f,[0,2*v],g),k=gu(f,[0,3*v],g),w=Zs(Os(vu(y),yu(b)),Os(l,vu(Zs(o,x))));return[w,Os(yu(w),vu(k))]}});var xu=qi({batchToSpaceND_:function(e,t,n){var r=Gi(e,"x","batchToSpaceND"),a=t.reduce((function(e,t){return e*t}));le(r.rank>=1+t.length,(function(){return"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(t.length)})),le(n.length===t.length,(function(){return"crops.length is ".concat(n.length," but should be equal to blockShape.length  ").concat(t.length)})),le(r.shape[0]%a===0,(function(){return"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of the elements of blockShape ").concat(t.join(" * ")," === ").concat(a)}));var i={x:r},o={blockShape:t,crops:n};return Zi.runKernel(wt,i,o)}});function ku(e){return 0===e.rank||1===e.rank?pu(e,[1,1,1,e.size]):2===e.rank?pu(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?pu(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e}var wu=qi({batchNorm_:function(e,t,n,r,a,i){null==i&&(i=.001);var o,s,u=Gi(e,"x","batchNorm"),c=Gi(t,"mean","batchNorm"),l=Gi(n,"variance","batchNorm");null!=a&&(o=Gi(a,"scale","batchNorm")),null!=r&&(s=Gi(r,"offset","batchNorm")),le(c.rank===l.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),le(null==s||c.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),le(null==o||c.rank===o.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var p={x:ku(u),scale:o,offset:s,mean:c,variance:l},h={varianceEpsilon:i},d=Zi.runKernel(dn,p,h);return pu(d,u.shape)}});var Iu=qi({batchNorm2d_:function(e,t,n,r,a,i){var o,s,u=Gi(e,"x","batchNorm"),c=Gi(t,"mean","batchNorm"),l=Gi(n,"variance","batchNorm");return null!=a&&(o=Gi(a,"scale","batchNorm")),null!=r&&(s=Gi(r,"offset","batchNorm")),le(2===u.rank,(function(){return"Error in batchNorm2D: x must be rank 2 but got rank ".concat(u.rank,".")})),le(2===c.rank||1===c.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ".concat(c.rank,".")})),le(2===l.rank||1===l.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ".concat(l.rank,".")})),null!=o&&le(2===o.rank||1===o.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ".concat(o.rank,".")})),null!=s&&le(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ".concat(s.rank,".")})),wu(u,c,l,s,o,i)}});var Su=qi({batchNorm3d_:function(e,t,n,r,a,i){var o,s,u=Gi(e,"x","batchNorm"),c=Gi(t,"mean","batchNorm"),l=Gi(n,"variance","batchNorm");return null!=a&&(o=Gi(a,"scale","batchNorm")),null!=r&&(s=Gi(r,"offset","batchNorm")),le(3===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank ".concat(u.rank,".")})),le(3===c.rank||1===c.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ".concat(c.rank,".")})),le(3===l.rank||1===l.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ".concat(l.rank,".")})),null!=o&&le(3===o.rank||1===o.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ".concat(o.rank,".")})),null!=s&&le(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ".concat(s.rank,".")})),wu(u,c,l,s,o,i)}});var Nu=qi({batchNorm4d_:function(e,t,n,r,a,i){var o,s,u=Gi(e,"x","batchNorm"),c=Gi(t,"mean","batchNorm"),l=Gi(n,"variance","batchNorm");return null!=a&&(o=Gi(a,"scale","batchNorm")),null!=r&&(s=Gi(r,"offset","batchNorm")),le(4===u.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank ".concat(u.rank,".")})),le(4===c.rank||1===c.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ".concat(c.rank,".")})),le(4===l.rank||1===l.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ".concat(l.rank,".")})),null!=o&&le(4===o.rank||1===o.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ".concat(o.rank,".")})),null!=s&&le(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ".concat(s.rank,".")})),wu(u,c,l,s,o,i)}});var Tu=qi({bincount_:function(e,t,n){var r=Gi(e,"x","bincount"),a=Gi(t,"weights","bincount");le("int32"===r.dtype,(function(){return"Error in bincount: input dtype must be int32, but got ".concat(r.dtype)})),le(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),le(a.size===r.size||0===a.size,(function(){return"Error in bincount: weights must have the same size as input or0-length, but got input shape: ".concat(r.shape,", weights shape: ").concat(a.shape,".")}));var i={x:r,weights:a},o={size:n};return Zi.runKernel(It,i,o)}});var Cu=qi({broadcastArgs_:function(e,t){var n=Gi(e,"s0","broadcastArgs","int32"),r=Gi(t,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error("broadcastArgs(): first input must be a vector (rank=1). Has rank ".concat(n.rank));if(1!==r.rank)throw new Error("broadcastArgs(): second input must be a vector (rank=1). Has rank ".concat(r.rank));var a={s0:n,s1:r};return Zi.runKernel(Nt,a)}});var _u=qi({broadcastTo_:function(e,t){var n=Gi(e,"broadcastTo","x"),r=n.shape;if(He(t),t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){for(var a=n.shape.slice();a.length<t.length;)a.unshift(1);n=pu(n,a)}for(var i=n.shape,o=Array.from(t),s=t.length-1;s>=0;s--)if(i[s]===t[s])o[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(t,"]."));if(0===o.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0})).length)return ls(n);var u={x:n},c={reps:o};return Zi.runKernel(na,u,c)}});var Eu=qi({ceil_:function(e){var t={x:Gi(e,"x","ceil","float32")};return Zi.runKernel(Ct,t)}});function Au(e,t,n){He(e);var r={shape:e,value:t,dtype:n};return Zi.runKernel(cn,{},r)}var Ru=qi({clipByValue_:function(e,t,n){var r=Gi(e,"x","clipByValue");if(le(t<=n,(function(){return"Error in clip: min (".concat(t,") must be less than or equal to max (").concat(n,").")})),t===n)return Au(r.shape,t,r.dtype);var a={x:r},i={clipValueMin:t,clipValueMax:n};return Zi.runKernel(_t,a,i)}});var Fu=qi({concat1d_:function(e){return fu(e,0)}});var Zu=qi({concat2d_:function(e,t){return fu(e,t)}});var Du=qi({concat3d_:function(e,t){return fu(e,t)}});var Mu=qi({concat4d_:function(e,t){return fu(e,t)}});var Ou=qi({conv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=Gi(e,"x","conv2d","float32"),u=Gi(t,"filter","conv2d","float32"),c=s,l=!1;3===s.rank&&(l=!0,c=pu(s,[1,s.shape[0],s.shape[1],s.shape[2]])),le(4===c.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")})),le(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank ".concat(u.rank,".")})),lu("conv2d",r,o);var p="NHWC"===a?c.shape[3]:c.shape[1];le(p===u.shape[2],(function(){return"Error in conv2d: depth of input (".concat(p,") must match input depth for filter ").concat(u.shape[2],".")})),le(su(n,i),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(i,"'")})),le(uu(i),(function(){return"Error in conv2D: Dilated rates should be larger than 0."})),le(uu(n),(function(){return"Error in conv2D: Strides should be larger than 0."}));var h={x:c,filter:u},d={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},f=Zi.runKernel(Ft,h,d);return l?pu(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});var Lu=qi({conv1d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6?arguments[6]:void 0,s=Gi(e,"x","conv1d"),u=Gi(t,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=pu(s,[1,s.shape[0],s.shape[1]])),le(3===c.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")})),le(3===u.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank ".concat(u.rank,".")})),lu("conv1d",r,o),le(c.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match input depth for filter ").concat(u.shape[1],".")})),le(su(n,i),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride ".concat(n," and dilation '").concat(i,"'")})),le(uu(i),(function(){return"Error in conv1D: Dilated rates should be larger than 0."})),le(uu(n),(function(){return"Error in conv1D: Stride should be larger than 0."})),le("NWC"===a,(function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")}));var p=pu(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=pu(c,[c.shape[0],1,c.shape[1],c.shape[2]]),d=Ou(h,p,[1,n],r,"NHWC",[1,i],o);return pu(d,l?[d.shape[2],d.shape[3]]:[d.shape[0],d.shape[2],d.shape[3]])}});var zu=qi({conv2DBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0;le(e.length===t.rank,(function(){return"Length of inShape (".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var s=e,u=t,c=!1;3===t.rank&&(c=!0,u=pu(t,[1,t.shape[0],t.shape[1],t.shape[2]]),s=[1,e[0],e[1],e[2]]),le(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length ".concat(s.length,".")})),le(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank ".concat(u.rank)})),le(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank ".concat(n.rank)}));var l="NHWC"===i?s[3]:s[1],p="NHWC"===i?u.shape[3]:u.shape[1];le(l===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must match input depth for filter ").concat(n.shape[2],".")})),le(p===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output (".concat(p,") must match output depth for filter ").concat(n.shape[3],".")})),lu("conv2dDerInput",a,o);var h={dy:u,filter:n},d={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},f=Zi.runKernel(Dt,h,d);return c?pu(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});var Pu=qi({conv2dTranspose_:function(e,t,n,r,a,i){var o=Gi(e,"x","conv2dTranspose"),s=Gi(t,"filter","conv2dTranspose");return zu(n,o,s,r,a,"NHWC",i)}});var Bu=qi({conv3d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NDHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],o=Gi(e,"x","conv3d"),s=Gi(t,"filter","conv3d"),u=o,c=!1;4===o.rank&&(c=!0,u=pu(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),le(5===u.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")})),le(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank ".concat(s.rank,".")})),le(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match input depth for filter ").concat(s.shape[3],".")})),le(su(n,i),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(i,"'")})),le("NDHWC"===a,(function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")})),le(uu(i),(function(){return"Error in conv3D: Dilated rates should be larger than 0."})),le(uu(n),(function(){return"Error in conv3D: Strides should be larger than 0."}));var l={x:u,filter:s},p={strides:n,pad:r,dataFormat:a,dilations:i},h=Zi.runKernel(Mt,l,p);return c?pu(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});var Wu=qi({conv3DBackpropInput_:function(e,t,n,r,a){le(e.length===t.rank,(function(){return"Length of inShape (".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var i=e,o=t,s=!1;4===t.rank&&(s=!0,o=pu(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),i=[1,e[0],e[1],e[2],e[3]]);var u=i[4],c=o.shape[4];le(5===i.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length ".concat(i.length,".")})),le(5===o.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank ".concat(o.rank)})),le(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank ".concat(n.rank)})),le(u===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must match input depth for filter ").concat(n.shape[3],".")})),le(c===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must match output depth for filter ").concat(n.shape[4],".")}));var l={dy:o,filter:n},p={pad:a,strides:r,inputShape:i},h=Zi.runKernel(Lt,l,p);return s?pu(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});var Vu=qi({conv3dTranspose_:function(e,t,n,r,a){var i=Gi(e,"x","conv3dTranspose"),o=Gi(t,"filter","conv3dTranspose");return Wu(n,i,o,r,a)}});var Uu=qi({cos_:function(e){var t={x:Gi(e,"x","cos","float32")};return Zi.runKernel(zt,t)}});var Gu=qi({cosh_:function(e){var t={x:Gi(e,"x","cosh","float32")};return Zi.runKernel(Pt,t)}});var Hu=qi({cumprod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a={x:Gi(e,"x","cumprod")},i={axis:t,exclusive:n,reverse:r};return Zi.runKernel(Bt,a,i)}});var ju=qi({cumsum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a={x:Gi(e,"x","cumsum")},i={axis:t,exclusive:n,reverse:r};return Zi.runKernel(Wt,a,i)}});var qu=qi({denseBincount_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Gi(e,"x","denseBincount"),i=Gi(t,"weights","denseBincount");le("int32"===a.dtype,(function(){return"Error in denseBincount: input dtype must be int32, but got ".concat(a.dtype)})),le(a.rank<=2,(function(){return"Error in denseBincount: input must be at most rank 2, but got rank ".concat(a.rank,".")})),le(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),le(i.size===a.size||0===i.size,(function(){return"Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ".concat(a.shape,", weights shape: ").concat(i.shape,".")}));var o={x:a,weights:i},s={size:n,binaryOutput:r};return Zi.runKernel(Ut,o,s)}});var Ku=qi({depthToSpace_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NHWC",r=Gi(e,"x","depthToSpace","float32"),a="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];le(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(t)})),le(a*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(a," and ").concat(t,"  for depthToSpace with input shape\n    ").concat(r.shape)})),le(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(i," and ").concat(t," for depthToSpace with input shape\n        ").concat(r.shape)})),le(o%(t*t)===0,(function(){return"Dimension size must be evenly divisible by ".concat(t*t," but is ").concat(o," for depthToSpace with input shape ").concat(r.shape)}));var s={x:r},u={blockSize:t,dataFormat:n};return Zi.runKernel(Gt,s,u)}});var Xu=qi({depthwiseConv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=Gi(e,"x","depthwiseConv2d","float32"),u=Gi(t,"filter","depthwiseConv2d","float32"),c=s,l=!1;3===s.rank&&(l=!0,c=pu(s,[1,s.shape[0],s.shape[1],s.shape[2]])),le(4===c.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank ".concat(c.rank,".")})),le(4===u.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank ".concat(u.rank,".")}));var p="NHWC"===a?c.shape[3]:c.shape[1];le(p===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels (".concat(p,") must match the inChannels dimension in filter ").concat(u.shape[2],".")})),lu("depthwiseConv2d",r,o);var h={x:c,filter:u},d={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},f=Zi.runKernel(Ht,h,d);return l?pu(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});var Yu=qi({diag_:function(e){var t={x:Gi(e,"x","diag")};return Zi.runKernel(Kt,t)}});var Ju=qi({dilation2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=Gi(e,"x","dilation2d"),s=Gi(t,"filter","dilation2d");le(3===o.rank||4===o.rank,(function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank ".concat(o.rank,".")})),le(3===s.rank,(function(){return"Error in dilation2d: filter must be rank 3, but got rank ".concat(s.rank,".")})),le("NHWC"===i,(function(){return"Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ".concat(i)}));var u=o,c=!1;3===o.rank&&(u=pu(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),le(u.shape[3]===s.shape[2],(function(){return"Error in dilation2d:  input and filter must have the same depth: ".concat(u.shape[3]," vs ").concat(s.shape[2])}));var l={x:u,filter:s},p={strides:n,pad:r,dilations:a},h=Zi.runKernel(Xt,l,p);return c?pu(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),Qu={};function $u(e,t){for(var n=e.length,r=[],a=0;a<n;a++){var i=n-1-a,o=e[i]||1;(t[t.length-1-a]||1)>1&&1===o&&r.unshift(i)}return r}function ec(e,t){for(var n=[],r=0;r<t.length;r++){var a=e[e.length-r-1],i=t.length-r-1,o=t[i];(null==a||1===a&&o>1)&&n.unshift(i)}return n}function tc(e,t){for(var n=[],r=Math.max(e.length,t.length),a=0;a<r;a++){var i=e[e.length-a-1];null==i&&(i=1);var o=t[t.length-a-1];if(null==o&&(o=1),1===i)n.unshift(o);else if(1===o)n.unshift(i);else{if(i!==o){var s="Operands could not be broadcast together with shapes ".concat(e," and ").concat(t,".");throw Error(s)}n.unshift(i)}}return n}A(Qu,{assertAndGetBroadcastShape:function(){return tc},getBroadcastDims:function(){return $u},getReductionAxes:function(){return ec}});var nc=qi({equal_:function(e,t){var n,r,a=Gi(e,"a","equal","string_or_numeric"),i=Gi(t,"b","equal","string_or_numeric");n=Si(a,i),a=(r=(0,h.Z)(n,2))[0],i=r[1],tc(a.shape,i.shape);var o={a:a,b:i};return Zi.runKernel(rn,o)}});var rc=qi({where_:function(e,t,n){var r=Gi(t,"a","where"),a=Gi(n,"b","where"),i=Gi(e,"condition","where","bool"),o=tc(tc(i.shape,r.shape),a.shape),s={condition:_u(i,o),t:_u(r,o),e:_u(a,o)};return Zi.runKernel(Er,s)}});var ac=qi({zerosLike_:function(e){var t={x:Gi(e,"x","zerosLike")};return Zi.runKernel(la,t)}});var ic=qi({divNoNan_:function(e,t){var n=Gi(e,"a","div"),r=Gi(t,"b","div"),a=Si(n,r),i=(0,h.Z)(a,2);n=i[0],r=i[1];var o=Ms(n,r),s=ac(o),u=nc(r,s);return rc(u,s,o)}});var oc=qi({dot_:function(e,t){var n=Gi(e,"t1","dot"),r=Gi(t,"t2","dot");le((1===n.rank||2===n.rank)&&(1===r.rank||2===r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks ".concat(n.rank," and ").concat(r.rank,".")}));var a=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];if(le(a===i,(function(){return"Error in dot: inner dimensions of inputs must match, but got ".concat(a," and ").concat(i,".")})),1===n.rank&&1===r.rank){var o=pu(n,[1,-1]),s=pu(r,[-1,1]),u=mu(o,s);return pu(u,[])}if(1===n.rank&&2===r.rank){var c=pu(n,[1,-1]),l=pu(r,[r.shape[0],r.shape[1]]),p=mu(c,l);return pu(p,[p.size])}if(2===n.rank&&1===r.rank){var h=pu(r,[-1,1]),d=mu(n,h);return pu(d,[d.size])}var f=pu(r,[r.shape[0],r.shape[1]]);return mu(n,f)}});var sc=qi({einsum_:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n.map((function(e,t){return Gi(e,"tensors".concat(t),"einsum")})),i={equation:e};return Zi.runKernel($t,a,i)}});var uc=qi({elu_:function(e){var t={x:Gi(e,"x","elu","float32")};return Zi.runKernel(en,t)}});var cc=qi({erf_:function(e){var t=Gi(e,"x","erf");le("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=cs(t,"float32"));var n={x:t};return Zi.runKernel(nn,n)}});function lc(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function pc(e,t,n){for(var r=e.length+t.length,a=[],i=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?a.push(e[i++]):a.push(t[o++]);return a}function hc(e,t){for(var n=[],r=e.length,a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);var i=t.map((function(t){return e[t]}));return[n,i]}function dc(e,t){return pc(e,t.map((function(e){return 1})),t)}function fc(e,t,n){le(lc(t,n),(function(){return"".concat(e," supports only inner-most axes for now. Got axes ").concat(t," and rank-").concat(n," input.")}))}function mc(e,t){if(lc(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function vc(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function gc(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}var yc=qi({max_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:Gi(e,"x","max")},a={reductionIndices:t,keepDims:n};return Zi.runKernel(zn,r,a)}});var bc=qi({min_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:Gi(e,"x","min")},a={axis:t,keepDims:n};return Zi.runKernel(jn,r,a)}});var xc=qi({pow_:function(e,t){var n=Gi(e,"base","pow"),r=Gi(t,"exp","pow"),a=Si(n,r),i=(0,h.Z)(a,2),o={a:n=i[0],b:r=i[1]};return Zi.runKernel(ur,o)}});function kc(e,t){if((Ja(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&Ja(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Xi(e,[],[],t)}var wc=qi({sqrt_:function(e){var t={x:Gi(e,"x","sqrt","float32")};return Zi.runKernel(Lr,t)}});var Ic=qi({square_:function(e){var t=Gi(e,"x","square");return Zi.runKernel("Square",{x:t},{})}});var Sc=qi({sum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Gi(e,"x","sum");"bool"===r.dtype&&(r=cs(r,"int32"));var a={x:r},i={axis:t,keepDims:n};return Zi.runKernel(zr,a,i)}});function Nc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===e.rank)return Ls(e);if(1!==e.rank&&null===n)return Nc(pu(e,[-1]),t,n);if(1===e.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===t)return Sc(Ls(e),n);if(t===1/0)return yc(Ls(e),n);if(t===-1/0)return bc(Ls(e),n);if("euclidean"===t||2===t)return wc(Sc(xc(Ls(e),kc(2,"int32")),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}if(Array.isArray(n)&&2===n.length){if(1===t)return yc(Sc(Ls(e),n[0]),n[1]-1);if(t===1/0)return yc(Sc(Ls(e),n[1]),n[0]);if(t===-1/0)return bc(Sc(Ls(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return wc(Sc(Ic(e),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}throw new Error("Error in norm: invalid axis: ".concat(n))}var Tc=qi({norm_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Nc(e=Gi(e,"x","norm"),t,n),i=a.shape;if(r){var o=Ie(n,e.shape);i=dc(a.shape,o)}return pu(a,i)}});var Cc=qi({euclideanNorm_:function(e){return Tc(e,"euclidean",arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}});var _c=qi({exp_:function(e){var t={x:Gi(e,"x","exp")};return Zi.runKernel(an,t)}});var Ec=qi({expandDims_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Gi(e,"x","expandDims","string_or_numeric");le(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r={input:n},a={dim:t};return Zi.runKernel(on,r,a)}});var Ac=qi({expm1_:function(e){var t={x:Gi(e,"x","expm1")};return Zi.runKernel(sn,t)}});var Rc=qi({tile_:function(e,t){var n=Gi(e,"x","tile","string_or_numeric");le(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," must match length of reps ").concat(t,".")}));var r={x:n},a={reps:t};return Zi.runKernel(na,r,a)}});var Fc=qi({eye_:function(e,t,n){null==t&&(t=e);for(var r=us([e,t],arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32"),a=e<=t?e:t,i=0;i<a;++i)r.set(1,i,i);var o=pu(r.toTensor(),[e,t]);if(null==n)return o;if(1===n.length)return Rc(Ec(o,0),[n[0],1,1]);if(2===n.length)return Rc(Ec(Ec(o,0),0),[n[0],n[1],1,1]);if(3===n.length)return Rc(Ec(Ec(Ec(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received ".concat(n.length,"D."))}});var Zc=qi({floor_:function(e){var t={x:Gi(e,"x","floor","float32")};return Zi.runKernel(pn,t)}});var Dc=qi({gather_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a={x:Gi(e,"x","gather"),indices:Gi(t,"indices","gather","int32")},i={axis:n,batchDims:r};return Zi.runKernel(fn,a,i)}});var Mc=qi({greater_:function(e,t){var n,r,a=Gi(e,"a","greater","string_or_numeric"),i=Gi(t,"b","greater","string_or_numeric");n=Si(a,i),a=(r=(0,h.Z)(n,2))[0],i=r[1],tc(a.shape,i.shape);var o={a:a,b:i};return Zi.runKernel(vn,o)}});var Oc=qi({greaterEqual_:function(e,t){var n,r,a=Gi(e,"a","greaterEqual","string_or_numeric"),i=Gi(t,"b","greaterEqual","string_or_numeric");n=Si(a,i),a=(r=(0,h.Z)(n,2))[0],i=r[1],tc(a.shape,i.shape);var o={a:a,b:i};return Zi.runKernel(gn,o)}});var Lc=qi({imag_:function(e){var t={input:Gi(e,"input","imag")};return Zi.runKernel(xn,t)}});var zc=qi({isFinite_:function(e){var t={x:Gi(e,"x","isFinite")};return Zi.runKernel(kn,t)}});var Pc=qi({isInf_:function(e){var t={x:Gi(e,"x","isInf")};return Zi.runKernel(wn,t)}});var Bc=qi({isNaN_:function(e){var t={x:Gi(e,"x","isNaN")};return Zi.runKernel(In,t)}});var Wc=qi({leakyRelu_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,n={x:Gi(e,"x","leakyRelu")},r={alpha:t};return Zi.runKernel(Sn,n,r)}});var Vc=qi({less_:function(e,t){var n,r,a=Gi(e,"a","less","string_or_numeric"),i=Gi(t,"b","less","string_or_numeric");n=Si(a,i),a=(r=(0,h.Z)(n,2))[0],i=r[1],tc(a.shape,i.shape);var o={a:a,b:i};return Zi.runKernel(Nn,o)}});var Uc=qi({lessEqual_:function(e,t){var n,r,a=Gi(e,"a","lessEqual","string_or_numeric"),i=Gi(t,"b","lessEqual","string_or_numeric");n=Si(a,i),a=(r=(0,h.Z)(n,2))[0],i=r[1],tc(a.shape,i.shape);var o={a:a,b:i};return Zi.runKernel(Tn,o)}});function Gc(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");var r={start:e,stop:t,num:n};return Zi.runKernel(Cn,{},r)}var Hc=qi({localResponseNormalization_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,i=Gi(e,"x","localResponseNormalization");le(4===i.rank||3===i.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ".concat(i.rank,".")})),le(ve(t),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ".concat(t,".")}));var o=i,s=!1;3===i.rank&&(s=!0,o=pu(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},c={depthRadius:t,bias:n,alpha:r,beta:a},l=Zi.runKernel(On,u,c);return s?pu(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var jc=qi({log_:function(e){var t={x:Gi(e,"x","log","float32")};return Zi.runKernel(_n,t)}});var qc=qi({log1p_:function(e){var t={x:Gi(e,"x","log1p")};return Zi.runKernel(En,t)}});function Kc(e){return le(Oe(e),(function(){return"The f passed in grad(f) must be a function"})),function(t,n){var r=Gi(t,"x","tf.grad","string_or_numeric"),a=null!=n?Gi(n,"dy","tf.grad"):null;return Zi.tidy((function(){var t=Zi.gradients((function(){return e(r)}),[r],a),n=t.value,i=t.grads;return null!=a&&pe(n.shape,a.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),el(i),i[0]}))}}function Xc(e){return le(Oe(e),(function(){return"The f passed in grads(f) must be a function"})),function(t,n){le(Array.isArray(t),(function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"}));var r=Hi(t,"args","tf.grads","string_or_numeric"),a=null!=n?Gi(n,"dy","tf.grads"):null;return Zi.tidy((function(){var t=Zi.gradients((function(){return e.apply(void 0,(0,g.Z)(r))}),r,a),n=t.value,i=t.grads;return null!=a&&pe(n.shape,a.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),el(i),i}))}}function Yc(e){return le(Oe(e),(function(){return"The f passed in valueAndGrad(f) must be a function"})),function(t,n){le(t instanceof hi,(function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"})),le(null==n||n instanceof hi,(function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"}));var r=Zi.gradients((function(){return e(t)}),[t],n),a=r.grads,i=r.value;return el(a),{grad:a[0],value:i}}}function Jc(e){return le(Oe(e),(function(){return"The f passed in valueAndGrads(f) must be a function"})),function(t,n){le(Array.isArray(t)&&t.every((function(e){return e instanceof hi})),(function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"})),le(null==n||n instanceof hi,(function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"}));var r=Zi.gradients((function(){return e.apply(void 0,(0,g.Z)(t))}),t,n);return null!=n&&pe(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),el(r.grads),r}}function Qc(e,t){le(Oe(e),(function(){return"The f passed in variableGrads(f) must be a function"})),le(null==t||Array.isArray(t)&&t.every((function(e){return e instanceof fi})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=t;if(!n)for(var r in t=[],Zi.registeredVariables)t.push(Zi.registeredVariables[r]);var a=n?t.filter((function(e){return!e.trainable})):null,i=t.length;t=t.filter((function(e){return e.trainable})),le(t.length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the ".concat(i," variables is trainable.")}));var o=Zi.gradients(e,t,null,!0),s=o.value,u=o.grads;le(u.some((function(e){return null!=e})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),le(0===s.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-".concat(s.rank," tensor")}));var c={};return t.forEach((function(e,t){null!=u[t]&&(c[e.name]=u[t])})),null!=a&&a.forEach((function(e){return c[e.name]=null})),{value:s,grads:c}}function $c(e){return Zi.customGrad(e)}function el(e){if(e.filter((function(e){return null==e})).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}var tl=qi({neg_:function(e){var t={x:Gi(e,"x","neg")};return Zi.runKernel(Qn,t)}});var nl=qi({softplus_:function(e){var t={x:Gi(e,"x","softplus")};return Zi.runKernel(Or,t)}});var rl=qi({logSigmoid_:function(e){var t=Gi(e,"x","logSigmoid");return $c((function(e){return{value:tl(nl(tl(e))),gradFunc:function(t){return Os(t,vu(tl(e)))}}}))(t)}});var al=qi({sub_:function(e,t){var n=Gi(e,"a","sub"),r=Gi(t,"b","sub"),a=Si(n,r),i=(0,h.Z)(a,2),o={a:n=i[0],b:r=i[1]};return Zi.runKernel($r,o)}});var il=qi({logSoftmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=Gi(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(n.rank," and axis was ").concat(t));return $c((function(e,n){var r=yc(e,t,!0),a=al(e,r),i=al(cs(a,"float32"),jc(Sc(_c(a),t,!0)));return n([i]),{value:i,gradFunc:function(e,n){var r=(0,h.Z)(n,1)[0],a=_c(r);return al(e,Os(Sc(e,t,!0),a))}}}))(n)}});var ol=qi({logSumExp_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Gi(e,"x","logSumExp"),a=Ie(t,r.shape),i=yc(r,a,!0),o=al(r,i),s=_c(o),u=Sc(s,a),c=jc(u),l=Zs(pu(i,c.shape),c);if(n){var p=dc(l.shape,a);return pu(l,p)}return l}});var sl=qi({logicalAnd_:function(e,t){var n=Gi(e,"a","logicalAnd","bool"),r=Gi(t,"b","logicalAnd","bool");tc(n.shape,r.shape);var a={a:n,b:r};return Zi.runKernel(An,a)}});var ul=qi({logicalNot_:function(e){var t={x:Gi(e,"x","logicalNot","bool")};return Zi.runKernel(Rn,t)}});var cl=qi({logicalOr_:function(e,t){var n=Gi(e,"a","logicalOr","bool"),r=Gi(t,"b","logicalOr","bool");tc(n.shape,r.shape);var a={a:n,b:r};return Zi.runKernel(Fn,a)}});var ll=qi({logicalXor_:function(e,t){var n=Gi(e,"a","logicalXor","bool"),r=Gi(t,"b","logicalXor","bool");return tc(n.shape,r.shape),sl(cl(e,t),ul(sl(e,t)))}}),pl=2147483648;var hl=qi({searchSorted_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"left",r=Gi(e,"sortedSequence","searchSorted"),a=Gi(t,"values","searchSorted"),i=r.shape[r.shape.length-1],o=a.shape[a.shape.length-1],s=pu(r,[-1,i]),u=pu(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(de(u.shape)>=pl)throw new Error("values tensor size must less than ".concat(pl));if(s.shape[1]>=pl)throw new Error("trailing dim_size must less than ".concat(pl," for int32 output type, was ").concat(s.shape[1]));var c={sortedSequence:s,values:u},l={side:n};return Zi.runKernel(_r,c,l)}});function dl(e,t){return hl(e,t,"left")}var fl=qi({maxPool_:function(e,t,n,r,a){var i=Gi(e,"x","maxPool"),o=i,s=!1;3===i.rank&&(s=!0,o=pu(i,[1,i.shape[0],i.shape[1],i.shape[2]])),le(4===o.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(o.rank,".")})),le(su(n,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(1,"'")})),lu("maxPool",r,a);var u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},l=Zi.runKernel(Bn,u,c);return s?pu(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var ml=qi({maxPool3d_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=Gi(e,"x","maxPool3d"),s=o,u=!1;4===o.rank&&(u=!0,s=pu(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),le(5===s.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,".")})),le("NDHWC"===i,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ".concat(i)})),lu("maxPool3d",r,a);var c={x:s},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},p=Zi.runKernel(Vn,c,l);return u?pu(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}});var vl=qi({maxPoolWithArgmax_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i={x:Gi(e,"x","maxPoolWithArgmax")},o={filterSize:t,strides:n,pad:r,includeBatchInIndex:a},s=Zi.runKernel(Gn,i,o);return{result:s[0],indexes:s[1]}}});var gl=qi({maximum_:function(e,t){var n,r,a=Gi(e,"a","maximum"),i=Gi(t,"b","maximum");n=Si(a,i),a=(r=(0,h.Z)(n,2))[0],i=r[1],"bool"===a.dtype&&(a=cs(a,"int32"),i=cs(i,"int32")),tc(a.shape,i.shape);var o={a:a,b:i};return Zi.runKernel(Pn,o)}});var yl=qi({mean_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:Gi(e,"x","mean")},a={axis:t,keepDims:n};return Zi.runKernel(Hn,r,a)}});function bl(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if(He(e),"complex64"===t){var n=bl(e,"float32"),r=bl(e,"float32");return Ki(n,r)}var a=Ue(de(e),t);return Zi.makeTensor(a,e,t)}function xl(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if(He(e),"complex64"===t){var n=xl(e,"float32"),r=bl(e,"float32");return Ki(n,r)}var a=Ve(de(e),t);return Zi.makeTensor(a,e,t)}function kl(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).indexing,r=void 0===n?"xy":n;if("xy"!==r&&"ij"!==r)throw new TypeError("".concat(r," is not a valid third argument to meshgrid"));if(void 0===e)return[];var a=Gi(e,"x","meshgrid",e instanceof hi?e.dtype:"float32");if(void 0===t)return[a];var i=Gi(t,"y","meshgrid",t instanceof hi?t.dtype:"float32"),o=de(a.shape),s=de(i.shape);return"xy"===r?(a=pu(a,[1,-1]),i=pu(i,[-1,1]),[mu(xl([s,1],a.dtype),a),mu(i,xl([1,o],i.dtype))]):(a=pu(a,[-1,1]),i=pu(i,[1,-1]),[mu(a,xl([1,s],a.dtype)),mu(xl([o,1],i.dtype),i)])}var wl=qi({minimum_:function(e,t){var n,r,a=Gi(e,"a","minimum"),i=Gi(t,"b","minimum");n=Si(a,i),a=(r=(0,h.Z)(n,2))[0],i=r[1],"bool"===a.dtype&&(a=cs(a,"int32"),i=cs(i,"int32")),tc(a.shape,i.shape);var o={a:a,b:i};return Zi.runKernel(qn,o)}});var Il=qi({mirrorPad_:function(e,t,n){le("reflect"===n||"symmetric"===n,(function(){return"Invalid mode. Mode must be either reflect or symmetric. Got ".concat(n,".")}));var r=Gi(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");le(t.length===r.rank,(function(){return"Padding doesn't match input. Must be ".concat(r.rank,". Got ").concat(t.length,".")}));for(var a="reflect"===n?1:0,i=function(e){le(2===t[e].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),le(t[e][0]>=0&&t[e][0]<=r.shape[e]-a&&t[e][1]>=0&&t[e][1]<=r.shape[e]-a,(function(){return"Padding in dimension ".concat(e," cannot be greater than or equal to ").concat(r.shape[e]-a," or less than 0 for input of shape ").concat(r.shape)}))},o=0;o<r.rank;o++)i(o);var s={paddings:t,mode:n},u={x:r};return Zi.runKernel(Kn,u,s)}});var Sl=qi({mod_:function(e,t){var n=Gi(e,"a","mod"),r=Gi(t,"b","mod"),a=Si(n,r),i=(0,h.Z)(a,2),o={a:n=i[0],b:r=i[1]};return Zi.runKernel(Xn,o)}});var Nl=qi({moments_:function(e){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=Ie(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,(e=Gi(e,"x","moments")).shape),r=yl(e,n,t),a=r.shape;t||(a=dc(r.shape,n));var i=Ic(al(cs(e,"float32"),pu(r,a)));return{mean:r,variance:yl(i,n,t)}}});var Tl=qi({multiRNNCell_:function(e,t,n,r){for(var a=Gi(t,"data","multiRNNCell"),i=Hi(n,"c","multiRNNCell"),o=Hi(r,"h","multiRNNCell"),s=a,u=[],c=0;c<e.length;c++){var l=e[c](s,i[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}for(var p=[],h=[],d=0;d<u.length;d+=2)p.push(u[d]),h.push(u[d+1]);return[p,h]}});var Cl=qi({multinomial_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Gi(e,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got ".concat(i,"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(o));n=n||Math.random();var s={logits:1===o?pu(a,[1,-1]):a},u={numSamples:t,seed:n,normalized:r},c=Zi.runKernel(Yn,s,u);return 1===o?pu(c,[c.size]):c}});var _l=qi({notEqual_:function(e,t){var n,r,a=Gi(e,"a","notEqual","string_or_numeric"),i=Gi(t,"b","notEqual","string_or_numeric");n=Si(a,i),a=(r=(0,h.Z)(n,2))[0],i=r[1],tc(a.shape,i.shape);var o={a:a,b:i};return Zi.runKernel($n,o)}});var El=qi({oneHot_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"int32";if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(t));var i={indices:Gi(e,"indices","oneHot","int32")},o={dtype:a,depth:t,onValue:n,offValue:r};return Zi.runKernel(ar,i,o)}});var Al=qi({onesLike_:function(e){var t={x:Gi(e,"x","onesLike")};return Zi.runKernel(rr,t)}});var Rl=qi({outerProduct_:function(e,t){var n=Gi(e,"v1","outerProduct"),r=Gi(t,"v2","outerProduct");le(1===n.rank&&1===r.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks ".concat(n.rank," and ").concat(r.rank,".")}));var a=pu(n,[-1,1]),i=pu(r,[1,-1]);return mu(a,i)}});var Fl=qi({pad_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Gi(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:t,constantValue:n},i={x:r};return Zi.runKernel(or,i,a)}});var Zl=qi({pad1d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return le(2===t.length,(function(){return"Invalid number of paddings. Must be length of 2."})),Fl(e,[t],n)}});var Dl=qi({pad2d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return le(2===t.length&&2===t[0].length&&2===t[1].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Fl(e,t,n)}});var Ml=qi({pad3d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return le(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Fl(e,t,n)}});var Ol=qi({pad4d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return le(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Fl(e,t,n)}});var Ll=qi({spaceToBatchND_:function(e,t,n){var r=Gi(e,"x","spaceToBatchND");le(r.rank>=1+t.length,(function(){return"input rank ".concat(r.rank," should be > than [blockShape] ").concat(t.length)})),le(n.length===t.length,(function(){return"paddings.shape[0] ".concat(n.length," must be equal to [blockShape] ").concat(t.length)})),le(r.shape.reduce((function(e,r,a){return a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]===0:e}),!0),(function(){return"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(n.toString()," must be divisible by blockShapes ").concat(t.toString())}));var a={x:r},i={blockShape:t,paddings:n};return Zi.runKernel(Pr,a,i)}});var zl=qi({pool_:function(e,t,n,r,a,i,o){null==a&&(a=[1,1]),null==i&&(i=1),0===r&&(r="valid");var s=Gi(e,"x","maxPool"),u=s,c=!1;3===s.rank&&(c=!0,u=pu(s,[1,s.shape[0],s.shape[1],s.shape[2]])),le(su(i,a),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides ".concat(i," and dilations '").concat(a,"'")}));var l,p=Js(u.shape,t,i,a,r),d=[p.dilationHeight,p.dilationWidth];l="same"===r?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})).map((function(e){return e-1})),r=n.map((function(e){return Math.floor(e/2)})),a=n.map((function(e,t){return e-r[t]}));return n.map((function(e,t){return[r[t],a[t]]}))}([p.filterHeight,p.filterWidth],d):[[0,0],[0,0]];var f=1===d[0]&&1===d[1],m=function(e,t,n){var r=n.map((function(e){return e[0]})),a=n.map((function(e){return e[1]})),i=e.concat(r,a),o=t.map((function(e,t){return(e-i[t]%e)%e})),s=a.map((function(e,t){return e+o[t]})),u=t.map((function(e,t){return[r[t],s[t]]})),c=t.map((function(e,t){return[0,o[t]]}));return[u,c]}([p.inHeight,p.inWidth],d,l),v=(0,h.Z)(m,2),g=v[0],y=v[1],b=f?r:"valid",x=f?u:Ll(u,d,g),k=("avg"===n?function(){return hu(x,t,i,b,o)}:function(){return fl(x,t,i,b,o)})(),w=f?k:xu(k,d,y);return c?pu(w,[w.shape[1],w.shape[2],w.shape[3]]):w}});var Pl=qi({prelu_:function(e,t){var n={x:Gi(e,"x","prelu"),alpha:Gi(t,"alpha","prelu")};return Zi.runKernel(cr,n)}});var Bl=qi({prod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Gi(e,"x","prod");"bool"===r.dtype&&(r=cs(r,"int32"));var a={x:r},i={axis:t,keepDims:n};return Zi.runKernel(lr,a,i)}});var Wl=qi({raggedGather_:function(e,t,n,r){var a={paramsNestedSplits:e.map((function(e,t){return Gi(e,"tensors".concat(t),"raggedGather","int32")})),paramsDenseValues:Gi(t,"paramsDenseValues","raggedGather"),indices:Gi(n,"indices","raggedGather","int32")},i={outputRaggedRank:r},o=Zi.runKernel(pr,a,i);return{outputNestedSplits:o.slice(0,o.length-1),outputDenseValues:o[o.length-1]}}});var Vl=qi({raggedRange_:function(e,t,n){var r=Gi(e,"starts","raggedRange"),a={starts:r,limits:Gi(t,"limits","raggedRange",r.dtype),deltas:Gi(n,"deltas","raggedRange",r.dtype)},i=Zi.runKernel(hr,a);return{rtNestedSplits:i[0],rtDenseValues:i[1]}}});var Ul=qi({raggedTensorToTensor_:function(e,t,n,r,a){var i=Gi(e,"shape","raggedTensorToTensor","int32"),o=Gi(t,"values","raggedTensorToTensor"),s={shape:i,values:o,defaultValue:Gi(n,"defaultValue","raggedTensorToTensor",o.dtype),rowPartitionTensors:r.map((function(e,t){return Gi(e,"tensors".concat(t),"raggedTensorToTensor","int32")}))},u={rowPartitionTypes:a};return Zi.runKernel(dr,s,u)}});var Gl=qi({rand_:function(e,t,n){He(e);var r=de(e),a=null;if(null==n||"float32"===n)a=new Float32Array(r);else if("int32"===n)a=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type ".concat(n));a=new Uint8Array(r)}for(var i=0;i<r;i++)a[i]=t();return Zi.makeTensor(a,e,n)}}),Hl=R(U()),jl={};A(jl,{TEST_EPSILON_FLOAT16:function(){return Kl},createVideoElement:function(){return ip},encodeStrings:function(){return ap},expectArrayBuffersEqual:function(){return rp},expectArraysClose:function(){return Xl},expectArraysEqual:function(){return $l},expectNumbersClose:function(){return ep},expectPromiseToFail:function(){return Ql},expectValuesInRange:function(){return np},play:function(){return op},testEpsilon:function(){return Yl}});var ql=.001,Kl=.1;function Xl(e,t,n){return null==n&&(n=Yl()),Jl(e,t,(function(e,t){return tp(e,t,n)}))}function Yl(){return 32===Zi.backend.floatPrecision()?ql:Kl}function Jl(e,t,n){var r=!0;if((Ja(e)||Ja(t))&&(r=!1),Ja(e)&&Ja(t)&&(r=!0),r){var a=e.constructor.name,i=t.constructor.name;if(a!==i)throw new Error("Arrays are of different type. Actual: ".concat(a,". Expected: ").concat(i))}if(Array.isArray(e)&&Array.isArray(t)){var o=Wi(e),s=Wi(t);if(!me(o,s))throw new Error("Arrays have different shapes. Actual: [".concat(o,"]. Expected: [").concat(s,"]"))}var u=Ja(e)?e:Qa(e),c=Ja(t)?t:Qa(t);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: ".concat(u.length," vs expected: ").concat(c.length,".\nActual:   ").concat(u,".\nExpected: ").concat(c,"."));for(var l=0;l<c.length;++l){var p=u[l],h=c[l];if(!n(p,h))throw new Error("Arrays differ: actual[".concat(l,"] = ").concat(p,", expected[").concat(l,"] = ").concat(h,".\nActual:   ").concat(u,".\nExpected: ").concat(c,"."))}"undefined"!=typeof expect&&expect().nothing()}function Ql(e,t){e().then((function(){return t.fail()}),(function(){return t()})),"undefined"!=typeof expect&&expect().nothing()}function $l(e,t){var n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return Fe(e)||Fe(e[0])||Fe(t)||Fe(t[0])?Jl(e,n,(function(e,t){return e==t})):Jl(e,t,(function(e,t){return tp(e,t,0)}))}function ep(e,t,n){if(null==n&&(n=Yl()),!tp(e,t,n))throw new Error("Numbers differ: actual === ".concat(e,", expected === ").concat(t));"undefined"!=typeof expect&&expect().nothing()}function tp(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}function np(e,t,n){for(var r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error("Value out of range:".concat(e[r]," low: ").concat(t,", high: ").concat(n))}function rp(e,t){var n=new Float32Array(e),r=new Float32Array(t);if(n.length!==r.length)throw new Error("Expected ArrayBuffer to be of length ".concat(r.length,", but it was ").concat(n.length));for(var a=0;a<r.length;a++)if(n[a]!==r[a])throw new Error("Expected ArrayBuffer value at ".concat(a," to be ").concat(r[a]," but got ").concat(n[a]," instead"))}function ap(e){for(var t=0;t<e.length;t++){var n=e[t];Array.isArray(n)?ap(n):e[t]=Xa(n)}return e}function ip(e){var t=document.createElement("video");return"playsInline"in t&&(t.playsInline=!0),t.muted=!0,t.loop=!0,t.style.position="fixed",t.style.left="0px",t.style.top="0px",t.preload="auto",t.appendChild(e),new Promise((function(e){t.addEventListener("loadeddata",(function(n){return e(t)})),t.load()}))}function op(e){return sp.apply(this,arguments)}function sp(){return sp=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.play();case 2:if(e.t0="requestVideoFrameCallback"in t,!e.t0){e.next=6;break}return e.next=6,new Promise((function(e){t.requestVideoFrameCallback(e)}));case 6:case"end":return e.stop()}}),e)}))),sp.apply(this,arguments)}var up=function(){function e(t,n,r,a,i){(0,m.Z)(this,e),this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=i||Math.random();this.random=Hl.alea(o.toString())}return(0,v.Z)(e,[{key:"nextValue",value:function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var a=void 0,i=void 0,o=void 0;do{o=(a=2*this.random()-1)*a+(i=2*this.random()-1)*i}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*a*s,n=this.mean+this.stdDev*i*s,(!this.truncated||this.isValidTruncated(t))&&(r=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(t)}},{key:"convertValue",value:function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}},{key:"isValidTruncated",value:function(e){return e<=this.upper&&e>=this.lower}}]),e}(),cp=function(){function e(t,n,r,a){(0,m.Z)(this,e),this.alpha=t,this.beta=1/n,this.dtype=r;var i=a||Math.random();this.randu=Hl.alea(i.toString()),this.randn=new up(0,1,r,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return(0,v.Z)(e,[{key:"nextValue",value:function(){for(var e,t,n,r,a,i;;){do{r=this.randn.nextValue(),i=1+this.c*r}while(i<=0);if(i*=i*i,t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-i+Math.log(i)),(a=this.randu())<t||Math.log(a)<n)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)}},{key:"convertValue",value:function(e){return"float32"===this.dtype?e:Math.round(e)}}]),e}(),lp=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if((0,m.Z)(this,e),this.canReturnFloat=function(){return null==t.dtype||"float32"===t.dtype},this.min=n,this.range=r-n,this.dtype=a,null==i&&(i=Math.random()),"number"==typeof i&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(n," - ").concat(r," <= 1 and dtype is not float"));this.random=Hl.alea(i)}return(0,v.Z)(e,[{key:"convertValue",value:function(e){return this.canReturnFloat()?e:Math.round(e)}},{key:"nextValue",value:function(){return this.convertValue(this.min+this.range*this.random())}}]),e}();var pp=qi({randomGamma_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0;if(He(e),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type ".concat(r));for(var i=new cp(t,n,r,a),o=us(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var hp=qi({randomNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(He(e),null!=r&&"bool"===r)throw new Error("Unsupported data type ".concat(r));for(var i=new up(t,n,r,!1,a),o=us(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var dp=qi({randomStandardNormal_:function(e,t,n){if(null!=t&&"bool"===t)throw new Error("Unsupported data type ".concat(t));return hp(e,0,1,t,n)}});var fp=qi({randomUniform_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0;He(e);for(var i=us(e,r),o=new lp(t,n,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}});function mp(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");var a={start:e,stop:t,step:n,dtype:r};return Zi.runKernel(fr,{},a)}var vp=qi({real_:function(e){var t={input:Gi(e,"input","real")};return Zi.runKernel(mr,t)}});var gp=qi({reciprocal_:function(e){var t={x:Gi(e,"x","reciprocal")};return Zi.runKernel(vr,t)}});var yp=qi({relu_:function(e){var t={x:Gi(e,"x","relu")};return Zi.runKernel(gr,t)}});var bp=qi({relu6_:function(e){var t={x:Gi(e,"x","relu6")};return Zi.runKernel(Ir,t)}});var xp=qi({reverse_:function(e,t){var n={x:Gi(e,"x","reverse")},r={dims:t};return Zi.runKernel(Sr,n,r)}});var kp=qi({reverse1d_:function(e){var t=Gi(e,"x","reverse");return le(1===t.rank,(function(){return"Error in reverse1D: x must be rank 1 but got rank ".concat(t.rank,".")})),xp(t,0)}});var wp=qi({reverse2d_:function(e,t){var n=Gi(e,"x","reverse");return le(2===n.rank,(function(){return"Error in reverse2D: x must be rank 2 but got rank ".concat(n.rank,".")})),xp(n,t)}});var Ip=qi({reverse3d_:function(e,t){var n=Gi(e,"x","reverse");return le(3===n.rank,(function(){return"Error in reverse3D: x must be rank 3 but got rank ".concat(n.rank,".")})),xp(n,t)}});var Sp=qi({reverse4d_:function(e,t){var n=Gi(e,"x","reverse");return le(4===n.rank,(function(){return"Error in reverse4D: x must be rank 4 but got rank ".concat(n.rank,".")})),xp(n,t)}});var Np=qi({round_:function(e){var t={x:Gi(e,"x","round")};return Zi.runKernel(Nr,t)}});var Tp=qi({rsqrt_:function(e){var t={x:Gi(e,"x","rsqrt","float32")};return Zi.runKernel(Tr,t)}});var Cp=qi({selu_:function(e){var t={x:Gi(e,"x","selu")};return Zi.runKernel(Ar,t)}});var _p=qi({separableConv2d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NHWC",s=Gi(e,"x","separableConv2d"),u=Gi(t,"depthwiseFilter","separableConv2d"),c=Gi(n,"pointwiseFilter","separableConv2d"),l=s,p=!1;if(3===s.rank&&(p=!0,l=pu(s,[1,s.shape[0],s.shape[1],s.shape[2]])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");le(4===l.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got rank ".concat(l.rank,".")})),le(4===u.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank ".concat(u.rank,".")})),le(4===c.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank ".concat(u.rank,".")})),le(1===c.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ".concat(c.shape[0],".")})),le(1===c.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ".concat(c.shape[1],".")}));var h=u.shape[2],d=u.shape[3];le(c.shape[2]===h*d,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be ".concat(h*d,", but got ").concat(c.shape[2],".")}));var f=Xu(l,u,r,a,o,i),m=Ou(f,c,1,"valid",o);return p?pu(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});function Ep(){return Ep=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,h,f;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Gi(t,"x","setdiff1d"),a=Gi(n,"y","setdiff1d"),le(r.dtype===a.dtype,(function(){return"x and y should have the same dtype, but got x (".concat(r.dtype,") and y (").concat(a.dtype,").")})),le(1===r.rank,(function(){return"x should be 1D tensor, but got x (".concat(r.shape,").")})),le(1===a.rank,(function(){return"y should be 1D tensor, but got y (".concat(a.shape,").")})),e.next=4,r.data();case 4:return i=e.sent,e.next=7,a.data();case 7:for(o=e.sent,s=new Set(o),u=0,c=0;c<i.length;c++)s.has(i[c])||u++;for(l=new ci([u],r.dtype),p=new ci([u],"int32"),h=0,f=0;h<i.length;h++)s.has(i[h])||(l.values[f]=i[h],p.values[f]=h,f++);return e.abrupt("return",[l.toTensor(),p.toTensor()]);case 14:case"end":return e.stop()}}),e)}))),Ep.apply(this,arguments)}var Ap=function(e,t){return Ep.apply(this,arguments)};var Rp=qi({sign_:function(e){var t={x:Gi(e,"x","sign")};return Zi.runKernel(Dr,t)}});var Fp=qi({sin_:function(e){var t={x:Gi(e,"x","sin","float32")};return Zi.runKernel(Fr,t)}});var Zp=qi({sinh_:function(e){var t={x:Gi(e,"x","sinh")};return Zi.runKernel(Zr,t)}});var Dp=qi({slice1d_:function(e,t,n){var r=Gi(e,"x","slice1d");return le(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(r.rank," tensor")})),gu(r,[t],[n])}});var Mp=qi({slice2d_:function(e,t,n){var r=Gi(e,"x","slice2d");return le(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(r.rank," tensor")})),gu(r,t,n)}});var Op=qi({slice3d_:function(e,t,n){var r=Gi(e,"x","slice3d");return le(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(r.rank," tensor")})),gu(r,t,n)}});var Lp=qi({slice4d_:function(e,t,n){var r=Gi(e,"x","slice4d");return le(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(r.rank," tensor")})),gu(r,t,n)}});var zp=qi({softmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=Gi(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(n.rank," and dim was ").concat(t));var r={logits:n},a={dim:t};return Zi.runKernel(Wr,r,a)}});var Pp=qi({fft_:function(e){le("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 but got ".concat(e.dtype,".")}));var t={input:e};return Zi.runKernel(un,t)}});var Bp=qi({ifft_:function(e){le("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got ".concat(e.dtype,".")}));var t={input:e};return Zi.runKernel(bn,t)}});var Wp=qi({irfft_:function(e){var t,n=e.shape[e.shape.length-1],r=e.size/n;if(n<=2){var a=pu(e,[r,n]);t=Bp(a)}else{var i=[r,2*(n-1)],o=pu(vp(e),[r,n]),s=pu(Lc(e),[r,n]),u=xp(gu(o,[0,1],[r,n-2]),1),c=Os(xp(gu(s,[0,1],[r,n-2]),1),kc(-1)),l=fu([o,u],1),p=fu([s,c],1),h=pu(Ki(l,p),[i[0],i[1]]);t=Bp(h)}if(t=vp(t),3===e.rank&&0!==e.shape[0]){var d=t,f=e.shape[0];t=pu(t,[f,t.shape[0]/f,t.shape[1]]),d.dispose()}return t}});var Vp=qi({split_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r={x:Gi(e,"x","split")},a={numOrSizeSplits:t,axis:n};return Zi.runKernel(Br,r,a)}});var Up=qi({rfft_:function(e,t){le("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got ".concat(e.dtype)}));var n,r=e.shape[e.shape.length-1],a=e.size/r;if(null!=t&&t<r){var i=e.shape.map((function(e){return 0})),o=e.shape.map((function(e){return e}));o[e.shape.length-1]=t,n=gu(e,i,o),r=t}else if(null!=t&&t>r){var s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t-r,n=fu([e,bl(s)],e.shape.length-1),r=t}else n=e;var u=ac(n),c=pu(Ki(n,u),[a,r]),l=Pp(c),p=Math.floor(r/2)+1,h=vp(l),d=Lc(l),f=Vp(h,[p,r-p],h.shape.length-1),m=Vp(d,[p,r-p],d.shape.length-1),v=n.shape.slice();return v[n.shape.length-1]=p,pu(Ki(f[0],m[0]),v)}});var Gp=qi({squaredDifference_:function(e,t){var n,r,a=Gi(e,"a","squaredDifference"),i=Gi(t,"b","squaredDifference");n=Si(a,i),a=(r=(0,h.Z)(n,2))[0],i=r[1],tc(a.shape,i.shape);var o={a:a,b:i};return Zi.runKernel(qr,o,{})}});var Hp=qi({squeeze_:function(e,t){var n=Gi(e,"x","squeeze","string_or_numeric");return pu(n,Se(n.shape,t).newShape)}});var jp=qi({stack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Hi(e,"tensors","stack","string_or_numeric");le(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),n.length>0&&le(t<=n[0].rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n,a={axis:t};return Zi.runKernel(ir,r,a)}});var qp=qi({step_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:Gi(e,"x","step")},r={alpha:t};return Zi.runKernel(pa,n,r)}});var Kp=qi({stridedSlice_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,c={x:Gi(e,"x","stridedSlice","string_or_numeric")},l={begin:t,end:n,strides:r,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return Zi.runKernel(Xr,c,l)}});var Xp=qi({tan_:function(e){var t={x:Gi(e,"x","tan","float32")};return Zi.runKernel(ea,t)}});function Yp(e,t){he(e);var n=Wi(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Xi(e,null,n,t)}function Jp(e,t,n){if(he(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=Wi(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Xi(e,t,r,n)}function Qp(e,t,n){if(he(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=Wi(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Xi(e,t,r,n)}function $p(e,t,n){if(he(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=Wi(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Xi(e,t,r,n)}function eh(e,t,n){if(he(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=Wi(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Xi(e,t,r,n)}function th(e,t,n){if(he(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=Wi(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Xi(e,t=t||r,r,n)}var nh=qi({topk_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=Gi(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(t<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(t));if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") but got ").concat(t));var i={x:r},o={k:t,sorted:n},s=Zi.runKernel(ra,i,o),u=(0,h.Z)(s,2);return{values:u[0],indices:u[1]}}});var rh=qi({truncatedNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(He(e),null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");for(var i=new up(t,n,r,!0,a),o=us(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var ah=qi({unique_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Gi(e,"x","unique","string_or_numeric");le(n.rank>0,(function(){return"The input tensor must be at least 1D"}));var r={x:n},a={axis:t},i=Zi.runKernel(oa,r,a),o=(0,h.Z)(i,2);return{values:o[0],indices:o[1]}}});var ih=qi({unsortedSegmentSum_:function(e,t,n){var r=Gi(e,"x","unsortedSegmentSum"),a=Gi(t,"segmentIds","unsortedSegmentSum","int32");le(ve(n),(function(){return"numSegments must be of dtype int"}));var i={x:r,segmentIds:a},o={numSegments:n};return Zi.runKernel(ua,i,o)}});var oh=qi({unstack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Gi(e,"x","unstack","string_or_numeric");le(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")")}));var r={value:n},a={axis:t};return Zi.runKernel(sa,r,a)}});function sh(e,t){return hl(e,t,"right")}function uh(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return Zi.makeVariable(e,t,n,r)}function ch(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);for(var a=us(e,"int32"),i=us([n.length,e.length],"int32"),o=0;o<n.length;o++){var s=a.indexToLoc(n[o]),u=o*e.length;i.values.set(s,u)}return i.toTensor()}function lh(){return lh=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r,a;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Gi(t,"condition","whereAsync","bool"),e.next=3,n.data();case 3:return r=e.sent,a=ch(n.shape,r),e.abrupt("return",(t!==n&&n.dispose(),a));case 6:case"end":return e.stop()}}),e)}))),lh.apply(this,arguments)}var ph=function(e){return lh.apply(this,arguments)};function hh(){return hh=(0,f.Z)((0,d.Z)().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,h,f,m,v,g;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=Gi(t,"tensor","boolMask"),i=Gi(n,"mask","boolMask","bool"),o=null==r?0:r,s=i.rank,u=a.shape,le(s>0,(function(){return"mask cannot be scalar"})),pe(u.slice(o,o+s),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),c=1,l=o;l<o+s;l++)c*=u[l];return p=u.slice(0,o).concat([c],u.slice(o+s)),h=pu(a,p),f=pu(i,[-1]),e.next=9,ph(f);case 9:return m=e.sent,v=Hp(m,[1]),g=Dc(h,v,o),e.abrupt("return",(t!==a&&a.dispose(),n!==i&&i.dispose(),v.dispose(),h.dispose(),f.dispose(),m.dispose(),g));case 13:case"end":return e.stop()}}),e)}))),hh.apply(this,arguments)}var dh=function(e,t,n){return hh.apply(this,arguments)};var fh=qi({transpose_:function(e,t,n){var r=Gi(e,"x","transpose");if(null==t&&(t=r.shape.map((function(e,t){return t})).reverse()),le(r.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(r.rank," must match length of perm ").concat(t,".")})),t.forEach((function(e){le(e>=0&&e<r.rank,(function(){return"All entries in 'perm' must be between 0 and ".concat(r.rank-1," but got ").concat(t)}))})),r.rank<=1)return r.clone();var a={x:r},i={perm:t};return"complex64"===r.dtype?xs((function(){var e=vp(r),t=Lc(r);return e=Zi.runKernel(ia,{x:e},i),t=Zi.runKernel(ia,{x:t},i),n&&(t=tl(t)),Ki(e,t)})):Zi.runKernel(ia,a,i)}});var mh=qi({movingAverage_:function(e,t,n,r){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=Gi(e,"v","movingAverage"),o=Gi(t,"x","movingAverage"),s=Gi(n,"decay","movingAverage");Ni(i,o),le(me(i.shape,o.shape),(function(){return"Shape mismatch in v and x"}));var u=kc(1),c=al(u,s),l=Os(al(o,i),c);if(a){le(null!=r,(function(){return"When using zeroDebias: true, step is required."}));var p=Gi(r,"step","movingAverage");l=Ms(l,al(u,xc(s,p)))}return Zs(i,l)}}),vh={};function gh(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ".concat(n.shape,", indices.shape: ").concat(t.shape,", shape: ").concat(e,", sliceDim: ").concat(r,", and batchDim: ").concat(a,".");if(n.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(e.length<r+(n.rank-a))throw new Error(i+" Output shape length < ".concat(r+(n.rank-a)));if(n.rank!==a+e.length-r)throw new Error(i+" update.rank != ".concat(a+e.length-r));for(var o=0;o<a;++o)if(n.shape[o]!==t.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(n.shape[o],") != indices.shape[").concat(o,"] (").concat(t.shape[o],")."));for(var s=0;s<n.rank-a;++s)if(n.shape[s+a]!==e[s+r])throw new Error(i+" updates.shape[".concat(s+a,"] (").concat(n.shape[s+a],") != shape[").concat(s+a,"] (").concat(e[s+a],")"))}function yh(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ".concat(t.rank,"."));if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ".concat(e.rank,"."));if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(t.dtype));if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(n));if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: ".concat(t.shape));if(0===e.size)throw new Error("Updates specified for empty output. updates shape: ".concat(e.shape))}gh(n,t,e)}function bh(e,t,n){for(var r=t.shape.length,a=r>1?t.shape[r-1]:1,i=n.length,o=1,s=a;s<i;++s)o*=n[s];var u=a<1?1:a;return{sliceRank:a,numUpdates:de(t.shape)/u,sliceSize:o,strides:[].concat((0,g.Z)(ze(n.slice(0,a))),[1]),outputSize:de(n)}}A(vh,{calculateShapes:function(){return bh},validateInput:function(){return yh},validateUpdateShape:function(){return gh}});var xh=qi({scatterND_:function(e,t,n){He(n);var r=Gi(e,"indices","scatterND","int32"),a=Gi(t,"updates","scatterND");yh(a,r,n);var i={indices:r,updates:a},o={shape:n};return Zi.runKernel(Cr,i,o)}});var kh=qi({sparseToDense_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;He(n);var a=Gi(e,"sparseIndices","sparseToDense","int32"),i=Gi(t,"sparseValues","sparseToDense","string_or_numeric"),o=Gi(r,"defaultValue","sparseToDense",i.dtype);!function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was ".concat(e.dtype,"."));if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape ".concat(e.shape,"."));var a=e.rank>0?e.shape[0]:1,i=e.rank>1?e.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:, ".concat(n.length,", should be: ").concat(i,"."));var o=t.size;if(0!==t.rank&&(1!==t.rank||o!==a))throw new Error("sparseValues has incorrect shape ".concat(t.shape,", should be [] or [").concat(a,"]"));if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(a,i,n,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:n};return Zi.runKernel(jr,s,u)}});var wh=qi({gatherND_:function(e,t){var n=Gi(t,"indices","gatherND","int32"),r={params:Gi(e,"x","gatherND","string_or_numeric"),indices:n};return Zi.runKernel(mn,r)}});var Ih=qi({dropout_:function(e,t,n,r){var a=Gi(e,"x","dropout");if(le("float32"===a.dtype,(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a ".concat(a.dtype," tensor instead.")})),le(t>=0&&t<1,(function(){return"rate must be a float in the range [0, 1), but got ".concat(t,".")})),0===t)return e instanceof hi?a.clone():a;var i=function(e,t){if(null==t)return e.shape.slice();if(me(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(a,n),o=1-t,s=Ms(Zc(Zs(fp(i,0,1,"float32",r),o)),o);return Os(a,s)}});function Sh(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function Nh(e,t,n){for(var r=1-e%2,a=new Float32Array(e),i=0;i<e;++i){var o=2*Math.PI*i/(e+r-1);a[i]=t-n*Math.cos(o)}return Yp(a,"float32")}function Th(){return Th=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,h,f,m,v,g,y,b=arguments;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=b.length>2&&void 0!==b[2]?b[2]:1,a=Gi(t,"predictions","inTopK"),i=Gi(n,"targets","inTopK"),le(a.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got ".concat(a.rank)})),le(a.rank-1===i.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank ".concat(a.rank," and targets rank ").concat(i.rank)})),pe(a.shape.slice(0,a.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=a.shape[a.shape.length-1],le(r>0&&r<=o,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension (".concat(o,"), but got ").concat(r)})),e.next=7,a.data();case 7:return s=e.sent,e.next=10,i.data();case 10:u=e.sent,c=s.length/o,l=o,p=Ne("bool",c),h=0;case 15:if(!(h<c)){e.next=30;break}for(f=h*l,m=s.subarray(f,f+l),v=[],g=0;g<m.length;g++)v.push({value:m[g],index:g});v.sort((function(e,t){return t.value-e.value})),p[h]=0,y=0;case 20:if(!(y<r)){e.next=27;break}if(v[y].index!==u[h]){e.next=24;break}return p[h]=1,e.abrupt("break",27);case 24:y++,e.next=20;break;case 27:h++,e.next=15;break;case 30:return e.abrupt("return",(t!==a&&a.dispose(),n!==i&&i.dispose(),Yi(p,i.shape,"bool")));case 31:case"end":return e.stop()}}),e)}))),Th.apply(this,arguments)}var Ch=function(e,t){return Th.apply(this,arguments)},_h={};A(_h,{conv2d:function(){return Dh},depthwiseConv2d:function(){return Lh},matMul:function(){return zh}});var Eh=qi({conv2DBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=pu(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=pu(t,[1,t.shape[0],t.shape[1],t.shape[2]])),le(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape ".concat(s.shape,".")})),le(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape ".concat(u.shape,".")})),le(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got ".concat(n,".")}));var c="NHWC"===i?s.shape[3]:s.shape[1],l="NHWC"===i?u.shape[3]:u.shape[1];le(c===n[2],(function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must match input depth in filter (").concat(n[2],".")})),le(l===n[3],(function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must match output depth for filter (").concat(n[3],").")})),lu("conv2dDerFilter",a,o);var p={x:s,dy:u},h={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:n};return Zi.runKernel(Zt,p,h)}});function Ah(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return Os(e,qp(t));throw new Error("Cannot compute gradient for fused activation ".concat(n,"."))}function Rh(e,t){var n=t,r=ec(e.shape,t.shape);return r.length>0&&(n=Sc(n,r)),pu(n,e.shape)}function Fh(e,t,n,r){if("linear"===t)return e;if("relu"===t)return yp(e);if("elu"===t)return uc(e);if("relu6"===t)return bp(e);if("prelu"===t)return Pl(e,n);if("leakyrelu"===t)return Wc(e,r);if("sigmoid"===t)return vu(e);throw new Error("Unknown fused activation ".concat(t,"."))}var Zh=function(e,t){return!(e>0)||"linear"===t};var Dh=qi({fusedConv2d_:function(e){var t,n,r=e.x,a=e.filter,i=e.strides,o=e.pad,s=e.dataFormat,u=void 0===s?"NHWC":s,c=e.dilations,l=void 0===c?[1,1]:c,p=e.dimRoundingMode,d=e.bias,f=e.activation,m=void 0===f?"linear":f,v=e.preluActivationWeights,g=e.leakyreluAlpha;if(m=m||"linear",!1===Zh(Zi.state.gradientDepth,m)){le("NHWC"===u,(function(){return"Error in fused conv2d: got dataFormat of ".concat(u," but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.")}));var y=Ou(r,a,i,o,u,l,p);return null!=d&&(y=Zs(y,d)),Fh(y,m,v,g)}var b=Gi(r,"x","conv2d","float32"),x=Gi(a,"filter","conv2d","float32"),k=b,w=!1;3===b.rank&&(w=!0,k=pu(b,[1,b.shape[0],b.shape[1],b.shape[2]])),le(4===k.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank ".concat(k.rank,".")})),le(4===x.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank ".concat(x.rank,".")})),lu("fused conv2d",o,p);var I="NHWC"===u?k.shape[3]:k.shape[1];le(x.shape[2]===I,(function(){return"Error in conv2d: depth of input (".concat(I,") must match input depth for filter ").concat(x.shape[2],".")})),le(su(i,l),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides ".concat(i," and dilations '").concat(l,"'")}));var S,N,T=$s(k.shape,x.shape,i,l,o,p);if(null!=d&&(t=Si(S=Gi(d,"bias","fused conv2d"),b),n=(0,h.Z)(t,1),S=n[0],"NHWC"===u?tc(T.outShape,S.shape):(le(S.shape.length<=1,(function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-".concat(S.shape.length,".")})),le(0===S.shape.length||S.shape[0]===T.outChannels||1===S.shape[0],(function(){return"Error in fused conv2d: bias shape (".concat(S.shape,") is not compatible with the number of output channels (").concat(T.outChannels,")")})))),null!=v){var C=v.shape;if(le(C.length<=1||3===C.length,(function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-".concat(C.length,".")})),1===C.length)le(1===C[0]||C[0]===T.outChannels,(function(){return"Error in fused conv2d: PReLU activation weights (".concat(C,") is not compatible with the number of output channels (").concat(T.outChannels,").")}));else if(3===C.length)try{tc(C,T.outShape)}catch(F){var _="Error in fused conv2d: PReLU activation weights (".concat(C,") is not compatible with the output shape of the conv2d (").concat(T.outShape,").");throw Error(_)}N=Gi(v,"prelu weights","fused conv2d")}var E=function(e,t){le("NHWC"===u,(function(){return"Error in gradient of fused conv2D: got dataFormat of ".concat(u," but only NHWC is currently supported.")}));var n=(0,h.Z)(t,4),r=n[0],a=n[1],s=n[2],c=n[3],p=Ah(e,s,m);le(ou(l),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(l,"'")}));var d=[zu(a.shape,p,r,i,o),Eh(a,p,r.shape,i,o)];if(null!=c){var f=Rh(c,p);d.push(f)}return d},A={x:k,filter:x,bias:S,preluActivationWeights:N},R={strides:i,pad:o,dataFormat:u,dilations:l,dimRoundingMode:p,activation:m,leakyreluAlpha:g};return null==d?$c((function(e,t,n){var r=Zi.runKernel(ma,A,R);return n([t,e,r]),w&&(r=pu(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:E}}))(k,x):$c((function(e,t,n,r){var a=Zi.runKernel(ma,A,R);return r([t,e,a,n]),w&&(a=pu(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:E}}))(k,x,S)}});var Mh=qi({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=pu(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=pu(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c={x:s,dy:u},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:n};return Zi.runKernel(jt,c,l)}});var Oh=qi({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=t,u=!1;3===t.rank&&(u=!0,s=pu(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c={dy:s,filter:n},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:e},p=Zi.runKernel(qt,c,l);return u?pu(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});var Lh=qi({fusedDepthwiseConv2d_:function(e){var t,n,r=e.x,a=e.filter,i=e.strides,o=e.pad,s=e.dataFormat,u=void 0===s?"NHWC":s,c=e.dilations,l=void 0===c?[1,1]:c,p=e.dimRoundingMode,d=e.bias,f=e.activation,m=void 0===f?"linear":f,v=e.preluActivationWeights,g=e.leakyreluAlpha;if(!1===Zh(Zi.state.gradientDepth,m)){var y=Xu(r,a,i,o,u,l,p);return null!=d&&(y=Zs(y,d)),Fh(y,m,v,g)}var b=Gi(r,"x","depthwiseConv2d","float32"),x=Gi(a,"filter","depthwiseConv2d","float32"),k=b,w=!1;3===b.rank&&(w=!0,k=pu(b,[1,b.shape[0],b.shape[1],b.shape[2]])),le(4===k.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank ".concat(k.rank,".")})),le(4===x.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank ".concat(x.rank,".")})),le(k.shape[3]===x.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels (".concat(k.shape[3],") must match the inChannels dimension in filter ").concat(x.shape[2],".")})),null==l&&(l=[1,1]),le(su(i,l),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(i," and dilations '").concat(l,"'")})),lu("fused depthwiseConv2d",o,p);var I,S,N=$s(k.shape,x.shape,i,l,o,p,!0);null!=d&&(t=Si(I=Gi(d,"bias","fused conv2d"),b),n=(0,h.Z)(t,1),I=n[0],tc(N.outShape,I.shape)),null!=v&&(S=Gi(v,"prelu weights","fused depthwiseConv2d"));var T=function(e,t){le(ou(l),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '".concat(l,"'")}));var n=(0,h.Z)(t,4),r=n[0],a=n[1],s=n[2],u=n[3],c=Ah(e,s,m),d=Oh(a.shape,c,r,i,o,l,p),f=Mh(a,c,r.shape,i,o,l,p);return null!=u?[d,f,Rh(I,c)]:[d,f]},C={x:k,filter:x,bias:I,preluActivationWeights:S},_={strides:i,pad:o,dataFormat:u,dilations:l,dimRoundingMode:p,activation:m,leakyreluAlpha:g};return null==d?$c((function(e,t,n){var r=Zi.runKernel(va,C,_);return n([t,e,r]),w&&(r=pu(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:T}}))(k,x):$c((function(e,t,n,r){var a=Zi.runKernel(va,C,_);return r([t,e,a,n]),w&&(a=pu(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:T}}))(k,x,I)}});var zh=qi({fusedMatMul_:function(e){var t,n=e.a,r=e.b,a=e.transposeA,i=void 0!==a&&a,o=e.transposeB,s=void 0!==o&&o,u=e.bias,c=e.activation,l=void 0===c?"linear":c,p=e.preluActivationWeights,d=e.leakyreluAlpha,f=void 0===d?.2:d;if(!1===Zh(Zi.state.gradientDepth,l)){var m=mu(n,r,i,s);return null!=u&&(m=Zs(m,u)),Fh(m,l,p,f)}var v=Gi(n,"a","fused matMul"),g=Gi(r,"b","fused matMul"),y=Si(v,g),b=(0,h.Z)(y,2);v=b[0],g=b[1];var x=i?v.shape[v.rank-2]:v.shape[v.rank-1],k=s?g.shape[g.rank-1]:g.shape[g.rank-2],w=i?v.shape[v.rank-1]:v.shape[v.rank-2],I=s?g.shape[g.rank-2]:g.shape[g.rank-1],S=v.shape.slice(0,-2),N=g.shape.slice(0,-2),T=de(S),C=de(N);le(x===k,(function(){return"Error in fused matMul: inner shapes (".concat(x,") and (").concat(k,") of Tensors with shapes ").concat(v.shape," and ").concat(g.shape," and transposeA=").concat(i," and transposeB=").concat(s," must match.")}));var _,E,A=tc(v.shape.slice(0,-2),g.shape.slice(0,-2)).concat([w,I]),R=pu(v,i?[T,x,w]:[T,w,x]),F=pu(g,s?[C,I,k]:[C,k,I]);null!=u&&(t=Si(_=Gi(u,"bias","fused matMul"),v),_=(0,h.Z)(t,1)[0],tc(A,_.shape)),null!=p&&(E=Gi(p,"prelu weights","fused matMul"));var Z=function(e,t){var n,r,a=(0,h.Z)(t,4),o=a[0],c=a[1],p=a[2],d=a[3],f=Ah(pu(e,p.shape),p,l);return i||s?!i&&s?(n=mu(f,c,!1,!1),r=mu(f,o,!0,!1)):i&&!s?(n=mu(c,f,!1,!0),r=mu(o,f,!1,!1)):(n=mu(c,f,!0,!0),r=mu(f,o,!0,!0)):(n=mu(f,c,!1,!0),r=mu(o,f,!0,!1)),null!=u?[n,r,Rh(d,f)]:[n,r]},D={a:R,b:F,bias:_,preluActivationWeights:E},M={transposeA:i,transposeB:s,activation:l,leakyreluAlpha:f};return null==u?$c((function(e,t,n){var r=Zi.runKernel(fa,D,M);return n([e,t,r]),{value:pu(r,A),gradFunc:Z}}))(R,F):$c((function(e,t,n,r){var a=Zi.runKernel(fa,D,M);return r([e,t,a,n]),{value:pu(a,A),gradFunc:Z}}))(R,F,_)}});var Ph=qi({hammingWindow_:function(e){return Nh(e,.54,.46)}});var Bh=qi({hannWindow_:function(e){return Nh(e,.5,.5)}});var Wh=qi({frame_:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=0,o=[];i+t<=e.size;)o.push(gu(e,i,t)),i+=n;if(r)for(;i<e.size;){var s=i+t-e.size,u=fu([gu(e,i,t-s),Au([s],a)]);o.push(u),i+=n}return 0===o.length?Jp([],[0,t]):pu(fu(o),[o.length,t])}});var Vh=qi({stft_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Bh;null==r&&(r=Sh(t));var i=Wh(e,t,n),o=Os(i,a(t));return Up(o,r)}});var Uh=qi({cropAndResize_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"bilinear",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=Gi(e,"image","cropAndResize"),s=Gi(t,"boxes","cropAndResize","float32"),u=Gi(n,"boxInd","cropAndResize","int32"),c=s.shape[0];le(4===o.rank,(function(){return"Error in cropAndResize: image must be rank 4,but got rank ".concat(o.rank,".")})),le(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] but had shape ").concat(s.shape,".")})),le(1===u.rank&&u.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] but had shape ").concat(s.shape,".")})),le(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length ".concat(r.length,".")})),le(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was ".concat(r)})),le("bilinear"===a||"nearest"===a,(function(){return"method must be bilinear or nearest, but was ".concat(a)}));var l={image:o,boxes:s,boxInd:u},p={method:a,extrapolationValue:i,cropSize:r};return Zi.runKernel(Vt,l,p)}});var Gh=qi({flipLeftRight_:function(e){var t=Gi(e,"image","flipLeftRight","float32");le(4===t.rank,(function(){return"Error in flipLeftRight: image must be rank 4,but got rank ".concat(t.rank,".")}));var n={image:t};return Zi.runKernel(ln,n,{})}});var Hh=qi({grayscaleToRGB_:function(e){var t=Gi(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];le(t.rank>=2,(function(){return"Error in grayscaleToRGB: images must be at least rank 2, but got rank ".concat(t.rank,".")})),le(1===r,(function(){return"Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ".concat(r,".")}));var a=new Array(t.rank);return a.fill(1,0,n),a[n]=3,Rc(t,a)}});var jh=qi({rotateWithOffset_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=Gi(e,"image","rotateWithOffset","float32");le(4===a.rank,(function(){return"Error in rotateWithOffset: image must be rank 4,but got rank ".concat(a.rank,".")}));var i={image:a},o={radians:t,fillValue:n,center:r};return Zi.runKernel(da,i,o)}});function qh(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);var o=e.shape[0];return n=Math.min(n,o),le(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")})),le(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'")})),le(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(e.shape[1])})),le(1===t.rank,(function(){return"scores must be a 1D tensor"})),le(t.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", but was ").concat(t.shape[0])})),le(0<=i&&i<=1,(function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}var Kh=qi({nonMaxSuppression_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=Gi(e,"boxes","nonMaxSuppression","float32"),o=Gi(t,"scores","nonMaxSuppression","float32"),s=qh(i,o,n,r,a),u={maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:a=s.scoreThreshold};return Zi.runKernel(er,{boxes:i,scores:o},u)}});function Xh(e,t,n){var r=function(e,t,n){return function(e,t,n){for(var r=0,a=e.length,i=0,o=!1;r<a;){var s=n(t,e[i=r+(a-r>>>1)]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}(e,t,n||Yh)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function Yh(e,t){return e>t?1:e<t?-1:0}function Jh(e,t,n,r,a){return ed(e,t,n,r,a,0)}function Qh(e,t,n,r,a,i){return ed(e,t,n,r,a,0,!1,i,!0)}function $h(e,t,n,r,a,i){return ed(e,t,n,r,a,i,!0)}function ed(e,t,n,r,a,i){for(var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=[],l=0;l<t.length;l++)t[l]>a&&c.push({score:t[l],boxIndex:l,suppressBeginIndex:0});c.sort(rd);for(var p=i>0?-.5/i:0,h=[],d=[];h.length<n&&c.length>0;){var f=c.pop(),m=f.score,v=f.boxIndex,y=f.suppressBeginIndex;if(m<a)break;for(var b=!1,x=h.length-1;x>=y;--x){var k=td(e,v,h[x]);if(k>=r){b=!0;break}if(f.score=f.score*nd(r,p,k),f.score<=a)break}f.suppressBeginIndex=h.length,b||(f.score===m?(h.push(v),d.push(f.score)):f.score>a&&Xh(c,f,rd))}var w=h.length,I=n-w;s&&I>0&&(h.push.apply(h,(0,g.Z)(new Array(I).fill(0))),d.push.apply(d,(0,g.Z)(new Array(I).fill(0))));var S={selectedIndices:h};return o&&(S.selectedScores=d),u&&(S.validOutputs=w),S}function td(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),p=Math.max(a[0],a[2]),h=Math.max(a[1],a[3]),d=(s-i)*(u-o),f=(p-c)*(h-l);if(d<=0||f<=0)return 0;var m=Math.max(i,c),v=Math.max(o,l),g=Math.min(s,p),y=Math.min(u,h),b=Math.max(g-m,0)*Math.max(y-v,0);return b/(d+f-b)}function nd(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function rd(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function ad(){return ad=(0,f.Z)((0,d.Z)().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,h,f,m=arguments;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=m.length>3&&void 0!==m[3]?m[3]:.5,i=m.length>4&&void 0!==m[4]?m[4]:Number.NEGATIVE_INFINITY,o=Gi(t,"boxes","nonMaxSuppressionAsync"),s=Gi(n,"scores","nonMaxSuppressionAsync"),u=qh(o,s,r,a,i),r=u.maxOutputSize,a=u.iouThreshold,i=u.scoreThreshold,e.next=6,Promise.all([o.data(),s.data()]);case 6:return c=e.sent,l=c[0],p=c[1],h=Jh(l,p,r,a,i),f=h.selectedIndices,e.abrupt("return",(o!==t&&o.dispose(),s!==n&&s.dispose(),Yp(f,"int32")));case 12:case"end":return e.stop()}}),e)}))),ad.apply(this,arguments)}var id=function(e,t,n){return ad.apply(this,arguments)};var od=qi({nonMaxSuppressionWithScore_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=Gi(e,"boxes","nonMaxSuppression"),s=Gi(t,"scores","nonMaxSuppression"),u=qh(o,s,n,r,a,i),c={boxes:o,scores:s},l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:a=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},p=Zi.runKernel(nr,c,l);return{selectedIndices:p[0],selectedScores:p[1]}}});function sd(){return sd=(0,f.Z)((0,d.Z)().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,h,f,m,v,g=arguments;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=g.length>3&&void 0!==g[3]?g[3]:.5,i=g.length>4&&void 0!==g[4]?g[4]:Number.NEGATIVE_INFINITY,o=g.length>5&&void 0!==g[5]?g[5]:0,s=Gi(t,"boxes","nonMaxSuppressionAsync"),u=Gi(n,"scores","nonMaxSuppressionAsync"),c=qh(s,u,r,a,i,o),r=c.maxOutputSize,a=c.iouThreshold,i=c.scoreThreshold,o=c.softNmsSigma,e.next=7,Promise.all([s.data(),u.data()]);case 7:return l=e.sent,p=l[0],h=l[1],f=$h(p,h,r,a,i,o),m=f.selectedIndices,v=f.selectedScores,e.abrupt("return",(s!==t&&s.dispose(),u!==n&&u.dispose(),{selectedIndices:Yp(m,"int32"),selectedScores:Yp(v)}));case 14:case"end":return e.stop()}}),e)}))),sd.apply(this,arguments)}var ud=function(e,t,n){return sd.apply(this,arguments)};var cd=qi({nonMaxSuppressionPadded_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=Gi(e,"boxes","nonMaxSuppression"),s=Gi(t,"scores","nonMaxSuppression"),u=qh(o,s,n,r,a,null),c={boxes:o,scores:s},l={maxOutputSize:u.maxOutputSize,iouThreshold:u.iouThreshold,scoreThreshold:u.scoreThreshold,padToMaxOutputSize:i},p=Zi.runKernel(tr,c,l);return{selectedIndices:p[0],validOutputs:p[1]}}});function ld(){return ld=(0,f.Z)((0,d.Z)().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,f,m,v,g,y,b,x,k,w=arguments;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=w.length>3&&void 0!==w[3]?w[3]:.5,i=w.length>4&&void 0!==w[4]?w[4]:Number.NEGATIVE_INFINITY,o=w.length>5&&void 0!==w[5]&&w[5],s=Gi(t,"boxes","nonMaxSuppressionAsync"),u=Gi(n,"scores","nonMaxSuppressionAsync"),c=qh(s,u,r,a,i,null),l=c.maxOutputSize,p=c.iouThreshold,f=c.scoreThreshold,e.next=11,Promise.all([s.data(),u.data()]);case 11:return m=e.sent,v=(0,h.Z)(m,2),g=v[0],y=v[1],b=Qh(g,y,l,p,f,o),x=b.selectedIndices,k=b.validOutputs,e.abrupt("return",(s!==t&&s.dispose(),u!==n&&u.dispose(),{selectedIndices:Yp(x,"int32"),validOutputs:kc(k,"int32")}));case 19:case"end":return e.stop()}}),e)}))),ld.apply(this,arguments)}var pd=function(e,t,n){return ld.apply(this,arguments)};var hd=qi({resizeBilinear_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Gi(e,"images","resizeBilinear");le(3===a.rank||4===a.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank ".concat(a.rank,".")})),le(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape ".concat(t,".")})),le(!1===r||!1===n,(function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=pu(a,[1,a.shape[0],a.shape[1],a.shape[2]])),(0,h.Z)(t,0);var s={images:i},u={alignCorners:n,halfPixelCenters:r,size:t},c=Zi.runKernel(kr,s,u);return o?pu(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});var dd=qi({resizeNearestNeighbor_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Gi(e,"images","resizeNearestNeighbor");le(3===a.rank||4===a.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ".concat(a.rank,".")})),le(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape ".concat(t,".")})),le("float32"===a.dtype||"int32"===a.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"})),le(!1===r||!1===n,(function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=pu(a,[1,a.shape[0],a.shape[1],a.shape[2]])),(0,h.Z)(t,0);var s={images:i},u={alignCorners:n,halfPixelCenters:r,size:t},c=Zi.runKernel(br,s,u);return o?pu(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});var fd=qi({threshold_:function(e){var t,n,r,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"binary",o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,u=Gi(e,"image","threshold"),c=u.shape[0]*u.shape[1],l=Os(Yp([s]),255);if(le(3===u.rank,(function(){return"Error in threshold: image must be rank 3,but got rank ".concat(u.rank,".")})),le(3===u.shape[2]||1===u.shape[2],(function(){return"Error in threshold: image color channel must be equal to 3 or 1but got ".concat(u.shape[2],".")})),le("int32"===u.dtype||"float32"===u.dtype,(function(){return"Error in dtype: image dtype must be int32 or float32,but got dtype ".concat(u.dtype,".")})),le("otsu"===i||"binary"===i,(function(){return"Method must be binary or otsu, but was ".concat(i)})),3===u.shape[2]){var p=Vp(u,[1,1,1],-1),d=(0,h.Z)(p,3);t=d[0],n=d[1],r=d[2];var f=Os(t,.2989),m=Os(n,.587),v=Os(r,.114);a=Zs(Zs(f,m),v)}else a=e;"otsu"===i&&(l=function(e,t){for(var n,r,a,i,o,s,u=Yp([-1]),c=Yp([0]),l=Yp([0]),p=0;p<e.size-1;p++){n=gu(e,0,p+1),r=gu(e,p+1),o=Ms(Sc(n),t),s=Ms(Sc(r),t);var h=Sc(Os(n,mp(0,n.size)));a=Ms(h,Sc(n));var d=Au(r.shape,n.size),f=Zs(mp(0,r.size),d),m=Os(r,f);i=Ms(Sc(m),Sc(r));var v=al(a,i),g=al(a,i),y=Os(o,s);l=Os(Os(y,v),g);var b=Mc(l,c);c=rc(b,l,c),u=rc(b,Yp([p]),u)}return u}(Tu(cs(Np(a),"int32"),Yi([]),256),c));var g=o?Uc(a,l):Mc(a,l);return cs(Os(g,255),"int32")}});var md=qi({transform_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"constant",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5?arguments[5]:void 0,o=Gi(e,"image","transform","float32"),s=Gi(t,"transforms","transform","float32");le(4===o.rank,(function(){return"Error in transform: image must be rank 4,but got rank ".concat(o.rank,".")})),le(2===s.rank&&(s.shape[0]===o.shape[0]||1===s.shape[0])&&8===s.shape[1],(function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"})),le(null==i||2===i.length,(function(){return"Error in transform: outputShape must be [height, width] or null, but got ".concat(i,".")}));var u={image:o,transforms:s},c={interpolation:n,fillMode:r,fillValue:a,outputShape:i};return Zi.runKernel(aa,u,c)}});var vd=qi({bandPart_:function(e,t,n){le(t%1===0,(function(){return"bandPart(): numLower must be an integer, got ".concat(t,".")})),le(n%1===0,(function(){return"bandPart(): numUpper must be an integer, got ".concat(n,".")}));var r=Gi(e,"a","bandPart");le(r.rank>=2,(function(){return"bandPart(): Rank must be at least 2, got ".concat(r.rank,".")}));var a=r.shape,i=r.shape.slice(-2),o=(0,h.Z)(i,2),s=o[0],u=o[1];if(!(t<=s))throw new Error("bandPart(): numLower (".concat(t,") must not be greater than the number of rows (").concat(s,")."));if(!(n<=u))throw new Error("bandPart(): numUpper (".concat(n,") must not be greater than the number of columns (").concat(u,")."));t<0&&(t=s),n<0&&(n=u);var c=pu(mp(0,s,1,"int32"),[-1,1]),l=mp(0,u,1,"int32"),p=al(c,l),d=sl(Uc(p,kc(+t,"int32")),Oc(p,kc(-n,"int32"))),f=bl([s,u],r.dtype);return pu(jp(oh(pu(r,[-1,s,u])).map((function(e){return rc(d,e,f)}))),a)}});var gd=qi({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,le(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){le(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: (".concat(e[t].shape[0]," vs. ").concat(n,")")}))},a=1;a<e.length;++a)r(a)}else t=!0,e=Vp(e,e.shape[0],0).map((function(e){return Hp(e,[0])}));le(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors (".concat(e.length,") exceeds number of dimensions (").concat(e[0].shape[0],").")}));for(var i=[],o=e,s=function(e){i.push(Zi.tidy((function(){var t=o[e];if(e>0)for(var n=0;n<e;++n){var r=Os(Sc(Os(i[n],t)),i[n]);t=al(t,r)}return Ms(t,Tc(t,"euclidean"))})))},u=0;u<e.length;++u)s(u);return t?jp(i,0):i}});function yd(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Zi.tidy((function(){le(2===e.shape.length,(function(){return"qr2d() requires a 2D Tensor, but got a ".concat(e.shape.length,"D Tensor.")}));for(var n=e.shape[0],r=e.shape[1],a=Fc(n),i=ls(e),o=Jp([[1]],[1,1]),s=ls(o),u=n>=r?r:n,c=function(e){var t,u,c=i,l=s,p=a;t=Zi.tidy((function(){var t=gu(i,[e,e],[n-e,1]),u=Tc(t),c=gu(i,[e,e],[1,1]),l=rc(Mc(c,0),Jp([[-1]]),Jp([[1]])),p=al(c,Os(l,u)),h=Ms(t,p);s=1===h.shape[0]?ls(o):fu([o,gu(h,[1,0],[h.shape[0]-1,h.shape[1]])],0);var d=tl(Ms(mu(l,p),u)),f=gu(i,[e,0],[n-e,r]),m=Os(d,s),v=fh(s);if(0===e)i=al(f,mu(m,mu(v,f)));else{var g=al(f,mu(m,mu(v,f)));i=fu([gu(i,[0,0],[e,r]),g],0)}var y=fh(m),b=gu(a,[0,e],[n,a.shape[1]-e]);if(0===e)a=al(b,mu(mu(b,s),y));else{var x=al(b,mu(mu(b,s),y));a=fu([gu(a,[0,0],[n,e]),x],1)}return[s,i,a]})),u=(0,h.Z)(t,3),s=u[0],i=u[1],a=u[2],ks([c,l,p])},l=0;l<u;++l)c(l);return!t&&n>r&&(a=gu(a,[0,0],[n,r]),i=gu(i,[0,0],[r,r])),[a,i]}))}var bd,xd=qi({qr_:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(le(e.rank>=2,(function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(e.rank)})),2===e.rank)return yd(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=oh(pu(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],i=[];return r.forEach((function(e){var n=yd(e,t),r=(0,h.Z)(n,2),o=r[0],s=r[1];a.push(o),i.push(s)})),[pu(jp(a,0),e.shape),pu(jp(i,0),e.shape)]}});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(bd||(bd={}));var kd=qi({computeWeightedLoss_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:bd.SUM_BY_NONZERO_WEIGHTS,r=Gi(e,"losses","computeWeightedLoss"),a=null;null!=t&&(a=Gi(t,"weights","computeWeightedLoss"));var i=null==a?r:Os(r,a);if(n===bd.NONE)return i;if(n===bd.SUM)return Sc(i);if(n===bd.MEAN){if(null==a)return yl(i);var o=r.size/a.size,s=Ms(Sc(i),Sc(a));return o>1?Ms(s,kc(o)):s}if(n===bd.SUM_BY_NONZERO_WEIGHTS){if(null==a)return Ms(Sc(i),kc(r.size));var u=Os(a,xl(r.shape)),c=cs(Sc(_l(u,kc(0))),"float32");return Ms(Sc(i),c)}throw Error("Unknown reduction: ".concat(n))}});var wd=qi({absoluteDifference_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:bd.SUM_BY_NONZERO_WEIGHTS,a=Gi(e,"labels","absoluteDifference"),i=Gi(t,"predictions","absoluteDifference"),o=null;null!=n&&(o=Gi(n,"weights","absoluteDifference")),pe(a.shape,i.shape,"Error in absoluteDifference: ");var s=Ls(al(a,i));return kd(s,o,r)}});var Id=qi({cosineDistance_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:bd.SUM_BY_NONZERO_WEIGHTS,i=Gi(e,"labels","cosineDistance"),o=Gi(t,"predictions","cosineDistance"),s=null;null!=r&&(s=Gi(r,"weights","cosineDistance")),pe(i.shape,o.shape,"Error in cosineDistance: ");var u=kc(1),c=al(u,Sc(Os(i,o),n,!0));return kd(c,s,a)}});var Sd=qi({hingeLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:bd.SUM_BY_NONZERO_WEIGHTS,a=Gi(e,"labels","hingeLoss"),i=Gi(t,"predictions","hingeLoss"),o=null;null!=n&&(o=Gi(n,"weights","hingeLoss")),pe(a.shape,i.shape,"Error in hingeLoss: ");var s=kc(1);a=al(Os(kc(2),a),s);var u=yp(al(s,Os(a,i)));return kd(u,o,r)}});var Nd=qi({huberLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:bd.SUM_BY_NONZERO_WEIGHTS,i=Gi(e,"labels","huberLoss"),o=Gi(t,"predictions","huberLoss"),s=null;null!=n&&(s=Gi(n,"weights","huberLoss")),pe(i.shape,o.shape,"Error in huberLoss: ");var u=kc(r),c=Ls(al(o,i)),l=wl(c,u),p=al(c,l),h=Zs(Os(kc(.5),Ic(l)),Os(u,p));return kd(h,s,a)}});var Td=qi({logLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-7,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:bd.SUM_BY_NONZERO_WEIGHTS,i=Gi(e,"labels","logLoss"),o=Gi(t,"predictions","logLoss"),s=null;null!=n&&(s=Gi(n,"weights","logLoss")),pe(i.shape,o.shape,"Error in logLoss: ");var u=kc(1),c=kc(r),l=tl(Os(i,jc(Zs(o,c)))),p=Os(al(u,i),jc(Zs(al(u,o),c))),h=al(l,p);return kd(h,s,a)}});var Cd=qi({meanSquaredError_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:bd.SUM_BY_NONZERO_WEIGHTS,a=Gi(e,"labels","meanSquaredError"),i=Gi(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=Gi(n,"weights","meanSquaredError")),pe(a.shape,i.shape,"Error in meanSquaredError: ");var s=Gp(a,i);return kd(s,o,r)}});var _d=qi({sigmoidCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:bd.SUM_BY_NONZERO_WEIGHTS,i=Gi(e,"multiClassLabels","sigmoidCrossEntropy"),o=Gi(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=Gi(n,"weights","sigmoidCrossEntropy")),pe(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=kc(r),c=kc(1),l=kc(.5);i=Zs(Os(i,al(c,u)),Os(l,u))}var p=function(e,t){var n=Gi(e,"labels","sigmoidCrossEntropyWithLogits"),r=Gi(t,"logits","sigmoidCrossEntropyWithLogits");pe(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=yp(r),i=Os(r,n),o=qc(_c(tl(Ls(r))));return Zs(al(a,i),o)}(i,o);return kd(p,s,a)}});var Ed=qi({softmaxCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:bd.SUM_BY_NONZERO_WEIGHTS,i=Gi(e,"onehotLabels","softmaxCrossEntropy"),o=Gi(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=Gi(n,"weights","softmaxCrossEntropy")),pe(i.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var u=kc(r),c=kc(1),l=kc(i.shape[1]);i=Zs(Os(i,al(c,u)),Ms(u,l))}var p=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ".concat(t.rank," and dim was ").concat(n));return $c((function(e,t,r){var a=ol(t,[n],!0),i=al(cs(t,"float32"),a);r([e,i]);var o=tl(Os(i,e));return{value:Sc(o,[n]),gradFunc:function(e,t){var r=(0,h.Z)(t,2),a=r[0],i=r[1],o=dc(e.shape,[n]);return[Os(pu(e,o),al(cs(a,"float32"),_c(i))),Os(pu(e,o),al(_c(i),cs(a,"float32")))]}}}))(e,t)}(i,o);return kd(p,s,a)}});var Ad=qi({sparseFillEmptyRows_:function(e,t,n,r){var a=Gi(e,"indices","sparseFillEmptyRows","int32"),i=Gi(t,"values","sparseFillEmptyRows"),o=Gi(n,"denseShape","sparseFillEmptyRows","int32"),s=Gi(r,"defaultValue","sparseFillEmptyRows",i.dtype);if(2!==a.rank)throw new Error("Indices should be Tensor2D but received shape\n        ".concat(a.shape));if(1!==i.rank)throw new Error("Values should be Tensor1D but received shape ".concat(i.shape));if(1!==o.rank)throw new Error("Dense shape should be Tensor1D but received shape ".concat(o.shape));if(0!==s.rank)throw new Error("Default value should be a scalar but received shape ".concat(s.shape));var u={indices:a,values:i,denseShape:o,defaultValue:s},c=Zi.runKernel(Vr,u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}});var Rd=qi({sparseReshape_:function(e,t,n){var r=Gi(e,"inputIndices","sparseReshape","int32"),a=Gi(t,"inputShape","sparseReshape","int32"),i=Gi(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error("Input indices should be Tensor2D but received shape\n        ".concat(r.shape));if(1!==a.rank)throw new Error("Input shape should be Tensor1D but received shape ".concat(a.shape));if(1!==i.rank)throw new Error("New shape should be Tensor1D but received shape ".concat(i.shape));var o={inputIndices:r,inputShape:a,newShape:i},s=Zi.runKernel(Ur,o);return{outputIndices:s[0],outputShape:s[1]}}});var Fd=qi({sparseSegmentMean_:function(e,t,n){var r=Gi(e,"data","sparseSegmentMean"),a=Gi(t,"indices","sparseSegmentMean","int32"),i=Gi(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error("Indices should be Tensor1D but received shape\n          ".concat(a.shape));if(1!==i.rank)throw new Error("Segment ids should be Tensor1D but received shape\n          ".concat(i.shape));var o={data:r,indices:a,segmentIds:i};return Zi.runKernel(Gr,o)}});var Zd=qi({sparseSegmentSum_:function(e,t,n){var r=Gi(e,"data","sparseSegmentSum"),a=Gi(t,"indices","sparseSegmentSum","int32"),i=Gi(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error("Indices should be Tensor1D but received shape\n         ".concat(a.shape));if(1!==i.rank)throw new Error("Segment ids should be Tensor1D but received shape\n         ".concat(i.shape));var o={data:r,indices:a,segmentIds:i};return Zi.runKernel(Hr,o)}});var Dd=qi({stringNGrams_:function(e,t,n,r,a,i,o,s){var u=Gi(e,"data","stringNGrams","string");if("string"!==u.dtype)throw new Error("Data must be of datatype string");if(1!==u.shape.length)throw new Error("Data must be a vector, saw: ".concat(u.shape));var c=Gi(t,"dataSplits","stringNGrams");if("int32"!==c.dtype)throw new Error("Data splits must be of datatype int32");var l={separator:n,nGramWidths:r,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},p={data:u,dataSplits:c},h=Zi.runKernel(Yr,p,l);return{nGrams:h[0],nGramsSplits:h[1]}}});var Md=qi({stringSplit_:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=Gi(e,"input","stringSplit","string"),a=Gi(t,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error("Input should be Tensor1D but received shape ".concat(r.shape));if(0!==a.rank)throw new Error("Delimiter should be a scalar but received shape ".concat(a.shape));var i={skipEmpty:n},o={input:r,delimiter:a},s=Zi.runKernel(Jr,o,i);return{indices:s[0],values:s[1],shape:s[2]}}});var Od=qi({stringToHashBucketFast_:function(e,t){var n=Gi(e,"input","stringToHashBucketFast","string"),r={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");var a={input:n};return Zi.runKernel(Qr,a,r)}}),Ld={fft:Pp,ifft:Bp,rfft:Up,irfft:Wp},zd={hammingWindow:Ph,hannWindow:Bh,frame:Wh,stft:Vh},Pd={flipLeftRight:Gh,grayscaleToRGB:Hh,resizeNearestNeighbor:dd,resizeBilinear:hd,rotateWithOffset:jh,cropAndResize:Uh,nonMaxSuppression:Kh,nonMaxSuppressionAsync:id,nonMaxSuppressionWithScore:od,nonMaxSuppressionWithScoreAsync:ud,nonMaxSuppressionPadded:cd,nonMaxSuppressionPaddedAsync:pd,threshold:fd,transform:md},Bd={bandPart:vd,gramSchmidt:gd,qr:xd},Wd={absoluteDifference:wd,computeWeightedLoss:kd,cosineDistance:Id,hingeLoss:Sd,huberLoss:Nd,logLoss:Td,meanSquaredError:Cd,sigmoidCrossEntropy:_d,softmaxCrossEntropy:Ed},Vd={sparseFillEmptyRows:Ad,sparseReshape:Rd,sparseSegmentMean:Fd,sparseSegmentSum:Zd},Ud={stringNGrams:Dd,stringSplit:Md,stringToHashBucketFast:Od},Gd={};A(Gd,{Serializable:function(){return Hd},SerializationMap:function(){return jd},registerClass:function(){return qd}});var Hd=function(){function e(){(0,m.Z)(this,e)}return(0,v.Z)(e,[{key:"getClassName",value:function(){return this.constructor.className}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),e}(),jd=function(){function e(){(0,m.Z)(this,e),this.classNameMap={}}return(0,v.Z)(e,null,[{key:"getMap",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"register",value:function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]}}]),e}();function qd(e){le(null!=e.className,(function(){return"Class being registered does not have the static className property defined."})),le("string"==typeof e.className,(function(){return"className is required to be a string, but got type "+typeof e.className})),le(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),jd.register(e)}var Kd=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"minimize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=this.computeGradients(e,n),a=r.value,i=r.grads;if(null!=n){var o=n.map((function(e){return{name:e.name,tensor:i[e.name]}}));this.applyGradients(o)}else this.applyGradients(i);return ks(i),t?a:(a.dispose(),null)}},{key:"iterations",get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}},{key:"incrementIterations",value:function(){this.iterations_=this.iterations+1}},{key:"computeGradients",value:function(e,t){return Qc(e,t)}},{key:"dispose",value:function(){null!=this.iterations_&&ks(this.iterations_)}},{key:"saveIterations",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:kc(this.iterations_,"int32")}));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWeights",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for this optimizer yet.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for this optimizer class ".concat(this.getClassName()));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"extractIterations",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t[0].tensor.data();case 2:return this.iterations_=e.sent[0],e.abrupt("return",t.slice(1));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(Hd);Object.defineProperty(Kd,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var Xd=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return(0,m.Z)(this,n),(a=t.call(this)).learningRate=e,a.rho=r,a.epsilon=i,a.accumulatedGrads=[],a.accumulatedUpdates=[],null==i&&(a.epsilon=Zi.backend.epsilon()),a}return(0,v.Z)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Zi.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:"".concat(n,"/accum_grad"),variable:xs((function(){return ac(a).variable(false)}))}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:"".concat(n,"/accum_var"),variable:xs((function(){return ac(a).variable(false)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;xs((function(){var e=Zs(Os(o,t.rho),Os(Ic(i),1-t.rho)),n=Os(Ms(wc(Zs(s,t.epsilon)),wc(Zs(o,t.epsilon))),i),r=Zs(Os(s,t.rho),Os(Ic(n),1-t.rho));o.assign(e),s.assign(r);var u=Zs(Os(n,-t.learningRate),a);a.assign(u)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedUpdates&&(ks(this.accumulatedGrads.map((function(e){return e.variable}))),ks(this.accumulatedUpdates.map((function(e){return e.variable}))))}},{key:"getWeights",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat((0,g.Z)(this.accumulatedGrads),(0,g.Z)(this.accumulatedUpdates)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=t.length/2,!1,this.accumulatedGrads=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}})),this.accumulatedUpdates=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}}],[{key:"className",get:function(){return"Adadelta"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}]),n}(Kd),Yd=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return(0,m.Z)(this,n),(r=t.call(this)).learningRate=e,r.initialAccumulatorValue=a,r.accumulatedGrads=[],r}return(0,v.Z)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Zi.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:"".concat(n,"/accumulator"),variable:xs((function(){return Au(a.shape,t.initialAccumulatorValue).variable(!1)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable;xs((function(){var e=Zs(o,Ic(i));o.assign(e);var n=Zs(Os(Ms(i,wc(Zs(e,Zi.backend.epsilon()))),-t.learningRate),a);a.assign(n)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedGrads&&ks(this.accumulatedGrads.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulatedGrads.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,!1,this.accumulatedGrads=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}}],[{key:"className",get:function(){return"Adagrad"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}]),n}(Kd),Jd=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return(0,m.Z)(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],xs((function(){i.accBeta1=kc(r).variable(),i.accBeta2=kc(a).variable()})),null==o&&(i.epsilon=Zi.backend.epsilon()),i}return(0,v.Z)(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);xs((function(){var r=al(1,t.accBeta1),a=al(1,t.accBeta2);n.forEach((function(n,i){var o=Zi.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:xs((function(){return ac(o).variable(false)}))}),null==t.accumulatedSecondMoment[i]&&(t.accumulatedSecondMoment[i]={originalName:"".concat(n,"/v"),variable:xs((function(){return ac(o).variable(false)}))});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedSecondMoment[i].variable,l=Zs(Os(u,t.beta1),Os(s,1-t.beta1)),p=Zs(Os(c,t.beta2),Os(Ic(s),1-t.beta2)),h=Ms(l,r),d=Ms(p,a);u.assign(l),c.assign(p);var f=Zs(Os(Ms(h,Zs(wc(d),t.epsilon)),-t.learningRate),o);o.assign(f)}})),t.accBeta1.assign(Os(t.accBeta1,t.beta1)),t.accBeta2.assign(Os(t.accBeta2,t.beta2))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&ks(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedSecondMoment&&ks(this.accumulatedSecondMoment.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat((0,g.Z)(this.accumulatedFirstMoment),(0,g.Z)(this.accumulatedSecondMoment)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,xs((function(){r.accBeta1.assign(xc(r.beta1,r.iterations_+1)),r.accBeta2.assign(xc(r.beta2,r.iterations_+1))})),n=t.length/2,!1,this.accumulatedFirstMoment=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}})),this.accumulatedSecondMoment=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}}],[{key:"className",get:function(){return"Adam"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}]),n}(Kd),Qd=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return(0,m.Z)(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.decay=s,i.accumulatedFirstMoment=[],i.accumulatedWeightedInfNorm=[],xs((function(){i.iteration=kc(0).variable(),i.accBeta1=kc(r).variable()})),null==o&&(i.epsilon=Zi.backend.epsilon()),i}return(0,v.Z)(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);xs((function(){var r=al(1,t.accBeta1),a=Ms(-t.learningRate,Zs(Os(t.iteration,t.decay),1));n.forEach((function(n,i){var o=Zi.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:ac(o).variable(false)}),null==t.accumulatedWeightedInfNorm[i]&&(t.accumulatedWeightedInfNorm[i]={originalName:"".concat(n,"/v"),variable:ac(o).variable(false)});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedWeightedInfNorm[i].variable,l=Zs(Os(u,t.beta1),Os(s,1-t.beta1)),p=Os(c,t.beta2),h=Ls(s),d=gl(p,h);u.assign(l),c.assign(d);var f=Zs(Os(Ms(a,r),Ms(l,Zs(d,t.epsilon))),o);o.assign(f)}})),t.iteration.assign(Zs(t.iteration,1)),t.accBeta1.assign(Os(t.accBeta1,t.beta1))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&ks(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedWeightedInfNorm&&ks(this.accumulatedWeightedInfNorm.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}}],[{key:"className",get:function(){return"Adamax"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}]),n}(Kd),$d=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this)).learningRate=e,r.setLearningRate(e),r}return(0,v.Z)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=Zi.registeredVariables[n];xs((function(){var e=Zs(Os(t.c,a),i);i.assign(e)}))}})),this.incrementIterations()}},{key:"setLearningRate",value:function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=ws(kc(-e))}},{key:"dispose",value:function(){this.c.dispose()}},{key:"getWeights",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0]);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:if(0===(t=e.sent).length){e.next=5;break}throw new Error("SGD optimizer does not have settable weights.");case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate}}}],[{key:"className",get:function(){return"SGD"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate)}}]),n}(Kd),ef=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,m.Z)(this,n),(a=t.call(this,e)).learningRate=e,a.momentum=r,a.useNesterov=i,a.accumulations=[],a.m=kc(a.momentum),a}return(0,v.Z)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Zi.registeredVariables[n];null==t.accumulations[r]&&(t.accumulations[r]={originalName:"".concat(n,"/momentum"),variable:xs((function(){return ac(a).variable(!1)}))});var i=t.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[n];null!=o&&xs((function(){var e,n=Zs(Os(t.m,i),o);e=t.useNesterov?Zs(Os(t.c,Zs(o,Os(n,t.m))),a):Zs(Os(t.c,n),a),i.assign(n),a.assign(e)}))})),this.incrementIterations()}},{key:"dispose",value:function(){this.m.dispose(),null!=this.accumulations&&ks(this.accumulations.map((function(e){return e.variable})))}},{key:"setMomentum",value:function(e){this.momentum=e}},{key:"getWeights",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulations.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,!1,this.accumulations=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}}],[{key:"className",get:function(){return"Momentum"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}]),n}($d),tf=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if((0,m.Z)(this,n),(r=t.call(this)).learningRate=e,r.decay=a,r.momentum=i,r.epsilon=o,r.accumulatedMeanSquares=[],r.accumulatedMoments=[],r.accumulatedMeanGrads=[],r.centered=s,null==o&&(r.epsilon=Zi.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return(0,c.Z)(r)}return(0,v.Z)(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Zi.registeredVariables[n],i=!1;null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:"".concat(n,"/rms"),variable:xs((function(){return ac(a).variable(i)}))}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:"".concat(n,"/momentum"),variable:xs((function(){return ac(a).variable(i)}))}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:"".concat(n,"/mg"),variable:xs((function(){return ac(a).variable(i)}))});var o=Array.isArray(e)?e[r].tensor:e[n];if(null!=o){var s=t.accumulatedMeanSquares[r].variable,u=t.accumulatedMoments[r].variable;xs((function(){var e=Zs(Os(s,t.decay),Os(Ic(o),1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,i=Zs(Os(n,t.decay),Os(o,1-t.decay)),c=Ms(Os(o,t.learningRate),wc(al(e,Zs(Ic(i),t.epsilon)))),l=Zs(Os(u,t.momentum),c);s.assign(e),n.assign(i),u.assign(l);var p=al(a,l);a.assign(p)}else{var h=Zs(Os(s,t.decay),Os(Ic(o),1-t.decay)),d=Zs(Os(u,t.momentum),Ms(Os(o,t.learningRate),wc(Zs(h,t.epsilon))));s.assign(h),u.assign(d);var f=al(a,d);a.assign(f)}}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedMeanSquares&&ks(this.accumulatedMeanSquares.map((function(e){return e.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&ks(this.accumulatedMeanGrads.map((function(e){return e.variable}))),null!=this.accumulatedMoments&&ks(this.accumulatedMoments.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat((0,g.Z)(this.accumulatedMeanSquares),(0,g.Z)(this.accumulatedMoments)),this.centered&&t.push.apply(t,(0,g.Z)(this.accumulatedMeanGrads)),e.next=4,this.saveIterations();case 4:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=this.centered?t.length/3:t.length/2,r=!1,this.accumulatedMeanSquares=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})),this.accumulatedMoments=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*n,3*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}}],[{key:"className",get:function(){return"RMSProp"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}]),n}(Kd),nf=[Xd,Yd,Jd,Qd,ef,tf,$d];var rf={};A(rf,{browserFiles:function(){return pf},browserHTTPRequest:function(){return If},concatenateArrayBuffers:function(){return so},copyModel:function(){return es},decodeWeights:function(){return to},encodeWeights:function(){return $i},fromMemory:function(){return Cf},fromMemorySync:function(){return _f},getLoadHandlers:function(){return ko},getModelArtifactsForJSON:function(){return po},getModelArtifactsForJSONSync:function(){return lo},getModelArtifactsInfoForJSON:function(){return fo},getSaveHandlers:function(){return xo},getWeightSpecs:function(){return mo},http:function(){return wf},isHTTPScheme:function(){return xf},listModels:function(){return Yo},loadWeights:function(){return mf},moveModel:function(){return ns},registerLoadRouter:function(){return bo},registerSaveRouter:function(){return yo},removeModel:function(){return Qo},weightsLoaderFactory:function(){return gf},withSaveHandler:function(){return Ef},withSaveHandlerSync:function(){return Af}});var af="model",of=".json",sf=".weights.bin";function uf(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var cf=function(){function e(t){if((0,m.Z)(this,e),!Qe().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),(null==t||0===t.length)&&(t=af),this.modelJsonFileName=t+of,this.weightDataFileName=t+sf}return(0,v.Z)(e,[{key:"save",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r,a,i,o,s;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!=typeof document){e.next=2;break}throw new Error("Browser downloads are not supported in this environment since `document` is not present");case 2:if(n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer)){e.next=5;break}throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 5:return r=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],a=co(t,r),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),(o=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor).download=this.modelJsonFileName,o.href=i,e.next=10,uf((function(){return o.dispatchEvent(new MouseEvent("click"))}));case 10:if(null==t.weightData){e.next=16;break}return(s=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=n,e.next=16,uf((function(){return s.dispatchEvent(new MouseEvent("click"))}));case 16:return e.abrupt("return",{modelArtifactsInfo:fo(t)});case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();cf.URL_SCHEME="downloads://";var lf=function(){function e(t){if((0,m.Z)(this,e),null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received ".concat(t));this.jsonFile=t[0],this.weightsFiles=t.slice(1)}return(0,v.Z)(e,[{key:"load",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=new FileReader;r.onload=function(r){var a=JSON.parse(r.target.result),i=a.modelTopology;if(null!=i)if(null!=a.weightsManifest)if(0!==t.weightsFiles.length){var o=po(a,(function(e){return t.loadWeights(e)}));e(o)}else e({modelTopology:i});else n(new Error("weightManifest field is missing from file ".concat(t.jsonFile.name)));else n(new Error("modelTopology field is missing from file ".concat(t.jsonFile.name)))},r.onerror=function(e){return n("Failed to read model topology and weights manifest JSON from file '".concat(t.jsonFile.name,"'. BrowserFiles supports loading Keras-style tf.Model artifacts only."))},r.readAsText(t.jsonFile)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(e){var t,n=this,r=[],a=[],i=(0,y.Z)(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;r.push.apply(r,(0,g.Z)(o.weights)),a.push.apply(a,(0,g.Z)(o.paths))}}catch(c){i.e(c)}finally{i.f()}var s=this.checkManifestAndWeightFiles(e),u=a.map((function(e){return n.loadWeightsFile(e,s[e])}));return Promise.all(u).then((function(e){return[r,so(e)]}))}},{key:"loadWeightsFile",value:function(e,t){return new Promise((function(n,r){var a=new FileReader;a.onload=function(e){var t=e.target.result;n(t)},a.onerror=function(t){return r("Failed to weights data from file of path '".concat(e,"'."))},a.readAsArrayBuffer(t)}))}},{key:"checkManifestAndWeightFiles",value:function(e){var t,n=this,r=[],a=this.weightsFiles.map((function(e){return uo(e.name)})),i={},o=(0,y.Z)(e);try{for(o.s();!(t=o.n()).done;){t.value.paths.forEach((function(e){var t=uo(e);if(-1!==r.indexOf(t))throw new Error("Duplicate file basename found in weights manifest: '".concat(t,"'"));if(r.push(t),-1===a.indexOf(t))throw new Error("Weight file with basename '".concat(t,"' is not provided."));i[e]=n.weightsFiles[a.indexOf(t)]}))}}catch(s){o.e(s)}finally{o.f()}if(r.length!==this.weightsFiles.length)throw new Error("Mismatch in the number of files in weights manifest (".concat(r.length,") and the number of weight files provided (").concat(this.weightsFiles.length,")."));return i}}]),e}();function pf(e){return new lf(e)}function hf(e,t,n,r){var a;le(null!=(a=e)&&Array.isArray(a)&&a.length>0,(function(){return"promises must be a none empty array"})),function(e,t){le(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction ".concat(e)})),le(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction ".concat(t)})),le(t>=e,(function(){return"startFraction must be no more than endFraction, but got startFraction ".concat(e," and endFraction ").concat(t)}))}(n=null==n?0:n,r=null==r?1:r);var i=0;return Promise.all(e.map((function(a){return a.then((function(a){var o=n+ ++i/e.length*(r-n);return t(o),a})),a})))}function df(e,t){return ff.apply(this,arguments)}function ff(){return ff=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i,o,s,u,c;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),r=null==n.fetchFunc?Qe().platform.fetch:n.fetchFunc,a=t.map((function(e){return r(e,n.requestInit,{isBinary:!0})})),i=0,o=.5,null!=n.onProgress){e.next=11;break}return e.next=8,Promise.all(a);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,hf(a,n.onProgress,i,o);case 13:e.t0=e.sent;case 14:if(s=e.t0.map((function(e){return e.arrayBuffer()})),u=.5,c=1,null!=n.onProgress){e.next=23;break}return e.next=20,Promise.all(s);case 20:e.t1=e.sent,e.next=26;break;case 23:return e.next=25,hf(s,n.onProgress,u,c);case 25:e.t1=e.sent;case 26:return e.abrupt("return",e.t1);case 27:case"end":return e.stop()}}),e)}))),ff.apply(this,arguments)}function mf(e){return vf.apply(this,arguments)}function vf(){return vf=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r,a,i=arguments;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:"",r=i.length>2?i[2]:void 0,a=i.length>3?i[3]:void 0,e.abrupt("return",gf((function(e){return df(e,{requestInit:a})}))(t,n,r));case 4:case"end":return e.stop()}}),e)}))),vf.apply(this,arguments)}function gf(e){return function(){var t=(0,f.Z)((0,d.Z)().mark((function t(n){var r,a,i,o,s,u,c,l,p,h,f,m,v=arguments;return(0,d.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=v.length>1&&void 0!==v[1]?v[1]:"",a=v.length>2?v[2]:void 0,i=n.map((function(){return!1})),o={},s=null!=a?a.map((function(){return!1})):[],u=[],n.forEach((function(e,t){var n=0;e.weights.forEach((function(e){var r="quantization"in e?e.quantization.dtype:e.dtype,c=Ji[r]*de(e.shape),l=function(){i[t]=!0,null==o[t]&&(o[t]=[]),o[t].push({manifestEntry:e,groupOffset:n,sizeBytes:c})};null!=a?a.forEach((function(t,n){t===e.name&&(l(),s[n]=!0)})):l(),u.push(e.name),n+=c}))})),s.every((function(e){return e}))){t.next=6;break}throw c=a.filter((function(e,t){return!s[t]})),new Error("Could not find weights in manifest with names: ".concat(c.join(", "),". \nManifest JSON has weights with names: ").concat(u.join(", "),"."));case 6:return l=i.reduce((function(e,t,n){return t&&e.push(n),e}),[]),p=[],l.forEach((function(e){n[e].paths.forEach((function(e){var t=r+(r.endsWith("/")?"":"/")+e;p.push(t)}))})),t.next=10,e(p);case 10:return h=t.sent,f={},m=0,t.abrupt("return",(l.forEach((function(e){for(var t=n[e].paths.length,r=0,a=0;a<t;a++)r+=h[m+a].byteLength;for(var i=new ArrayBuffer(r),s=new Uint8Array(i),u=0,c=0;c<t;c++){var l=new Uint8Array(h[m+c]);s.set(l,u),u+=l.byteLength}o[e].forEach((function(e){var t=to(i.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)f[n]=t[n]})),m+=t})),f));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}go.registerSaveRouter((function(e){return Qe().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(cf.URL_SCHEME)?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new cf(e)}(e.slice(cf.URL_SCHEME.length)):null}));var yf=function(){function e(t,n){if((0,m.Z)(this,e),this.DEFAULT_METHOD="POST",null==n&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,null!=n.fetchFunc?(le("function"==typeof n.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=n.fetchFunc):this.fetch=Qe().platform.fetch,le(null!=t&&t.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(t)&&le(2===t.length,(function(){return"URL paths for http must have a length of 2, (actual length is ".concat(t.length,").")})),this.path=t,null!=n.requestInit&&null!=n.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}return(0,v.Z)(e,[{key:"save",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r,a,i;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");case 2:return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],a=co(t,r),n.body.append("model.json",new Blob([JSON.stringify(a)],{type:"application/json"}),"model.json"),null!=t.weightData&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),e.next=8,this.fetch(this.path,n);case 8:if(!(i=e.sent).ok){e.next=11;break}return e.abrupt("return",{modelArtifactsInfo:fo(t),responses:[i]});case 11:throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status ".concat(i.status,"."));case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n,r,a,i,o=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(this.path,this.requestInit);case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("Request to ".concat(this.path," failed with status code ").concat(t.status,". Please verify this URL points to the model JSON of the model to load."));case 5:return e.prev=5,e.next=8,t.json();case 8:n=e.sent,e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(5),r="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 15:if(a=n.modelTopology,i=n.weightsManifest,null!=a||null!=i){e.next=18;break}throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model topology or manifest for weights."));case 18:return e.abrupt("return",po(n,(function(e){return o.loadWeights(e)})));case 19:case"end":return e.stop()}}),e,this,[[5,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r,a,i,o,s,u,c,l,p,f,m,v,b,x,k;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Array.isArray(this.path)?this.path[1]:this.path,r=bf(n),a=(0,h.Z)(r,2),i=a[0],o=a[1],s=this.weightPathPrefix||i,u=mo(t),c=[],l=[],p=(0,y.Z)(t);try{for(p.s();!(f=p.n()).done;){m=f.value,v=(0,y.Z)(m.paths);try{for(v.s();!(b=v.n()).done;)x=b.value,null!=this.weightUrlConverter?l.push(this.weightUrlConverter(x)):c.push(s+x+o)}catch(d){v.e(d)}finally{v.f()}}}catch(d){p.e(d)}finally{p.f()}if(e.t0=this.weightUrlConverter,!e.t0){e.next=13;break}return e.t1=c.push,e.t2=c,e.t3=g.Z,e.next=10,Promise.all(l);case 10:e.t4=e.sent,e.t5=(0,e.t3)(e.t4),e.t1.apply.call(e.t1,e.t2,e.t5);case 13:return e.next=15,df(c,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});case 15:return k=e.sent,e.abrupt("return",[u,so(k)]);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function bf(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}function xf(e){return null!=e.match(yf.URL_SCHEME_REGEX)}yf.URL_SCHEME_REGEX=/^https?:\/\//;var kf=function(e,t){if("undefined"==typeof fetch&&(null==t||null==t.fetchFunc))return null;return(Array.isArray(e)?e.every((function(e){return xf(e)})):xf(e))?wf(e,t):null};function wf(e,t){return new yf(e,t)}function If(e,t){return wf(e,t)}go.registerSaveRouter(kf),go.registerLoadRouter(kf);var Sf=function(){function e(t){(0,m.Z)(this,e),this.modelArtifacts=t}return(0,v.Z)(e,[{key:"load",value:function(){return this.modelArtifacts}}]),e}(),Nf=function(){function e(t){(0,m.Z)(this,e),this.saveHandler=t}return(0,v.Z)(e,[{key:"save",value:function(e){return this.saveHandler(e)}}]),e}(),Tf=(0,v.Z)((function e(t){(0,m.Z)(this,e),t.load&&(this.load=function(){return Promise.resolve(t.load())}),t.save&&(this.save=function(e){return Promise.resolve(t.save(e))})}));function Cf(e,t,n,r){var a=arguments;return new Tf(_f.apply(void 0,(0,g.Z)(a)))}function _f(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new Sf(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Sf({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Sf({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))}function Ef(e){return new Nf(e)}function Af(e){return new Nf(e)}var Rf={};A(Rf,{confusionMatrix:function(){return Zf}});var Ff,Zf=qi({confusionMatrix_:function(e,t,n){var r=Gi(e,"labels","confusionMatrix"),a=Gi(t,"predictions","confusionMatrix");le(null==n||n>0&&Number.isInteger(n),(function(){return"If provided, numClasses must be a positive integer, but got ".concat(n)})),le(1===r.rank,(function(){return"Expected the rank of labels to be 1, but got ".concat(r.rank)})),le(1===a.rank,(function(){return"Expected the rank of predictions to be 1, but got ".concat(a.rank)})),le(r.shape[0]===a.shape[0],(function(){return"Mismatch in the number of examples: ".concat(r.shape[0]," vs. ").concat(a.shape[0],". Labels and predictions should have the same number of elements.")})),le(n>0&&Number.isInteger(n),(function(){return"numClasses is required to be a positive integer, but got ".concat(n)}));var i=El(cs(r,"int32"),n),o=El(cs(a,"int32"),n),s=fh(i),u=mu(s,o);return cs(u,"int32")}}),Df={};function Mf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,a=!1,i=!1,o=!1,s=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)a=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)i=!0;else if(null!=e.getContext)o=!0;else{if(!("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ".concat(e.constructor.name));s=!0}if(null!=ka(ha,Zi.backendName)){var u={pixels:e},c={numChannels:t};return Zi.runKernel(ha,u,c)}var l,p,d=a?[e.videoWidth,e.videoHeight]:[e.width,e.height],f=(0,h.Z)(d,2),m=f[0],v=f[1];if(o)l=e.getContext("2d").getImageData(0,0,m,v).data;else if(r||n)l=e.data;else if(i||a||s){if(null==Ff)if("undefined"==typeof document){if("undefined"==typeof OffscreenCanvas||"undefined"==typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");Ff=new OffscreenCanvas(1,1).getContext("2d")}else Ff=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});Ff.canvas.width=m,Ff.canvas.height=v,Ff.drawImage(e,0,0,m,v),l=Ff.getImageData(0,0,m,v).data}if(4===t)p=new Int32Array(l);else{var g=m*v;p=new Int32Array(g*t);for(var y=0;y<g;y++)for(var b=0;b<t;++b)p[y*t+b]=l[4*y+b]}return Qp(p,[v,m,t],"int32")}function Of(e){return"undefined"!=typeof window&&"undefined"!=typeof ImageBitmap&&window.hasOwnProperty("createImageBitmap")&&!(e instanceof ImageBitmap)&&function(e){return null!=e&&0!==e.width&&0!==e.height}(e)&&!function(e){return null!=e&&e.data instanceof Uint8Array}(e)}function Lf(e){return zf.apply(this,arguments)}function zf(){return zf=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r,a,i=arguments;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:3,r=null,!Qe().getBool("WRAP_TO_IMAGEBITMAP")||!Of(t)){e.next=15;break}return e.prev=3,e.next=6,createImageBitmap(t,{premultiplyAlpha:"none"});case 6:a=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),a=null;case 12:r=null!=a&&a.width===t.width&&a.height===t.height?a:t,e.next=16;break;case 15:r=t;case 16:return e.abrupt("return",Mf(r,n));case 17:case"end":return e.stop()}}),e,null,[[3,9]])}))),zf.apply(this,arguments)}function Pf(e,t){return Bf.apply(this,arguments)}function Bf(){return Bf=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,f,m,v,g,y,b,x,k;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Gi(t,"img","toPixels"),t instanceof hi||(r=cs(a=r,"int32"),a.dispose()),2===r.rank||3===r.rank){e.next=4;break}throw new Error("toPixels only supports rank 2 or 3 tensors, got rank ".concat(r.rank,"."));case 4:if(i=r.shape.slice(0,2),o=(0,h.Z)(i,2),s=o[0],u=o[1],!((c=2===r.rank?1:r.shape[2])>4||2===c)){e.next=7;break}throw new Error("toPixels only supports depth of size 1, 3 or 4 but got ".concat(c));case 7:if("float32"===r.dtype||"int32"===r.dtype){e.next=9;break}throw new Error("Unsupported type for toPixels: ".concat(r.dtype,". Please use float32 or int32 tensors."));case 9:return e.next=11,r.data();case 11:l=e.sent,p="float32"===r.dtype?255:1,f=new Uint8ClampedArray(u*s*4),m=0;case 15:if(!(m<s*u)){e.next=36;break}v=[0,0,0,255],g=0;case 18:if(!(g<c)){e.next=31;break}if(y=l[m*c+g],"float32"!==r.dtype){e.next=25;break}if(!(y<0||y>1)){e.next=23;break}throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ".concat(y,"."));case 23:e.next=27;break;case 25:if("int32"!==r.dtype||!(y<0||y>255)){e.next=27;break}throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ".concat(y,"."));case 27:1===c?(v[0]=y*p,v[1]=y*p,v[2]=y*p):v[g]=y*p;case 28:g++,e.next=18;break;case 31:f[(b=4*m)+0]=Math.round(v[0]),f[b+1]=Math.round(v[1]),f[b+2]=Math.round(v[2]),f[b+3]=Math.round(v[3]);case 33:++m,e.next=15;break;case 36:return null!=n&&(n.width=u,n.height=s,x=n.getContext("2d"),k=new ImageData(f,u,s),x.putImageData(k,0,0)),e.abrupt("return",(r!==t&&r.dispose(),f));case 38:case"end":return e.stop()}}),e)}))),Bf.apply(this,arguments)}A(Df,{fromPixels:function(){return Wf},fromPixelsAsync:function(){return Lf},toPixels:function(){return Pf}});var Wf=qi({fromPixels_:Mf}),Vf={};function Uf(e,t){var n=e.shape.length,r=t.shape.length;if(n<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was ".concat(n,"."));if(r<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ".concat(r,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was ".concat(t.dtype,"."));if(t.shape[r-1]>n)throw new Error("index innermost dimension length must be <= tensor rank; saw: ".concat(t.shape[r-1]," vs. ").concat(n));if(0===de(e.shape))throw new Error("Requested more than 0 entries, but input is empty. Input shape: ".concat(e.shape,"."));for(var a=t.shape,i=a[a.length-1],o=1,s=0;s<a.length-1;++s)o*=a[s];var u=e.shape,c=a.slice();c.pop();for(var l=1,p=i;p<n;++p)l*=u[p],c.push(u[p]);var h=[].concat((0,g.Z)(ze(e.shape).map((function(e){return e/l}))),[1]).slice(0,i);return[c,o,l,h]}A(Vf,{prepareAndValidate:function(){return Uf}});var Gf={};A(Gf,{assertParamsValid:function(){return qf},computeFlatOffset:function(){return om},computeOutShape:function(){return Xf},getNormalizedAxes:function(){return $f},isSliceContinous:function(){return im},maskToAxes:function(){return Kf},parseSliceParams:function(){return sm},sliceInfo:function(){return um},startForAxis:function(){return rm},startIndicesWithElidedDims:function(){return em},stopForAxis:function(){return am},stopIndicesWithElidedDims:function(){return tm},stridesForAxis:function(){return nm},stridesWithElidedDims:function(){return Yf}});var Hf=-2,jf=-1;function qf(e,t,n){var r=e.shape.length;le(r===t.length,(function(){return"Error in slice".concat(r,"D: Length of begin ").concat(t," must match the rank of the array (").concat(r,").")})),le(r===n.length,(function(){return"Error in slice".concat(r,"D: Length of size ").concat(n," must match the rank of the array (").concat(r,").")}));for(var a=function(a){le(t[a]+n[a]<=e.shape[a],(function(){return"Error in slice".concat(r,"D: begin[").concat(a,"] + size[").concat(a,"] (").concat(t[a]+n[a],") would overflow input.shape[").concat(a,"] (").concat(e.shape[a],")")}))},i=0;i<r;++i)a(i)}function Kf(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function Xf(e,t,n){for(var r=[],a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function Yf(e,t,n,r){for(var a=(0,g.Z)(e),i=a.length;i<r.length;i++)a.push(1);for(var o=0;o<n;o++)0===o?a[t]=1:(a.splice(t,0,1),a.pop());return a}function Jf(e,t,n){return n<=e?n:n-(t-1)}function Qf(e,t){for(var n=[],r=0;r<e;r++)n.push(t+r);return n}function $f(e,t,n,r,a,i,o,s,u){var c=e.length,l=new Array(c),p=new Array(c),h=new Array(c);if(t.length&&n>0){var d=t[0],f=n+1;l=em(o,d,f,r,e),p=tm(s,d,f,a,e),h=Yf(i,d,f,e)}else for(var m=0;m<c;m++)l[m]=rm(o,r,i,e,m,u),p[m]=am(s,a,i,e,m,u),h[m]=nm(i,m,u);return{begin:l,end:p,strides:h}}function em(e,t,n,r,a){for(var i=(0,g.Z)(a),o=Qf(n,t),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=0;else{var u=Jf(t,n,s),c=r[u];e&1<<u&&(c=0),i[s]=c}return i}function tm(e,t,n,r,a){for(var i=(0,g.Z)(a),o=Qf(n,t),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=Number.MAX_SAFE_INTEGER;else{var u=Jf(t,n,s),c=r[u];e&1<<u&&(c=Number.MAX_SAFE_INTEGER),i[s]=c}for(var l=0;l<i.length;l++){var p=a[l];i[l]<0&&(i[l]+=p),i[l]=ae(0,i[l],a[l])}return i}function nm(e,t,n){var r=e[t];return(n&1<<t||null==r)&&(r=1),r}function rm(e,t,n,r,a,i){var o=t[a],s=n[a]||1;(e&1<<a||i&1<<a||null==o)&&(o=s>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var u=r[a];return o<0&&(o+=u),o=ae(0,o,u-1)}function am(e,t,n,r,a,i){var o=t[a],s=n[a]||1;(e&1<<a||i&1<<a||null==o)&&(o=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var u=r[a];return o<0&&(o+=u),o=s>0?ae(0,o,u):ae(-1,o,u-1)}function im(e,t,n){for(var r=n.length,a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(var i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function om(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function sm(e,t,n){var r,a,i=e.shape.length;return(r="number"==typeof t?[t].concat((0,g.Z)(new Array(i-1).fill(0))):t.length<i?t.concat(new Array(i-t.length).fill(0)):t.slice()).forEach((function(e){le(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),a=(a=null==n?new Array(i).fill(-1):"number"==typeof n?[n].concat((0,g.Z)(new Array(i-1).fill(-1))):n.length<i?n.concat(new Array(i-n.length).fill(-1)):n).map((function(t,n){return t>=0?t:(le(-1===t,(function(){return"Negative size values should be exactly -1 but got ".concat(t," for the slice() size at index ").concat(n,".")})),e.shape[n]-r[n])})),[r,a]}function um(e,t,n,r,a,i,o,s,u){var c;if(null==r?(c=new Array(t.length)).fill(1):c=r,null!=o&&o&o-1)throw new Error("Multiple ellipses in slice is not allowed.");for(var l=!1,p={dims:c.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:c.slice(),beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u},h=0;h<p.dims;h++)l&&1<<h&s&&p.numAddAxisAfterEllipsis++,1<<h&o&&(l=!0);l||(p.ellipsisMask|=1<<p.dims,p.dims++);var d={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;var n=0;t.beginValid=null!=e.begin,t.endValid=null!=e.end,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(var r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask)for(var a=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);n<a;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r;else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(Hf),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error("Index out of range using input dim ".concat(n,"; input has only ").concat(t.dims," dims, ").concat(t.begin.length,"."));null!=e.begin&&(t.begin[n]=e.begin[r]),null!=e.end&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(jf),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}(p,d);for(var f=!0,m=!0,v=!0,g=[],y=[],b=0;b<e.length;++b){if(0===d.strides[b])throw Error("strides[".concat(b,"] must be non-zero"));var x=!!(d.shrinkAxisMask&1<<b),k=e[b];if(-1!==k){var w=[d.beginMask&1<<b,d.endMask&1<<b],I=[d.strides[b]>0?0:-1,d.strides[b]>0?k:k-1];if(x&&d.strides[b]<=0)throw Error("only stride 1 allowed on non-range indexing.");v=v&&1===d.strides[b];var S=!!(d.beginMask&1<<b&&d.endMask&1<<b);if(d.beginValid&&d.endValid){if(x){var N=d.begin[b]<0?k+d.begin[b]:d.begin[b];if(d.begin[b]=N,d.end[b]=d.begin[b]+1,N<0||N>=k)throw Error("slice index ".concat(d.begin[b]," of dimension ").concat(b," out of bounds."))}else d.begin[b]=cm(d.begin[b],0,d.strides[b],k,w,I),d.end[b]=cm(d.end[b],1,d.strides[b],k,w,I);var T=1===d.strides[b]&&0===d.begin[b]&&d.end[b]===k;f=f&&T,m=m&&(0===b&&1===d.strides[b]||T)}else f=f&&1===d.strides[b]&&S,m=m&&(0===b&&1===d.strides[b]||S);var C=void 0,_=!1;if(d.beginValid&&d.endValid?(C=d.end[b]-d.begin[b],_=!0):x?(C=1,_=!0):S&&k>=0&&(C=d.strides[b]<0?-k:k,_=!0),_){var E=void 0;E=0===C||C<0!=d.strides[b]<0?0:Math.trunc(C/d.strides[b])+(C%d.strides[b]!==0?1:0),g.push(E)}else g.push(-1)}else g.push(x?1:-1)}for(var A=0;A<d.finalShapeGatherIndices.length;++A){var R=d.finalShapeGatherIndices[A];R>=0?y.push(g[R]):R===Hf&&y.push(1)}return{finalShapeSparse:y.filter((function(e,t){return d.finalShapeGatherIndices[t]!==Hf})),finalShape:y,isIdentity:f,sliceDim0:m,isSimpleSlice:v,begin:d.begin,end:d.end,strides:d.strides}}function cm(e,t,n,r,a,i){if(a[t])return n>0?i[t]:i[t+1&1];var o=e<0?r+e:e;return o<i[0]?i[0]:o>i[1]?i[1]:o}var lm="4.2.0",pm=function(){function e(){(0,m.Z)(this,e)}return(0,v.Z)(e,null,[{key:"sgd",value:function(e){return new $d(e)}},{key:"momentum",value:function(e,t){return new ef(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}},{key:"rmsprop",value:function(e){return new tf(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}},{key:"adam",value:function(){return new Jd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},{key:"adadelta",value:function(){return new Xd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},{key:"adamax",value:function(){return new Qd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.002,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]?arguments[4]:0)}},{key:"adagrad",value:function(e){return new Yd(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1)}}]),e}(),hm=pm,dm="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:function(e){return e()};function fm(){return new Promise((function(e){return dm((function(){return e()}))}))}var mm,vm={};function gm(e,t){var n=e[0].length;e.forEach((function(e,t){le(e.length===n,(function(){return"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same as the rank of the rest (").concat(n,")")}))})),le(t>=0&&t<n,(function(){return"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,".")}));var r=e[0];e.forEach((function(e,a){for(var i=0;i<n;i++)le(i===t||e[i]===r[i],(function(){return"Error in concat".concat(n,"D: Shape of tensors[").concat(a,"] (").concat(e,") does not match the shape of the rest (").concat(r,") along the non-concatenated axis ").concat(a,".")}))}))}function ym(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function bm(e,t,n){var r=new Array;if(null==n&&null==t)return r;if(null==t)for(;r.length<e+n.length;)r.push(-1);else r=t.slice();if(null==n)return r;if(e+n.length!==r.length)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.rank = ").concat(e+n.length,", but shape.rank = ").concat(r.length));for(var a=1;a<n.length;++a){var i=n[a],o=r[r.length-n.length+a],s=r[o];if(i>=0)if(s>=0){if(s!==i)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.shape[").concat(a+e,"] = ").concat(i," but shape[").concat(a+e,"] = ").concat(s))}else r[o]=i}return r}function xm(e){var t,n={FIRST_DIM_SIZE:mm.FIRST_DIM_SIZE,VALUE_ROWIDS:mm.VALUE_ROWIDS,ROW_LENGTHS:mm.ROW_LENGTHS,ROW_SPLITS:mm.ROW_SPLITS,ROW_LIMITS:mm.ROW_LIMITS,ROW_STARTS:mm.ROW_STARTS},r=[],a=(0,y.Z)(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(!(i in n))break;r.push(n[i])}}catch(o){a.e(o)}finally{a.f()}return r}function km(e){return 0===e.length?0:e[0]===mm.FIRST_DIM_SIZE?e.length-1:e.length}function wm(e,t){if(null!=e&&null!=t){var n=e.length,r=t.length;if(n>=r)throw new Error("defaultValue.shape=".concat(e," and ragged tensor flatValues.shape=").concat(t,", are incompatible: defaultValue.rank = ").concat(n," must be less than ragged tensor input flatValues.rank = ").concat(r,")"));for(var a=0;a<Math.min(n,r-1);++a){var i=e[a],o=t[a+1];if(i>=0&&o>=0&&1!==i&&i!==o)throw new Error("defaultValue.shape=".concat(e,", and ragged tensor input flatValues.shape=").concat(t," are incompatible: defaultValue.shape[").concat(a-e.length,"] = ").concat(i," but ragged tensor input.flatValues.shape[").concat(a-e.length,"] = ").concat(o))}}}A(vm,{ERF_A1:function(){return Dm},ERF_A2:function(){return Mm},ERF_A3:function(){return Om},ERF_A4:function(){return Lm},ERF_A5:function(){return zm},ERF_P:function(){return Zm},PARALLELIZE_THRESHOLD:function(){return Im},RowPartitionType:function(){return mm},SELU_SCALE:function(){return Fm},SELU_SCALEALPHA:function(){return Rm},applyActivation:function(){return Fh},assertAndGetBroadcastShape:function(){return tc},assertAxesAreInnerMostDims:function(){return fc},assertParamsConsistent:function(){return gm},assignToTypedArray:function(){return Gm},axesAreInnerMostDims:function(){return lc},calculateShapes:function(){return bh},checkEinsumDimSizes:function(){return $m},checkPadOnDimRoundingMode:function(){return lu},combineLocations:function(){return pc},combineRaggedTensorToTensorShapes:function(){return bm},complexWithEvenIndex:function(){return Wm},complexWithOddIndex:function(){return Vm},computeConv2DInfo:function(){return $s},computeConv3DInfo:function(){return eu},computeDefaultPad:function(){return tu},computeDilation2DInfo:function(){return Ys},computeOptimalWindowSize:function(){return Sm},computeOutAndReduceShapes:function(){return hc},computeOutShape:function(){return ym},computePool2DInfo:function(){return Js},computePool3DInfo:function(){return Qs},convertConv2DDataFormat:function(){return cu},decodeEinsumEquation:function(){return Jm},eitherStridesOrDilationsAreOne:function(){return su},expandShapeToKeepDim:function(){return dc},exponent:function(){return jm},exponents:function(){return Hm},fromStringArrayToUint8:function(){return kv},fromUint8ToStringArray:function(){return xv},getAxesPermutation:function(){return mc},getBroadcastDims:function(){return $u},getComplexWithIndex:function(){return Um},getEinsumComputePath:function(){return ev},getEinsumPermutation:function(){return Qm},getFusedBiasGradient:function(){return Rh},getFusedDyActivation:function(){return Ah},getImageCenter:function(){return Nm},getInnerMostAxes:function(){return gc},getPermuted:function(){return Cm},getRaggedRank:function(){return km},getReductionAxes:function(){return ec},getReshaped:function(){return Tm},getReshapedPermuted:function(){return _m},getRowPartitionTypesHelper:function(){return xm},getSliceBeginCoords:function(){return Em},getSliceSize:function(){return Am},getSparseFillEmptyRowsIndicesDenseShapeMismatch:function(){return av},getSparseFillEmptyRowsNegativeIndexErrorMessage:function(){return iv},getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:function(){return ov},getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:function(){return cv},getSparseReshapeInputOutputMismatchErrorMessage:function(){return pv},getSparseReshapeInputOutputMultipleErrorMessage:function(){return lv},getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:function(){return sv},getSparseReshapeNegativeOutputDimErrorMessage:function(){return uv},getSparseSegmentReductionIndicesOutOfRangeErrorMessage:function(){return mv},getSparseSegmentReductionNegativeSegmentIdsErrorMessage:function(){return hv},getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:function(){return dv},getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:function(){return fv},getUndoAxesPermutation:function(){return vc},isIdentityPermutation:function(){return tv},log:function(){return ya},mergeRealAndImagArrays:function(){return Pm},prepareAndValidate:function(){return Uf},prepareSplitSize:function(){return rv},segment_util:function(){return vv},shouldFuse:function(){return Zh},slice_util:function(){return Gf},splitRealAndImagArrays:function(){return Bm},stridesOrDilationsArePositive:function(){return uu},tupleValuesAreOne:function(){return ou},upcastType:function(){return wi},validateDefaultValueShape:function(){return wm},validateInput:function(){return yh},validateUpdateShape:function(){return gh},warn:function(){return ga}}),function(e){e[e.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",e[e.VALUE_ROWIDS=1]="VALUE_ROWIDS",e[e.ROW_LENGTHS=2]="ROW_LENGTHS",e[e.ROW_SPLITS=3]="ROW_SPLITS",e[e.ROW_LIMITS=4]="ROW_LIMITS",e[e.ROW_STARTS=5]="ROW_STARTS"}(mm||(mm={}));var Im=30;function Sm(e){return e<=Im?e:Le(e,Math.floor(Math.sqrt(e)))}function Nm(e,t,n){return[n*("number"==typeof e?e:e[0]),t*("number"==typeof e?e:e[1])]}function Tm(e,t,n){var r=[];if(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])(r=r.concat(t.slice(0))).push(e[0]/n),r=r.concat(e.slice(1));else{r=r.concat(e[0]);for(var a=t.length,i=0;i<a;++i)r=r.concat([e[i+1]/t[i],t[i]]);r=r.concat(e.slice(a+1))}return r}function Cm(e,t){var n=[];if(!(arguments.length>2&&void 0!==arguments[2])||arguments[2]){n.push(t);for(var r=t+1;r<e;++r)r<=2*t?(n.push(r),n.push(r-(t+1))):n.push(r)}else{for(var a=[],i=[],o=1;o<e;++o)o>=2*t+1||o%2===1?i.push(o):a.push(o);n.push.apply(n,a),n.push(0),n.push.apply(n,i)}return n}function _m(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(var i=1;i<e.length;++i)i<=t.length?r?a.push(t[i-1]*e[i]):a.push(e[i]/t[i-1]):a.push(e[i]);return a}function Em(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function Am(e,t,n){for(var r=e.slice(0,1),a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}var Rm=1.7580993408473768,Fm=1.0507009873554805,Zm=.3275911,Dm=.254829592,Mm=-.284496736,Om=1.421413741,Lm=-1.453152027,zm=1.061405429;function Pm(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:".concat(e.length,", imag: ").concat(t.length,"."));for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function Bm(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function Wm(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function Vm(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function Um(e,t){return{real:e[2*t],imag:e[2*t+1]}}function Gm(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function Hm(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),a=0;a<Math.ceil(e/2);a++){var i=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:n,imag:r}}function jm(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}var qm="->",Km=/->/g,Xm=",",Ym="...";function Jm(e,t){var n=((e=e.replace(/\s/g,"")).length-e.replace(Km,"").length)/qm.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("'.concat(qm,'").'));var r=e.split(qm),a=(0,h.Z)(r,2),i=a[0],o=a[1];le(-1===i.indexOf(Ym),(function(){return'The ellipsis notation ("'.concat(Ym,'") is not supported yet.')}));var s=i.split(Xm),u=s.length;if(t!==u)throw new Error("Expected ".concat(u," input tensors, received ").concat(t));if(u>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");for(var c=[],l=function(){var e=o[p];if(!s.some((function(t){return-1!==t.indexOf(e)})))throw new Error("Output subscripts contain the label ".concat(e," not present in the input subscripts."));-1===c.indexOf(e)&&c.push(e)},p=0;p<o.length;++p)l();for(var d=0;d<i.length;++d){var f=i[d];-1===c.indexOf(f)&&f!==Xm&&c.push(f)}for(var m=new Array(s.length),v=0;v<u;++v){if(new Set(s[v].split("")).size!==s[v].length)throw new Error("Found duplicate axes in input component ".concat(s[v],". Support for duplicate axes in input is not implemented yet."));m[v]=[];for(var g=0;g<s[v].length;++g)m[v].push(c.indexOf(s[v][g]))}for(var y=c.length,b=[],x=o.length;x<y;++x)b.push(x);return{allDims:c,summedDims:b,idDims:m}}function Qm(e,t){var n=new Array(e);n.fill(-1);for(var r=0;r<t.length;++r)n[t[r]]=r;for(var a=[],i=0;i<e;++i)-1===n[i]&&a.push(i);return n=n.filter((function(e){return-1!==e})),{permutationIndices:n,expandDims:a}}function $m(e,t,n){for(var r=new Array(e),a=function(e){for(var a=n[e].shape,i=function(n){void 0===r[t[e][n]]?r[t[e][n]]=a[n]:le(r[t[e][n]]===a[n],(function(){return"Expected dimension ".concat(r[t[e][n]]," at axis ").concat(n," of input shaped ").concat(JSON.stringify(a),", but got dimension ").concat(a[n])}))},o=0;o<t[e].length;++o)i(o)},i=0;i<n.length;++i)a(i)}function ev(e,t){var n,r=e,a=[];0===e.length&&r.push(-1),n=e.length+1;for(var i=0;i<n;++i)a.push([]);for(var o=[],s=0;s<r.length;++s){var u,c=nv(t,r[s]),l=(0,y.Z)(c);try{for(l.s();!(u=l.n()).done;){var p=u.value;-1===o.indexOf(p)&&(a[s].push(p),o.push(p))}}catch(h){l.e(h)}finally{l.f()}}return{path:r,steps:a}}function tv(e){return e.every((function(e,t){return e===t}))}function nv(e,t){for(var n=[],r=0;r<e.length;++r)(0===e[r].length||-1!==e[r].indexOf(t)||-1===t)&&n.push(r);return n}function rv(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];if("number"==typeof t)le(e.shape[n]%t===0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(e.shape[n]/t);else{var a=t.reduce((function(e,t){return-1===t&&(e+=1),e}),0);le(a<=1,(function(){return"There should be only one negative value in split array."}));var i=t.indexOf(-1);if(-1!==i){var o=t.reduce((function(e,t){return t>0?e+t:e}));t[i]=e.shape[n]-o}le(e.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t}return r}function av(e){return"Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ".concat(e)}function iv(e,t){return"indices(".concat(e,", 0) is invalid: ").concat(t," < 0")}function ov(e,t,n){return"indices(".concat(e,", 0) is invalid: ").concat(t," >= ").concat(n)}function sv(e,t){return"only one output dimension may be -1, not both ".concat(e," and ").concat(t)}function uv(e,t){return"size ".concat(e," must be non-negative, not ").concat(t)}function cv(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function lv(e,t){var n=de(e),r=de(t);return"Input to reshape is a SparseTensor with ".concat(n,"\n  dense values, but the requested shape requires a multiple of ").concat(r,". inputShape=").concat(e," outputShape= ").concat(t)}function pv(e,t){var n=de(e),r=de(t);return"Input to reshape is a tensor with ".concat(n," dense values, but the requested shape has ").concat(r,". inputShape=").concat(e," outputShape=").concat(t)}function hv(){return"segment ids must be >= 0"}function dv(){return"segment ids are not increasing"}function fv(e,t){return"Segment id ".concat(e," out of range [0, ").concat(t,"), possibly because segmentIds input is not sorted.")}function mv(e,t,n){return"Bad: indices[".concat(e,"] == ").concat(t," out of range [0, ").concat(n,")")}var vv={};function gv(e,t){var n,r=!1;for(e<=Im?(n=e,r=!0):n=Le(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=Le(e,n+1);return n}function yv(e,t,n){for(var r=[],a=e.length,i=0;i<a;i++)i!==t?r.push(e[i]):r.push(n);return r}function bv(e,t,n,r){var a=t.shape.length,i=e.shape.length;if(0!==r&&(r<-a||r>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(r));if(r<0&&(r+=a),r>i)throw new Error("batchDims (".concat(r,") must be less than rank(x) (\n    ").concat(i,")."));if(n<r)throw new Error("batchDims (".concat(r,") must be less than or equal to axis (").concat(n,")."));for(var o=0;o<r;++o)if(e.shape[o]!==t.shape[o])throw new Error("x.shape[".concat(o,"]: ").concat(e.shape[o]," should be equal to indices.shape[").concat(o,"]: ").concat(t.shape[o],"."));for(var s=e.shape[n],u=[],c=1,l=1,p=1,h=0;h<r;++h)u.push(e.shape[h]),c*=e.shape[h];for(var d=r;d<n;d++)u.push(e.shape[d]),l*=e.shape[d];for(var f=r;f<a;f++)u.push(t.shape[f]);for(var m=n+1;m<i;m++)u.push(e.shape[m]),p*=e.shape[m];return{batchSize:c,sliceSize:p,outerSize:l,dimSize:s,outputShape:u}}function xv(e){try{return e.map((function(e){return Ya(e)}))}catch(t){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat(t))}}function kv(e){return e.map((function(e){return Xa(e)}))}A(vv,{collectGatherOpShapeInfo:function(){return bv},computeOutShape:function(){return yv},segOpComputeOptimalWindowSize:function(){return gv}});var wv={};A(wv,{nonMaxSuppressionV3Impl:function(){return Jh},nonMaxSuppressionV4Impl:function(){return Qh},nonMaxSuppressionV5Impl:function(){return $h},whereImpl:function(){return ch}}),function(){for(var e=0,t=nf;e<t.length;e++){qd(t[e])}}();var Iv={kernelName:rt,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{x:function(){return Os(e,qp(cs(n,"float32"),-1))}}}},Sv={kernelName:at,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{x:function(){var t=Ic(cs(n,"float32")),r=wc(al(kc(1),t));return tl(Ms(e,r))}}}},Nv={kernelName:it,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{x:function(){var t=wc(al(Ic(cs(n,"float32")),1));return Ms(e,t)}}}},Tv={kernelName:ot,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,h.Z)(t,2),r=n[0],a=n[1],i=tc(r.shape,a.shape);return{a:function(){var t=e,n=ec(r.shape,i);return n.length>0&&(t=Sc(t,n)),pu(t,r.shape)},b:function(){var t=e,n=ec(a.shape,i);return n.length>0&&(t=Sc(t,n)),pu(t,a.shape)}}}},Cv={kernelName:st,saveAllInputs:!0,gradFunc:function(e,t){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}},_v={kernelName:lt,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{x:function(){return ac(n)}}}},Ev={kernelName:pt,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{x:function(){return ac(n)}}}},Av={kernelName:ht,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{x:function(){return Ms(e,wc(al(kc(1),Ic(cs(n,"float32")))))}}}},Rv={kernelName:dt,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{x:function(){var t=wc(Zs(kc(1),Ic(cs(n,"float32"))));return Ms(e,t)}}}},Fv={kernelName:vt,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,h.Z)(t,2),r=n[0],a=n[1],i=tc(r.shape,a.shape);return{a:function(){var t=Zs(Ic(r),Ic(a)),n=Os(e,Ms(a,t)),o=ec(r.shape,i);return o.length>0&&(n=Sc(n,o)),pu(n,r.shape)},b:function(){var t=Zs(Ic(r),Ic(a)),n=tl(Os(e,Ms(r,t))),o=ec(a.shape,i);return o.length>0&&(n=Sc(n,o)),pu(n,a.shape)}}}},Zv={kernelName:ft,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{x:function(){return Ms(e,Zs(Ic(cs(n,"float32")),1))}}}},Dv={kernelName:mt,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{x:function(){return Ms(e,al(kc(1),Ic(cs(n,"float32"))))}}}};var Mv=qi({avgPool3dGrad_:function(e,t,n,r,a,i){var o=Gi(e,"dy","avgPool3dGrad"),s=Gi(t,"input","avgPool3dGrad"),u=o,c=s,l=!1;4===s.rank&&(l=!0,u=pu(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=pu(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),le(5===u.rank,(function(){return"Error in avgPool3dGrad: dy must be rank 5 but got rank ".concat(u.rank,".")})),le(5===c.rank,(function(){return"Error in avgPool3dGrad: input must be rank 5 but got rank ".concat(c.rank,".")})),lu("avgPool3dGrad",a,i);var p={dy:u,input:c},h={filterSize:n,strides:r,pad:a,dimRoundingMode:i},d=Zi.runKernel(xt,p,h);return l?pu(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}}),Ov={kernelName:bt,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,h.Z)(t,1)[0],a=n.filterSize,i=n.strides,o=n.pad,s=n.dimRoundingMode;return{x:function(){return Mv(e,r,a,i,o,s)}}}};var Lv=qi({avgPoolGrad_:function(e,t,n,r,a){var i=Gi(e,"dy","avgPoolGrad"),o=Gi(t,"input","avgPoolGrad");le(o.rank===i.rank,(function(){return"Rank of input (".concat(o.rank,") does not match rank of dy (").concat(i.rank,")")}));var s=o,u=i,c=!1;3===o.rank&&(c=!0,s=pu(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=pu(i,[1,i.shape[0],i.shape[1],i.shape[2]])),le(4===u.rank,(function(){return"Error in avgPoolGrad: dy must be rank 4 but got rank ".concat(u.rank,".")})),le(4===s.rank,(function(){return"Error in avgPoolGrad: input must be rank 4 but got rank ".concat(s.rank,".")}));var l={dy:u,input:s},p={filterSize:n,strides:r,pad:a},h=Zi.runKernel(yt,l,p);return c?pu(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),zv={kernelName:gt,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,h.Z)(t,1)[0],a=n.filterSize,i=n.strides,o=n.pad;return{x:function(){return Lv(e,r,a,i,o)}}}},Pv={kernelName:kt,inputsToSave:["a","b"],gradFunc:function(e,t,n){var r=(0,h.Z)(t,2),a=r[0],i=r[1],o=n.transposeA,s=n.transposeB;return o||s?!o&&s?{a:function(){return mu(e,i,!1,!1)},b:function(){return mu(e,a,!0,!1)}}:o&&!s?{a:function(){return mu(i,e,!1,!0)},b:function(){return mu(a,e,!1,!1)}}:{a:function(){return mu(i,e,!0,!0)},b:function(){return mu(e,a,!0,!0)}}:{a:function(){return mu(e,i,!1,!0)},b:function(){return mu(a,e,!0,!1)}}}},Bv={kernelName:wt,gradFunc:function(e,t,n){var r=n.blockShape,a=n.crops;return{x:function(){return Ll(e,r,a)}}}},Wv={kernelName:St,gradFunc:function(e,t,n){for(var r=n,a=r.inputShape,i=r.shape,o=Array.from(i),s=a.length-1;s>=0;s--)if(a[s]===i[s])o[s]=1;else if(1!==a[s])throw new Error("broadcastTo(): [".concat(a,"] cannot be broadcast to [").concat(i,"]."));for(var u=[],c=0;c<o.length;c++)o[c]>1&&u.push(c);return{x:function(){return Sc(e,u,!0)}}}},Vv={kernelName:Tt,gradFunc:function(e){return{x:function(){return e.clone()}}}},Uv={kernelName:Ct,gradFunc:function(e){return{x:function(){return ac(e)}}}},Gv={kernelName:_t,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,h.Z)(t,1)[0],a=n.clipValueMin,i=n.clipValueMax;return{x:function(){return rc(sl(Oc(r,a),Uc(r,i)),e,ac(e))}}}},Hv={kernelName:At,inputsToSave:["x"],gradFunc:Iv.gradFunc},jv={kernelName:Rt,saveAllInputs:!0,gradFunc:function(e,t,n){var r=t.map((function(e){return e.shape})),a=Ie(n.axis,t[0].shape)[0],i=r.map((function(e){return e[a]}));return Vp(e,i,a).map((function(e){return function(){return e}}))}},qv={kernelName:Ft,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=(0,h.Z)(t,2),a=r[0],i=r[1],o=n.dilations,s=n.strides,u=n.pad,c=n.dataFormat;return le(ou(o),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(o,"'")})),{x:function(){return zu(a.shape,e,i,s,u,c)},filter:function(){return Eh(a,e,i.shape,s,u,c)}}}},Kv={kernelName:Dt,inputsToSave:["dy","filter"],gradFunc:function(e,t,n){var r=(0,h.Z)(t,2),a=r[0],i=r[1],o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode;return{dy:function(){return Ou(e,i,o,s,u,1,c)},filter:function(){return Eh(e,a,i.shape,o,s,u,c)}}}};var Xv=qi({conv3DBackpropFilter_:function(e,t,n,r,a){var i=e;4===e.rank&&(i=pu(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));var o=t;4===o.rank&&(o=pu(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),le(5===i.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape ".concat(i.shape,".")})),le(5===o.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape ".concat(o.shape,".")})),le(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got ".concat(n,".")})),le(i.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must match input depth in filter (").concat(n[3],".")})),le(o.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy (".concat(o.shape[4],") must match output depth for filter (").concat(n[4],").")}));var s={x:i,dy:o},u={strides:r,pad:a,filterShape:n};return Zi.runKernel(Ot,s,u)}}),Yv={kernelName:Mt,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad;le(ou(r),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(r,"'")}));var o=(0,h.Z)(t,2),s=o[0],u=o[1];return{x:function(){return Wu(s.shape,e,u,a,i)},filter:function(){return Xv(s,e,u.shape,a,i)}}}},Jv={kernelName:zt,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{x:function(){return Os(tl(Fp(cs(n,"float32"))),e)}}}},Qv={kernelName:Pt,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{x:function(){return Os(Zp(cs(n,"float32")),e)}}}},$v={kernelName:Wt,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,h.Z)(t,1)[0],a=n.axis,i=n.exclusive,o=n.reverse;return{x:function(){var t=mc([a],r.rank),n=ju(e,a,i,!o);return null!=t&&(n=fh(n,t)),n}}}},eg={kernelName:Ht,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad,o=n.dimRoundingMode,s=null==r?[1,1]:r;le(ou(s),(function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '".concat(s,"'")}));var u=(0,h.Z)(t,2),c=u[0],l=u[1];return le(4===c.rank,(function(){return"Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ".concat(c.rank,".")})),le(4===l.rank,(function(){return"Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ".concat(l.rank,".")})),le(c.shape[3]===l.shape[2],(function(){return"Error in gradient of depthwiseConv2d: number of input channels (".concat(c.shape[3],") must match the inChannels dimension in filter ").concat(l.shape[2],".")})),le(su(a,s),(function(){return"Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ".concat(a," and dilations '").concat(s,"'.")})),lu("depthwiseConv2d",i,o),{x:function(){return Oh(c.shape,e,l,a,i,s,o)},filter:function(){return Mh(c,e,l.shape,a,i,s,o)}}}},tg={kernelName:Xt,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=(0,h.Z)(t,2),a=r[0],i=r[1],o={x:a,filter:i,dy:e},s={x:a,filter:i,dy:e};return{x:function(){return Zi.runKernel(Yt,o,n)},filter:function(){return Zi.runKernel(Jt,s,n)}}}},ng={kernelName:en,outputsToSave:[!0],gradFunc:function(e,t){var n={dy:e,y:(0,h.Z)(t,1)[0]};return{x:function(){return Zi.runKernel(tn,n)}}}},rg={kernelName:nn,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0],r=Os(_c(tl(Ic(n))),2/Math.sqrt(Math.PI));return{x:function(){return Os(e,r)}}}},ag={kernelName:an,outputsToSave:[!0],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{x:function(){return Os(e,n)}}}},ig={kernelName:on,inputsToSave:["input"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{input:function(){return pu(e,n.shape)}}}},og={kernelName:sn,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{x:function(){return Os(e,_c(n))}}}},sg={kernelName:pn,gradFunc:function(e){return{x:function(){return ac(e)}}}},ug={kernelName:hn,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,h.Z)(t,2),r=n[0],a=n[1],i=tc(r.shape,a.shape);return{a:function(){var t=Ms(e,cs(a,"float32")),n=ec(r.shape,i);return n.length>0?pu(Sc(t,n),r.shape):t},b:function(){var t=Os(e,cs(r,"float32")),n=ec(a.shape,i);n.length>0&&(t=pu(Sc(t,n),a.shape));var o=Ic(a);return tl(Ms(t,cs(o,"float32")))}}}},cg={kernelName:dn,inputsToSave:["x","mean","variance","scale"],gradFunc:function(e,t,n){var r=n.varianceEpsilon,a=(0,h.Z)(t,4),i=a[0],o=a[1],s=a[2],u=a[3],c=null==u?kc(1):u,l=ec(o.shape,i.shape),p=[];if(1===o.rank){for(var d=0;d<i.shape.length-1;++d)p.push(i.shape[d]);p.push(1)}var f=al(i,o),m=Os(e,c),v=Tp(Zs(s,kc(r))),g=Os(Os(Os(v,v),v),kc(-.5));return{x:function(){return 1===o.rank?pu(Os(Os(e,Rc(pu(v,[1,1,1,o.shape[0]]),p)),c),i.shape):pu(Os(Os(e,v),c),i.shape)},mean:function(){var e=Os(Os(v,kc(-1)),m);return 1===o.rank&&(e=Sc(e,l)),pu(e,o.shape)},variance:function(){var e=Os(Os(g,f),m);return 1===o.rank&&(e=Sc(e,l)),pu(e,o.shape)},scale:function(){var t=Os(f,v),n=Os(e,t);return 1===o.rank&&(n=Sc(n,l)),pu(n,o.shape)},offset:function(){var t=e;return 1===o.rank&&(t=Sc(t,l)),pu(t,o.shape)}}}},lg={kernelName:fn,inputsToSave:["x","indices"],gradFunc:function(e,t,n){var r=(0,h.Z)(t,2),a=r[0],i=r[1],o=n.axis,s=Ie(o,a.shape)[0];return{x:function(){var t=a.shape,n=i.size,r=t.slice(0,s),u=r.length,c=t.slice(o,t.length).slice(1),l=c.length,p=pg(0,u),h=pg(u+1,u+1+l),d=hg([r,[n],c]),f=pu(e,d),m=pu(i,[n]),v=hg([[u],p,h]),g=fh(f,v),y=ih(g,m,a.shape[s]),b=vc(v);return y=fh(y,b)},indices:function(){return i}}}};function pg(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function hg(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var dg={kernelName:gn,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,h.Z)(t,2),r=n[0],a=n[1];return{a:function(){return ac(r)},b:function(){return ac(a)}}}},fg={kernelName:yn,gradFunc:function(e){return{x:function(){return cs(e,"float32")}}}},mg={kernelName:kn,gradFunc:function(e){return{x:function(){return ac(e)}}}},vg={kernelName:wn,gradFunc:function(e){return{x:function(){return ac(e)}}}},gg={kernelName:In,gradFunc:function(e){return{x:function(){return ac(e)}}}},yg={kernelName:Sn,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,h.Z)(t,1)[0],a=n.alpha,i=Mc(r,0);return{x:function(){return rc(i,e,Os(e,a))}}}},bg={kernelName:En,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{x:function(){return Ms(e,Zs(n,1))}}}},xg={kernelName:_n,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{x:function(){return Ms(e,cs(n,"float32"))}}}},kg={kernelName:Dn,inputsToSave:[],outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,h.Z)(t,1)[0],a=n.axis;return{logits:function(){var t=_c(r);return al(e,Os(Sc(e,a,!0),t))}}}};var wg=qi({localResponseNormalizationBackprop_:function(e,t,n){var r={x:e,y:t,dy:n},a={depthRadius:arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,bias:arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,alpha:arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,beta:arguments.length>6&&void 0!==arguments[6]?arguments[6]:.5};return Zi.runKernel(Ln,r,a)}}),Ig={kernelName:On,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,h.Z)(t,2),a=r[0],i=r[1],o=n.depthRadius,s=n.bias,u=n.alpha,c=n.beta;return{x:function(){return wg(a,i,e,o,s,u,c)}}}};function Sg(e,t,n,r){return t.rank<n.rank&&(t=pu(t,dc(t.shape,r))),e.rank<n.rank&&(e=pu(e,dc(e.shape,r))),{x:function(){return Os(e,cs(nc(n,t),e.dtype))}}}var Ng={kernelName:zn,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.reductionIndices,a=t[0],i=Sg(e,t[1],a,Ie(r,a.shape));return{x:function(){return i.x()}}}},Tg={kernelName:Pn,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,h.Z)(t,2),r=n[0],a=n[1];return{a:function(){return Os(e,cs(Oc(r,a),"float32"))},b:function(){return Os(e,cs(Vc(r,a),"float32"))}}}};var Cg=qi({maxPool3dGrad_:function(e,t,n,r,a,i,o){var s=Gi(e,"dy","maxPool3dGrad"),u=Gi(t,"input","maxPool3dGrad"),c=Gi(n,"output","maxPool3dGrad"),l=s,p=u,h=c,d=!1;4===u.rank&&(d=!0,l=pu(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),p=pu(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),h=pu(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),le(5===l.rank,(function(){return"Error in maxPool3dGrad: dy must be rank 5 but got rank ".concat(l.rank,".")})),le(5===p.rank,(function(){return"Error in maxPool3dGrad: input must be rank 5 but got rank ".concat(p.rank,".")})),le(5===h.rank,(function(){return"Error in maxPool3dGrad: output must be rank 5 but got rank ".concat(h.rank,".")})),lu("maxPool3dGrad",i,o);var f={dy:l,input:p,output:h},m={filterSize:r,strides:a,pad:i,dimRoundingMode:o},v=Zi.runKernel(Un,f,m);return d?pu(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}}),_g={kernelName:Vn,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,h.Z)(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode;return{x:function(){return Cg(e,a,i,o,s,u,c)}}}};var Eg=qi({maxPoolGrad_:function(e,t,n,r,a,i,o){var s=Gi(e,"dy","maxPoolGrad"),u=Gi(t,"input","maxPoolGrad"),c=Gi(n,"output","maxPoolGrad");le(u.rank===s.rank,(function(){return"Rank of input (".concat(u.rank,") does not match rank of dy (").concat(s.rank,")")})),le(4===s.rank,(function(){return"Error in maxPoolGrad: dy must be rank 4 but got rank ".concat(s.rank,".")})),le(4===u.rank,(function(){return"Error in maxPoolGrad: input must be rank 4 but got rank ".concat(u.rank,".")})),lu("maxPoolGrad",i,o);var l={dy:s,input:u,output:c},p={filterSize:r,strides:a,pad:i,dimRoundingMode:o};return Zi.runKernel(Wn,l,p)}}),Ag={kernelName:Bn,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,h.Z)(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.pad;return{x:function(){return Eg(e,a,i,o,s,u)}}}},Rg={kernelName:Hn,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,h.Z)(t,1)[0],a=Ie(n.axis,r.shape),i=de(hc(r.shape,a)[1]);return{x:function(){var t=r.shape.slice();a.forEach((function(e){t[e]=1}));var n=pu(e,t);return Ms(Os(n,xl(r.shape,"float32")),i)}}}},Fg={kernelName:jn,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.axis,a=(0,h.Z)(t,2),i=a[0],o=Sg(e,a[1],i,Ie(r,i.shape));return{x:function(){return o.x()}}}},Zg={kernelName:qn,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,h.Z)(t,2),r=n[0],a=n[1];return{a:function(){return Os(e,cs(Uc(r,a),"float32"))},b:function(){return Os(e,cs(Mc(r,a),"float32"))}}}},Dg={kernelName:Kn,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return gu(e,a,r.shape)}}}},Mg={kernelName:Xn,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,h.Z)(t,2),r=n[0],a=n[1],i=tc(r.shape,a.shape);return{a:function(){var t=ec(r.shape,i);return t.length>0?pu(Sc(e,t),r.shape):e},b:function(){var t=Os(e,tl(Zc(Ms(r,a)))),n=ec(a.shape,i);return n.length>0?pu(Sc(t,n),a.shape):t}}}},Og={kernelName:Jn,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,h.Z)(t,2),r=n[0],a=n[1],i=tc(r.shape,a.shape);return{a:function(){var t=Os(e,cs(a,"float32")),n=ec(r.shape,i);return n.length>0?pu(Sc(t,n),r.shape):t},b:function(){var t=Os(e,cs(r,"float32")),n=ec(a.shape,i);return n.length>0?pu(Sc(t,n),a.shape):t}}}},Lg={kernelName:Qn,gradFunc:function(e){return{x:function(){return tl(e)}}}},zg={kernelName:ar,inputsToSave:["indices"],gradFunc:function(e,t){var n=t[0];return{indices:function(){return bl(n.shape,"float32")}}}},Pg={kernelName:rr,gradFunc:function(e){return{x:function(){return ac(e)}}}},Bg={kernelName:ir,saveAllInputs:!0,gradFunc:function(e,t,n){var r=n.axis;return oh(e,r).map((function(e){return function(){return e}}))}},Wg={kernelName:or,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return gu(e,a,r.shape)}}}},Vg={kernelName:ur,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(e,t){var n=(0,h.Z)(t,3),r=n[0],a=n[1],i=n[2],o=r,s=a,u=tc(o.shape,s.shape);return{a:function(){var t=cs(s,"float32"),n=Os(e,Os(t,xc(o,al(t,kc(1))))),r=ec(o.shape,u);return r.length>0&&(n=Sc(n,r)),pu(n,o.shape)},b:function(){var t=Mc(o,0),n=rc(t,jc(o),ac(o)),r=Os(e,Os(i,n)),a=ec(s.shape,u);return a.length>0&&(r=Sc(r,a)),pu(r,s.shape)}}}},Ug={kernelName:cr,inputsToSave:["x","alpha"],gradFunc:function(e,t){var n=(0,h.Z)(t,2),r=n[0],a=n[1],i=Mc(r,0);return{x:function(){return rc(i,e,Os(e,a))},alpha:function(){var t=rc(i,ac(e),Os(e,r)),n=ec(a.shape,e.shape);return n.length>0&&(t=Sc(t,n)),pu(t,a.shape)}}}};function Gg(e,t,n){var r=e.shape.length,a=r-n.length,i=vm.getAxesPermutation(n,r),o=e;null!=i&&(o=fh(e,i));var s=o.shape.slice(),u=s.splice(r-n.length,n.length).reduce((function(e,t){return e*t}),1);s.push(u);var c=function(e,t,n){var r=e.shape.slice();r[n]=1;var a=pu(t,r),i=Hu(e,n,!0,!1),o=Hu(e,n,!0,!0),s=Os(i,o);return Os(a,s)}(o.reshape(s),t,a);if(c=c.reshape(o.shape),null!=i){var l=vm.getUndoAxesPermutation(i);c=fh(c,l)}return c}var Hg={kernelName:lr,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,h.Z)(t,1)[0],a=n.axis,i=[];return i=null==a?r.shape.map((function(e,t){return t})):"number"==typeof a?[a]:a,{x:function(){return Gg(r,e,i)}}}},jg={kernelName:Qt,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,h.Z)(t,2),r=n[0],a=n[1],i=tc(r.shape,a.shape);return{a:function(){var t=Ms(e,cs(a,"float32")),n=ec(r.shape,i);return n.length>0?pu(Sc(t,n),r.shape):t},b:function(){var t=Os(e,cs(r,"float32")),n=ec(a.shape,i);n.length>0&&(t=pu(Sc(t,n),a.shape));var o=Ic(a);return tl(Ms(t,cs(o,"float32")))}}}},qg={kernelName:vr,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{x:function(){return Ms(e,tl(Ic(n)))}}}},Kg={kernelName:Ir,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0],r=Os(Uc(n,6),qp(n));return{x:function(){return Os(e,cs(r,"float32"))}}}},Xg={kernelName:gr,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{x:function(){return Os(e,cs(qp(n),"float32"))}}}},Yg={kernelName:yr,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{x:function(){return pu(e,n.shape)}}}},Jg={kernelName:kr,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:(0,h.Z)(t,1)[0]};return{images:function(){return Zi.runKernel(wr,r,n)}}}},Qg={kernelName:br,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:(0,h.Z)(t,1)[0]};return{images:function(){return Zi.runKernel(xr,r,n)}}}},$g={kernelName:Sr,gradFunc:function(e,t,n){var r=Ie(n.dims,e.shape);return{x:function(){return xp(e,r)}}}},ey={kernelName:Nr,gradFunc:function(e){return{x:function(){return ac(e)}}}},ty={kernelName:Tr,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{x:function(){return tl(Ms(e,Os(xc(n,1.5),2)))}}}},ny={kernelName:Er,inputsToSave:["condition"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{condition:function(){return cs(ac(n),"float32")},t:function(){return Os(e,cs(n,e.dtype))},e:function(){return Os(e,cs(ul(n),e.dtype))}}}},ry={kernelName:Ar,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{x:function(){var t=Mc(n,kc(0)),r=kc(Rm),a=kc(Fm),i=Os(e,a),o=Os(Os(e,r),_c(cs(n,"float32")));return rc(t,i,o)}}}},ay={kernelName:Mr,outputsToSave:[!0],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{x:function(){return Os(e,Os(n,al(kc(1),n)))}}}},iy={kernelName:Dr,gradFunc:function(e){return{x:function(){return ac(e)}}}},oy={kernelName:Fr,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{x:function(){return Os(Uu(cs(n,"float32")),e)}}}},sy={kernelName:Zr,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{x:function(){return Os(Gu(cs(n,"float32")),e)}}}},uy={kernelName:Rr,inputsToSave:["x"],gradFunc:function(e,t,n){for(var r=(0,h.Z)(t,1)[0],a=n.begin,i=n.size,o=r.shape,s=sm(r,a,i),u=(0,h.Z)(s,2),c=u[0],l=u[1],p=[],d=0;d<e.rank;d++)p.push([c[d],o[d]-c[d]-l[d]]);return{x:function(){return Fl(e,p)}}}},cy={kernelName:Wr,outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,h.Z)(t,1)[0],a=n.dim,i=Os(e,r);return{logits:function(){return al(i,Os(Sc(i,[a],true),r))}}}},ly={kernelName:Or,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{x:function(){return Os(e,vu(n))}}}},py={kernelName:Pr,gradFunc:function(e,t,n){var r=n.blockShape,a=n.paddings;return{x:function(){return xu(e,r,a)}}}},hy={kernelName:Br,gradFunc:function(e,t,n){var r=n.axis;return{x:function(){return fu(e,r)}}}},dy={kernelName:Lr,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{x:function(){return Ms(e,Os(wc(cs(n,"float32")),2))}}}},fy={kernelName:Kr,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{x:function(){return Os(e,Os(cs(n,"float32"),2))}}}},my={kernelName:qr,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,h.Z)(t,2),r=n[0],a=n[1],i=kc(2);return{a:function(){return Os(e,Os(i,al(r,a)))},b:function(){return Os(e,Os(i,al(a,r)))}}}},vy={kernelName:pa,gradFunc:function(e){return{x:function(){return ac(e)}}}},gy={kernelName:$r,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,h.Z)(t,2),r=n[0],a=n[1],i=tc(r.shape,a.shape);return{a:function(){var t=e,n=ec(r.shape,i);return n.length>0&&(t=Sc(t,n)),pu(t,r.shape)},b:function(){var t=e,n=ec(a.shape,i);return n.length>0&&(t=Sc(t,n)),pu(tl(t),a.shape)}}}},yy={kernelName:zr,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,h.Z)(t,1)[0],a=r.shape.slice();Ie(n.axis,r.shape).forEach((function(e){a[e]=1}));var i=pu(e,a),o=Os(i,xl(r.shape,"float32"));return{x:function(){return o}}}},by={kernelName:ea,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{x:function(){return Ms(e,Ic(Uu(n)))}}}},xy={kernelName:ta,outputsToSave:[!0],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{x:function(){return Os(al(kc(1),Ic(n)),e)}}}},ky={kernelName:na,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,h.Z)(t,1)[0],a=n.reps;return{x:function(){var t=ac(r);if(1===r.rank)for(var n=0;n<a[0];++n)t=Zs(t,gu(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(var i=0;i<a[0];++i)for(var o=0;o<a[1];++o)t=Zs(t,gu(e,[i*r.shape[0],o*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(var s=0;s<a[0];++s)for(var u=0;u<a[1];++u)for(var c=0;c<a[2];++c)t=Zs(t,gu(e,[s*r.shape[0],u*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-".concat(r.rank," tensors yet."));for(var l=0;l<a[0];++l)for(var p=0;p<a[1];++p)for(var h=0;h<a[2];++h)for(var d=0;d<a[3];++d)t=Zs(t,gu(e,[l*r.shape[0],p*r.shape[1],h*r.shape[2],d*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},wy={kernelName:ia,gradFunc:function(e,t,n){var r=vc(n.perm);return{x:function(){return fh(e,r)}}}},Iy={kernelName:sa,gradFunc:function(e,t,n){var r=n.axis;return{value:function(){return jp(e,r)}}}},Sy={kernelName:ua,inputsToSave:["segmentIds"],gradFunc:function(e,t){var n=(0,h.Z)(t,1)[0];return{x:function(){return function(e,t){for(var n=gl(t,ac(t)),r=Dc(e,n),a=Oc(t,kc(0,"int32")),i=r.rank-a.rank,o=0;o<i;++o)a=Ec(a,o+1);a=sl(a,xl(r.shape,"bool"));var s=ac(r);return rc(a,r,s)}(e,n)}}}};for(var Ny={kernelName:la,gradFunc:function(e){return{x:function(){return ac(e)}}}},Ty=0,Cy=[Iv,Sv,Nv,Tv,Cv,_v,Ev,Av,Rv,Fv,Zv,Dv,Ov,zv,Pv,Bv,Wv,Vv,Uv,Gv,Hv,jv,Kv,qv,Yv,Jv,Qv,$v,eg,tg,jg,ng,rg,ag,ig,og,ug,sg,cg,lg,dg,fg,mg,vg,gg,yg,bg,xg,kg,Ig,Ng,Ng,Tg,_g,Ag,Rg,Fg,Zg,Dg,Mg,Og,Lg,zg,Pg,Bg,Wg,Wg,Vg,Ug,Hg,qg,Kg,Xg,Yg,Jg,Qg,$g,ey,ty,ny,ry,ay,iy,oy,sy,uy,cy,ly,py,py,hy,hy,dy,my,fy,vy,gy,yy,by,xy,ky,wy,Iy,Sy,Ny];Ty<Cy.length;Ty++){Na(Cy[Ty])}di().prototype.abs=function(){return this.throwIfDisposed(),Ls(this)},di().prototype.acos=function(){return this.throwIfDisposed(),zs(this)},di().prototype.acosh=function(){return this.throwIfDisposed(),Ps(this)},di().prototype.add=function(e){return this.throwIfDisposed(),Zs(this,e)},di().prototype.all=function(e,t){return this.throwIfDisposed(),Ws(this,e,t)},di().prototype.any=function(e,t){return this.throwIfDisposed(),Vs(this,e,t)},di().prototype.argMax=function(e){return this.throwIfDisposed(),Us(this,e)},di().prototype.argMin=function(e){return this.throwIfDisposed(),Gs(this,e)},di().prototype.asScalar=function(){return this.throwIfDisposed(),le(1===this.size,(function(){return"The array must have only 1 element."})),pu(this,[])},di().prototype.asType=function(e){return this.throwIfDisposed(),cs(this,e)},di().prototype.as1D=function(){return this.throwIfDisposed(),pu(this,[this.size])},di().prototype.as2D=function(e,t){return this.throwIfDisposed(),pu(this,[e,t])},di().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),pu(this,[e,t,n])},di().prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),pu(this,[e,t,n,r])},di().prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),pu(this,[e,t,n,r,a])},di().prototype.asin=function(){return this.throwIfDisposed(),Hs(this)},di().prototype.asinh=function(){return this.throwIfDisposed(),js(this)},di().prototype.atan=function(){return this.throwIfDisposed(),qs(this)},di().prototype.atan2=function(e){return this.throwIfDisposed(),Ks(this,e)},di().prototype.atanh=function(){return this.throwIfDisposed(),Xs(this)},di().prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),hu(this,e,t,n,r)},di().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),xu(this,e,t)},di().prototype.batchNorm=function(e,t,n,r,a){return this.throwIfDisposed(),wu(this,e,t,n,r,a)},di().prototype.broadcastTo=function(e){return this.throwIfDisposed(),_u(this,e)},di().prototype.cast=function(e){return this.throwIfDisposed(),cs(this,e)},di().prototype.ceil=function(){return this.throwIfDisposed(),Eu(this)},di().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),Ru(this,e,t)},di().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof hi&&(e=[e]),fu([this].concat((0,g.Z)(e)),t)},di().prototype.conv1d=function(e,t,n,r,a,i){return this.throwIfDisposed(),Lu(this,e,t,n,r,a,i)},di().prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),Pu(this,e,t,n,r,a)},di().prototype.conv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),Ou(this,e,t,n,r,a,i)},di().prototype.cos=function(){return this.throwIfDisposed(),Uu(this)},di().prototype.cosh=function(){return this.throwIfDisposed(),Gu(this)},di().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),Hu(this,e,t,n)},di().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),ju(this,e,t,n)},di().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),Ku(this,e,t)},di().prototype.depthwiseConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),Xu(this,e,t,n,r,a,i)},di().prototype.dilation2d=function(e,t,n,r,a){return this.throwIfDisposed(),Ju(this,e,t,n,r,a)},di().prototype.divNoNan=function(e){return this.throwIfDisposed(),ic(this,e)},di().prototype.div=function(e){return this.throwIfDisposed(),Ms(this,e)},di().prototype.dot=function(e){return this.throwIfDisposed(),oc(this,e)},di().prototype.elu=function(){return this.throwIfDisposed(),uc(this)},di().prototype.equal=function(e){return this.throwIfDisposed(),nc(this,e)},di().prototype.erf=function(){return this.throwIfDisposed(),cc(this)},di().prototype.euclideanNorm=function(e,t){return this.throwIfDisposed(),Cc(this,e,t)},di().prototype.exp=function(){return this.throwIfDisposed(),_c(this)},di().prototype.expandDims=function(e){return this.throwIfDisposed(),Ec(this,e)},di().prototype.expm1=function(){return this.throwIfDisposed(),Ac(this)},di().prototype.fft=function(){return this.throwIfDisposed(),Pp(this)},di().prototype.flatten=function(){return this.throwIfDisposed(),pu(this,[this.size])},di().prototype.floor=function(){return this.throwIfDisposed(),Zc(this)},di().prototype.floorDiv=function(e){return this.throwIfDisposed(),Ds(this,e)},di().prototype.gather=function(e,t){return this.throwIfDisposed(),Dc(this,e,t)},di().prototype.greaterEqual=function(e){return this.throwIfDisposed(),Oc(this,e)},di().prototype.greater=function(e){return this.throwIfDisposed(),Mc(this,e)},di().prototype.ifft=function(){return this.throwIfDisposed(),Bp(this)},di().prototype.irfft=function(){return this.throwIfDisposed(),Wp(this)},di().prototype.isFinite=function(){return this.throwIfDisposed(),zc(this)},di().prototype.isInf=function(){return this.throwIfDisposed(),Pc(this)},di().prototype.isNaN=function(){return this.throwIfDisposed(),Bc(this)},di().prototype.leakyRelu=function(e){return this.throwIfDisposed(),Wc(this,e)},di().prototype.lessEqual=function(e){return this.throwIfDisposed(),Uc(this,e)},di().prototype.less=function(e){return this.throwIfDisposed(),Vc(this,e)},di().prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),Hc(this,e,t,n,r)},di().prototype.logSigmoid=function(){return this.throwIfDisposed(),rl(this)},di().prototype.logSoftmax=function(e){return this.throwIfDisposed(),il(this,e)},di().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),ol(this,e,t)},di().prototype.log=function(){return this.throwIfDisposed(),jc(this)},di().prototype.log1p=function(){return this.throwIfDisposed(),qc(this)},di().prototype.logicalAnd=function(e){return this.throwIfDisposed(),sl(this,e)},di().prototype.logicalNot=function(){return this.throwIfDisposed(),ul(this)},di().prototype.logicalOr=function(e){return this.throwIfDisposed(),cl(this,e)},di().prototype.logicalXor=function(e){return this.throwIfDisposed(),ll(this,e)},di().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),mu(this,e,t,n)},di().prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),fl(this,e,t,n,r)},di().prototype.max=function(e,t){return this.throwIfDisposed(),yc(this,e,t)},di().prototype.maximum=function(e){return this.throwIfDisposed(),gl(this,e)},di().prototype.mean=function(e,t){return this.throwIfDisposed(),yl(this,e,t)},di().prototype.min=function(e,t){return this.throwIfDisposed(),bc(this,e,t)},di().prototype.minimum=function(e){return this.throwIfDisposed(),wl(this,e)},di().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),Il(this,e,t)},di().prototype.mod=function(e){return this.throwIfDisposed(),Sl(this,e)},di().prototype.mul=function(e){return this.throwIfDisposed(),Os(this,e)},di().prototype.neg=function(){return this.throwIfDisposed(),tl(this)},di().prototype.norm=function(e,t,n){return this.throwIfDisposed(),Tc(this,e,t,n)},di().prototype.notEqual=function(e){return this.throwIfDisposed(),_l(this,e)},di().prototype.oneHot=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.throwIfDisposed(),El(this,e,t,n)},di().prototype.onesLike=function(){return this.throwIfDisposed(),Al(this)},di().prototype.pad=function(e,t){return this.throwIfDisposed(),Fl(this,e,t)},di().prototype.pool=function(e,t,n,r,a,i){return this.throwIfDisposed(),zl(this,e,t,n,r,a,i)},di().prototype.pow=function(e){return this.throwIfDisposed(),xc(this,e)},di().prototype.prelu=function(e){return this.throwIfDisposed(),Pl(this,e)},di().prototype.prod=function(e,t){return this.throwIfDisposed(),Bl(this,e,t)},di().prototype.reciprocal=function(){return this.throwIfDisposed(),gp(this)},di().prototype.relu=function(){return this.throwIfDisposed(),yp(this)},di().prototype.relu6=function(){return this.throwIfDisposed(),bp(this)},di().prototype.reshapeAs=function(e){return this.throwIfDisposed(),pu(this,e.shape)},di().prototype.reshape=function(e){return this.throwIfDisposed(),pu(this,e)},di().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),hd(this,e,t,n)},di().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),dd(this,e,t,n)},di().prototype.reverse=function(e){return this.throwIfDisposed(),xp(this,e)},di().prototype.rfft=function(){return this.throwIfDisposed(),Up(this)},di().prototype.round=function(){return this.throwIfDisposed(),Np(this)},di().prototype.rsqrt=function(){return this.throwIfDisposed(),Tp(this)},di().prototype.selu=function(){return this.throwIfDisposed(),Cp(this)},di().prototype.separableConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),_p(this,e,t,n,r,a,i)},di().prototype.sigmoid=function(){return this.throwIfDisposed(),vu(this)},di().prototype.sign=function(){return this.throwIfDisposed(),Rp(this)},di().prototype.sin=function(){return this.throwIfDisposed(),Fp(this)},di().prototype.sinh=function(){return this.throwIfDisposed(),Zp(this)},di().prototype.slice=function(e,t){return this.throwIfDisposed(),gu(this,e,t)},di().prototype.softmax=function(e){return this.throwIfDisposed(),zp(this,e)},di().prototype.softplus=function(){return this.throwIfDisposed(),nl(this)},di().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),Ll(this,e,t)},di().prototype.split=function(e,t){return this.throwIfDisposed(),Vp(this,e,t)},di().prototype.sqrt=function(){return this.throwIfDisposed(),wc(this)},di().prototype.square=function(){return this.throwIfDisposed(),Ic(this)},di().prototype.squaredDifference=function(e){return this.throwIfDisposed(),Gp(this,e)},di().prototype.squeeze=function(e){return this.throwIfDisposed(),Hp(this,e)},di().prototype.stack=function(e,t){this.throwIfDisposed();var n=e instanceof hi?[this,e]:[this].concat((0,g.Z)(e));return jp(n,t)},di().prototype.step=function(e){return this.throwIfDisposed(),qp(this,e)},di().prototype.stridedSlice=function(e,t,n,r,a,i,o,s){return this.throwIfDisposed(),Kp(this,e,t,n,r,a,i,o,s)},di().prototype.sub=function(e){return this.throwIfDisposed(),al(this,e)},di().prototype.sum=function(e,t){return this.throwIfDisposed(),Sc(this,e,t)},di().prototype.tan=function(){return this.throwIfDisposed(),Xp(this)},di().prototype.tanh=function(){return this.throwIfDisposed(),yu(this)},di().prototype.tile=function(e){return this.throwIfDisposed(),Rc(this,e)},di().prototype.toBool=function(){return this.throwIfDisposed(),cs(this,"bool")},di().prototype.toFloat=function(){return this.throwIfDisposed(),cs(this,"float32")},di().prototype.toInt=function(){return this.throwIfDisposed(),cs(this,"int32")},di().prototype.topk=function(e,t){return this.throwIfDisposed(),nh(this,e,t)},di().prototype.transpose=function(e){return this.throwIfDisposed(),fh(this,e)},di().prototype.unique=function(e){return this.throwIfDisposed(),ah(this,e)},di().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),ih(this,e,t)},di().prototype.unstack=function(e){return this.throwIfDisposed(),oh(this,e)},di().prototype.where=function(e,t){return this.throwIfDisposed(),rc(e,this,t)},di().prototype.zerosLike=function(){return this.throwIfDisposed(),ac(this)};var _y=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),r=t.call(this,e),Object.setPrototypeOf((0,s.Z)(r),n.prototype),r}return(0,v.Z)(n)}((0,u.Z)(Error)),Ey=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),r=t.call(this,e),Object.setPrototypeOf((0,s.Z)(r),n.prototype),r}return(0,v.Z)(n)}((0,u.Z)(Error)),Ay=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),r=t.call(this,e),Object.setPrototypeOf((0,s.Z)(r),n.prototype),r}return(0,v.Z)(n)}((0,u.Z)(Error)),Ry=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),r=t.call(this,e),Object.setPrototypeOf((0,s.Z)(r),n.prototype),r}return(0,v.Z)(n)}((0,u.Z)(Error)),Fy=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),r=t.call(this,e),Object.setPrototypeOf((0,s.Z)(r),n.prototype),r}return(0,v.Z)(n)}((0,u.Z)(Error)),Zy=function(){function e(t){(0,m.Z)(this,e),this.maxEntries=t||100,this.cache=new Map}return(0,v.Z)(e,[{key:"get",value:function(e){var t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}},{key:"put",value:function(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){var n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,t)}},{key:"getMaxEntries",value:function(){return this.maxEntries}},{key:"setMaxEntries",value:function(e){if(e<0)throw new Error("The maxEntries of LRU caches must be at least 0, but got ".concat(e,"."));if(this.maxEntries>e)for(var t=0;t<this.maxEntries-e;t++){var n=this.cache.keys().next().value;this.cache.delete(n)}this.maxEntries=e}}]),e}();function Dy(e,t){if(Array.isArray(e)){for(var n=[],r=0;r<t;r++)n=n.concat(e);return n}var a=new Array(t);return a.fill(e),a}function My(e,t){if(!e)throw new Fy(t)}function Oy(e,t){var n,r=0,a=(0,y.Z)(e);try{for(a.s();!(n=a.n()).done;){n.value===t&&r++}}catch(i){a.e(i)}finally{a.f()}return r}function Ly(e){return 1===e.length?e[0]:e}function zy(e){return Array.isArray(e)?e:[e]}function Py(e){var t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function By(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,(function(e,t){return t.toUpperCase()}))}var Wy={};function Vy(e){if(null==e)return null;var t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function Uy(e){if(null!=e&&"object"==typeof e)if(Array.isArray(e))e.forEach((function(e){return Uy(e)}));else for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],a=e[r];null!=a&&"object"==typeof a&&(Array.isArray(a)||"ndarray"!==a.type||"number"!=typeof a.value?Uy(a):e[r]=a.value)}}function Gy(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"object",a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("string"==typeof e){var i,o=e;if(o in n)i=n[o];else if(o in Wy)i=Wy[o];else if(null==(i=t[o]))throw new Ay("Unknown ".concat(r,": ").concat(e,". This may be due to one of the following reasons:\n1. The ").concat(r," is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ").concat(r," is defined in JavaScript, but is not registered properly with tf.serialization.registerClass()."));return i}var s,u,c,l,p,d,f=e;if(null==f.className||null==f.config)throw new Ay("".concat(r,": Improper config format: ").concat(JSON.stringify(f),".\n'className' and 'config' must set."));var m,v,g=f.className;if(g in n?(s=n[g],m=(u=(0,h.Z)(s,2))[0],v=u[1]):g in Wy?(c=Wy.className,m=(l=(0,h.Z)(c,2))[0],v=l[1]):g in t&&(p=t[g],m=(d=(0,h.Z)(p,2))[0],v=d[1]),null==m)throw new Ay("Unknown ".concat(r,": ").concat(g,". This may be due to one of the following reasons:\n1. The ").concat(r," is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ").concat(r," is defined in JavaScript, but is not registered properly with tf.serialization.registerClass()."));if(null!=v){for(var y={},b=0,x=Object.keys(Wy);b<x.length;b++){var k=x[b];y[k]=Wy[k]}for(var w=0,I=Object.keys(n);w<I.length;w++){var S=I[w];y[S]=n[S]}f.config.customObjects=y;for(var N=Object.assign({},Wy),T=0,C=Object.keys(n);T<C.length;T++){var _=C[T];Wy[_]=n[_]}Uy(f.config);var E=v(m,f.config,n,a);return Wy=Object.assign({},N),E}for(var A=Object.assign({},Wy),R=0,F=Object.keys(n);R<F.length;R++){var Z=F[R];Wy[Z]=n[Z]}var D=new m(f.config);return Wy=Object.assign({},A),D}function Hy(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function jy(e){if(null==e)return e;var t,n=[],r=(0,y.Z)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;-1===n.indexOf(a)&&n.push(a)}}catch(i){r.e(i)}finally{r.f()}return n}function qy(e){if(null==e)throw new Ay("Invalid value in obj: ".concat(JSON.stringify(e)));for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function Ky(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new Ay("".concat(n," is not a valid ").concat(t,".  Valid values are ").concat(e," or null/undefined."))}function Xy(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return My(n>=0),My(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every((function(e){return typeof e===t}))}function Yy(e,t){Array.isArray(e)?(Aa.assert(e.length>0,(function(){return"".concat(t," is unexpectedly an empty array.")})),e.forEach((function(e,n){return Yy(e,"element ".concat(n+1," of ").concat(t))}))):Aa.assert(Number.isInteger(e)&&e>0,(function(){return"Expected ".concat(t," to be a positive integer, but got ").concat(Jy(e),".")}))}function Jy(e){return null===e?"null":Array.isArray(e)?"["+e.map((function(e){return Jy(e)})).join(",")+"]":"string"==typeof e?'"'.concat(e,'"'):"".concat(e)}function Qy(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}var $y=0;function eb(){return $y++}var tb={};function nb(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e in tb||(tb[e]=0),tb[e]+=1,e+tb[e].toString()}var rb=["channelsFirst","channelsLast"],ab=["nearest","bilinear"],ib=["valid","same","causal"],ob=["max","avg"],sb=["sum","mul","concat","ave"],ub=new Map;function cb(e){Ky(rb,"DataFormat",e)}function lb(e){Ky(ib,"PaddingMode",e)}function pb(e){Ky(ob,"PoolMode",e)}var hb=[],db="/";function fb(e,t){hb.push(e);try{var n=t();return hb.pop(),n}catch(n){throw hb.pop(),n}}function mb(e){if(!bb(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===hb.length?"":hb.join(db)+db)+e}function vb(e){if(!bb(e))throw new Error("Not a valid tensor name: '"+e+"'");ub.has(e)||ub.set(e,0);var t=ub.get(e);if(ub.set(e,ub.get(e)+1),t>0){var n="".concat(e,"_").concat(t);return ub.set(n,1),n}return e}var gb,yb=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function bb(e){return!!e.match(yb)}function xb(e){return e===parseInt(e.toString(),10)}function kb(e,t,n){null==t&&(t=0),null==n&&(n=e.length);for(var r=1,a=t;a<n;++a)r*=e[a];return r}function wb(e){if(0===e.length)return Number.NaN;for(var t=Number.POSITIVE_INFINITY,n=0;n<e.length;n++){var r=e[n];r<t&&(t=r)}return t}function Ib(e){if(0===e.length)return Number.NaN;for(var t=Number.NEGATIVE_INFINITY,n=0;n<e.length;n++){var r=e[n];r>t&&(t=r)}return t}function Sb(e,t){if(t<e)throw new Ay("end (".concat(t,") < begin (").concat(e,") is forbidden."));for(var n=[],r=e;r<t;++r)n.push(r);return n}function Nb(){return null==gb&&(gb=Rs().epsilon()),gb}function Tb(e,t){return cs(e,t)}function Cb(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),pu(e,n)}function _b(e,t,n){return xs((function(){switch(e.rank){case 1:return Dp(e,t,n);case 2:return Mp(e,[t,0],[n,e.shape[1]]);case 3:return Op(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return Lp(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return gu(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return gu(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new Ay("sliceAlongFirstAxis() received an unsupported tensor rank: ".concat(e.rank))}}))}function Eb(e,t,n){return xs((function(){switch(e.rank){case 1:return Dp(e,t,n);case 2:return Mp(e,[0,t],[e.shape[0],n]);case 3:return Op(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return Lp(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new Ay("sliceAlongLastAxis() received an unsupported tensor rank: ".concat(e.rank))}}))}function Ab(e,t,n,r){return xs((function(){switch(e.rank){case 1:return Dp(e,t,n);case 2:switch(r){case 1:return _b(e,t,n);case 2:return Eb(e,t,n);default:throw new Ay("The axis is not within the rank of the tensor ".concat(r))}case 3:switch(r){case 1:return _b(e,t,n);case 2:return Op(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return Eb(e,t,n);default:throw new Ay("The axis is not within the rank of the tensor ".concat(r))}case 4:switch(r){case 1:return _b(e,t,n);case 2:return Lp(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return Lp(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return Eb(e,t,n);default:throw new Ay("The axis is not within the rank of the tensor ".concat(r))}default:throw new Ay("sliceAlongLastAxis() received an unsupported tensor rank: ".concat(e.rank))}}))}function Rb(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return n<0&&(n=0!==(t=e[0].rank)?t:0),n===e[0].rank&&(n=-1),fu(e,n)}function Fb(e,t){switch(e.rank){case 1:return Fu([e,t]);case 2:return Zu([e,t],0);case 3:return Du([e,t],0);case 4:return Mu([e,t],0);default:throw new Ay("concatAlongFirstAxis() received an unsupported tensor rank: ".concat(e.rank))}}function Zb(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new Ay("The length of input n (".concat(t.length,") does not match the number of dimensions in input x (").concat(e.rank,")"));return Rc(e,t)}function Db(e){return hp(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0)}function Mb(e,t,n,r){if(e.rank<2||t.rank<2)throw new Ry("dot requires both inputs to be rank >= 2 but got x shape = ".concat(e.shape," and y shape = ").concat(t.shape));if(t.rank>=3&&e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new Ry("If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ".concat(e.shape," and  y shape = ").concat(t.shape));if(2===e.rank&&2===t.rank)return _h.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?zb(e.rank,r,"channelsLast"):null,activation:n});var a=e.shape.slice(),i=a.pop();e=pu(e,[-1,i]);var o=t.shape.slice(),s=o.pop(),u=o.pop(),c=[].concat((0,g.Z)(o),[s]),l=Array.from({length:t.rank},(function(e,n){return 0===n?t.rank-2:n<=t.rank-2?n-1:n}));t=pu(fh(t,l),[u,-1]);var p=[].concat((0,g.Z)(a),(0,g.Z)(c));return pu(_h.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?zb(e.rank,r,"channelsLast"):null,activation:n}),p)}function Ob(e,t,n){return xs((function(){return t=Array.isArray(t)?Yp(t,"int32"):cs(t,"int32"),Dc(e,t,n)}))}function Lb(e){return Os(e,e)}function zb(e,t,n){var r=t.shape;if(1!==t.rank&&t.rank!==e)throw new Ay("Unexpected bias dimensions: ".concat(t.rank,"; expected it to be 1 or ").concat(e));if(5===e){if("channelsFirst"===n)return 1===r.length?pu(t,[1,r[0],1,1,1]):pu(t,[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return 1===r.length?pu(t,[1,1,1,1,r[0]]):pu(t,[1].concat(r))}else if(4===e){if("channelsFirst"===n)return 1===r.length?pu(t,[1,r[0],1,1]):pu(t,[1,r[2],r[0],r[1]]);if("channelsLast"===n)return 1===r.length?pu(t,[1,1,1,r[0]]):pu(t,[1].concat(r))}else if(3===e){if("channelsFirst"===n)return 1===r.length?pu(t,[1,r[0],1]):pu(t,[1,r[1],r[0]]);if("channelsLast"===n)return 1===r.length?pu(t,[1,1,r[0]]):pu(t,[1].concat(r))}else if(e<3)return t;throw new Ay("Unsupported input rank by biasAdd: ".concat(t.rank))}function Pb(e,t,n){return xs((function(){return null==n&&(n="channelsLast"),cb(n),Zs(e,zb(e.rank,t,n))}))}function Bb(e,t,n,r){return xs((function(){return Ih(e,t,n,r)}))}function Wb(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?e():t()}var Vb=["fanIn","fanOut","fanAvg"],Ub=["normal","uniform","truncatedNormal"];var Gb=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"fromConfigUsesCustomObjects",value:function(){return!1}},{key:"getConfig",value:function(){return{}}}]),n}(Gd.Serializable),Hb=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"apply",value:function(e,t){return bl(e,t)}}]),n}(Gb);Hb.className="Zeros",Gd.registerClass(Hb);var jb=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"apply",value:function(e,t){return xl(e,t)}}]),n}(Gb);jb.className="Ones",Gd.registerClass(jb);var qb=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;if((0,m.Z)(this,n),r=t.call(this),"object"!=typeof e)throw new Ay("Expected argument of type ConstantConfig but got ".concat(e));if(void 0===e.value)throw new Ay("config must have value set but got ".concat(e));return r.value=e.value,(0,c.Z)(r)}return(0,v.Z)(n,[{key:"apply",value:function(e,t){var n=this;return xs((function(){return Os(kc(n.value),xl(e,t))}))}},{key:"getConfig",value:function(){return{value:this.value}}}]),n}(Gb);qb.className="Constant",Gd.registerClass(qb);var Kb=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this)).DEFAULT_MINVAL=-.05,r.DEFAULT_MAXVAL=.05,r.minval=e.minval||r.DEFAULT_MINVAL,r.maxval=e.maxval||r.DEFAULT_MAXVAL,r.seed=e.seed,r}return(0,v.Z)(n,[{key:"apply",value:function(e,t){return fp(e,this.minval,this.maxval,t,this.seed)}},{key:"getConfig",value:function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}]),n}(Gb);Kb.className="RandomUniform",Gd.registerClass(Kb);var Xb=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return(0,v.Z)(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new Ry("randomNormal does not support dType ".concat(t,"."));return Db(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(Gb);Xb.className="RandomNormal",Gd.registerClass(Xb);var Yb=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return(0,v.Z)(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new Ry("truncatedNormal does not support dType ".concat(t,"."));return rh(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(Gb);Yb.className="TruncatedNormal",Gd.registerClass(Yb);var Jb=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this)).gain=null!=e.gain?e.gain:1,r}return(0,v.Z)(n,[{key:"apply",value:function(e,t){var n=this;return xs((function(){if(2!==e.length||e[0]!==e[1])throw new Ay("Identity matrix initializer can only be used for 2D square matrices.");return Os(n.gain,Fc(e[0]))}))}},{key:"getConfig",value:function(){return{gain:this.gain}}}]),n}(Gb);Jb.className="Identity",Gd.registerClass(Jb);var Qb=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;if((0,m.Z)(this,n),r=t.call(this),e.scale<0)throw new Ay("scale must be a positive float. Got: ".concat(e.scale));return r.scale=null==e.scale?1:e.scale,r.mode=null==e.mode?"fanIn":e.mode,function(e){Ky(Vb,"FanMode",e)}(r.mode),r.distribution=null==e.distribution?"normal":e.distribution,function(e){Ky(Ub,"Distribution",e)}(r.distribution),r.seed=e.seed,(0,c.Z)(r)}return(0,v.Z)(n,[{key:"apply",value:function(e,t){var n=function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"channelsLast";if(cb(r),2===e.length)t=e[0],n=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===r){var a=kb(e,2);t=e[1]*a,n=e[0]*a}else if("channelsLast"===r){var i=kb(e,0,e.length-2);t=e[e.length-2]*i,n=e[e.length-1]*i}}else{var o=kb(e);t=Math.sqrt(o),n=Math.sqrt(o)}return[t,n]}(e),r=n[0],a=n[1],i=this.scale;if("fanIn"===this.mode?i/=Math.max(1,r):"fanOut"===this.mode?i/=Math.max(1,a):i/=Math.max(1,(r+a)/2),"normal"===this.distribution){var o=Math.sqrt(i);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new Ry("".concat(this.getClassName()," does not support dType ").concat(t,"."));return rh(e,0,o,t,this.seed)}var s=Math.sqrt(3*i);return fp(e,-s,s,t,this.seed)}},{key:"getConfig",value:function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}]),n}(Gb);Qb.className="VarianceScaling",Gd.registerClass(Qb);var $b=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){return(0,m.Z)(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}return(0,v.Z)(n,[{key:"getClassName",value:function(){return Qb.className}}]),n}(Qb);$b.className="GlorotUniform",Gd.registerClass($b);var ex=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){return(0,m.Z)(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}return(0,v.Z)(n,[{key:"getClassName",value:function(){return Qb.className}}]),n}(Qb);ex.className="GlorotNormal",Gd.registerClass(ex);var tx=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){return(0,m.Z)(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return(0,v.Z)(n,[{key:"getClassName",value:function(){return Qb.className}}]),n}(Qb);tx.className="HeNormal",Gd.registerClass(tx);var nx=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){return(0,m.Z)(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return(0,v.Z)(n,[{key:"getClassName",value:function(){return Qb.className}}]),n}(Qb);nx.className="HeUniform",Gd.registerClass(nx);var rx=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){return(0,m.Z)(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return(0,v.Z)(n,[{key:"getClassName",value:function(){return Qb.className}}]),n}(Qb);rx.className="LeCunNormal",Gd.registerClass(rx);var ax=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){return(0,m.Z)(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return(0,v.Z)(n,[{key:"getClassName",value:function(){return Qb.className}}]),n}(Qb);ax.className="LeCunUniform",Gd.registerClass(ax);var ix=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;if((0,m.Z)(this,n),(r=t.call(this)).DEFAULT_GAIN=1,r.gain=null==e.gain?r.DEFAULT_GAIN:e.gain,r.seed=e.seed,null!=r.seed)throw new Ry("Random seed is not implemented for Orthogonal Initializer yet.");return(0,c.Z)(r)}return(0,v.Z)(n,[{key:"apply",value:function(e,t){var n=this;return xs((function(){if(e.length<2)throw new Ry("Shape must be at least 2D.");e[0]*e[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more than 2000 (".concat(e[0]*e[1],") elements: Slowness may result."));var t=Db(e[0]>e[1]?[e[1],e[0]]:e,0,1,"float32"),r=Bd.gramSchmidt(t);return e[0]>e[1]&&(r=fh(r)),Os(n.gain,r)}))}},{key:"getConfig",value:function(){return{gain:this.gain,seed:this.seed}}}]),n}(Gb);ix.className="Orthogonal",Gd.registerClass(ix);var ox={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function sx(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Gy(e,Gd.SerializationMap.getMap().classNameMap,t,"initializer")}function ux(e){return Vy(e)}function cx(e){if("string"==typeof e){var t=e in ox?ox[e]:e;if("GlorotNormal"===t)return new ex;if("GlorotUniform"===t)return new $b;if("HeNormal"===t)return new tx;if("HeUniform"===t)return new nx;if("LeCunNormal"===t)return new rx;if("LeCunUniform"===t)return new ax;var n={};return n.className=t,n.config={},sx(n)}return e instanceof Gb?e:sx(e)}function lx(e){return Array.isArray(e)&&Array.isArray(e[0])}function px(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function hx(e){var t;if(Array.isArray(e)){if(1!==e.length)throw new Ay("Expected Tensor length to be 1; got ".concat(e.length));t=e[0]}else t=e;return t}function dx(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return e[0];throw new Ay("Expected exactly 1 Shape; got ".concat(e.length))}return e}function fx(e){var t,n=0,r=(0,y.Z)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;0===a.shape.length?n+=1:n+=a.shape.reduce((function(e,t){return e*t}))}}catch(i){r.e(i)}finally{r.f()}return n}var mx="Variable",vx=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:mx,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;(0,m.Z)(this,e),this.dtype=null==n?"float32":n,this.shape=t.shape,this.id=eb(),r=null==r?mx:r,this.originalName=mb(r),this.name=vb(this.originalName),this.trainable_=a,this.constraint=i,this.val=uh(t,this.trainable_,this.name,this.dtype)}return(0,v.Z)(e,[{key:"read",value:function(){return this.assertNotDisposed(),this.val}},{key:"write",value:function(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}},{key:"dispose",value:function(){this.assertNotDisposed(),this.val.dispose()}},{key:"assertNotDisposed",value:function(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e}}]),e}();function gx(e){return e.map((function(e){return e.read()}))}function yx(e){e.forEach((function(e){e[0].write(e[1])}))}var bx=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.dtype=t.dtype,this.shape=t.shape,null!=t.shape?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}})),xx=(0,v.Z)((function e(t,n,r,a,i,o,s){(0,m.Z)(this,e),this.dtype=t,this.shape=n,this.sourceLayer=r,this.inputs=a,this.callArgs=i,this.outputTensorIndex=s,this.id=eb(),null!=o&&(this.originalName=mb(o),this.name=vb(this.originalName)),this.rank=n.length})),kx=0,wx=function(){function e(t,n){(0,m.Z)(this,e),this.callArgs=n,this.id=kx++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;var r,a=(0,y.Z)(t.inboundLayers);try{for(a.s();!(r=a.n()).done;){var i=r.value;null!=i&&i.outboundNodes.push(this)}}catch(o){a.e(o)}finally{a.f()}t.outboundLayer.inboundNodes.push(this)}return(0,v.Z)(e,[{key:"getConfig",value:function(){var e,t=[],n=(0,y.Z)(this.inboundLayers);try{for(n.s();!(e=n.n()).done;){var r=e.value;null!=r?t.push(r.name):t.push(null)}}catch(a){n.e(a)}finally{n.f()}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}]),e}(),Ix=0,Sx=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,m.Z)(this,n),(e=t.call(this))._callHook=null,e._addedWeightNames=[],e._stateful=!1,e.id=Ix++,e.activityRegularizer=null,e.inputSpec=null,e.supportsMasking=!1,e._trainableWeights=[],e._nonTrainableWeights=[],e._losses=[],e._updates=[],e._built=!1,e.inboundNodes=[],e.outboundNodes=[];var a=r.name;if(!a){var i=e.getClassName();a=Py(i)+"_"+nb(i)}if(e.name=a,e.trainable_=null==r.trainable||r.trainable,null!=r.inputShape||null!=r.batchInputShape){var o;if(null!=r.batchInputShape)o=r.batchInputShape;else if(null!=r.inputShape){var s=null;null!=r.batchSize&&(s=r.batchSize),o=[s].concat(r.inputShape)}e.batchInputShape=o;var u=r.dtype;null==u&&(u=r.inputDType),null==u&&(u="float32"),e.dtype=u}return null!=r.weights?e.initialWeights=r.weights:e.initialWeights=null,e._refCount=null,e.fastWeightInitDuringBuild=!1,e}return(0,v.Z)(n,[{key:"getNodeAtIndex",value:function(e,t){if(0===this.inboundNodes.length)throw new Ey("The layer has never been called and thus has no defined ".concat(t,"."));if(this.inboundNodes.length<=e)throw new Ay("Asked to get ".concat(t," at node ").concat(e,", but the layer has only ").concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[e]}},{key:"getInputAt",value:function(e){return Ly(this.getNodeAtIndex(e,"input").inputTensors)}},{key:"getOutputAt",value:function(e){return Ly(this.getNodeAtIndex(e,"output").outputTensors)}},{key:"input",get:function(){if(this.inboundNodes.length>1)throw new _y("Layer ".concat(this.name,' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.'));if(0===this.inboundNodes.length)throw new _y("Layer ".concat(this.name," is not connected, no input to return."));return Ly(this.getNodeAtIndex(0,"input").inputTensors)}},{key:"output",get:function(){if(0===this.inboundNodes.length)throw new _y("Layer ".concat(this.name," has no inbound nodes."));if(this.inboundNodes.length>1)throw new _y("Layer ".concat(this.name,' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.'));return Ly(this.getNodeAtIndex(0,"output").outputTensors)}},{key:"losses",get:function(){return this._losses}},{key:"calculateLosses",value:function(){return this.losses.map((function(e){return e()}))}},{key:"updates",get:function(){return this._updates}},{key:"built",get:function(){return this._built},set:function(e){this._built=e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this._trainableWeights.forEach((function(t){return t.trainable=e})),this.trainable_=e}},{key:"trainableWeights",get:function(){return this.trainable_?this._trainableWeights.filter((function(e){return e.trainable})):[]},set:function(e){this._trainableWeights=e}},{key:"nonTrainableWeights",get:function(){return this.trainable?this._trainableWeights.filter((function(e){return!e.trainable})).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(e){this._nonTrainableWeights=e}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"stateful",get:function(){return this._stateful}},{key:"resetStates",value:function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}},{key:"assertInputCompatibility",value:function(e){if(e=zy(e),null!=this.inputSpec&&0!==this.inputSpec.length){var t=zy(this.inputSpec);if(e.length!==t.length)throw new Ay("Layer ".concat(this.name," expects ").concat(t.length," inputs, but it received ").concat(e.length," input tensors. Input received: ").concat(e));for(var n=0;n<e.length;n++){var r=e[n],a=t[n];if(null!=a){var i=r.rank;if(null!=a.ndim&&i!==a.ndim)throw new Ay("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected ndim=").concat(a.ndim,", found ndim=").concat(i));if(null!=a.maxNDim&&i>a.maxNDim)throw new Ay("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected max_ndim=").concat(a.maxNDim,", found ndim=").concat(i));if(null!=a.minNDim&&i<a.minNDim)throw new Ay("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected min_ndim=").concat(a.minNDim,", found ndim=").concat(i,"."));if(null!=a.dtype&&r.dtype!==a.dtype)throw new Ay("Input ".concat(n," is incompatible with layer ").concat(this.name," : expected dtype=").concat(a.dtype,", found dtype=").concat(r.dtype,"."));if(a.axes){var o=r.shape;for(var s in a.axes){var u=Number(s),c=a.axes[s],l=u>=0?o[u]:o[o.length+u];if(null!=c&&-1===[c,null].indexOf(l))throw new Ay("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected axis ").concat(u," of input shape to have value ").concat(c," but got shape ").concat(o,"."))}}if(null!=a.shape)for(var p=0;p<a.shape.length;++p){var h=a.shape[p],d=r.shape[p];if(null!=h&&null!=d&&h!==d)throw new Ay("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected shape=").concat(a.shape,", found shape=").concat(r.shape,"."))}}}}}},{key:"call",value:function(e,t){return e}},{key:"invokeCallHook",value:function(e,t){null!=this._callHook&&this._callHook(e,t)}},{key:"setCallHook",value:function(e){this._callHook=e}},{key:"clearCallHook",value:function(){this._callHook=null}},{key:"apply",value:function(e,t){var n=this;t=t||{},this.assertNotDisposed();var r,a=zy(e),i=!0,o=(0,y.Z)(a);try{for(o.s();!(r=o.n()).done;){if(!(r.value instanceof xx)){i=!1;break}}}catch(l){o.e(l)}finally{o.f()}var s,u=!0,c=(0,y.Z)(a);try{for(c.s();!(s=c.n()).done;){if(s.value instanceof xx){u=!1;break}}}catch(l){c.e(l)}finally{c.f()}if(i===u)throw new Ay("Arguments to apply() must be all SymbolicTensors or all Tensors");return fb(this.name,(function(){if(!n.built){n.assertInputCompatibility(e);var r,i=[],o=(0,y.Z)(zy(e));try{for(o.s();!(r=o.n()).done;){var s=r.value;i.push(s.shape)}}catch(l){o.e(l)}finally{o.f()}n.build(Ly(i)),n.built=!0,n.initialWeights&&n.setWeights(n.initialWeights),null===n._refCount&&u&&(n._refCount=1)}if(n.assertInputCompatibility(e),u){var c,p=n.call(e,t),h=zy(p),d=[],f=(0,y.Z)(h);try{for(f.s();!(c=f.n()).done;){var m=c.value;-1!==a.indexOf(m)&&(m=m.clone()),d.push(m)}}catch(l){f.e(l)}finally{f.f()}if(p=Ly(d),null!=n.activityRegularizer)throw new Ry("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return p}var v,g=function(e){e=zy(e);var t,n=[],r=(0,y.Z)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push(a.shape)}}catch(l){r.e(l)}finally{r.f()}return Ly(n)}(e),b=n.computeOutputShape(g),x="float32";if(n.warnOnIncompatibleInputShape(Array.isArray(e)?g[0]:g),v=null!=b&&b.length>0&&Array.isArray(b[0])?b.map((function(r,a){return new xx(x,r,n,zy(e),t,n.name,a)})):new xx(x,b,n,zy(e),t,n.name),n.addInboundNode(e,v,null,null,g,b,t),n._refCount++,null!=n.activityRegularizer)throw new Ry("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return v}))}},{key:"warnOnIncompatibleInputShape",value:function(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: ".concat(JSON.stringify(e),") does not match that of the batchInputShape (").concat(JSON.stringify(this.batchInputShape),") of the layer ").concat(this.name));else{var t=!1;this.batchInputShape.forEach((function(n,r){null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)})),t&&console.warn("The shape of the input tensor (".concat(JSON.stringify(e),") does not match the expectation of layer ").concat(this.name,": ").concat(JSON.stringify(this.batchInputShape)))}}},{key:"outputShape",get:function(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new _y("The layer ".concat(this.name," has never been called and thus has no defined output shape."));var e,t=[],n=(0,y.Z)(this.inboundNodes);try{for(n.s();!(e=n.n()).done;){var r=e.value,a=JSON.stringify(r.outputShapes);-1===t.indexOf(a)&&t.push(a)}}catch(o){n.e(o)}finally{n.f()}if(1===t.length){var i=this.inboundNodes[0].outputShapes;return Array.isArray(i)&&Array.isArray(i[0])&&1===i.length?i[0]:i}throw new _y("The layer ".concat(this.name,' has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.'))}},{key:"countParams",value:function(){if(!this.built)throw new Ey("You tried to call countParams() on ".concat(this.name,", but the layer is not built yet. Build it first by calling build(batchInputShape)."));return fx(this.weights)}},{key:"build",value:function(e){this.built=!0}},{key:"getWeights",value:function(){return gx(arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.trainableWeights:this.weights)}},{key:"setWeights",value:function(e){var t=this;xs((function(){var n=t.weights;if(n.length!==e.length)throw new Ay('You called setWeights(weights) on layer "'.concat(t.name,'" with a weight list of length ').concat(e.length,", but the layer was expecting ").concat(n.length," weights. Provided weights: ").concat(e,"..."));if(0!==n.length){for(var r=[],a=gx(n),i=0;i<a.length;++i){var o=a[i],s=n[i],u=e[i];if(!Aa.arraysEqual(o.shape,u.shape))throw new Ay("Layer weight shape ".concat(o.shape," not compatible with provided weight shape ").concat(u.shape));r.push([s,u])}yx(r)}}))}},{key:"addWeight",value:function(e,t,n,r,a,i,o,s){if(-1!==this._addedWeightNames.indexOf(e))throw new Ay("Duplicate weight name ".concat(e," for layer ").concat(this.name));this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=null!=s?s():cx("zeros"));var u=r.apply(t,n),c=new vx(u,n,e,i,o);return u.dispose(),null!=a&&this.addLoss((function(){return a.apply(c.read())})),null==i&&(i=!0),i?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}},{key:"setFastWeightInitDuringBuild",value:function(e){this.fastWeightInitDuringBuild=e}},{key:"addLoss",value:function(e){var t;null==e||Array.isArray(e)&&0===e.length||(e=zy(e),void 0!==this._losses&&null!==this._losses&&(t=this.losses).push.apply(t,(0,g.Z)(e)))}},{key:"computeOutputShape",value:function(e){return e}},{key:"computeMask",value:function(e,t){var n=this;if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer ".concat(this.name," does not support masking, but was passed an inputMask."));t.forEach((function(e){if(null!=e)throw new TypeError("Layer ".concat(n.name," does not support masking, but was passed an inputMask."))}))}return null}return t}},{key:"addInboundNode",value:function(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=zy(e);t=zy(t),n=zy(n),r=zy(r),a=px(a),i=px(i);var u,c=[],l=[],p=[],h=(0,y.Z)(s);try{for(h.s();!(u=h.n()).done;){var d=u.value;c.push(d.sourceLayer),l.push(d.nodeIndex),p.push(d.tensorIndex)}}catch(m){h.e(m)}finally{h.f()}new wx({outboundLayer:this,inboundLayers:c,nodeIndices:l,tensorIndices:p,inputTensors:s,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:a,outputShapes:i},o);for(var f=0;f<t.length;f++)t[f].sourceLayer=this,t[f].nodeIndex=this.inboundNodes.length-1,t[f].tensorIndex=f}},{key:"getConfig",value:function(){var e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}},{key:"disposeWeights",value:function(){return this.weights.forEach((function(e){return e.dispose()})),this.weights.length}},{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Layer '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been built yet."));if(null===this._refCount)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used yet."));this.assertNotDisposed();var e=0;return 0===--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}],[{key:"nodeKey",value:function(e,t){return e.name+"_ib-"+t.toString()}}]),n}(Gd.Serializable);function Nx(e,t,n){if((null==t||null!=n&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),0===t.inboundNodes.length)return[e];var r=t.inboundNodes[n];if(0===r.inboundLayers.length)return r.inputTensors;for(var a=[],i=0;i<r.inboundLayers.length;i++){var o,s=Nx(r.inputTensors[i],r.inboundLayers[i],r.nodeIndices[i]),u=(0,y.Z)(s);try{for(u.s();!(o=u.n()).done;){var c=o.value;-1===a.indexOf(c)&&a.push(c)}}catch(l){u.e(l)}finally{u.f()}}return a}var Tx=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;if((0,m.Z)(this,n),r=t.call(this,{dtype:e.dtype,name:null!=e.name?e.name:nb("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),r.trainable=!1,r.built=!0,r.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new Ay("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var a=e.batchInputShape;if(null==a){if(null==e.inputShape)throw new Ay("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");a=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new Ay("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=e.dtype||"float32";r.batchInputShape=a,r.dtype=i,r.inputSpec=[{shape:a}];var o=new xx(r.dtype,r.batchInputShape,(0,s.Z)(r),[],{},r.name);return o.nodeIndex=0,o.tensorIndex=0,new wx({outboundLayer:(0,s.Z)(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[a],outputShapes:[a]}),(0,c.Z)(r)}return(0,v.Z)(n,[{key:"apply",value:function(e,t){throw new Ay("Cannot pass any input to an InputLayer's apply() method. InputLayer name: ".concat(this.name))}},{key:"dispose",value:function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}},{key:"getConfig",value:function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}]),n}(Sx);function Cx(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new Ay("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));var n=e.dtype;return null==n&&(n="float32"),new Tx({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}Tx.className="InputLayer",Gd.registerClass(Tx);var _x=function(){function e(t){if((0,m.Z)(this,e),this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof e)for(var n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(null==t)return;var r,a=(0,y.Z)(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;this.add(i.key,i.value)}}catch(o){a.e(o)}finally{a.f()}}}return(0,v.Z)(e,[{key:"add",value:function(e,t,n){if(null!=this.id2Value[e.id])throw new Ay("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return cs(t,e.dtype)}catch(n){throw new Ay("The dtype of the feed (".concat(t.dtype,") can not be cast to the dtype of the key '").concat(e.name,"' (").concat(e.dtype,")."))}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}},{key:"addFeed",value:function(e){this.add(e.key,e.value)}},{key:"hasKey",value:function(e){return null!=this.id2Value[e.id]}},{key:"names",value:function(){return Object.keys(this.name2Id)}},{key:"getValue",value:function(e){if(e instanceof xx){if(null==this.id2Value[e.id])throw new Ay("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}var t=this.name2Id[e];if(null==t)throw new Ay("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}},{key:"getMask",value:function(e){if(e instanceof xx){if(null==this.id2Value[e.id])throw new Ay("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}var t=this.name2Id[e];if(null==t)throw new Ay("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}},{key:"disposeMasks",value:function(){null!=this.id2Mask&&ks(this.id2Mask)}}]),e}(),Ex=new Zy,Ax=new Zy;function Rx(e,t,n,r){var a,i=null!=n&&n.training,o=Array.isArray(e),s=o?e:[e],u=s.map((function(e){return e.name})),c=[],l=t.names(),p=(0,y.Z)(u);try{for(p.s();!(a=p.n()).done;){var h=a.value;-1!==l.indexOf(h)?c.push(t.getValue(h)):c.push(null)}}catch(z){p.e(z)}finally{p.f()}null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);var d,f=u.join(",")+"|"+t.names().sort().join(","),m=Ex.get(f);if(null==m){var v=function(e,t){Aa.assert(null!=e&&e.length>0,(function(){return"Expected at least one fetch, got none"}));var n=[],r={};if(1===e.length){var a=Zx(e[0],t);n=a.sorted,r=a.recipientMap}else{var i,o=new Set,s=(0,y.Z)(e);try{for(s.s();!(i=s.n()).done;){var u,c=Zx(i.value,t),l=c.sorted,p=c.recipientMap,h=(0,y.Z)(l);try{for(h.s();!(u=h.n()).done;){var d=u.value;o.has(d.name)||(n.push(d),o.add(d.name))}}catch(z){h.e(z)}finally{h.f()}var f=function(e){null==r[e]&&(r[e]=new Set),p[e].forEach((function(t){return r[e].add(t)}))};for(var m in p)f(m)}}catch(z){s.e(z)}finally{s.f()}}return{sorted:n,recipientCounts:Fx(r)}}(s,t);m=v.sorted,d=v.recipientCounts,Ex.put(f,m),Ax.put(f,d)}d={},i||Object.assign(d,Ax.get(f));for(var g=new _x(t),b=0;b<m.length;++b){if(null!=r){var x=ys().numTensors;x>r.maxNumTensors&&(r.maxNumTensors=x),x<r.minNumTensors&&(r.minNumTensors=x)}var k=m[b],w=k.sourceLayer;if(!(w instanceof Tx)){var I,S=[],N=[],T=[],C=!1,_=(0,y.Z)(k.inputs);try{for(_.s();!(I=_.n()).done;){var E=I.value,A=g.getValue(E),R=g.getMask(E);S.push(A),N.push(R),null!=R&&(C=!0),i||(d[E.name]--,0===d[E.name]&&!t.hasKey(E)&&-1===u.indexOf(E.name)&&!A.isDisposed&&!0!==E.sourceLayer.stateful&&T.push(A))}}catch(z){_.e(z)}finally{_.f()}C&&((n=n||{}).mask=N[0]);var F=zy(w.apply(S,n)),Z=null;w.supportsMasking&&(Z=w.computeMask(S,N));for(var D=Dx(k),M=Array.isArray(D)?D:[D],O=0;O<M.length;++O){g.hasKey(M[O])||g.add(M[O],F[O],Array.isArray(Z)?Z[0]:Z);var L=u.indexOf(M[O].name);-1!==L&&(c[L]=F[O])}i||ks(T)}}return g.disposeMasks(),o?c:c[0]}function Fx(e){var t={};for(var n in e)t[n]=e[n].size;return t}function Zx(e,t){var n,r=new Set,a=[],i={},o=(0,y.Z)(t.names());try{for(o.s();!(n=o.n()).done;){var s=n.value;r.add(s)}}catch(m){o.e(m)}finally{o.f()}var u=[],c=[];for(u.push(e);u.length>0;){var l=u[u.length-1];if(r.has(l.name))u.pop();else{var p=c[c.length-1]===u.length-1;if(0===l.inputs.length||p)u.pop(),a.push(l),r.add(l.name),p&&c.pop();else{c.push(u.length-1);var h,d=(0,y.Z)(l.inputs);try{for(d.s();!(h=d.n()).done;){var f=h.value;null==i[f.name]&&(i[f.name]=new Set),i[f.name].add(l.name),!r.has(f.name)&&u.push(f)}}catch(m){d.e(m)}finally{d.f()}}}}return{sorted:a,recipientMap:i}}function Dx(e){var t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{for(var n=null,r=0;r<e.sourceLayer.inboundNodes.length;++r){var a,i=(0,y.Z)(e.sourceLayer.inboundNodes[r].outputTensors);try{for(i.s();!(a=i.n()).done;){if(a.value.id===e.id){n=r;break}}}catch(o){i.e(o)}finally{i.f()}}t=e.sourceLayer.getOutputAt(n)}return t}Qe().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",(function(){return 100}),(function(e){null!=Ex&&Ex.setMaxEntries(e),null!=Ax&&Ax.setMaxEntries(e)}));var Mx={};function Ox(e,t){return xs((function(){return wc(Sc(Os(e,e),t,!0))}))}A(Mx,{maxNorm:function(){return jx},minMaxNorm:function(){return Xx},nonNeg:function(){return Kx},unitNorm:function(){return qx}});var Lx=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"getConfig",value:function(){return{}}}]),n}(Gd.Serializable),zx=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this)).defaultMaxValue=2,r.defaultAxis=0,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return(0,v.Z)(n,[{key:"apply",value:function(e){var t=this;return xs((function(){var n=Ox(e,t.axis),r=Ru(n,0,t.maxValue);return Os(e,Ms(r,Zs(Nb(),n)))}))}},{key:"getConfig",value:function(){return{maxValue:this.maxValue,axis:this.axis}}}]),n}(Lx);zx.className="MaxNorm",Gd.registerClass(zx);var Px=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this)).defaultAxis=0,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return(0,v.Z)(n,[{key:"apply",value:function(e){var t=this;return xs((function(){return Ms(e,Zs(Nb(),Ox(e,t.axis)))}))}},{key:"getConfig",value:function(){return{axis:this.axis}}}]),n}(Lx);Px.className="UnitNorm",Gd.registerClass(Px);var Bx=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"apply",value:function(e){return yp(e)}}]),n}(Lx);Bx.className="NonNeg",Gd.registerClass(Bx);var Wx=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this)).defaultMinValue=0,r.defaultMaxValue=1,r.defaultRate=1,r.defaultAxis=0,r.minValue=null!=e.minValue?e.minValue:r.defaultMinValue,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.rate=null!=e.rate?e.rate:r.defaultRate,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return(0,v.Z)(n,[{key:"apply",value:function(e){var t=this;return xs((function(){var n=Ox(e,t.axis),r=Zs(Os(t.rate,Ru(n,t.minValue,t.maxValue)),Os(1-t.rate,n));return Os(e,Ms(r,Zs(Nb(),n)))}))}},{key:"getConfig",value:function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}]),n}(Lx);Wx.className="MinMaxNorm",Gd.registerClass(Wx);var Vx={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Ux(e){return Vy(e)}function Gx(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Gy(e,Gd.SerializationMap.getMap().classNameMap,t,"constraint")}function Hx(e){return null==e?null:"string"==typeof e?Gx({className:e in Vx?Vx[e]:e,config:{}}):e instanceof Lx?e:Gx(e)}function jx(e){return new zx(e)}function qx(e){return new Px(e)}function Kx(){return new Bx}function Xx(e){return new Wx(e)}var Yx={};function Jx(){return new Hb}function Qx(){return new jb}function $x(e){return new qb(e)}function ek(e){return new Kb(e)}function tk(e){return new Xb(e)}function nk(e){return new Yb(e)}function rk(e){return new Jb(e)}function ak(e){return new Qb(e)}function ik(e){return new $b(e)}function ok(e){return new ex(e)}function sk(e){return new tx(e)}function uk(e){return new nx(e)}function ck(e){return new rx(e)}function lk(e){return new ax(e)}function pk(e){return new ix(e)}A(Yx,{constant:function(){return $x},glorotNormal:function(){return ok},glorotUniform:function(){return ik},heNormal:function(){return sk},heUniform:function(){return uk},identity:function(){return rk},leCunNormal:function(){return ck},leCunUniform:function(){return lk},ones:function(){return Qx},orthogonal:function(){return pk},randomNormal:function(){return tk},randomUniform:function(){return ek},truncatedNormal:function(){return nk},varianceScaling:function(){return ak},zeros:function(){return Jx}});var hk,dk={};function fk(e){return mk.apply(this,arguments)}function mk(){return mk=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r,a,i,o,s,u,c;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}return e.abrupt("return");case 2:for(i in n=[],r=[],a=[],t)"number"!=typeof(o=t[i])&&(s=o,n.push(s.data()),r.push(i),a.push(s));if(!(n.length>0)){e.next=10;break}return e.next=7,Promise.all(n);case 7:for(u=e.sent,c=0;c<u.length;++c)t[r[c]]=u[c][0];ks(a);case 10:case"end":return e.stop()}}),e)}))),mk.apply(this,arguments)}function vk(e){if(null!=e)for(var t in e){var n=e[t];"number"!=typeof n&&n.dispose()}}A(dk,{Layer:function(){return Sx},RNN:function(){return WI},RNNCell:function(){return VI},activation:function(){return gN},add:function(){return TN},alphaDropout:function(){return vT},average:function(){return CN},averagePooling1d:function(){return ON},averagePooling2d:function(){return PN},averagePooling3d:function(){return VN},avgPool1d:function(){return LN},avgPool2d:function(){return BN},avgPool3d:function(){return UN},avgPooling1d:function(){return zN},avgPooling2d:function(){return WN},avgPooling3d:function(){return GN},batchNormalization:function(){return ZN},bidirectional:function(){return uT},categoryEncoding:function(){return kT},centerCrop:function(){return bT},concatenate:function(){return _N},conv1d:function(){return uN},conv2d:function(){return cN},conv2dTranspose:function(){return lN},conv3d:function(){return pN},conv3dTranspose:function(){return hN},convLstm2d:function(){return aT},convLstm2dCell:function(){return iT},cropping2D:function(){return fN},dense:function(){return yN},depthwiseConv2d:function(){return vN},dot:function(){return FN},dropout:function(){return bN},elu:function(){return nN},embedding:function(){return NN},flatten:function(){return kN},gaussianDropout:function(){return mT},gaussianNoise:function(){return fT},globalAveragePooling1d:function(){return HN},globalAveragePooling2d:function(){return jN},globalMaxPool1d:function(){return lT},globalMaxPool2d:function(){return pT},globalMaxPooling1d:function(){return qN},globalMaxPooling2d:function(){return KN},gru:function(){return QN},gruCell:function(){return $N},input:function(){return Vw},inputLayer:function(){return tN},layerNormalization:function(){return DN},leakyReLU:function(){return aN},lstm:function(){return eT},lstmCell:function(){return tT},masking:function(){return gT},maxPool1d:function(){return hT},maxPool2d:function(){return dT},maxPooling1d:function(){return XN},maxPooling2d:function(){return YN},maxPooling3d:function(){return JN},maximum:function(){return EN},minimum:function(){return AN},multiply:function(){return RN},permute:function(){return SN},prelu:function(){return iN},reLU:function(){return rN},repeatVector:function(){return wN},rescaling:function(){return yT},reshape:function(){return IN},resizing:function(){return xT},rnn:function(){return oT},separableConv2d:function(){return dN},simpleRNN:function(){return nT},simpleRNNCell:function(){return rT},softmax:function(){return oN},spatialDropout1d:function(){return xN},stackedRNNCells:function(){return sT},thresholdedReLU:function(){return sN},timeDistributed:function(){return cT},upSampling2d:function(){return mN},zeroPadding2d:function(){return MN}}),function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(hk||(hk={}));var gk=125,yk=function(){function e(){(0,m.Z)(this,e),this.validationData=null}return(0,v.Z)(e,[{key:"setParams",value:function(e){this.params=e}},{key:"onEpochBegin",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"setModel",value:function(e){}}]),e}(),bk=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;(0,m.Z)(this,e),null==t&&(t=[]),this.callbacks=t,this.queueLength=n}return(0,v.Z)(e,[{key:"append",value:function(e){this.callbacks.push(e)}},{key:"setParams",value:function(e){var t,n=(0,y.Z)(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setParams(e)}}catch(r){n.e(r)}finally{n.f()}}},{key:"setModel",value:function(e){var t,n=(0,y.Z)(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setModel(e)}}catch(r){n.e(r)}finally{n.f()}}},{key:"onEpochBegin",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=(0,y.Z)(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=(0,y.Z)(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=(0,y.Z)(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=(0,y.Z)(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r,a;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=(0,y.Z)(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainBegin(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r,a;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=(0,y.Z)(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainEnd(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),xk=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.call(this)}return(0,v.Z)(n,[{key:"onEpochBegin",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.seen=0,this.totals={};case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i,o=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=null==n.size?0:n.size,this.seen+=r,a=(0,d.Z)().mark((function e(t){var a,i,s;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"number"==typeof(a=n[t])?(o.totals.hasOwnProperty(t)||(o.totals[t]=0),o.totals[t]=o.totals[t]+a*r):(t in o.totals?i=o.totals[t]:o.totals[t]=0,s=xs((function(){return Zs(o.totals[t],Os(a,r))})),o.totals[t]=s,null!=i&&i.dispose());case 2:case"end":return e.stop()}}),e)})),e.t0=(0,d.Z)().keys(n);case 5:if((e.t1=e.t0()).done){e.next=10;break}return i=e.t1.value,e.delegateYield(a(i),"t2",8);case 8:e.next=5;break;case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i,o=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n){e.next=17;break}r=(0,y.Z)(this.params.metrics),e.prev=2,i=(0,d.Z)().mark((function e(){var t;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=a.value,null!=o.totals[t]&&("number"==typeof o.totals[t]?n[t]=o.totals[t]/o.seen:xs((function(){var e=Os(Ms(1,o.seen),o.totals[t]);n[t]=e,o.totals[t].dispose(),ws(n[t])})));case 2:case"end":return e.stop()}}),e)})),r.s();case 5:if((a=r.n()).done){e.next=9;break}return e.delegateYield(i(),"t0",7);case 7:e.next=5;break;case 9:e.next=14;break;case 11:e.prev=11,e.t1=e.catch(2),r.e(e.t1);case 14:return e.prev=14,r.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[2,11,14,17]])})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(yk),kk=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"onTrainBegin",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.epoch=[],this.history={};case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r in null==n&&(n={}),this.epoch.push(t),n)null==this.history[r]&&(this.history[r]=[]),this.history[r].push(n[r]);case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"syncData",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n,r,a,i,o,s,u,c;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a in t=[],n=[],r=[],this.history)for(i=this.history[a],o=0;o<i.length;++o)"number"!=typeof i[o]&&(s=i[o],t.push(s.data()),n.push(a),r.push(o));return e.next=4,Promise.all(t);case 4:for(u=e.sent,c=0;c<u.length;++c)this.history[n[c]][r[c]].dispose(),this.history[n[c]][r[c]]=u[c][0];case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(yk),wk=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var a;if((0,m.Z)(this,n),(a=t.call(this)).currentEpoch=0,a.nowFunc=e.nowFunc,a.nextFrameFunc=e.nextFrameFunc||fm,a.yieldEvery=r||"auto","auto"===a.yieldEvery&&(a.yieldEvery=gk),"never"===a.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return Aa.isNumber(a.yieldEvery)&&(a.maybeWait=function(e,t,n){var r,a=null!=n?n():Aa.now();return function(){var i=null!=n?n():Aa.now();return i-a<t||(a=i,r=e.apply(void 0,arguments)),r}}(a.maybeWait.bind((0,s.Z)(a)),a.yieldEvery,a.nowFunc)),a.trainBegin=e.onTrainBegin,a.trainEnd=e.onTrainEnd,a.epochBegin=e.onEpochBegin,a.epochEnd=e.onEpochEnd,a.batchBegin=e.onBatchBegin,a.batchEnd=e.onBatchEnd,a.yield=e.onYield,(0,c.Z)(a)}return(0,v.Z)(n,[{key:"maybeWait",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n,r){var a;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],e.t0=null!=this.yield,!e.t0){e.next=6;break}return e.next=5,fk(r);case 5:a.push(this.yield(t,n,r));case 6:return a.push(this.nextFrameFunc()),e.next=9,Promise.all(a);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"onEpochBegin",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentEpoch=t,e.t0=null!=this.epochBegin,!e.t0){e.next=7;break}return e.next=5,fk(n);case 5:return e.next=7,this.epochBegin(t,n);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],e.t0=null!=this.epochEnd,!e.t0){e.next=6;break}return e.next=5,fk(n);case 5:r.push(this.epochEnd(t,n));case 6:return"epoch"===this.yieldEvery&&r.push(this.nextFrameFunc()),e.next=9,Promise.all(r);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=this.batchBegin,!e.t0){e.next=6;break}return e.next=4,fk(n);case 4:return e.next=6,this.batchBegin(t,n);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],e.t0=null!=this.batchEnd,!e.t0){e.next=6;break}return e.next=5,fk(n);case 5:r.push(this.batchEnd(t,n));case 6:return"batch"===this.yieldEvery?r.push(this.nextFrameFunc()):Aa.isNumber(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,t,n)),e.next=9,Promise.all(r);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=this.trainBegin,!e.t0){e.next=6;break}return e.next=4,fk(t);case 4:return e.next=6,this.trainBegin(t);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=this.trainEnd,!e.t0){e.next=6;break}return e.next=4,fk(t);case 4:return e.next=6,this.trainEnd(t);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(yk);function Ik(e,t){return null==e&&(e={}),e instanceof yk?[e]:Array.isArray(e)&&e[0]instanceof yk?e:zy(e).map((function(e){return new wk(e,t)}))}var Sk=function(){function e(){(0,m.Z)(this,e)}return(0,v.Z)(e,null,[{key:"registerCallbackConstructor",value:function(t,n){Aa.assert(t>=0&&Number.isInteger(t),(function(){return"Verbosity level is expected to be an integer >= 0, but got ".concat(t)})),e.checkForDuplicate(n),null==e.constructors[t]&&(e.constructors[t]=[]),e.constructors[t].push(n)}},{key:"checkForDuplicate",value:function(t){for(var n in e.constructors)e.constructors[+n].forEach((function(e){if(e===t)throw new Ay("Duplicate callback constructor.")}))}},{key:"clear",value:function(){e.constructors={}}},{key:"createCallbacks",value:function(t){var n=[];for(var r in e.constructors){var a=+r;t>=a&&n.push.apply(n,(0,g.Z)(e.constructors[a]))}return n.map((function(e){return new e}))}}]),e}();function Nk(e,t,n,r,a,i,o,s,u){var c=new kk,l=[new xk].concat((0,g.Z)(Sk.createCallbacks(t)));null!=e&&l.push.apply(l,(0,g.Z)(e)),l.push(c);var p=new bk(l);return p.setParams({epochs:n,initialEpoch:r,samples:a,steps:i,batchSize:o,verbose:t,doValidation:s,metrics:u}),{callbackList:p,history:c}}function Tk(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Gy(e,Gd.SerializationMap.getMap().classNameMap,t,"layer",n)}function Ck(e,t){return xs((function(){"float32"!==e.dtype&&(e=cs(e,"float32"));var n=Sc(Lb(e),t,!0),r=Au(n.shape,Nb()),a=wc(gl(n,r));return Ms(e,a)}))}function _k(e,t){return xs((function(){return yl(Lb(al(t,e)),-1)}))}function Ek(e,t){return xs((function(){return yl(Ls(al(t,e)),-1)}))}function Ak(e,t){return xs((function(){var n=al(e,t),r=Ru(Ls(e),Nb(),Number.MAX_VALUE),a=Ls(Ms(n,r));return Os(100,yl(a,-1))}))}function Rk(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return xs((function(){if(n)t=zp(t);else{var r=Sc(t,t.shape.length-1,!0);t=Ms(t,r)}return t=Ru(t,Nb(),1-Nb()),tl(Sc(Os(cs(e,"float32"),jc(t)),t.shape.length-1))}))}function Fk(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return xs((function(){var r=cs(Zc(function(e){var t=[kb(e.shape)];return pu(e,t)}(e)),"int32"),a=(t=Ru(t,Nb(),1-Nb())).shape;return Rk(pu(El(r,a[a.length-1]),a),t,n)}))}function Zk(e,t){return xs((function(){var n;return n=Ru(t,Nb(),1-Nb()),n=jc(Ms(n,al(1,n))),yl(function(e,t){if(!Aa.arraysEqual(e.shape,t.shape))throw new Ay("logits and labels must have the same shape, but got shapes ".concat(JSON.stringify(e.shape)," and ").concat(JSON.stringify(t.shape)));return xs((function(){var n=yp(t),r=tl(Ls(t));return Zs(al(n,Os(t,e)),qc(_c(r)))}))}(e,n),-1)}))}function Dk(e,t){return xs((function(){var n=Ck(e,-1),r=Ck(t,-1),a=Os(n,r);return tl(Sc(a,-1))}))}Sk.constructors={};var Mk={meanSquaredError:_k,meanAbsoluteError:Ek,meanAbsolutePercentageError:Ak,meanSquaredLogarithmicError:function(e,t){return xs((function(){var n=Ru(t,Nb(),Number.MAX_VALUE),r=jc(Zs(1,n)),a=Ru(e,Nb(),Number.MAX_VALUE),i=jc(Zs(1,a));return yl(Lb(al(r,i)),-1)}))},squaredHinge:function(e,t){return xs((function(){var n=gl(0,al(1,Os(e,t)));return yl(Lb(n),-1)}))},hinge:function(e,t){return xs((function(){var n=gl(0,al(1,Os(e,t)));return yl(n,-1)}))},categoricalHinge:function(e,t){return xs((function(){var n=Sc(Os(e,t),-1),r=yc(Os(al(1,e),t),-1);return gl(0,Zs(1,al(r,n)))}))},logcosh:function(e,t){return xs((function(){var n=Math.log(2),r=al(t,e),a=al(Zs(r,nl(Os(-2,r))),n);return yl(a,-1)}))},categoricalCrossentropy:Rk,sparseCategoricalCrossentropy:Fk,binaryCrossentropy:Zk,kullbackLeiblerDivergence:function(e,t){return xs((function(){var n=Ru(e,Nb(),1),r=Ru(t,Nb(),1);return Sc(Os(e,jc(Ms(n,r))),-1)}))},poisson:function(e,t){return xs((function(){var n=jc(Zs(Nb(),t));return yl(al(t,Os(e,n)),-1)}))},cosineProximity:Dk};function Ok(e){if("string"==typeof e){if(e in Mk)return Mk[e];var t="Unknown loss ".concat(e);throw e.toLowerCase().includes("softmaxcrossentropy")&&(t="Unknown loss ".concat(e,'. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy')),new Ay(t)}return e}function Lk(e,t){return xs((function(){var n=Os(.5,Al(t)),r=Tb(Mc(t,n),e.dtype);return yl(nc(e,r),-1)}))}function zk(e,t){return xs((function(){return Tb(nc(Us(e,-1),Us(t,-1)),"float32")}))}function Pk(e,t){return xs((function(){return cs(Sc(sl(nc(e,1),nc(t,1))),"float32")}))}function Bk(e,t){return xs((function(){var n=Pk(e,t),r=function(e,t){return xs((function(){return cs(Sc(sl(nc(e,0),nc(t,1))),"float32")}))}(e,t),a=Zs(n,r);return cs(rc(Mc(a,0),Ms(n,a),0),"float32")}))}function Wk(e,t){return xs((function(){var n=Pk(e,t),r=function(e,t){return xs((function(){return cs(Sc(sl(nc(e,1),nc(t,0))),"float32")}))}(e,t),a=Zs(n,r);return cs(rc(Mc(a,0),Ms(n,a),0),"float32")}))}function Vk(e,t){return Zk(e,t)}function Uk(e,t){return e.rank===t.rank&&(e=Hp(e,[e.rank-1])),(t=Us(t,-1)).dtype!==e.dtype&&(t=cs(t,e.dtype)),cs(nc(e,t),"float32")}var Gk=Rk,Hk=Fk,jk={binaryAccuracy:Lk,categoricalAccuracy:zk,precision:Bk,categoricalCrossentropy:Gk,sparseCategoricalCrossentropy:Hk,mse:_k,MSE:_k,mae:Ek,MAE:Ek,mape:Ak,MAPE:Ak,cosine:Dk};function qk(e){if(My(null!==e,"Unknown LossOrMetricFn ".concat(e)),"string"==typeof e)return e;for(var t,n=0,r=Object.keys(Mk);n<r.length;n++){var a=r[n];if(Mk[a]===e){t=a;break}}if(void 0!==t)return t;for(var i=0,o=Object.keys(jk);i<o.length;i++){var s=o[i];if(jk[s]===e){t=s;break}}return void 0!==t?t:e.name}function Kk(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e||"object"!=typeof e||Object.getPrototypeOf(e)!==Object.prototype||!Xk(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){var r=JSON.stringify(e);r.length>1048576&&console.warn('User-defined metadata of model "'.concat(t,'" is too large in size (length=').concat(r.length," when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ",1048576,"."))}}function Xk(e){if(null===e)return!0;if("object"==typeof e){if(Object.getPrototypeOf(e)===Object.prototype){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t];if("string"!=typeof r||!Xk(e[r]))return!1}return!0}if(Array.isArray(e)){var a,i=(0,y.Z)(e);try{for(i.s();!(a=i.n()).done;){if(!Xk(a.value))return!1}}catch(s){i.e(s)}finally{i.f()}return!0}return!1}var o=typeof e;return"string"===o||"number"===o||"boolean"===o}function Yk(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:console.log,i=function(e){var t=!0,n=[],r=[];for(var a in e.nodesByDepth)n.push(e.nodesByDepth[a]);for(var i=0,o=n;i<o.length;i++){var s=o[i];if(s.length>1||1===s.length&&s[0].inboundLayers.length>1){t=!1;break}r.push.apply(r,(0,g.Z)(s))}if(t){var u,c=(0,y.Z)(e.layers);try{for(c.s();!(u=c.n()).done;){var l,p=u.value,h=!1,d=(0,y.Z)(p.inboundNodes);try{for(d.s();!(l=d.n()).done;){var f=l.value;if(-1!==r.indexOf(f)){if(h){t=!1;break}h=!0}}}catch(m){d.e(m)}finally{d.f()}if(!t)break}}catch(m){c.e(m)}finally{c.f()}}return t}(e),o=["Layer (type)","Input Shape","Output shape","Param #"];if(i?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map((function(e){return Math.floor(t*e)}))),!i)for(var s in o.push("Receives inputs"),r=[],e.nodesByDepth){var u;(u=r).push.apply(u,(0,g.Z)(e.nodesByDepth[s]))}a("_".repeat(t)),Jk(o,n,a),a("=".repeat(t));for(var c=e.layers,l=0;l<c.length;++l)i?Qk(c[l],n,a):$k(c[l],n,r,a),a((l===c.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();var p=function(e){var t;return t=null!=e.collectedTrainableWeights?fx(e.collectedTrainableWeights):fx(e.trainableWeights),t}(e),h=fx(e.nonTrainableWeights);a("Total params: ".concat(p+h)),a("Trainable params: ".concat(p)),a("Non-trainable params: ".concat(h)),a("_".repeat(t))}function Jk(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log,r="",a=0;a<e.length;++a)a>0&&(r=r.slice(0,r.length-1)+" "),r=(r+=e[a]).slice(0,t[a]),r+=" ".repeat(t[a]-r.length);n(r)}function Qk(e,t,n){var r,a;try{a=e.inboundNodes.map((function(e){return JSON.stringify(e.inputShapes)})).join(",")}catch(s){a="multiple"}try{r=JSON.stringify(e.outputShape)}catch(s){r="multiple"}var i=e.name,o=e.getClassName();Jk(["".concat(i," (").concat(o,")"),a,r,e.countParams().toString()],t,n)}function $k(e,t,n,r){var a,i;try{i=e.inboundNodes.map((function(e){return JSON.stringify(e.inputShapes)})).join(",")}catch(g){i="multiple"}try{a=JSON.stringify(e.outputShape)}catch(g){a="multiple"}var o,s=[],u=(0,y.Z)(e.inboundNodes);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(!(null!=n&&n.length>0&&-1===n.indexOf(c)))for(var l=0;l<c.inboundLayers.length;++l){var p=c.inboundLayers[l].name,h=c.nodeIndices[l],d=c.tensorIndices[l];s.push("".concat(p,"[").concat(h,"][").concat(d,"]"))}}}catch(b){u.e(b)}finally{u.f()}var f=e.name,m=e.getClassName(),v=0===s.length?"":s[0];Jk(["".concat(f," (").concat(m,")"),i,a,e.countParams().toString(),v],t,r);for(var g=1;g<s.length;++g)Jk(["","","","",s[g]],t,r)}function ew(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"==typeof n}function tw(e,t){if(null===e)return null;if("string"==typeof e)return By(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];ew(t,a,i)?n.push(i):n.push(tw(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c];if("name"===c&&"string"==typeof l)o[c]=l;else{var p=By(c);o[p]=tw(l,p)}}return o}function nw(e,t){if(null==e)return null;if("string"==typeof e)return Py(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];ew(t,a,i)?n.push(i):n.push(nw(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c],p=Py(c);o[p]="name"!==c&&"className"!==c||"string"!=typeof l?nw(l,c):l}return o}var rw="4.2.0",aw=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;if((0,m.Z)(this,n),(r=t.call(this,{})).containerNodes=new Set,r.name=e.name,null==r.name){var a=r.getClassName().toLowerCase();r.name=nb(a)}if(r.supportsMasking=!1,r.trainable_=!0,Array.isArray(e.inputs)?r.inputs=e.inputs.slice():r.inputs=[e.inputs],Array.isArray(e.outputs)?r.outputs=e.outputs.slice():r.outputs=[e.outputs],jy(r.inputs).length!==r.inputs.length)throw new Ay("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ".concat(r.inputs.map((function(e){return e.name}))));jy(r.outputs).length!==r.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ".concat(r.outputs.map((function(e){return e.name})))),r.inputLayers=[],r.inputLayersNodeIndices=[],r.inputLayersTensorIndices=[],r.outputLayers=[],r.outputLayersNodeIndices=[],r.outputLayersTensorIndices=[],r.layers=[],r.internalContainerRefs=[];var i,o=(0,y.Z)(r.outputs);try{for(o.s();!(i=o.n()).done;){var u=i.value,l=u.sourceLayer,p=u.nodeIndex,h=u.tensorIndex;r.outputLayers.push(l),r.outputLayersNodeIndices.push(p),r.outputLayersTensorIndices.push(h)}}catch(Te){o.e(Te)}finally{o.f()}var d,f=(0,y.Z)(r.inputs);try{for(f.s();!(d=f.n()).done;){var v=d.value,g=v.sourceLayer,b=v.nodeIndex,x=v.tensorIndex;My(0===b,"input layer has >1 nodes"),My(0===x,"input layer has >1 tensors"),r.inputLayers.push(g),r.inputLayersNodeIndices.push(b),r.inputLayersTensorIndices.push(x)}}catch(Te){f.e(Te)}finally{f.f()}r.inputNames=[],r.outputNames=[],r.feedInputShapes=[],r.feedInputNames=[],r.feedOutputNames=[];for(var k=0;k<r.inputLayers.length;k++){var w=r.inputLayers[k];if(!(w instanceof Tx))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. Received inputs: ".concat(e.inputs,". Input ").concat(k," (0-based) originates from layer type ").concat(w.getClassName(),"."));r.inputNames.push(w.name),r.feedInputShapes.push(w.batchInputShape),r.feedInputNames.push(w.name)}var I,S=(0,y.Z)(r.outputLayers);try{for(S.s();!(I=S.n()).done;){var N=I.value;r.outputNames.push(N.name)}}catch(Te){S.e(Te)}finally{S.f()}r.internalInputShapes=r.inputs.map((function(e){return e.shape})),r.internalOutputShapes=r.outputs.map((function(e){return e.shape}));var T,C={},_={},E={},A={},R={},F=[],Z=function e(t,a,i,o,s,u){(null==o||null==s||null==u)&&(o=t.sourceLayer,s=t.nodeIndex,u=t.tensorIndex);var c=o.inboundNodes[s];if(-1!==i.indexOf(c))throw new Ey("The tensor ".concat(t.name,' at layer "').concat(o.name,'" is part of a cycle.'));if(-1===a.indexOf(c)){r.containerNodes.add(n.nodeKey(o,s)),o.id in R||(R[o.id]=Object.keys(R).length),-1===i.indexOf(c)&&i.push(c);for(var l=c.inboundLayers.length,p=0;p<l;p++){e(c.inputTensors[p],a,i,c.inboundLayers[p],c.nodeIndices[p],c.tensorIndices[p])}for(a.push(c);i.indexOf(c)>=0;)i.splice(i.indexOf(c),1);F.push(c)}},D=[],M=[],O=(0,y.Z)(r.outputs);try{for(O.s();!(T=O.n()).done;){Z(T.value,D,M)}}catch(Te){O.e(Te)}finally{O.f()}var L,z=F.slice().reverse(),P=(0,y.Z)(z);try{for(P.s();!(L=P.n()).done;){var B=L.value;_[B.id]=B,B.id in C||(C[B.id]=0);var W=C[B.id],V=null==E[B.outboundLayer.id]?0:E[B.outboundLayer.id];W=Math.max(W,V),E[B.outboundLayer.id]=W,A[B.outboundLayer.id]=B.outboundLayer,C[B.id]=W;for(var U=0;U<B.inboundLayers.length;U++){var G=B.inboundLayers[U],H=B.nodeIndices[U],j=G.inboundNodes[H],q=null==C[j.id]?0:C[j.id];C[j.id]=Math.max(W+1,q),_[j.id]=j}}}catch(Te){P.e(Te)}finally{P.f()}var K={};for(var X in C){var Y=C[X];Y in K||(K[Y]=[]),K[Y].push(_[X])}var J={};for(var Q in E){var $=E[Q];$ in J||(J[$]=[]),J[$].push(A[Q])}var ee=Object.keys(J).map((function(e){return parseInt(e,10)})).sort(Hy);r.layers=[];var te,ne=(0,y.Z)(ee);try{for(ne.s();!(te=ne.n()).done;){var re=J[te.value];re.sort((function(e,t){var n=R[e.id],r=R[t.id];return n<r?-1:n>r?1:0}));var ae,ie=(0,y.Z)(re);try{for(ie.s();!(ae=ie.n()).done;){var oe=ae.value;oe instanceof n&&r.internalContainerRefs.push(oe),r.layers.push(oe)}}catch(Te){ie.e(Te)}finally{ie.f()}}}catch(Te){ne.e(Te)}finally{ne.f()}r.layersByDepth=J,ee=Object.keys(K).map((function(e){return parseInt(e,10)})).sort(Hy);var se,ue=r.inputs.slice(),ce=[],le=(0,y.Z)(ee);try{for(le.s();!(se=le.n()).done;){var pe,he=se.value,de=(0,y.Z)(K[he]);try{for(de.s();!(pe=de.n()).done;){var fe=pe.value,me=fe.outboundLayer;if(null!=me){var ve,ge=(0,y.Z)(fe.inputTensors);try{for(ge.s();!(ve=ge.n()).done;){var ye=ve.value;if(-1===ue.indexOf(ye))throw new Ey("Graph disconnected: cannot obtain value for tensor ".concat(ye,' at layer "').concat(me.name,'". The following previous layers were accessed without issue: ').concat(ce))}}catch(Te){ge.e(Te)}finally{ge.f()}var be,xe=(0,y.Z)(fe.outputTensors);try{for(xe.s();!(be=xe.n()).done;){var ke=be.value;ue.push(ke)}}catch(Te){xe.e(Te)}finally{xe.f()}ce.push(me.name)}}}catch(Te){de.e(Te)}finally{de.f()}}}catch(Te){le.e(Te)}finally{le.f()}r.nodesByDepth=K;var we,Ie=r.layers.map((function(e){return e.name})),Se=(0,y.Z)(Ie);try{var Ne=function(){var e=we.value,t=Ie.filter((function(t){return t===e})).length;if(1!==t)throw new Ey('The name "'.concat(e,'" is used ').concat(t," times in the model. All layer names should be unique. Layer names: ")+JSON.stringify(Ie))};for(Se.s();!(we=Se.n()).done;)Ne()}catch(Te){Se.e(Te)}finally{Se.f()}return r.outboundNodes=[],r.inboundNodes=[],new wx({outboundLayer:(0,s.Z)(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:r.inputs,outputTensors:r.outputs,inputMasks:r.inputs.map((function(e){return null})),outputMasks:r.outputs.map((function(e){return null})),inputShapes:r.inputs.map((function(e){return e.shape})),outputShapes:r.outputs.map((function(e){return e.shape}))}),r.built=!0,r._refCount=1,(0,c.Z)(r)}return(0,v.Z)(n,[{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Container '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){this.assertNotDisposed();var e={refCountAfterDispose:null,numDisposedVariables:0};if(0===--this._refCount){var t,n=(0,y.Z)(this.layers);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.numDisposedVariables+=r.dispose().numDisposedVariables}}catch(s){n.e(s)}finally{n.f()}var a,i=(0,y.Z)(this.internalContainerRefs);try{for(i.s();!(a=i.n()).done;){var o=a.value;e.numDisposedVariables+=o.dispose().numDisposedVariables}}catch(s){i.e(s)}finally{i.f()}}return e.refCountAfterDispose=this._refCount,e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.layers.forEach((function(t){t._trainableWeights.forEach((function(t){return t.trainable=e}))})),this.trainable_=e}},{key:"trainableWeights",get:function(){if(this._trainableWeights.length>0)throw new Ay("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];var e,t=[],n=(0,y.Z)(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t=t.concat(r.trainableWeights)}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=(0,y.Z)(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,(0,g.Z)(r.nonTrainableWeights))}}catch(u){n.e(u)}finally{n.f()}if(!this.trainable){var a,i=[],o=(0,y.Z)(this.layers);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,(0,g.Z)(s.trainableWeights))}}catch(u){o.e(u)}finally{o.f()}return i.concat(t)}return t}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"loadWeights",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r={},a=0,i=(0,y.Z)(this.layers);try{for(i.s();!(t=i.n()).done;){var o,s=t.value,u=(0,y.Z)(s.weights);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(null!=r[c.originalName])throw new Ay("Duplicate weight name: ".concat(c.originalName));r[c.originalName]=c,a++}}catch(v){u.e(v)}finally{u.f()}}}catch(v){i.e(v)}finally{i.f()}var l=[];for(var p in e){var h=p;if(null==r[p]){var d=p.split("/");h=d.slice(0,-2).concat([d[d.length-1]]).join("/")}if(null!=r[h])l.push([r[h],e[p]]);else if(n)throw new Ay("Provided weight data has no target variable: ".concat(p));delete r[h]}if(n){var f=[];for(var m in r)f.push(m);if(f.length>0)throw new Ay("".concat(f.length," of ").concat(a," weights are not set: ").concat(f))}yx(l)}},{key:"updatedConfig",value:function(){var e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers ".concat(rw),t.backend="TensorFlow.js",t}},{key:"toJSON",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=nw(this.updatedConfig());return t?JSON.stringify(n):n}},{key:"call",value:function(e,t){var n=this;return xs((function(){e=zy(e);for(var r=new _x,a=0;a<n.inputs.length;++a)r.add(n.inputs[a],e[a]);return Rx(n.outputs,r,t)}))}},{key:"computeMask",value:function(e,t){var n=this;return xs((function(){var r;return e=zy(e),r=null==t?Dy(null,e.length):zy(t),n.runInternalGraph(e,r)[1]}))}},{key:"computeOutputShape",value:function(e){var t=px(e);if(t.length!==this.inputLayers.length)throw new Ay("Invalid inputShape argument ".concat(e,": model has ").concat(this.inputLayers.length," tensor inputs."));for(var n={},r=0;r<t.length;r++){var a=this.inputLayers[r],i=t[r];n[a.name+"_0_0"]=i}var o=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(Hy);if(o.length>1){var s,u=(0,y.Z)(o);try{for(u.s();!(s=u.n()).done;){var c,l=s.value,p=this.nodesByDepth[l],h=(0,y.Z)(p);try{for(h.s();!(c=h.n()).done;){var d=c.value,f=d.outboundLayer;if(-1===this.inputLayers.map((function(e){return e.id})).indexOf(f.id)){for(var m=[],v=0;v<d.inboundLayers.length;v++){var g=d.inboundLayers[v],b=d.nodeIndices[v],x=d.tensorIndices[v],k=n["".concat(g.name,"_").concat(b,"_").concat(x)];m.push(k)}for(var w=px(f.computeOutputShape(Ly(m))),I=f.inboundNodes.indexOf(d),S=0;S<w.length;S++){n["".concat(f.name,"_").concat(I,"_").concat(S)]=w[S]}}}}catch(D){h.e(D)}finally{h.f()}}}catch(D){u.e(D)}finally{u.f()}}for(var N=[],T=[],C=0;C<this.outputLayers.length;C++){var _=this.outputLayers[C],E=this.outputLayersNodeIndices[C],A=this.outputLayersTensorIndices[C],R="".concat(_.name,"_").concat(E,"_").concat(A);T.push(R)}for(var F=0;F<T.length;F++){var Z=T[F];My(Z in n),N.push(n[Z])}return Ly(N)}},{key:"runInternalGraph",value:function(e,t){null==t&&(t=Dy(null,e.length));for(var n={},r=0;r<this.inputs.length;++r){var a=this.inputs[r],i=e[r],o=t[r];n[a.id]=[i,o]}var s,u=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(Hy),c=(0,y.Z)(u);try{for(c.s();!(s=c.n()).done;){var l,p=s.value,d=this.nodesByDepth[p],f=(0,y.Z)(d);try{for(f.s();!(l=f.n()).done;){var m,v=l.value,g=v.outboundLayer,b=v.inputTensors,x=v.outputTensors,k=new Array,w=(0,y.Z)(b);try{for(w.s();!(m=w.n()).done;){var I=m.value;I.id in n&&k.push(n[I.id])}}catch(H){w.e(H)}finally{w.f()}if(k.length===b.length){var S={},N=void 0,T=void 0,C=void 0,_=void 0;if(null!=v.callArgs&&(S=v.callArgs),1===k.length){var E=(0,h.Z)(k[0],2),A=E[0],R=E[1];null==S.mask&&(S.mask=R),C=zy(g.call(A,S)),_=zy(g.computeMask(A,R)),N=[A],T=[R]}else N=k.map((function(e){return e[0]})),T=k.map((function(e){return e[1]})),null==S.mask&&(S.mask=T),C=zy(g.call(N,S)),_=zy(g.computeMask(N,T));if(g.activityRegularizer)throw new Ry("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(var F=0;F<x.length;++F){var Z=x[F],D=C[F],M=_[F];n[Z.id]=[D,M]}}}}catch(H){f.e(H)}finally{f.f()}}}catch(H){c.e(H)}finally{c.f()}var O,L=[],z=[],P=[],B=(0,y.Z)(this.outputs);try{for(B.s();!(O=B.n()).done;){var W=O.value;My(W.id in n,"Could not compute output ".concat(W.name," : ").concat(W.id));var V=(0,h.Z)(n[W.id],2),U=V[0],G=V[1];P.push(U.shape),L.push(U),z.push(G)}}catch(H){B.e(H)}finally{B.f()}return[L,z,P]}},{key:"buildNodeConversionMap",value:function(e){var t,r,a={},i=(0,y.Z)(this.layers);try{for(i.s();!(r=i.n()).done;){var o=r.value;t=o instanceof n?1:0;for(var s=0;s<o.inboundNodes.length;s++){var u=n.nodeKey(o,s);this.containerNodes.has(u)&&(a[u]=t,t+=1)}}}catch(c){i.e(c)}finally{i.f()}return a}},{key:"getLayer",value:function(e,t){if(null!=t){if(this.layers.length<=t)throw new Ay("Was asked to retrieve layer at index ".concat(t,", but model only has ").concat(this.layers.length," layer(s)."));return this.layers[t]}if(null==e)throw new Ay("Provide either a layer name or layer index");var n,r=(0,y.Z)(this.layers);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.name===e)return a}}catch(i){r.e(i)}finally{r.f()}throw new Ay("No such layer: ".concat(e))}},{key:"calculateLosses",value:function(){var e=this;return xs((function(){var t,r=[],a=(0,y.Z)(e.layers);try{for(a.s();!(t=a.n()).done;)for(var i=t.value,o=0;o<i.inboundNodes.length;++o){var s=n.nodeKey(i,o);e.containerNodes.has(s)&&r.push.apply(r,(0,g.Z)(i.calculateLosses()))}}catch(u){a.e(u)}finally{a.f()}return r}))}},{key:"getConfig",value:function(){var e,t={name:this.name},r=this.buildNodeConversionMap(this.layers),a=[],i=(0,y.Z)(this.layers);try{for(i.s();!(e=i.n()).done;){for(var o=e.value,s=o.getClassName(),u=o.getConfig(),c=[],l=0;l<o.inboundNodes.length;l++){var p=o.inboundNodes[l],h=n.nodeKey(o,l),d={};if(this.containerNodes.has(h)){if(p.callArgs)try{JSON.stringify(p.callArgs),d=p.callArgs}catch(f){console.warn("Layer ".concat(o.name," was passed non-serializable keyword arguments: ").concat(p.callArgs,". They will not be included in the serialized model (and thus will be missing at deserialization time).")),d={}}if(p.inboundLayers.length>0){for(var f=[],m=0;m<p.inboundLayers.length;m++){var v=p.inboundLayers[m],g=p.nodeIndices[m],b=p.tensorIndices[m],x=r[n.nodeKey(v,g)];null==x&&(x=0),f.push([v.name,x,b,d])}c.push(f)}}}var k={};k.name=o.name,k.className=s,k.config=u,k.inboundNodes=c,a.push(k)}}catch(O){i.e(O)}finally{i.f()}t.layers=a;for(var w=[],I=0;I<this.inputLayers.length;I++){var S=this.inputLayers[I],N=this.inputLayersNodeIndices[I],T=n.nodeKey(S,N);if(this.containerNodes.has(T)){var C=r[T];null==C&&(C=0);var _=this.inputLayersTensorIndices[I];w.push([S.name,C,_])}}t.inputLayers=w;for(var E=[],A=0;A<this.outputLayers.length;A++){var R=this.outputLayers[A],F=this.outputLayersNodeIndices[A],Z=n.nodeKey(R,F);if(this.containerNodes.has(Z)){var D=r[Z];null==D&&(D=0);var M=this.outputLayersTensorIndices[A];E.push([R.name,D,M])}}return t.outputLayers=E,t}},{key:"stateful",get:function(){if(this._stateful)throw new Ay("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");var e,t=(0,y.Z)(this.layers);try{for(t.s();!(e=t.n()).done;){if(e.value.stateful)return!0}}catch(n){t.e(n)}finally{t.f()}return!1}},{key:"resetStates",value:function(){var e=this;xs((function(){e.layers.forEach((function(e){e.stateful&&e.resetStates()}))}))}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r={},a={};function i(e,t){e.name in a?a[e.name].push(t):a[e.name]=[t]}function o(e,t){var n,a,o=[],s=(0,y.Z)(t);try{for(s.s();!(a=s.n()).done;){var u=a.value,c=u[0],l=u[1],p=u[2];if(n=null==u[3]?{}:u[3],!(c in r))return void i(e,t);var h=r[c];if(h.inboundNodes.length<=l)return void i(e,t);var d=h.inboundNodes[l];o.push(d.outputTensors[p])}}catch(f){s.e(f)}finally{s.f()}o.length>0&&e.apply(Ly(o),n)}function s(e){var a=e.name,o=Tk(e,null!=t.customObjects?t.customObjects:{});o.setFastWeightInitDuringBuild(n),r[a]=o,e.inboundNodes.forEach((function(e){if(!(e instanceof Array))throw new Ay("Corrupted configuration, expected array for nodeData: ".concat(e));i(o,e)}))}var u,c=t.name,l=t.layers,p=(0,y.Z)(l);try{for(p.s();!(u=p.n()).done;){s(u.value)}}catch(z){p.e(z)}finally{p.f()}for(;!qy(a);){var h,d=(0,y.Z)(l);try{for(d.s();!(h=d.n()).done;){var f=h.value,m=r[f.name];if(m.name in a){var v=a[m.name];delete a[m.name];var g,b=(0,y.Z)(v);try{for(b.s();!(g=b.n()).done;){o(m,g.value)}}catch(z){b.e(z)}finally{b.f()}}}}catch(z){d.e(z)}finally{d.f()}}var x,k=[],w=[],I=t.inputLayers,S=(0,y.Z)(I);try{for(S.s();!(x=S.n()).done;){var N=x.value,T=N[0],C=N[1],_=N[2];My(T in r);var E=r[T].inboundNodes[C].outputTensors;k.push(E[_])}}catch(z){S.e(z)}finally{S.f()}var A,R=t.outputLayers,F=(0,y.Z)(R);try{for(F.s();!(A=F.n()).done;){var Z=A.value,D=Z[0],M=Z[1],O=Z[2];My(D in r);var L=r[D].inboundNodes[M].outputTensors;w.push(L[O])}}catch(z){F.e(z)}finally{F.f()}return new e({inputs:k,outputs:w,name:c})}}]),n}(Sx);function iw(e,t){return function(e,t,n){var r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return null}));if(1===r)return Array.isArray(e)&&1===e.length?e:"object"==typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error("Provided ".concat(n," is an array of ").concat(e.length," element(s), but the model has ").concat(r," outputs. Make sure a set of weights is provided for each model output."));return e}if("object"==typeof e&&Object.keys(e).length>0&&"object"==typeof e[Object.keys(e)[0]]){var a=[];return t.forEach((function(t){t in e?a.push(e[t]):a.push(null)})),a}throw new Error("The model has multiple (".concat(r,") outputs, so ").concat(n," must be either an array with ").concat(r," elements or an object with ").concat(t," keys. Provided ").concat(n," not understood: ").concat(JSON.stringify(e)))}(e,t,"classWeight")}function ow(e,t,n,r){return sw.apply(this,arguments)}function sw(){return sw=(0,f.Z)((0,d.Z)().mark((function e(t,n,r,a){var i,o,s;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&null==a){e.next=2;break}throw new Error("Support sampleWeight is not implemented yet");case 2:if(null==r){e.next=14;break}return i=xs((function(){if(1===t.shape.length)return ls(t);if(2===t.shape.length){if(t.shape[1]>1)return Us(t,1);if(1===t.shape[1])return pu(t,[t.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(t.shape[1],") during handling of class weights. The size is expected to be >= 1."))}throw new Error("Unexpected rank of target (y) tensor (".concat(t.rank,") during handling of class weights. The rank is expected to be 1 or 2."))})),e.t0=Array,e.next=7,i.data();case 7:return e.t1=e.sent,o=e.t0.from.call(e.t0,e.t1),ks(i),s=[],e.abrupt("return",(o.forEach((function(e){if(null==r[e])throw new Error("classWeight must contain all classes in the training data. The class ".concat(e," exists in the data but not in classWeight"));s.push(r[e])})),Yp(s,"float32")));case 14:return e.abrupt("return",null);case 15:case"end":return e.stop()}}),e)}))),sw.apply(this,arguments)}function uw(e,t){return Os(e,t)}var cw=32;function lw(e,t){var n,r,a=t;n=a.xs,r=a.ys,Aa.assert(null!=n&&null!=r,(function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ".concat(t)}));var i=pw("input",e.inputNames,n),o=pw("output",e.outputNames,r),s=i[0].shape[0];Aa.assert(i.length===e.inputs.length,(function(){return"LayersModel has ".concat(e.inputs.length," inputs, but the dataset provides ").concat(i.length," inputs.  (Expected input keys: ").concat(JSON.stringify(e.inputNames),")")})),Aa.assert(o.length===e.outputs.length,(function(){return"LayersModel has ".concat(e.outputs.length," outputs, but the dataset provides ").concat(o.length," outputs.  (Expected output keys: ").concat(JSON.stringify(e.outputNames),")")}));for(var u=function(t){Aa.assert(i[t].shape[0]===s,(function(){return"Batch size mismatch: input ".concat(e.inputNames[t]," has ").concat(i[t].shape[0],"; expected  ").concat(s," based on input ").concat(e.inputNames[0],".")}))},c=0;c<i.length;c++)u(c);for(var l=function(t){Aa.assert(o[t].shape[0]===s,(function(){return"Batch size mismatch: output ".concat(e.outputNames[t]," has ").concat(o[t].shape[0],"; expected  ").concat(s," based on input ").concat(e.inputNames[0],".")}))},p=0;p<o.length;p++)l(p);return{xs:i,ys:o}}function pw(e,t,n){if(n instanceof hi)return[n];if(Array.isArray(n))return Aa.assert(n.length===t.length,(function(){return"Received an array of ".concat(n.length," Tensors, but expected ").concat(t.length," to match the ").concat(e," keys ").concat(t,".")})),n;var r,a=[],i=(0,y.Z)(t);try{for(i.s();!(r=i.n()).done;){var o=r.value;if(null==n[o])throw new Ay("The feature data generated by the dataset lacks the required ".concat(e," key '").concat(o,"'."));a.push(n[o])}}catch(s){i.e(s)}finally{i.f()}return a}function hw(e){if(3===e.length)throw new Ry("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}function dw(e,t,n){return fw.apply(this,arguments)}function fw(){return fw=(0,f.Z)((0,d.Z)().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,h,f,m,v,g,y,b,x,k,w,I,S,N,T,C,_,E,A,R,F,Z,D,M,O,L;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!=r.batchesPerEpoch,Aa.assert(null!=t.optimizer,(function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."})),Aa.assert(null!=r,(function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."})),Aa.assert(null!=r.epochs&&r.epochs>0&&Number.isInteger(r.epochs),(function(){return"For fitDataset(), config.epochs is expected to be a positive integer, but got ".concat(r.epochs)})),Aa.assert(!a||r.batchesPerEpoch>0&&Number.isInteger(r.batchesPerEpoch),(function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ".concat(r.batchesPerEpoch)})),Aa.assert(null==r.validationSplit,(function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."})),!t.isTraining){e.next=3;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 3:return t.isTraining=!0,e.prev=4,(i=null!=r.validationData)&&(vw(r.validationData)?Aa.assert(null==r.validationBatches||r.validationBatches>0&&Number.isInteger(r.validationBatches),(function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ".concat(r.validationBatches)})):(u=hw(r.validationData),o=u.xs,s=u.ys)),c=t.makeTrainFunction(),l=t.getDedupedMetricsNames(),p=i?l.slice().concat(l.map((function(e){return"val_"+e}))):l.slice(),h=Ik(r.callbacks,r.yieldEvery),f=null==r.verbose?1:r.verbose,m=Nk(h,f,r.epochs,null,null,mw(n,r),null,i,p),v=m.callbackList,g=m.history,v.setModel(t),t.history=g,e.next=14,v.onTrainBegin();case 14:return t.stopTraining_=!1,y=null==r.initialEpoch?0:r.initialEpoch,e.next=18,n.iterator();case 18:b=e.sent;case 19:if(!(y<r.epochs)){e.next=88;break}return x={},e.next=23,v.onEpochBegin(y);case 23:if(k=0,w=0,e.t0=a,e.t0){e.next=29;break}return e.next=28,n.iterator();case 28:b=e.sent;case 29:if(a&&!(k<r.batchesPerEpoch)){e.next=81;break}return e.next=32,b.next();case 32:if(I=e.sent,!a||!I.done){e.next=36;break}return console.warn("You provided `batchesPerEpoch` as ".concat(r.batchesPerEpoch,", but your dataset iterator ran out of data after ").concat(k," batches; interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, ").concat(r.batchesPerEpoch*r.epochs," batches). You may need to use the repeat() function when building your dataset.")),e.abrupt("break",81);case 36:if(null==I.value){e.next=63;break}return S=lw(t,I.value),N=S.xs,T=S.ys,(C={}).batch=w,C.size=N[0].shape[0],e.next=42,v.onBatchBegin(w,C);case 42:if(_=[],null==r.classWeight){e.next=55;break}E=iw(r.classWeight,t.outputNames),A=0;case 46:if(!(A<E.length)){e.next=55;break}return e.t1=_,e.next=50,ow(T[A],null,E[A]);case 50:e.t2=e.sent,e.t1.push.call(e.t1,e.t2);case 52:++A,e.next=46;break;case 55:for(R=N.concat(T).concat(_),F=c(R),ks(R),Z=0;Z<l.length;++Z)D=l[Z],M=F[Z],C[D]=M,ws(M);return e.next=60,v.onBatchEnd(w,C);case 60:vk(C),w++,k++;case 63:if(!(a?k>=r.batchesPerEpoch:I.done)){e.next=77;break}if(!i){e.next=76;break}if(O=void 0,!vw(r.validationData)){e.next=74;break}return e.t3=zy,e.next=70,t.evaluateDataset(r.validationData,{batches:r.validationBatches});case 70:e.t4=e.sent,O=(0,e.t3)(e.t4),e.next=75;break;case 74:O=zy(t.evaluate(o,s,{batchSize:null==r.validationBatchSize?cw:r.validationBatchSize,verbose:0}));case 75:for(L=0;L<t.metricsNames.length;++L)x["val_".concat(t.metricsNames[L])]=O[L];case 76:return e.abrupt("break",81);case 77:if(!t.stopTraining_){e.next=79;break}return e.abrupt("break",81);case 79:e.next=29;break;case 81:return e.next=83,v.onEpochEnd(y,x);case 83:if(y++,!t.stopTraining_){e.next=86;break}return e.abrupt("break",88);case 86:e.next=19;break;case 88:return e.next=90,v.onTrainEnd();case 90:return e.next=92,t.history.syncData();case 92:return e.abrupt("return",t.history);case 93:return e.prev=93,t.isTraining=!1,e.finish(93);case 96:case"end":return e.stop()}}),e,null,[[4,,93,96]])}))),fw.apply(this,arguments)}function mw(e,t){var n=null;return null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}function vw(e){return"function"==typeof e.iterator}function gw(e){return"function"==typeof e.next}function yw(e,t,n){return bw.apply(this,arguments)}function bw(){return bw=(0,f.Z)((0,d.Z)().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,h;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!=(r=r||{}).batches,i=t.testFunction,o=[],!(r.verbose>0)){e.next=4;break}throw new Ry("Verbose mode is not implemented yet.");case 4:if(Aa.assert(!a||r.batches>0&&Number.isInteger(r.batches),(function(){return"Test loop expects `batches` to be a positive integer, but received ".concat(JSON.stringify(r.batches))})),!gw(n)){e.next=9;break}e.t0=n,e.next=12;break;case 9:return e.next=11,n.iterator();case 11:e.t0=e.sent;case 12:s=e.t0,u=0,c=0,l=(0,d.Z)().mark((function e(){var n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.next();case 2:if(n=e.sent,o=xs((function(){if(n.value){var e=lw(t,n.value),r=e.xs,a=e.ys,s=r.concat(a),l=xs((function(){return i(s)}));if(ks(s),0===c)for(var p=0;p<l.length;++p)o.push(kc(0));for(var h=s[0].shape[0],d=function(e){var t=l[e],n=o[e];o[e]=xs((function(){return Zs(o[e],Os(h,t))})),c>0&&ks(n)},f=0;f<l.length;++f)d(f);ks(l),u+=h,++c}return o})),!n.done){e.next=6;break}return a&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` batches (in this case, ".concat(r.batches," batches). You may need to use the repeat() function when building your dataset.")),e.abrupt("return","break");case 6:case"end":return e.stop()}}),e)}));case 16:if(a&&!(c<r.batches)){e.next=23;break}return e.delegateYield(l(),"t1",18);case 18:if("break"!==e.t1){e.next=21;break}return e.abrupt("break",23);case 21:e.next=16;break;case 23:for(p=0;p<o.length;++p)h=o[p],o[p]=Ms(o[p],u),ks(h);return e.abrupt("return",Ly(o));case 25:case"end":return e.stop()}}),e)}))),bw.apply(this,arguments)}function xw(e){Aa.assert(e>0&&Number.isInteger(e),(function(){return"batchSize is required to be a positive integer, but got ".concat(e)}))}function kw(e,t,n){return null==e?[null]:Array.isArray(e)?e.map((function(e){return _b(e,t,n-t)})):_b(e,t,n-t)}function ww(e,t){return xs((function(){return null==e?null:Array.isArray(e)?e.map((function(e){return ww(e,t)})):Ob(e,"int32"===t.dtype?t:cs(t,"int32"))}))}function Iw(e,t){for(var n=[],r=0,a=null;r<e;)(a=r+t)>=e&&(a=e),n.push([r,a]),r=a;return n}function Sw(e){var t=[];e instanceof hi&&(e=[e]);for(var n=0;n<e.length;++n){var r=e[n];if(1===r.rank)t.push(Cb(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function Nw(e,t){if(null!=e){var n=[];if(t instanceof hi)n.push(t.id);else if(Array.isArray(t))t.forEach((function(e){return n.push(e.id)}));else if(null!=t)for(var r in t){var a=t[r];n.push(a.id)}var i=[];if(e instanceof hi)-1===n.indexOf(e.id)&&i.push(e);else if(Array.isArray(e))e.forEach((function(e){-1===n.indexOf(e.id)&&i.push(e)}));else if(null!=e)for(var o in e){var s=e[o];-1===n.indexOf(s.id)&&i.push(s)}i.forEach((function(e){e.isDisposed||e.dispose()}))}}function Tw(e){return Array.isArray(e)}function Cw(e){return!function(e){return e instanceof hi}(e)&&!Tw(e)}function _w(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(null==t||0===t.length){if(null!=e){var o=!1;if(Tw(e)&&e.length>0)o=!0;else if(Cw(e)){for(var s in e)if(e.hasOwnProperty(s)){o=!0;break}}else o=!0;if(o)throw new Ay("Error when checking model ".concat(i," expected no data, but got ").concat(e))}return[]}if(null==e)return t.map((function(e){return null}));if(Cw(e)){r=[];var u,c=(0,y.Z)(t);try{for(c.s();!(u=c.n()).done;){var l=u.value;if(null==e[l])throw new Ay('No data provided for "'.concat(l,'". Need data for each key in: ').concat(t));r.push(e[l])}}catch(v){c.e(v)}finally{c.f()}}else if(Tw(e)){if(e.length!==t.length)throw new Ay("Error when checking model ".concat(i,": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ").concat(t.length," Tensor(s), but instead got the following list of Tensor(s): ").concat(e));r=e}else{if(t.length>1)throw new Ay("The model ".concat(i," expects ").concat(t.length," Tensor(s), but only received one Tensor. Found: Tensor with shape ").concat(e.shape));r=[e]}if(r=Sw(r),null!=n)for(var p=0;p<t.length;++p)if(null!=n[p]){var h=r[p];if(h.shape.length!==n[p].length)throw new Ay("Error when checking ".concat(i,": expected ").concat(t[p]," to have ").concat(n[p].length," dimension(s). but got array with shape ").concat(h.shape));for(var d=0;d<n[p].length;++d)if(0!==d||a){var f=h.shape[d],m=n[p][d];if(null!=m&&m>=0&&f!==m)throw new Ay("".concat(i," expected a batch of elements where each example has shape [").concat(n[p].slice(1,n[p].length),"] (i.e.,tensor shape [*,").concat(n[p].slice(1,n[p].length),"]) but the ").concat(i," received an input with ").concat(h.shape[0]," examples, each with shape [").concat(h.shape.slice(1,h.shape.length),"] (tensor shape [").concat(h.shape,"])"))}}return r}function Ew(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(Array.isArray(e)){if(e.length!==t.length)throw new Ay("Error when checking model ".concat(i,": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ").concat(t.length," Tensor(s), but instead got ").concat(e.length," Tensors(s)."));r=e}else{if(t.length>1)throw new Ay("The model expects ".concat(t.length," ").concat(i," Tensors, but only received one Tensor. Found: array with shape ").concat(JSON.stringify(e.shape),"."));r=[e]}if(null!=n)for(var o=0;o<t.length;++o)if(null!=n[o]){var s=r[o];if(s.shape.length!==n[o].length)throw new Ay("Error when checking ".concat(i,": expected ").concat(t[o]," to have ").concat(n[o].length," dimension(s), but got array with shape ").concat(JSON.stringify(s.shape)));for(var u=0;u<n[o].length;++u)if(0!==u||a){var c=s.shape[u],l=n[o][u];if(null!=l&&l!==c)throw new Ay("Error when checking ".concat(i,": expected ").concat(t[o]," to have shape ").concat(JSON.stringify(n[o])," but got array with shape ").concat(JSON.stringify(s.shape),"."))}}}var Aw=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,e)).isTraining=!1,r}return(0,v.Z)(n,[{key:"summary",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;if(!this.built)throw new Ay("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");Yk(this,e,t,n)}},{key:"compile",value:function(e){var t=this;if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"==typeof e.optimizer)this.optimizer_=function(e){var t={Adagrad:function(){return hm.adagrad(.01)},Adadelta:function(){return hm.adadelta(1,.95,Nb())},Adam:function(){return hm.adam(.001,.9,.999,Nb())},Adamax:function(){return hm.adamax(.002,.9,.999,Nb(),0)},RMSProp:function(){return hm.rmsprop(.001,.9,0,Nb())},SGD:function(){return hm.sgd(.01)}};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new Ay("Unknown Optimizer ".concat(e))}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Kd))throw new Ay("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}var n=[];if(Array.isArray(e.loss)||"string"==typeof e.loss||"function"==typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new Ay("When passing an Array as loss, it should have one entry per model output. The model has ".concat(this.outputs.length," output(s), but you passed loss=").concat(e.loss,"."));n=e.loss.map((function(e){return Ok(e)}))}else{var r=Ok(e.loss);this.outputs.forEach((function(e){n.push(r)}))}else{for(var a in e.loss=e.loss,e.loss)if(-1===this.outputNames.indexOf(a))throw new Ay('Unknown entry in loss dictionary: "'.concat(a,'". Only expected the following keys: ').concat(this.outputNames));var i,o=(0,y.Z)(this.outputNames);try{for(o.s();!(i=o.n()).done;){var s=i.value;null==e.loss[s]&&console.warn('Output "'.concat(s,'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ').concat(s," during training")),n.push(Ok(e.loss[s]))}}catch(d){o.e(d)}finally{o.f()}}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var u=0;u<this.outputs.length;++u){var c=this.internalOutputShapes[u],l=this.outputNames[u];this.feedOutputNames.push(l),this.feedOutputShapes.push(c),this.feedLossFns.push(this.lossFunctions[u])}var p=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],fb("loss",(function(){for(var e=0;e<t.outputs.length;++e)if(-1===p.indexOf(e)){var n=t.lossFunctions[e];t.outputs.length>1&&(t.metricsTensors.push([n,e]),t.metricsNames.push(t.outputNames[e]+"_loss"))}}));var h=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return[]}));var n;if("string"==typeof e||"function"==typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!=typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ".concat(e));n=e}if(Array.isArray(n))return t.map((function(e){return n}));var r,a=[],i=(0,y.Z)(t);try{for(i.s();!(r=i.n()).done;){var o=r.value,s=n.hasOwnProperty(o)?n[o]:[];Array.isArray(s)||(s=[s]),a.push(s)}}catch(d){i.e(d)}finally{i.f()}return a}(e.metrics,this.outputNames);fb("metric",(function(){for(var e=function(e){if(-1!==p.indexOf(e))return"continue";!function(n){var r,a,i,o,s=(0,y.Z)(n);try{var u=function(){var n,s=o.value;if("string"==typeof s&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(s)){var u,c=t.internalOutputShapes[e];1===c[c.length-1]||t.lossFunctions[e]===Zk?-1!==["accuracy","acc"].indexOf(s)?a=Lk:-1!==["crossentropy","ce"].indexOf(s)&&(a=Vk):t.lossFunctions[e]===Fk?-1!==["accuracy","acc"].indexOf(s)?a=Uk:-1!==["crossentropy","ce"].indexOf(s)&&(a=Hk):-1!==["accuracy","acc"].indexOf(s)?a=zk:-1!==["crossentropy","ce"].indexOf(s)&&(a=Gk),-1!==["accuracy","acc"].indexOf(s)?u="acc":-1!==["crossentropy","ce"].indexOf(s)&&(u="ce"),i=a,r=""+u}else i=function(e){if("string"==typeof e&&e in jk)return jk[e];if("string"!=typeof e&&null!=e)return e;throw new Ay("Unknown metric ".concat(e))}(s),r=""+qk(s);fb(r,(function(){n=i})),function(e,n,r){t.outputNames.length>1&&(n=t.outputNames[e]+"_"+n),t.metricsNames.push(n),t.metricsTensors.push([r,e])}(e,r,n)};for(s.s();!(o=s.n()).done;)u()}catch(d){s.e(d)}finally{s.f()}}(h[e])},n=0;n<t.outputs.length;++n)e(n)})),this.collectedTrainableWeights=this.trainableWeights}},{key:"checkTrainableWeightsConsistency",value:function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=null==n.batchSize?32:n.batchSize;xw(r);var a=this.standardizeUserDataXY(e,t,!0,r);try{var i=a[0].concat(a[1]);this.makeTestFunction();var o=this.testFunction;return Ly(this.testLoop(o,i,r,n.verbose,n.steps))}finally{Nw(a[0],e),Nw(a[1],t)}}},{key:"evaluateDataset",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.makeTestFunction(),yw(this,t,n)));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"checkNumSamples",value:function(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(null!=n){if(r=null,null!=t)throw new Ay("If ".concat(a," is set, batchSize must be null or undefined.Got batchSize = ").concat(t))}else{if(null==e)throw new Ay("Either the input data should have a defined shape, or ".concat(a," shoud be specified."));r=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return r}},{key:"execute",value:function(e,t){if(Array.isArray(t)&&0===t.length)throw new Ay("`outputs` is an empty Array, which is not allowed.");var n=Array.isArray(t),r=n?t:[t],a=this.retrieveSymbolicTensors(r),i=new _x;if(e instanceof hi&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new Ay("The number of inputs provided (".concat(e.length,") does not match the number of inputs of this model (").concat(this.inputs.length,")."));for(var o=0;o<this.inputs.length;++o)i.add(this.inputs[o],e[o])}else{var s,u=(0,y.Z)(this.inputs);try{for(u.s();!(s=u.n()).done;){var c=s.value,l=e[c.name];if(null==l)throw new Ay("No value is provided for the model's input ".concat(c.name));i.add(c,l)}}catch(h){u.e(h)}finally{u.f()}}var p=Rx(a,i);return n?p:p[0]}},{key:"retrieveSymbolicTensors",value:function(e){var t,n=Dy(null,e.length),r=e.length,a=(0,y.Z)(this.layers);try{for(a.s();!(t=a.n()).done;){for(var i=t.value,o=Array.isArray(i.output)?i.output:[i.output],s=o.map((function(e){return e.name})),u=0;u<e.length;++u){var c=s.indexOf(e[u]);if(-1!==c&&(n[u]=o[c],r--),0===r)break}if(0===r)break}}catch(p){a.e(p)}finally{a.f()}if(r>0){var l=[];throw n.forEach((function(t,n){null==t&&l.push(e[n])})),new Ay("Cannot find SymbolicTensors for output name(s): ".concat(JSON.stringify(l)))}return n}},{key:"predictLoop",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return xs((function(){var a=t.checkNumSamples(e);if(r)throw new Ry("Verbose predictLoop() is not implemented yet.");for(var i=Iw(a,n),o=t.outputs.map((function(e){return[]})),s=function(n){xs((function(){var r=i[n][0],a=i[n][1],o=kw(e,r,a),s=[];if(Array.isArray(o))for(var u=0;u<o.length;++u)s.push({key:t.inputs[u],value:o[u]});else s.push({key:t.inputs[0],value:o});var c=new _x(s);return Rx(t.outputs,c)})).forEach((function(e,t){return o[t].push(e)}))},u=0;u<i.length;++u)s(u);return Ly(o.map((function(e){return fu(e,0)})))}))}},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Sw(e);Ew(n,this.inputNames,this.feedInputShapes,!1);try{var r=null==t.batchSize?32:t.batchSize;return xw(r),this.predictLoop(n,r)}finally{Nw(n,e)}}},{key:"predictOnBatch",value:function(e){Ew(e,this.inputNames,this.feedInputShapes,!0);var t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}},{key:"standardizeUserDataXY",value:function(e,t){var n=arguments.length>3?arguments[3]:void 0;if(null==this.optimizer_)throw new Ey("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var r=[],a=0;a<this.feedOutputShapes.length;++a){var i=this.feedOutputShapes[a];this.feedLossFns[a]===Fk?r.push(i.slice(0,i.length-1).concat([1])):r.push(i)}if(function(e,t,n){var r=jy(e.map((function(e){return e.shape[0]})));r.sort();var a=jy(t.map((function(e){return e.shape[0]})));if(a.sort(),r.length>1)throw new Ay("All input Tensors (x) should have the same number of samples. Got array shapes: ".concat(JSON.stringify(e.map((function(e){return e.shape})))));if(a.length>1)throw new Ay("All target Tensors (y) should have the same number of samples. Got array shapes: ".concat(JSON.stringify(t.map((function(e){return e.shape})))));if(r.length>0&&a.length>0&&!Aa.arraysEqual(r,a))throw new Ay("Input Tensors should have the same number of samples as target Tensors. Found ".concat(r[0]," input sample(s) and ").concat(a[0]," target sample(s)."))}(e=_w(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=_w(t,this.feedOutputNames,r,!1,"target")),function(e,t,n){for(var r=[_k,Zk,Rk],a=0;a<e.length;++a){var i=e[a],o=t[a],s=n[a];if(null!=o){if(o===Rk&&1===i.shape[i.shape.length-1])throw new Ay("You are passing a target array of shape ".concat(i.shape," while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes]."));if(-1!==r.indexOf(o))for(var u=i.shape.slice(1),c=s.slice(1),l=0;l<u.length;++l){var p=u[l],h=c[l];if(null!=h&&p!==h)throw new Ay("A target Tensor with shape ".concat(i.shape," was passed for an output of shape ").concat(s,", while using a loss function that expects targets to have the same shape as the output."))}}}}(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=n&&n>0&&e[0].shape[0]%n!==0)throw new Ay("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ".concat(n,". Found: ").concat(e[0].shape[0]," sample(s)."));return[e,t]}},{key:"standardizeUserData",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n,r,a){var i,o,s,u,c,l,p,f,m,v=arguments;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=!(v.length>4&&void 0!==v[4])||v[4],o=v.length>5?v[5]:void 0,s=this.standardizeUserDataXY(t,n,i,o),u=(0,h.Z)(s,2),c=u[0],l=u[1],null==r){e.next=5;break}throw new Error("sample weight is not supported yet.");case 5:if(p=null,null==a){e.next=19;break}f=iw(a,this.outputNames),p=[],m=0;case 10:if(!(m<f.length)){e.next=19;break}return e.t0=p,e.next=14,ow(l[m],null,f[m]);case 14:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 16:++m,e.next=10;break;case 19:return e.abrupt("return",[c,l,p]);case 20:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"testLoop",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0;return xs((function(){var o=r.checkNumSamples(t,n,i,"steps"),s=[];if(a>0)throw new Ry("Verbose mode is not implemented yet.");if(null!=i)throw new Ry("steps mode in testLoop() is not implemented yet");for(var u=Iw(o,n),c=Yp(Sb(0,o)),l=0;l<u.length;++l){var p=u[l][0],h=u[l][1],d=_b(c,p,h-p),f=ww(t,d),m=e(f);if(0===l)for(var v=0;v<m.length;++v)s.push(kc(0));for(var g=0;g<m.length;++g){var y=m[g];s[g]=Zs(s[g],Os(h-p,y))}}for(var b=0;b<s.length;++b)s[b]=Ms(s[b],o);return s}))}},{key:"getDedupedMetricsNames",value:function(){for(var e=this.metricsNames,t=[],n=0;n<e.length;++n){var r=e[n],a=r;if(Oy(e,r)>1){var i=Oy(e.slice(0,n),r);a+="_".concat(i)}t.push(a)}return t}},{key:"makeTrainFunction",value:function(){var e=this;return function(t){var n=[],r=t.slice(0,e.inputs.length),a=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),i=t.slice(e.inputs.length+e.outputs.length,e.inputs.length+2*e.outputs.length),o=[],s=e.collectedTrainableWeights.map((function(e){return e.read()}));return[e.optimizer_.minimize((function(){for(var t=[],s=0;s<e.inputs.length;++s)t.push({key:e.inputs[s],value:r[s]});for(var u,c=new _x(t),l=Rx(e.outputs,c,{training:!0}),p=0;p<e.lossFunctions.length;++p){var h=(0,e.lossFunctions[p])(a[p],l[p]);null!=i[p]&&(h=uw(h,i[p]));var d=yl(h);n.push(d),u=0===p?h:Zs(u,h)}for(var f=0;f<e.metricsTensors.length;++f){var m=void 0;if(e.outputs.length>1&&f<e.outputs.length)m=n[f];else{var v=e.metricsTensors[f][0],g=e.metricsTensors[f][1];m=yl(v(a[g],l[g]))}ws(m),o.push(m)}return u=yl(u),e.calculateLosses().forEach((function(e){u=Zs(u,e)})),u}),!0,s)].concat(o)}}},{key:"makeTestFunction",value:function(){var e=this;this.testFunction=function(t){return xs((function(){for(var n,r=[],a=t.slice(0,e.inputs.length),i=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),o=[],s=0;s<e.inputs.length;++s)o.push({key:e.inputs[s],value:a[s]});for(var u=new _x(o),c=Rx(e.outputs,u),l=0;l<e.lossFunctions.length;++l){var p=e.lossFunctions[l],h=yl(p(i[l],c[l]));n=0===l?h:Zs(n,h),r.push(n)}for(var d=0;d<e.metricsTensors.length;++d){var f=e.metricsTensors[d][0],m=e.metricsTensors[d][1],v=yl(f(i[m],c[m]));r.push(v)}return r}))}}},{key:"fit",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,h,f,m,v,g,y,b,x,k,w,I,S,N,T,C=arguments;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=C.length>2&&void 0!==C[2]?C[2]:{},!this.isTraining){e.next=3;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 3:return this.isTraining=!0,e.prev=4,xw(f=null==r.batchSize?32:r.batchSize),!1,e.next=10,this.standardizeUserData(t,n,r.sampleWeight,r.classWeight,false,f);case 10:if(m=e.sent,a=m[0],i=m[1],h=m[2],v=!1,!(null!=r.validationData&&r.validationData.length>0)){e.next=26;break}if(v=!0,2!==r.validationData.length){e.next=18;break}u=r.validationData[0],c=r.validationData[1],e.next=19;break;case 18:throw 3===r.validationData.length?new Ry("validationData including sample weights is not supported yet."):new Ay("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ".concat(r.validationData," is invalid."));case 19:return!0,e.next=22,this.standardizeUserData(u,c,null,null,true,f);case 22:y=e.sent,l=y[0],p=y[1],g=l.concat(p),e.next=27;break;case 26:null!=r.validationSplit&&r.validationSplit>0&&r.validationSplit<1?(v=!0,b=Math.floor(a[0].shape[0]*(1-r.validationSplit)),x=a[0].shape[0],l=kw(a,b,x),o=a,a=kw(a,0,b),p=kw(i,b,x),s=i,i=kw(i,0,b),g=l.concat(p)):null!=r.validationSteps&&(v=!0);case 27:return k=a.concat(i).concat(h),this.checkTrainableWeightsConsistency(),w=this.makeTrainFunction(),I=this.getDedupedMetricsNames(),v?(this.makeTestFunction(),S=this.testFunction,N=I.slice().concat(I.map((function(e){return"val_"+e})))):(S=null,g=[],N=I.slice()),T=Ik(r.callbacks,r.yieldEvery),e.next=34,this.fitLoop(w,k,I,f,r.epochs,r.verbose,T,S,g,r.shuffle,N,r.initialEpoch,null,null);case 34:return e.abrupt("return",e.sent);case 35:return e.prev=35,this.isTraining=!1,Nw(a,t),Nw(i,n),Nw(o,t),Nw(s,n),Nw(l,u),Nw(p,c),null!=h&&ks(h),e.finish(35);case 38:case"end":return e.stop()}}),e,this,[[4,,35,38]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fitLoop",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n,r,a,i,o,s,u,c,l,p,h,f,m){var v,g,y,b,x,k,w,I,S=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==a&&(a=32),null==i&&(i=1),null==l&&(l=!0),null==h&&(h=0),v=!1,null!=u&&null!=c&&(v=!0),null==m||(v=!0,null!=f)){e.next=4;break}throw new Ay("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");case 4:return null!=(g=this.checkNumSamples(n,a,f,"steps_per_epoch"))&&(y=Sb(0,g)),null==o&&(o=1),b=Nk(s,o,i,h,g,f,a,v,p),x=b.callbackList,k=b.history,x.setModel(this),this.history=k,e.next=11,x.onTrainBegin();case 11:this.stopTraining_=!1,w=(0,d.Z)().mark((function e(){var i,o,s,p,h;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.onEpochBegin(I);case 2:if(i={},null==f){e.next=5;break}throw new Ry("stepsPerEpoch mode is not implemented yet.");case 5:if("batch"!==l){e.next=7;break}throw new Ry("batch shuffling is not implemneted yet");case 7:l&&Aa.shuffle(y),o=Yp(y),s=Iw(g,a),p=(0,d.Z)().mark((function e(l){var p;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p={},e.next=3,x.onBatchBegin(l,p);case 3:return xs((function(){var e=s[l][0],h=s[l][1],d=_b(o,e,h-e);p.batch=l,p.size=h-e;for(var f=ww(n,d),m=t(f),g=0;g<r.length;++g){var y=r[g],b=m[g];p[y]=b,ws(b)}if(l===s.length-1&&v)for(var x=S.testLoop(u,c,a),k=0;k<r.length;++k){var w=r[k],I=x[k];ws(I),i["val_"+w]=I}})),e.next=6,x.onBatchEnd(l,p);case 6:if(vk(p),!S.stopTraining_){e.next=9;break}return e.abrupt("return","break");case 9:case"end":return e.stop()}}),e)})),h=0;case 11:if(!(h<s.length)){e.next=19;break}return e.delegateYield(p(h),"t0",13);case 13:if("break"!==e.t0){e.next=16;break}return e.abrupt("break",19);case 16:++h,e.next=11;break;case 19:return o.dispose(),e.next=22,x.onEpochEnd(I,i);case 22:if(!S.stopTraining_){e.next=24;break}return e.abrupt("return","break");case 24:case"end":return e.stop()}}),e)})),I=h;case 14:if(!(I<i)){e.next=22;break}return e.delegateYield(w(),"t0",16);case 16:if("break"!==e.t0){e.next=19;break}return e.abrupt("break",22);case 19:++I,e.next=14;break;case 22:return e.next=24,x.onTrainEnd();case 24:return e.next=26,this.history.syncData();case 26:return e.abrupt("return",this.history);case 27:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a,i,o,s,u,c,l,p,h,d,f){return e.apply(this,arguments)}}()},{key:"fitDataset",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",dw(this,t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"trainOnBatch",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i,o,s,u,c,l,p;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.standardizeUserData(t,n);case 2:r=e.sent,a=r[0],i=r[1],o=this.makeTrainFunction()(a.concat(i)),s=[],u=(0,y.Z)(o),e.prev=8,u.s();case 10:if((c=u.n()).done){e.next=18;break}return l=c.value,e.next=14,l.data();case 14:p=e.sent,s.push(p[0]);case 16:e.next=10;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(8),u.e(e.t0);case 23:return e.prev=23,u.f(),e.finish(23);case 26:return e.abrupt("return",(ks(o),Nw(r[0],t),Nw(r[1],n),Ly(s)));case 27:case"end":return e.stop()}}),e,this,[[8,20,23,26]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getNamedWeights",value:function(e){for(var t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,a=this.getWeights(n),i=0;i<r.length;++i)n&&!r[i].trainable||t.push({name:r[i].originalName,tensor:a[i]});return t}},{key:"stopTraining",get:function(){return this.stopTraining_},set:function(e){this.stopTraining_=e}},{key:"optimizer",get:function(){return this.optimizer_},set:function(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}},{key:"dispose",value:function(){var e=o((0,i.Z)(n.prototype),"dispose",this).call(this);if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){var t=ys().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-ys().numTensors}return e}},{key:"getLossIdentifiers",value:function(){var e;if("string"==typeof this.loss)e=Py(this.loss);else if(Array.isArray(this.loss)){var t,n=(0,y.Z)(this.loss);try{for(n.s();!(t=n.n()).done;){if("string"!=typeof t.value)throw new Error("Serialization of non-string loss is not supported.")}}catch(u){n.e(u)}finally{n.f()}e=this.loss.map((function(e){return Py(e)}))}else{var r=Object.keys(this.loss);e={};for(var a=this.loss,i=0,o=r;i<o.length;i++){var s=o[i];if("string"!=typeof a[s])throw new Error("Serialization of non-string loss is not supported.");e[s]=Py(a[s])}}return e}},{key:"getMetricIdentifiers",value:function(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[Py(qk(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((function(e){return Py(qk(e))}));var e={};for(var t in this.metrics)e[t]=Py(qk(this.metrics[t]));return e}},{key:"getTrainingConfig",value:function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}},{key:"loadTrainingConfig",value:function(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");var t,n,r=Tk(tw(e.optimizer_config));if("string"==typeof e.loss)t=By(e.loss);else if(Array.isArray(e.loss))t=e.loss.map((function(e){return By(e)}));else if(null!=e.loss)for(var a in t={},e.loss)t[a]=By(e.loss[a]);if(Array.isArray(e.metrics))n=e.metrics.map((function(e){return By(e)}));else if(null!=e.metrics)for(var i in n={},e.metrics)n[i]=By(e.metrics[i]);this.compile({loss:t,metrics:n,optimizer:r})}},{key:"save",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i,o,s,u,c,l;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=7;break}if(0!==(r=rf.getSaveHandlers(t)).length){e.next=4;break}throw new Ay("Cannot find any save handlers for URL '".concat(t,"'"));case 4:if(!(r.length>1)){e.next=6;break}throw new Ay("Found more than one (".concat(r.length,") save handlers for URL '").concat(t,"'"));case 6:t=r[0];case 7:if(null!=t.save){e.next=9;break}throw new Ay("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 9:return e.next=11,rf.encodeWeights(this.getNamedWeights(n));case 11:if(a=e.sent,!1,null,i={modelTopology:this.toJSON(null,false),format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v".concat(rw),convertedBy:null},null==n||!n.includeOptimizer||null==this.optimizer){e.next=29;break}return i.trainingConfig=this.getTrainingConfig(),s="optimizer",e.t0=rf,e.next=21,this.optimizer.getWeights();case 21:return e.t1=e.sent,e.t2=s,e.next=25,e.t0.encodeWeights.call(e.t0,e.t1,e.t2);case 25:u=e.sent,c=u.data,l=u.specs,(o=a.specs).push.apply(o,(0,g.Z)(l)),a.data=rf.concatenateArrayBuffers([a.data,c]);case 29:return e.abrupt("return",(null!=this.userDefinedMetadata&&(Kk(this.userDefinedMetadata,this.name,!0),i.userDefinedMetadata=this.userDefinedMetadata),i.weightData=a.data,i.weightSpecs=a.specs,t.save(i)));case 30:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setUserDefinedMetadata",value:function(e){Kk(e,this.name),this.userDefinedMetadata=e}},{key:"getUserDefinedMetadata",value:function(){return this.userDefinedMetadata}}]),n}(aw);Aw.className="Model",Gd.registerClass(Aw);var Rw=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n)}(Aw);function Fw(e,t){return Zw.apply(this,arguments)}function Zw(){return Zw=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i,o,s,u,c,l;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("modelTopology"in t||(t={modelTopology:t}),null!=(r=t.modelTopology).model_config&&(r=r.model_config),a=tw(r),i=Tk(a,n),null==t.weightsManifest){e.next=12;break}return e.next=7,rf.loadWeights(t.weightsManifest,t.pathPrefix,i.weights.map((function(e){return e.originalName})));case 7:o=e.sent,s={},u=(0,y.Z)(i.weights);try{for(u.s();!(c=u.n()).done;)l=c.value,s[l.originalName]=o[l.originalName]}catch(p){u.e(p)}finally{u.f()}i.loadWeights(s),ks(o);case 12:return e.abrupt("return",i);case 13:case"end":return e.stop()}}),e)}))),Zw.apply(this,arguments)}function Dw(e,t){return Mw.apply(this,arguments)}function Mw(){return Mw=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),"string"!=typeof t){e.next=9;break}if(0!==(r=rf.getLoadHandlers(t,n)).length){e.next=6;break}r.push(rf.browserHTTPRequest(t,n)),e.next=8;break;case 6:if(!(r.length>1)){e.next=8;break}throw new Ay("Found more than one (".concat(r.length,") load handlers for URL '").concat(t,"'"));case 8:t=r[0];case 9:return e.abrupt("return",Ow(t,void 0,n));case 10:case"end":return e.stop()}}),e)}))),Mw.apply(this,arguments)}function Ow(e,t,n){return Lw.apply(this,arguments)}function Lw(){return Lw=(0,f.Z)((0,d.Z)().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,h;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==r&&(r={}),null!=t.load){e.next=2;break}throw new Ay("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");case 2:return e.next=4,t.load();case 4:if(a=e.sent,null!=(i=a.modelTopology).model_config&&(i=i.model_config),o=null==r.strict||r.strict,s=null!=a.weightData&&null!=a.weightSpecs&&o,u=Tk(tw(i),n,s),null!=(c=a.trainingConfig)&&u.loadTrainingConfig(c),null!=a.userDefinedMetadata&&u.setUserDefinedMetadata(a.userDefinedMetadata),null==a.weightData){e.next=19;break}if(null!=a.weightSpecs){e.next=11;break}throw new Ay("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");case 11:if(l=zw(a.weightData,a.weightSpecs),p=l.modelWeights,h=l.optimizerWeights,u.loadWeights(p,o),e.t0=null!=u.optimizer&&h.length>0,!e.t0){e.next=17;break}return e.next=17,u.optimizer.setWeights(h);case 17:ks(p),ks(h.map((function(e){return e.tensor})));case 19:return e.abrupt("return",u);case 20:case"end":return e.stop()}}),e)}))),Lw.apply(this,arguments)}function zw(e,t){var n=rf.decodeWeights(e,t),r={},a=[];return t.forEach((function(e){"optimizer"===e.group?a.push({name:e.name,tensor:n[e.name]}):r[e.name]=n[e.name]})),{modelWeights:r,optimizerWeights:a}}Rw.className="Functional",Gd.registerClass(Rw);var Pw=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;if((0,m.Z)(this,n),e=e||{},(r=t.call(this,{inputs:[],outputs:[]})).trainable=!0,r.built=!1,r.name=null!=e.name?e.name:nb("sequential_"),null!=e.layers){var a,i=(0,y.Z)(e.layers);try{for(i.s();!(a=i.n()).done;){var o=a.value;r.add(o)}}catch(s){i.e(s)}finally{i.f()}}return(0,c.Z)(r)}return(0,v.Z)(n,[{key:"checkShape",value:function(e){if(e.inboundNodes[0].outputTensors[0].shape.some((function(e){return e<0})))throw new Ay("Negative dimension size caused by adding layer ".concat(e.name," with input shape [").concat(e.inboundNodes[0].inputTensors[0].shape,"]"))}},{key:"add",value:function(e){var t,r=e instanceof n||e instanceof Aw;if(r){if(1!==(t=e).outputs.length)throw new Ay("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==t.inputs.length)throw new Ay("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new Ay("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var a=Cx({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(a)}if(r)this.outputs=t.outputs,this.inputs=t.inputs;else{if(1!==e.inboundNodes.length)throw new Ay("A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ".concat(e.name," which has ").concat(e.inboundNodes.length," pre-existing inbound connections."));if(1!==e.inboundNodes[0].outputTensors.length)throw new Ay("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=Nx(this.outputs[0])}this.inboundNodes=[],new wx({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Dy(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((function(e){return e.shape})),outputShapes:this.outputs[0].shape})}else{var i=e.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}},{key:"pop",value:function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}},{key:"call",value:function(e,t){return null==this.model&&this.build(),this.model.call(e,t)}},{key:"build",value:function(e){if(dx(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Aw({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}},{key:"countParams",value:function(){return this.built||this.build(),o((0,i.Z)(n.prototype),"countParams",this).call(this)}},{key:"summary",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;this.built||this.build(),o((0,i.Z)(n.prototype),"summary",this).call(this,e,t,r)}},{key:"setWeights",value:function(e){null==this.model&&this.build(),this.model.setWeights(e)}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new Ey("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}},{key:"evaluateDataset",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new Ey("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.evaluateDataset(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null==this.model&&this.build(),this.model.predict(e,t)}},{key:"predictOnBatch",value:function(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}},{key:"compile",value:function(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}},{key:"optimizer",get:function(){return null==this.model?void 0:this.model.optimizer},set:function(e){this.model.optimizer=e}},{key:"fit",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a=arguments;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>2&&void 0!==a[2]?a[2]:{},this.built){e.next=3;break}throw new Ey("The model needs to be compiled before being used.");case 3:return e.abrupt("return",this.model.fit(t,n,r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fitDataset",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new Ey("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.fitDataset(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"trainOnBatch",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.model.trainOnBatch(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"stopTraining",get:function(){if(null==this.model)throw new Ay("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(e){if(null==this.model)throw new Ay("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}},{key:"getConfig",value:function(){var e,t=[],n=(0,y.Z)(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value,a={};a.className=r.getClassName(),a.config=r.getConfig(),t.push(a)}}catch(i){n.e(i)}finally{n.f()}return{name:this.name,layers:t}}}],[{key:"fromConfig",value:function(e,t){var r,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new Ay("Legacy serialization format not supported yet.");r=t}else Aa.assert(null!=t.layers,(function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."})),r=t.layers,delete t.layers,i=t;var o=new e(i);if(!(o instanceof n))throw new Ry("Sequential.fromConfig called on non-Sequential input: ".concat(o));var s,u=(0,y.Z)(r);try{for(u.s();!(s=u.n()).done;){var c=Tk(s.value,void 0,a);a&&c.setFastWeightInitDuringBuild(!0),o.add(c)}}catch(l){u.e(l)}finally{u.f()}return o}}]),n}(Aw);function Bw(e){return new Aw(e)}function Ww(e){return new Pw(e)}function Vw(e){return Cx(e)}function Uw(e,t){Sk.registerCallbackConstructor(e,t)}Pw.className="Sequential",Gd.registerClass(Pw);var Gw=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"getConfig",value:function(){return{}}}]),n}(Gd.Serializable),Hw=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"apply",value:function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(1!==t)throw new Ry("Support for alpha values other than 1 (".concat(t,") is not implemented yet."));return uc(e)}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}}]),n}(Gw);Hw.className="elu",Gd.registerClass(Hw);var jw=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"apply",value:function(e){return Cp(e)}}]),n}(Gw);jw.className="selu",Gd.registerClass(jw);var qw=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"apply",value:function(e){return yp(e)}}]),n}(Gw);qw.className="relu",Gd.registerClass(qw);var Kw=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"apply",value:function(e){return xs((function(){return wl(6,yp(e))}))}}]),n}(Gw);Kw.className="relu6",Gd.registerClass(Kw);var Xw=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"apply",value:function(e){return e}}]),n}(Gw);Xw.className="linear",Gd.registerClass(Xw);var Yw=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"apply",value:function(e){return vu(e)}}]),n}(Gw);Yw.className="sigmoid",Gd.registerClass(Yw);var Jw=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"apply",value:function(e){return function(e){return xs((function(){var t=Zs(.5,Os(.2,e));return Ru(t,0,1)}))}(e)}}]),n}(Gw);Jw.className="hardSigmoid",Gd.registerClass(Jw);var Qw=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"apply",value:function(e){return nl(e)}}]),n}(Gw);Qw.className="softplus",Gd.registerClass(Qw);var $w=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"apply",value:function(e){return function(e){return xs((function(){return Ms(e,Zs(Ls(e),1))}))}(e)}}]),n}(Gw);$w.className="softsign",Gd.registerClass($w);var eI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"apply",value:function(e){return yu(e)}}]),n}(Gw);eI.className="tanh",Gd.registerClass(eI);var tI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"apply",value:function(e){return zp(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)}}]),n}(Gw);tI.className="softmax",Gd.registerClass(tI);var nI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"apply",value:function(e){return il(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)}}]),n}(Gw);nI.className="logSoftmax",Gd.registerClass(nI);var rI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return xs((function(){return Os(vu(Os(e,t)),e)}))}}]),n}(Gw);rI.className="swish",Gd.registerClass(rI);var aI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"apply",value:function(e){return xs((function(){return Os(e,yu(nl(e)))}))}}]),n}(Gw);function iI(e){return e.getClassName()}function oI(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Gy(e,Gd.SerializationMap.getMap().classNameMap,t,"activation")}function sI(e){if(null==e){var t={className:"linear",config:{}};return oI(t)}if("string"==typeof e){var n={};return n.className=e,n.config={},oI(n)}return e instanceof Gw?e:oI(e)}function uI(e){if(null!=e&&"object"!=typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an object, but received: ".concat(e))}aI.className="mish",Gd.registerClass(aI);var cI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n)}(Gd.Serializable),lI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),r=t.call(this),uI(e),r.l1=null==e||null==e.l1?.01:e.l1,r.l2=null==e||null==e.l2?.01:e.l2,r.hasL1=0!==r.l1,r.hasL2=0!==r.l2,r}return(0,v.Z)(n,[{key:"apply",value:function(e){var t=this;return xs((function(){var n=bl([1]);return t.hasL1&&(n=Zs(n,Sc(Os(t.l1,Ls(e))))),t.hasL2&&(n=Zs(n,Sc(Os(t.l2,Lb(e))))),pu(n,[])}))}},{key:"getConfig",value:function(){return{l1:this.l1,l2:this.l2}}}],[{key:"fromConfig",value:function(e,t){return new e({l1:t.l1,l2:t.l2})}}]),n}(cI);lI.className="L1L2",Gd.registerClass(lI);var pI={l1l2:"L1L2"};function hI(e){return Vy(e)}function dI(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Gy(e,Gd.SerializationMap.getMap().classNameMap,t,"regularizer")}function fI(e){return null==e?null:"string"==typeof e?dI({className:e in pI?pI[e]:e,config:{}}):e instanceof cI?e:dI(e)}var mI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,null!=e&&(r.maxValue=e.maxValue),r}return(0,v.Z)(n,[{key:"call",value:function(e,t){e=hx(e);var n=yp(e);return null!=this.maxValue&&(n=Ru(n,0,this.maxValue)),n}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={maxValue:this.maxValue},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Sx);mI.className="ReLU",Gd.registerClass(mI);var vI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=.3,null==e&&(e={}),r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,r}return(0,v.Z)(n,[{key:"call",value:function(e,t){var n=hx(e);return Wc(n,this.alpha)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Sx);vI.className="LeakyReLU",Gd.registerClass(vI);var gI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;if((0,m.Z)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),r.supportsMasking=!0,r.alphaInitializer=cx(e.alphaInitializer||r.DEFAULT_ALPHA_INITIALIZER),r.alphaRegularizer=fI(e.alphaRegularizer),r.alphaConstraint=Hx(e.alphaConstraint),null==e.sharedAxes)r.sharedAxes=null;else if(Array.isArray(e.sharedAxes))r.sharedAxes=e.sharedAxes;else{if("number"!=typeof e.sharedAxes)throw new Ay("Expected sharedAxes to be a number or an array of numbers, but got ".concat(e.sharedAxes));r.sharedAxes=[e.sharedAxes]}return(0,c.Z)(r)}return(0,v.Z)(n,[{key:"build",value:function(e){var t=(e=dx(e)).slice(1);if(null!=this.sharedAxes){var n,r=(0,y.Z)(this.sharedAxes);try{for(r.s();!(n=r.n()).done;){t[n.value-1]=1}}catch(o){r.e(o)}finally{r.f()}}this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var a={};if(null!=this.sharedAxes)for(var i=1;i<e.length;++i)a[i]=e[i];this.inputSpec=[new bx({ndim:e.length,axes:a})],this.built=!0}},{key:"call",value:function(e,t){return e=hx(e),Pl(e,this.alpha.read())}},{key:"getConfig",value:function(){var e={alphaInitializer:ux(this.alphaInitializer),alphaRegularizer:hI(this.alphaRegularizer),alphaConstraint:Ux(this.alphaConstraint),sharedAxes:this.sharedAxes},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Sx);gI.className="PReLU",Gd.registerClass(gI);var yI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;if((0,m.Z)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==r.DEFAULT_ALPHA)throw new Ry("Non-default alpha value (".concat(e.alpha,") is not supported by the ELU layer yet."));return r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,(0,c.Z)(r)}return(0,v.Z)(n,[{key:"call",value:function(e,t){var n=hx(e);return uc(n)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Sx);yI.className="ELU",Gd.registerClass(yI);var bI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_THETA=1,null==e&&(e={}),r.theta=null==e.theta?r.DEFAULT_THETA:e.theta,r}return(0,v.Z)(n,[{key:"call",value:function(e,t){var n=hx(e);return Os(n,cs(Mc(n,this.theta),"float32"))}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={theta:this.theta},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Sx);bI.className="ThresholdedReLU",Gd.registerClass(bI);var xI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_AXIS=1,null==e&&(e={}),r.softmax=(new tI).apply,r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r}return(0,v.Z)(n,[{key:"call",value:function(e,t){var n=hx(e);return this.softmax(n,this.axis)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={axis:this.axis},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Sx);function kI(e,t,n){if("number"==typeof e)return Dy(e,t);if(e.length!==t)throw new Ay("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers. Received: ").concat(e.length," elements."));for(var r=0;r<t;++r){var a=e[r];if(!xb(a))throw new Ay("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers. Received: ").concat(JSON.stringify(e)," including a non-integer number ").concat(a))}return e}function wI(e,t,n,r){var a;return null==e?e:(a="same"===n?e:e-(t+(t-1)*((arguments.length>4&&void 0!==arguments[4]?arguments[4]:1)-1))+1,Math.floor((a+r-1)/r))}function II(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+Ib([n-t,0]);else{if("same"!==r)throw new Ay("Unsupport padding mode: ".concat(r,"."));e*=t}return e}function SI(e,t){return xs((function(){return cb(t),"channelsFirst"===t?fh(e,[0,2,3,1]):e}))}function NI(e,t){return xs((function(){return cb(t),"channelsFirst"===t?fh(e,[0,2,3,4,1]):e}))}function TI(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return xs((function(){if(null==i&&(i="channelsLast"),cb(i),3!==e.rank&&4!==e.rank)throw new Ay("conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ".concat(e.rank,"."));if(3!==t.rank&&4!==t.rank)throw new Ay("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ".concat(e.rank,"."));var u=SI(e,i);if("causal"===a)throw new Ry("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=_h.conv2d({x:u,filter:t,strides:r,pad:"same"===a?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:s}),"channelsFirst"===i&&(u=fh(u,[0,3,1,2])),u}))}xI.className="Softmax",Gd.registerClass(xI);var CI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var a;if((0,m.Z)(this,n),(a=t.call(this,r)).bias=null,a.DEFAULT_KERNEL_INITIALIZER="glorotNormal",a.DEFAULT_BIAS_INITIALIZER="zeros",n.verifyArgs(r),a.rank=e,Yy(a.rank,"rank"),1!==a.rank&&2!==a.rank&&3!==a.rank)throw new Ry("Convolution layer for rank other than 1, 2, or 3 (".concat(a.rank,") is not implemented yet."));if(a.kernelSize=kI(r.kernelSize,e,"kernelSize"),a.strides=kI(null==r.strides?1:r.strides,e,"strides"),a.padding=null==r.padding?"valid":r.padding,lb(a.padding),a.dataFormat=null==r.dataFormat?"channelsLast":r.dataFormat,cb(a.dataFormat),a.activation=sI(r.activation),a.useBias=null==r.useBias||r.useBias,a.biasInitializer=cx(r.biasInitializer||a.DEFAULT_BIAS_INITIALIZER),a.biasConstraint=Hx(r.biasConstraint),a.biasRegularizer=fI(r.biasRegularizer),a.activityRegularizer=fI(r.activityRegularizer),a.dilationRate=kI(null==r.dilationRate?1:r.dilationRate,e,"dilationRate"),1===a.rank&&Array.isArray(a.dilationRate)&&1!==a.dilationRate.length)throw new Ay("dilationRate must be a number or an array of a single number for 1D convolution, but received ".concat(JSON.stringify(a.dilationRate)));if(2===a.rank){if("number"==typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate];else if(2!==a.dilationRate.length)throw new Ay("dilationRate must be a number or array of two numbers for 2D convolution, but received ".concat(JSON.stringify(a.dilationRate)))}else if(3===a.rank)if("number"==typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate,a.dilationRate];else if(3!==a.dilationRate.length)throw new Ay("dilationRate must be a number or array of three numbers for 3D convolution, but received ".concat(JSON.stringify(a.dilationRate)));return(0,c.Z)(a)}return(0,v.Z)(n,[{key:"getConfig",value:function(){var e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:iI(this.activation),useBias:this.useBias,biasInitializer:ux(this.biasInitializer),biasRegularizer:hI(this.biasRegularizer),activityRegularizer:hI(this.activityRegularizer),biasConstraint:Ux(this.biasConstraint)},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(My("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!=typeof e.kernelSize&&!Xy(e.kernelSize,"number",1,3))throw new Ay("BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(Sx),_I=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var a;return(0,m.Z)(this,n),(a=t.call(this,e,r)).kernel=null,n.verifyArgs(r),a.filters=r.filters,Yy(a.filters,"filters"),a.kernelInitializer=cx(r.kernelInitializer||a.DEFAULT_KERNEL_INITIALIZER),a.kernelConstraint=Hx(r.kernelConstraint),a.kernelRegularizer=fI(r.kernelRegularizer),a}return(0,v.Z)(n,[{key:"build",value:function(e){e=dx(e);var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new Ay("The channel dimension of the input should be defined. Found ".concat(e[t]));var n=e[t],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(0,a.Z)({},t,n)}],this.built=!0}},{key:"call",value:function(e,t){var n=this;return xs((function(){e=hx(e);var t,r=null==n.bias?null:n.bias.read(),a=Qy(n.activation.getClassName());if(null!=a&&2===n.rank)t=TI(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate,a);else{if(1===n.rank)t=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return xs((function(){if(null==i&&(i="channelsLast"),cb(i),3!==e.shape.length)throw new Ay("The input of a conv1dWithBias operation should be 3, but is ".concat(e.shape.length," instead."));if(3!==t.shape.length)throw new Ay("The kernel for a conv1dWithBias operation should be 3, but is ".concat(t.shape.length," instead"));if(null!=n&&1!==n.shape.length)throw new Ay("The bias for a conv1dWithBias operation should be 1, but is ".concat(t.shape.length," instead"));if("channelsFirst"===i&&(e=fh(e,[0,2,1])),"causal"===a)throw new Ry("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=Lu(e,t,r,"same"===a?"same":"valid","NWC",o);return null!=n&&(s=Pb(s,n)),s}))}(e,n.kernel.read(),r,n.strides[0],n.padding,n.dataFormat,n.dilationRate[0]);else if(2===n.rank)t=TI(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate);else{if(3!==n.rank)throw new Ry("convolutions greater than 3D are not implemented yet.");t=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;return xs((function(){if(null==i&&(i="channelsLast"),cb(i),4!==e.rank&&5!==e.rank)throw new Ay("conv3dWithBias expects input to be of rank 4 or 5, but received ".concat(e.rank,"."));if(4!==t.rank&&5!==t.rank)throw new Ay("conv3dWithBias expects kernel to be of rank 4 or 5, but received ".concat(e.rank,"."));var s=NI(e,i);if("causal"===a)throw new Ry("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=Bu(s,t,r,"same"===a?"same":"valid","NDHWC",o),null!=n&&(s=Pb(s,n)),"channelsFirst"===i&&(s=fh(s,[0,4,1,2,3])),s}))}(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate)}null!=n.activation&&(t=n.activation.apply(t))}return t}))}},{key:"computeOutputShape",value:function(e){e=dx(e);for(var t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2),r=0;r<n.length;++r){var a=wI(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);t.push(a)}var i=[e[0]];return"channelsLast"===this.dataFormat?(i=i.concat(t)).push(this.filters):(i.push(this.filters),i=i.concat(t)),i}},{key:"getConfig",value:function(){var e={filters:this.filters,kernelInitializer:ux(this.kernelInitializer),kernelRegularizer:hI(this.kernelRegularizer),kernelConstraint:Ux(this.kernelConstraint)},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(!("filters"in e)||"number"!=typeof e.filters||e.filters<1)throw new Ay("Convolution layer expected config.filters to be a 'number' > 0 but got ".concat(JSON.stringify(e.filters)))}}]),n}(CI),EI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),r=t.call(this,2,e),n.verifyArgs(e),r}return(0,v.Z)(n,[{key:"getConfig",value:function(){var e=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&!Xy(e.kernelSize,"number",1,2))throw new Ay("Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(_I);EI.className="Conv2D",Gd.registerClass(EI);var AI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),r=t.call(this,3,e),n.verifyArgs(e),r}return(0,v.Z)(n,[{key:"getConfig",value:function(){var e=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new Ay("Conv3D expects config.kernelSize to be number or [number, number, number], but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(_I);AI.className="Conv3D",Gd.registerClass(AI);var RI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;if((0,m.Z)(this,n),(r=t.call(this,e)).inputSpec=[new bx({ndim:4})],"same"!==r.padding&&"valid"!==r.padding)throw new Ay("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ".concat(r.padding));return(0,c.Z)(r)}return(0,v.Z)(n,[{key:"build",value:function(e){if(4!==(e=dx(e)).length)throw new Ay("Input should have rank 4; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new Ay("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new bx({ndim:4,axes:(0,a.Z)({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return xs((function(){var t=hx(e);if(4!==t.shape.length)throw new Ay("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-".concat(t.shape.length));var r,a,i=t.shape,o=i[0];"channelsFirst"===n.dataFormat?(r=2,a=3):(r=1,a=2);var s=i[r],u=i[a],c=n.kernelSize[0],l=n.kernelSize[1],p=n.strides[0],h=n.strides[1],d=[o,II(s,p,c,n.padding),II(u,h,l,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=fh(t,[0,2,3,1]));var f=Pu(t,n.kernel.read(),d,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(f=fh(f,[0,3,1,2])),null!=n.bias&&(f=Pb(f,n.bias.read(),n.dataFormat)),null!=n.activation&&(f=n.activation.apply(f)),f}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=(e=dx(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3):(t=3,n=1,r=2);var i=this.kernelSize[0],o=this.kernelSize[1],s=this.strides[0],u=this.strides[1];return a[t]=this.filters,a[n]=II(a[n],s,i,this.padding),a[r]=II(a[r],u,o,this.padding),a}},{key:"getConfig",value:function(){var e=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(EI);RI.className="Conv2DTranspose",Gd.registerClass(RI);var FI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;if((0,m.Z)(this,n),(r=t.call(this,e)).inputSpec=[new bx({ndim:5})],"same"!==r.padding&&"valid"!==r.padding)throw new Ay("Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ".concat(r.padding));return(0,c.Z)(r)}return(0,v.Z)(n,[{key:"build",value:function(e){if(5!==(e=dx(e)).length)throw new Ay("Input should have rank 5; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new Ay("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new bx({ndim:5,axes:(0,a.Z)({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return xs((function(){var t=hx(e);if(5!==t.shape.length)throw new Ay("Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-".concat(t.shape.length));var r,a,i,o=t.shape,s=o[0];"channelsFirst"===n.dataFormat?(i=2,r=3,a=4):(i=1,r=2,a=3);var u=o[i],c=o[r],l=o[a],p=n.kernelSize[0],h=n.kernelSize[1],d=n.kernelSize[2],f=n.strides[0],m=n.strides[1],v=n.strides[2],g=[s,II(u,f,p,n.padding),II(c,m,h,n.padding),II(l,v,d,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=fh(t,[0,2,3,4,1]));var y=Vu(t,n.kernel.read(),g,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(y=fh(y,[0,4,1,2,3])),null!==n.bias&&(y=Pb(y,n.bias.read(),n.dataFormat)),null!==n.activation&&(y=n.activation.apply(y)),y}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a,i=(e=dx(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3,a=4):(t=4,n=1,r=2,a=3);var o=this.kernelSize[0],s=this.kernelSize[1],u=this.kernelSize[2],c=this.strides[0],l=this.strides[1],p=this.strides[2];return i[t]=this.filters,i[n]=II(i[n],c,o,this.padding),i[r]=II(i[r],l,s,this.padding),i[a]=II(i[a],p,u,this.padding),i}},{key:"getConfig",value:function(){var e=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(AI);FI.className="Conv3DTranspose",Gd.registerClass(FI);var ZI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var a;if((0,m.Z)(this,n),(a=t.call(this,e,r)).DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",a.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",a.depthwiseKernel=null,a.pointwiseKernel=null,null==r.filters)throw new Ay("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=r.kernelInitializer||null!=r.kernelRegularizer||null!=r.kernelConstraint)throw new Ay("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=r.padding&&"same"!==r.padding&&"valid"!==r.padding)throw new Ay("SeparableConv".concat(a.rank,"D supports only padding modes: 'same' and 'valid', but received ").concat(JSON.stringify(r.padding)));return a.depthMultiplier=null==r.depthMultiplier?1:r.depthMultiplier,a.depthwiseInitializer=cx(r.depthwiseInitializer||a.DEFAULT_DEPTHWISE_INITIALIZER),a.depthwiseRegularizer=fI(r.depthwiseRegularizer),a.depthwiseConstraint=Hx(r.depthwiseConstraint),a.pointwiseInitializer=cx(r.depthwiseInitializer||a.DEFAULT_POINTWISE_INITIALIZER),a.pointwiseRegularizer=fI(r.pointwiseRegularizer),a.pointwiseConstraint=Hx(r.pointwiseConstraint),(0,c.Z)(a)}return(0,v.Z)(n,[{key:"build",value:function(e){if((e=dx(e)).length<this.rank+2)throw new Ay("Inputs to SeparableConv".concat(this.rank,"D should have rank ").concat(this.rank+2,", but received input shape: ").concat(JSON.stringify(e)));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new Ay("The channel dimension of the inputs should be defined, but found ".concat(JSON.stringify(e[t])));for(var n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),i=[],o=0;o<this.rank;++o)i.push(1);i.push(n*this.depthMultiplier,this.filters);var s=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,s,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,s,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,s,this.biasConstraint):this.bias=null,this.inputSpec=[new bx({ndim:this.rank+2,axes:(0,a.Z)({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return xs((function(){var t;if(e=hx(e),1===n.rank)throw new Ry("1D separable convolution is not implemented yet.");return 2===n.rank&&("channelsFirst"===n.dataFormat&&(e=fh(e,[0,2,3,1])),t=_p(e,n.depthwiseKernel.read(),n.pointwiseKernel.read(),n.strides,n.padding,n.dilationRate,"NHWC")),n.useBias&&(t=Pb(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),"channelsFirst"===n.dataFormat&&(t=fh(t,[0,3,1,2])),t}))}},{key:"getConfig",value:function(){var e=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=ux(this.depthwiseInitializer),e.pointwiseInitializer=ux(this.pointwiseInitializer),e.depthwiseRegularizer=hI(this.depthwiseRegularizer),e.pointwiseRegularizer=hI(this.pointwiseRegularizer),e.depthwiseConstraint=Ux(this.depthwiseConstraint),e.pointwiseConstraint=Ux(this.pointwiseConstraint),e}}]),n}(_I);ZI.className="SeparableConv";var DI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){return(0,m.Z)(this,n),t.call(this,2,e)}return(0,v.Z)(n)}(ZI);DI.className="SeparableConv2D",Gd.registerClass(DI);var MI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),r=t.call(this,1,e),n.verifyArgs(e),r.inputSpec=[{ndim:3}],r}return(0,v.Z)(n,[{key:"getConfig",value:function(){var e=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.dataFormat,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&!Xy(e.kernelSize,"number",1,1))throw new Ay("Conv1D expects config.kernelSize to be number or number[] with length 1, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(_I);MI.className="Conv1D",Gd.registerClass(MI);var OI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),r=t.call(this,e),"number"==typeof e.cropping?r.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"==typeof e.cropping[0]?r.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:r.cropping=e.cropping,r.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,r.inputSpec=[{ndim:4}],r}return(0,v.Z)(n,[{key:"computeOutputShape",value:function(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}},{key:"call",value:function(e,t){var n=this;return xs((function(){if(e=hx(e),"channelsLast"===n.dataFormat){var t=Ab(e,n.cropping[0][0],e.shape[1]-n.cropping[0][0]-n.cropping[0][1],2);return Ab(t,n.cropping[1][0],e.shape[2]-n.cropping[1][1]-n.cropping[1][0],3)}var r=Ab(e,n.cropping[0][0],e.shape[2]-n.cropping[0][0]-n.cropping[0][1],3);return Ab(r,n.cropping[1][0],e.shape[3]-n.cropping[1][1]-n.cropping[1][0],4)}))}},{key:"getConfig",value:function(){var e={cropping:this.cropping,dataFormat:this.dataFormat},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Sx);OI.className="Cropping2D",Gd.registerClass(OI);var LI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,e)).DEFAULT_SIZE=[2,2],r.inputSpec=[{ndim:4}],r.size=null==e.size?r.DEFAULT_SIZE:e.size,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,cb(r.dataFormat),r.interpolation=null==e.interpolation?"nearest":e.interpolation,function(e){Ky(ab,"InterpolationFormat",e)}(r.interpolation),r}return(0,v.Z)(n,[{key:"computeOutputShape",value:function(e){if("channelsFirst"===this.dataFormat){var t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}var r=null==e[1]?null:this.size[0]*e[1],a=null==e[2]?null:this.size[1]*e[2];return[e[0],r,a,e[3]]}},{key:"call",value:function(e,t){var n=this;return xs((function(){var t=hx(e),r=t.shape;if("channelsFirst"===n.dataFormat){t=fh(t,[0,2,3,1]);var a=n.size[0]*r[2],i=n.size[1]*r[3],o="nearest"===n.interpolation?Pd.resizeNearestNeighbor(t,[a,i]):Pd.resizeBilinear(t,[a,i]);return fh(o,[0,3,1,2])}var s=n.size[0]*r[1],u=n.size[1]*r[2];return"nearest"===n.interpolation?Pd.resizeNearestNeighbor(t,[s,u]):Pd.resizeBilinear(t,[s,u])}))}},{key:"getConfig",value:function(){var e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Sx);LI.className="UpSampling2D",Gd.registerClass(LI);var zI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,2,e)).depthwiseKernel=null,r.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,r.depthwiseInitializer=cx(e.depthwiseInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.depthwiseConstraint=Hx(e.depthwiseConstraint),r.depthwiseRegularizer=fI(e.depthwiseRegularizer),r}return(0,v.Z)(n,[{key:"build",value:function(e){if((e=dx(e)).length<4)throw new Ay("Inputs to DepthwiseConv2D should have rank 4. Received input shape: ".concat(JSON.stringify(e),"."));var t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new Ay("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (".concat(e[t],")."));var n=e[t],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return xs((function(){var t=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"valid",a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;return xs((function(){null==a&&(a="channelsLast"),cb(a);var o=SI(e,a);if(4!==e.rank)throw new Ay("Input for depthwiseConv2d is required to be 4-D, but is instead ".concat(e.rank,"-D"));if(4!==t.rank)throw new Ay("depthwiseKernel is required to be 4-D, but is instead ".concat(t.rank,"-D"));return o=Xu(o,t,n,"same"===r?"same":"valid","NHWC",i),"channelsFirst"===a&&(o=fh(o,[0,3,1,2])),o}))}(e=hx(e),n.depthwiseKernel.read(),n.strides,n.padding,n.dataFormat,null);return n.useBias&&(t=Pb(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),t}))}},{key:"computeOutputShape",value:function(e){e=dx(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,a=wI(t,this.kernelSize[0],this.padding,this.strides[0]),i=wI(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],r,a,i]:[e[0],a,i,r]}},{key:"getConfig",value:function(){var e=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=ux(this.depthwiseInitializer),e.depthwiseRegularizer=hI(this.depthwiseRegularizer),e.depthwiseConstraint=Ux(this.depthwiseRegularizer),e}}]),n}(CI);function PI(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new Ay("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function a(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=a(t),constants:n=a(n)}}function BI(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return xs((function(){var u=t.shape.length;if(u<3)throw new Ay("Input should be at least 3D, but is ".concat(u,"D."));var c=[1,0].concat(Sb(2,u));if(t=fh(t,c),null!=i)throw new Ry("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=a&&((a=cs(cs(a,"bool"),"float32")).rank===u-1&&(a=Ec(a,-1)),a=fh(a,c)),r&&(t=xp(t,0),null!=a&&(a=xp(a,0)));var l,p,h=[],d=n,f=t.shape[0],m=oh(t);null!=a&&(p=oh(a));for(var v,g=function(t){var n=m[t],r=xs((function(){return e(n,d)}));if(null==a)l=r[0],d=r[1];else{var i=xs((function(){var e=p[t],n=al(Al(e),e);return{output:Zs(Os(r[0],e),Os(d[0],n)),newStates:d.map((function(t,a){return Zs(Os(r[1][a],e),Os(t,n))}))}}));l=i.output,d=i.newStates}s&&h.push(l)},y=0;y<f;++y)g(y);return s&&(v=jp(h,1)),[l,v,d]}))}zI.className="DepthwiseConv2D",Gd.registerClass(zI);var WI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r,a;if((0,m.Z)(this,n),r=t.call(this,e),null==e.cell)throw new Ay("cell property is missing for the constructor of RNN.");if(null==(a=Array.isArray(e.cell)?new XI({cells:e.cell}):e.cell).stateSize)throw new Ay("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=a,r.returnSequences=null!=e.returnSequences&&e.returnSequences,r.returnState=null!=e.returnState&&e.returnState,r.goBackwards=null!=e.goBackwards&&e.goBackwards,r._stateful=null!=e.stateful&&e.stateful,r.unroll=null!=e.unroll&&e.unroll,r.supportsMasking=!0,r.inputSpec=[new bx({ndim:3})],r.stateSpec=null,r.states_=null,r.numConstants=null,r.keptStates=[],r}return(0,v.Z)(n,[{key:"getStates",value:function(){return null==this.states_?Sb(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((function(e){return null})):this.states_}},{key:"setStates",value:function(e){this.states_=e}},{key:"computeOutputShape",value:function(e){lx(e)&&(e=e[0]);var t=this.cell.stateSize;Array.isArray(t)||(t=[t]);var n,r=t[0];if(n=this.returnSequences?[e[0],e[1],r]:[e[0],r],this.returnState){var a,i=[],o=(0,y.Z)(t);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push([e[0],s])}}catch(u){o.e(u)}finally{o.f()}return[n].concat(i)}return n}},{key:"computeMask",value:function(e,t){var n=this;return xs((function(){Array.isArray(t)&&(t=t[0]);var e=n.returnSequences?t:null;if(n.returnState){var r=n.states.map((function(e){return null}));return[e].concat(r)}return e}))}},{key:"states",get:function(){if(null==this.states_){for(var e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[],n=0;n<e;++n)t.push(null);return t}return this.states_},set:function(e){this.states_=e}},{key:"build",value:function(e){if(null!=this.numConstants)throw new Ry("Constants support is not implemented in RNN yet.");lx(e)&&(e=e[0]);var t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new bx({shape:[t,null].concat((0,g.Z)(n))});var r,a=[e[0]].concat(e.slice(2));if(this.cell.build(a),r=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!Aa.arraysEqual(this.stateSpec.map((function(e){return e.shape[e.shape.length-1]})),r))throw new Ay("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; However cell.stateSize is ").concat(this.cell.stateSize))}else this.stateSpec=r.map((function(e){return new bx({shape:[null,e]})}));this.stateful&&this.resetStates()}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];xs((function(){if(!t.stateful)throw new _y("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape[0];if(null==r)throw new Ay("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.states_)Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return bl([r,e])})):t.states_=[bl([r,t.cell.stateSize])];else if(null==e)ks(t.states_),null!=t.keptStates&&(ks(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return bl([r,e])})):t.states_[0]=bl([r,t.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new Ay("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), but it received ").concat(e.length," state value(s). Input received: ").concat(e));!0===n?t.keptStates.push(t.states_.slice()):ks(t.states_);for(var a=0;a<t.states_.length;++a){var i=e[a],o=Array.isArray(t.cell.stateSize)?t.cell.stateSize[a]:t.cell.stateSize,s=[r,o];if(!Aa.arraysEqual(i.shape,s))throw new Ay("State ".concat(a," is incompatible with layer ").concat(t.name,": expected shape=").concat(s,", received shape=").concat(i.shape));t.states_[a]=i}}t.states_=t.states_.map((function(e){return ws(e.clone())}))}))}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var s=PI(e,r,a,this.numConstants);e=s.inputs,r=s.initialState,a=s.constants;var u=[],c=[];if(null!=r){t.initialState=r,u=u.concat(r),this.stateSpec=[];var l,p=(0,y.Z)(r);try{for(p.s();!(l=p.n()).done;){var h=l.value;this.stateSpec.push(new bx({shape:h.shape}))}}catch(g){p.e(g)}finally{p.f()}c=c.concat(this.stateSpec)}if(null!=a&&(t.constants=a,u=u.concat(a),this.numConstants=a.length),u[0]instanceof xx){var d=[e].concat(u),f=this.inputSpec.concat(c),m=this.inputSpec;this.inputSpec=f;var v=o((0,i.Z)(n.prototype),"apply",this).call(this,d,t);return this.inputSpec=m,v}return o((0,i.Z)(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return xs((function(){var r=null==t?null:t.mask,a=null==t?null:t.training,i=null==t?null:t.initialState;e=hx(e),null==i&&(i=n.stateful?n.states_:n.getInitialState(e));var o=Array.isArray(n.cell.stateSize)?n.cell.stateSize.length:1;if(i.length!==o)throw new Ay("RNN Layer has ".concat(o," state(s) but was passed ").concat(i.length," initial state(s)."));n.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var s={training:a},u=BI((function(e,t){var r=n.cell.call([e].concat(t),s);return[r[0],r.slice(1)]}),e,i,n.goBackwards,r,null,n.unroll,n.returnSequences),c=u[0],l=u[1],p=u[2];n.stateful&&n.resetStates(p,a);var h=n.returnSequences?l:c;return n.returnState?[h].concat(p):h}))}},{key:"getInitialState",value:function(e){var t=this;return xs((function(){var n=bl(e.shape);return n=Cb(n=Sc(n,[1,2])),Array.isArray(t.cell.stateSize)?t.cell.stateSize.map((function(e){return e>1?Zb(n,[1,e]):n})):t.cell.stateSize>1?[Zb(n,[1,t.cell.stateSize])]:[n]}))}},{key:"trainableWeights",get:function(){return this.trainable?this.cell.trainableWeights:[]}},{key:"nonTrainableWeights",get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}},{key:"setFastWeightInitDuringBuild",value:function(e){o((0,i.Z)(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e=o((0,i.Z)(n.prototype),"getConfig",this).call(this),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);var r=this.cell.getConfig();return this.getClassName()===n.className&&(t.cell={className:this.cell.getClassName(),config:r}),Object.assign(Object.assign(Object.assign({},r),e),t)}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Tk(t.cell,n);return new e(Object.assign(t,{cell:r}))}}]),n}(Sx);WI.className="RNN",Gd.registerClass(WI);var VI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n)}(Sx),UI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,Yy(r.units,"units"),r.activation=sI(null==e.activation?r.DEFAULT_ACTIVATION:e.activation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=cx(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=cx(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=cx(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=fI(e.kernelRegularizer),r.recurrentRegularizer=fI(e.recurrentRegularizer),r.biasRegularizer=fI(e.biasRegularizer),r.kernelConstraint=Hx(e.kernelConstraint),r.recurrentConstraint=Hx(e.recurrentConstraint),r.biasConstraint=Hx(e.biasConstraint),r.dropout=wb([1,Ib([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=wb([1,Ib([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return(0,v.Z)(n,[{key:"build",value:function(e){e=dx(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return xs((function(){if(2!==e.length)throw new Ay("SimpleRNNCell expects 2 input Tensors, got ".concat(e.length,"."));var r=e[1];e=e[0];var a=null!=t.training&&t.training;0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=YI({ones:function(){return Al(e)},rate:n.dropout,training:a,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=YI({ones:function(){return Al(r)},rate:n.recurrentDropout,training:a,dropoutFunc:n.dropoutFunc}));var i,o=n.dropoutMask,s=n.recurrentDropoutMask;i=Mb(null!=o?Os(e,o):e,n.kernel.read()),null!=n.bias&&(i=Pb(i,n.bias.read())),null!=s&&(r=Os(r,s));var u=Zs(i,Mb(r,n.recurrentKernel.read()));return null!=n.activation&&(u=n.activation.apply(u)),[u,u]}))}},{key:"getConfig",value:function(){var e=o((0,i.Z)(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:iI(this.activation),useBias:this.useBias,kernelInitializer:ux(this.kernelInitializer),recurrentInitializer:ux(this.recurrentInitializer),biasInitializer:ux(this.biasInitializer),kernelRegularizer:hI(this.kernelRegularizer),recurrentRegularizer:hI(this.recurrentRegularizer),biasRegularizer:hI(this.biasRegularizer),activityRegularizer:hI(this.activityRegularizer),kernelConstraint:Ux(this.kernelConstraint),recurrentConstraint:Ux(this.recurrentConstraint),biasConstraint:Ux(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}]),n}(VI);UI.className="SimpleRNNCell",Gd.registerClass(UI);var GI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){return(0,m.Z)(this,n),e.cell=new UI(e),t.call(this,e)}return(0,v.Z)(n,[{key:"call",value:function(e,t){var r=this;return xs((function(){null!=r.cell.dropoutMask&&(ks(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(ks(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,s=null==t?null:t.training,u=null==t?null:t.initialState;return o((0,i.Z)(n.prototype),"call",r).call(r,e,{mask:a,training:s,initialState:u})}))}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(WI);GI.className="SimpleRNN",Gd.registerClass(GI);var HI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;if((0,m.Z)(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new Ay("GRUCell does not support reset_after parameter set to true.");return r.units=e.units,Yy(r.units,"units"),r.activation=sI(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=sI(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=cx(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=cx(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=cx(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=fI(e.kernelRegularizer),r.recurrentRegularizer=fI(e.recurrentRegularizer),r.biasRegularizer=fI(e.biasRegularizer),r.kernelConstraint=Hx(e.kernelConstraint),r.recurrentConstraint=Hx(e.recurrentConstraint),r.biasConstraint=Hx(e.biasConstraint),r.dropout=wb([1,Ib([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=wb([1,Ib([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.implementation=e.implementation,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,(0,c.Z)(r)}return(0,v.Z)(n,[{key:"build",value:function(e){var t=(e=dx(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return xs((function(){if(2!==e.length)throw new Ay("GRUCell expects 2 input Tensors (inputs, h, c), got ".concat(e.length,"."));var r=null!=t.training&&t.training,a=e[1];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=YI({ones:function(){return Al(e)},rate:n.dropout,training:r,count:3,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=YI({ones:function(){return Al(a)},rate:n.recurrentDropout,training:r,count:3,dropoutFunc:n.dropoutFunc}));var i,o,s,u=n.dropoutMask,c=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=Os(e,u[0]));var l=Mb(e,n.kernel.read());n.useBias&&(l=Pb(l,n.bias.read())),0<n.recurrentDropout&&n.recurrentDropout<1&&(a=Os(a,c[0]));var p=n.recurrentKernel.read(),d=Vp(p,[2*n.units,n.units],p.rank-1),f=(0,h.Z)(d,2),m=f[0],v=f[1],g=Mb(a,m),y=Vp(l,3,l.rank-1),b=(0,h.Z)(y,3),x=b[0],k=b[1],w=b[2],I=Vp(g,2,g.rank-1),S=(0,h.Z)(I,2),N=S[0],T=S[1];i=n.recurrentActivation.apply(Zs(x,N)),o=n.recurrentActivation.apply(Zs(k,T));var C=Mb(Os(o,a),v);s=n.activation.apply(Zs(w,C));var _=Zs(Os(i,a),Os(Zs(1,tl(i)),s));return[_,_]}))}},{key:"getConfig",value:function(){var e=o((0,i.Z)(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:iI(this.activation),recurrentActivation:iI(this.recurrentActivation),useBias:this.useBias,kernelInitializer:ux(this.kernelInitializer),recurrentInitializer:ux(this.recurrentInitializer),biasInitializer:ux(this.biasInitializer),kernelRegularizer:hI(this.kernelRegularizer),recurrentRegularizer:hI(this.recurrentRegularizer),biasRegularizer:hI(this.biasRegularizer),activityRegularizer:hI(this.activityRegularizer),kernelConstraint:Ux(this.kernelConstraint),recurrentConstraint:Ux(this.recurrentConstraint),biasConstraint:Ux(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}]),n}(VI);HI.className="GRUCell",Gd.registerClass(HI);var jI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){return(0,m.Z)(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new HI(e),t.call(this,e)}return(0,v.Z)(n,[{key:"call",value:function(e,t){var r=this;return xs((function(){null!=r.cell.dropoutMask&&(ks(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(ks(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,s=null==t?null:t.training,u=null==t?null:t.initialState;return o((0,i.Z)(n.prototype),"call",r).call(r,e,{mask:a,training:s,initialState:u})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(WI);jI.className="GRU",Gd.registerClass(jI);var qI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,Yy(r.units,"units"),r.activation=sI(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=sI(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=cx(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=cx(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=cx(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.unitForgetBias=e.unitForgetBias,r.kernelRegularizer=fI(e.kernelRegularizer),r.recurrentRegularizer=fI(e.recurrentRegularizer),r.biasRegularizer=fI(e.biasRegularizer),r.kernelConstraint=Hx(e.kernelConstraint),r.recurrentConstraint=Hx(e.recurrentConstraint),r.biasConstraint=Hx(e.biasConstraint),r.dropout=wb([1,Ib([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=wb([1,Ib([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.implementation=e.implementation,r.stateSize=[r.units,r.units],r.dropoutMask=null,r.recurrentDropoutMask=null,r}return(0,v.Z)(n,[{key:"build",value:function(e){var t,n,r=(e=dx(e))[e.length-1];if(this.kernel=this.addWeight("kernel",[r,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var a=this.biasInitializer,i=this.units;n=new(t=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"apply",value:function(e,t){var n=a.apply([i]),r=(new jb).apply([i]),o=a.apply([2*i]);return Fb(Fb(n,r),o)}}]),n}(Gb),t.className="CustomInit",t)}else n=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,n,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}},{key:"call",value:function(e,t){var n=this;return xs((function(){var r=null!=t.training&&t.training;if(3!==e.length)throw new Ay("LSTMCell expects 3 input Tensors (inputs, h, c), got ".concat(e.length,"."));var a=e[1],i=e[2];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=YI({ones:function(){return Al(e)},rate:n.dropout,training:r,count:4,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=YI({ones:function(){return Al(a)},rate:n.recurrentDropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var o,s,u,c,l=n.dropoutMask,p=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=Os(e,l[0]));var d=Mb(e,n.kernel.read());0<n.recurrentDropout&&n.recurrentDropout<1&&(a=Os(a,p[0])),d=Zs(d,Mb(a,n.recurrentKernel.read())),n.useBias&&(d=Pb(d,n.bias.read()));var f=Vp(d,4,d.rank-1),m=(0,h.Z)(f,4),v=m[0],g=m[1],y=m[2],b=m[3];o=n.recurrentActivation.apply(v),s=n.recurrentActivation.apply(g),u=Zs(Os(s,i),Os(o,n.activation.apply(y))),c=n.recurrentActivation.apply(b);var x=Os(c,n.activation.apply(u));return[x,x,u]}))}},{key:"getConfig",value:function(){var e=o((0,i.Z)(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:iI(this.activation),recurrentActivation:iI(this.recurrentActivation),useBias:this.useBias,kernelInitializer:ux(this.kernelInitializer),recurrentInitializer:ux(this.recurrentInitializer),biasInitializer:ux(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:hI(this.kernelRegularizer),recurrentRegularizer:hI(this.recurrentRegularizer),biasRegularizer:hI(this.biasRegularizer),activityRegularizer:hI(this.activityRegularizer),kernelConstraint:Ux(this.kernelConstraint),recurrentConstraint:Ux(this.recurrentConstraint),biasConstraint:Ux(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}]),n}(VI);qI.className="LSTMCell",Gd.registerClass(qI);var KI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){return(0,m.Z)(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new qI(e),t.call(this,e)}return(0,v.Z)(n,[{key:"call",value:function(e,t){var r=this;return xs((function(){null!=r.cell.dropoutMask&&(ks(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(ks(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,s=null==t?null:t.training,u=null==t?null:t.initialState;return o((0,i.Z)(n.prototype),"call",r).call(r,e,{mask:a,training:s,initialState:u})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(WI);KI.className="LSTM",Gd.registerClass(KI);var XI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,e)).cells=e.cells,r}return(0,v.Z)(n,[{key:"stateSize",get:function(){var e,t=[],n=(0,y.Z)(this.cells.slice().reverse());try{for(n.s();!(e=n.n()).done;){var r=e.value;Array.isArray(r.stateSize)?t.push.apply(t,(0,g.Z)(r.stateSize)):t.push(r.stateSize)}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"call",value:function(e,t){var n=this;return xs((function(){var r,a=e.slice(1),i=[],o=(0,y.Z)(n.cells.slice().reverse());try{for(o.s();!(r=o.n()).done;){var s=r.value;Array.isArray(s.stateSize)?i.push(a.splice(0,s.stateSize.length)):i.push(a.splice(0,1))}}catch(v){o.e(v)}finally{o.f()}i.reverse();for(var u,c=[],l=0;l<n.cells.length;++l){var p=n.cells[l];a=i[l],u=0===l?[e[0]].concat(a):[u[0]].concat(a),u=p.call(u,t),c.push(u.slice(1))}a=[];var h,d=(0,y.Z)(c.slice().reverse());try{for(d.s();!(h=d.n()).done;){var f,m=h.value;(f=a).push.apply(f,(0,g.Z)(m))}}catch(v){d.e(v)}finally{d.f()}return[u[0]].concat(a)}))}},{key:"build",value:function(e){var t;lx(e)&&(e=e[0]),this.cells.forEach((function(n,r){fb("RNNCell_".concat(r),(function(){n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]}))})),this.built=!0}},{key:"getConfig",value:function(){var e=o((0,i.Z)(n.prototype),"getConfig",this).call(this),t={cells:this.cells.map((function(e){return{className:e.getClassName(),config:e.getConfig()}}))};return Object.assign(Object.assign({},e),t)}},{key:"trainableWeights",get:function(){if(!this.trainable)return[];var e,t=[],n=(0,y.Z)(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,(0,g.Z)(r.trainableWeights))}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=(0,y.Z)(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,(0,g.Z)(r.nonTrainableWeights))}}catch(u){n.e(u)}finally{n.f()}if(!this.trainable){var a,i=[],o=(0,y.Z)(this.cells);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,(0,g.Z)(s.trainableWeights))}}catch(u){o.e(u)}finally{o.f()}return i.concat(t)}return t}},{key:"getWeights",value:function(){var e,t=[],n=(0,y.Z)(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,(0,g.Z)(r.weights))}}catch(a){n.e(a)}finally{n.f()}return gx(t)}},{key:"setWeights",value:function(e){var t,n=[],r=(0,y.Z)(this.cells);try{for(r.s();!(t=r.n()).done;)for(var a=t.value,i=a.weights.length,o=e.splice(i),s=0;s<a.weights.length;++s)n.push([a.weights[s],o[s]])}catch(u){r.e(u)}finally{r.f()}yx(n)}}],[{key:"fromConfig",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=[],i=(0,y.Z)(t.cells);try{for(i.s();!(n=i.n()).done;){var o=n.value;a.push(Tk(o,r))}}catch(s){i.e(s)}finally{i.f()}return new e({cells:a})}}]),n}(VI);function YI(e){var t=e.ones,n=e.rate,r=e.training,a=void 0!==r&&r,i=e.count,o=void 0===i?1:i,s=e.dropoutFunc,u=function(){return null!=s?s(t(),n):Bb(t(),n)},c=function(){return Wb(u,t,a)};return!o||o<=1?ws(c().clone()):Array(o).fill(void 0).map(c).map((function(e){return ws(e.clone())}))}XI.className="StackedRNNCells",Gd.registerClass(XI);var JI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;if((0,m.Z)(this,n),e.unroll)throw new Ry("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Ry("It is not possible at the moment to stack convolutional cells.");return(r=t.call(this,e)).inputSpec=[new bx({ndim:5})],r}return(0,v.Z)(n,[{key:"call",value:function(e,t){var r=this;return xs((function(){if(null!=r.cell.dropoutMask&&(ks(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(ks(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),t&&t.constants)throw new Ay("ConvRNN2D cell does not support constants");var a=null==t?null:t.mask,s=null==t?null:t.training,u=null==t?null:t.initialState;return o((0,i.Z)(n.prototype),"call",r).call(r,e,{mask:a,training:s,initialState:u})}))}},{key:"computeOutputShape",value:function(e){var t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0]].concat((0,g.Z)(t.slice(2)))),this.returnState&&(t=[t].concat((0,g.Z)(Array(2).fill([e[0]].concat((0,g.Z)(t.slice(-3))))))),t}},{key:"getInitialState",value:function(e){var t=this;return xs((function(){var n=t.cell.stateSize,r=e.shape,a=t.computeSingleOutputShape(r),i=bl([a[0]].concat((0,g.Z)(a.slice(2))));return Array.isArray(n)?Array(n.length).fill(i):[i]}))}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];xs((function(){if(!t.stateful)throw new _y("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape,a=t.computeSingleOutputShape(r),i=[a[0]].concat((0,g.Z)(a.slice(2)));if(null==r[0])throw new Ay("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.getStates())Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return bl(i)})):t.states_=[bl(i)];else if(null==e)ks(t.states_),null!=t.keptStates&&(ks(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return bl(i)})):t.states_[0]=bl(i);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new Ay("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), but it received ").concat(e.length," state value(s). Input received: ").concat(e));n?t.keptStates.push(t.states_.slice()):ks(t.states_);for(var o=0;o<t.states_.length;++o){var s=e[o],u=i;if(!Aa.arraysEqual(s.shape,u))throw new Ay("State ".concat(o," is incompatible with layer ").concat(t.name,": expected shape=").concat(u,", received shape=").concat(s.shape));t.states_[o]=s}}t.states_=t.states_.map((function(e){return ws(e.clone())}))}))}},{key:"computeSingleOutputShape",value:function(e){var t=this.cell,n=t.dataFormat,r=t.filters,a=t.kernelSize,i=t.padding,o=t.strides,s=t.dilationRate,u="channelsFirst"===n,c=e[u?3:2],l=e[u?4:3],p=wI(c,a[0],i,o[0],s[0]),h=wI(l,a[1],i,o[1],s[1]);return[].concat((0,g.Z)(e.slice(0,2)),(0,g.Z)(u?[r,p,h]:[p,h,r]))}}]),n}(WI);JI.className="ConvRNN2D";var QI=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;(0,m.Z)(this,n);var a=e.filters,i=e.kernelSize,o=e.strides,s=e.padding,u=e.dataFormat,c=e.dilationRate;return(r=t.call(this,Object.assign(Object.assign({},e),{units:a}))).filters=a,Yy(r.filters,"filters"),r.kernelSize=kI(i,2,"kernelSize"),r.kernelSize.forEach((function(e){return Yy(e,"kernelSize")})),r.strides=kI(o||1,2,"strides"),r.strides.forEach((function(e){return Yy(e,"strides")})),r.padding=s||"valid",lb(r.padding),r.dataFormat=u||"channelsLast",cb(r.dataFormat),r.dilationRate=kI(c||1,2,"dilationRate"),r.dilationRate.forEach((function(e){return Yy(e,"dilationRate")})),r}return(0,v.Z)(n,[{key:"build",value:function(e){var t;e=dx(e);var n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new Ay("The channel dimension of the input should be defined. Found ".concat(e[n]));var r=e[n],a=this.kernelSize.concat([r,4*this.filters]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);var i=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",i,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){var o;if(this.unitForgetBias){var s=this.biasInitializer,u=this.filters;o=new(t=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"apply",value:function(e,t){return Rb([s.apply([u]),xl([u]),s.apply([2*u])])}}]),n}(Gb),t.className="CustomInit",t)}else o=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,o,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}},{key:"call",value:function(e,t){var n=this;return xs((function(){if(3!==e.length)throw new Ay("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ".concat(e.length,"."));var r=t.training||!1,a=e[0],i=e[1],o=e[2];0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=YI({ones:function(){return Al(a)},rate:n.dropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var s=n.dropoutMask,u=function(e,t,n){return t&&t[n]?Os(t[n],e):e},c=u(a,s,0),l=u(a,s,1),p=u(a,s,2),d=u(a,s,3);0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=YI({ones:function(){return Al(i)},rate:n.recurrentDropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var f=n.recurrentDropoutMask,m=u(i,f,0),v=u(i,f,1),g=u(i,f,2),y=u(i,f,3),b=Vp(n.kernel.read(),4,3),x=(0,h.Z)(b,4),k=x[0],w=x[1],I=x[2],S=x[3],N=n.useBias?Vp(n.bias.read(),4):[null,null,null,null],T=(0,h.Z)(N,4),C=T[0],_=T[1],E=T[2],A=T[3];c=n.inputConv(c,k,C,n.padding),l=n.inputConv(l,w,_,n.padding),p=n.inputConv(p,I,E,n.padding),d=n.inputConv(d,S,A,n.padding);var R=Vp(n.recurrentKernel.read(),4,3),F=(0,h.Z)(R,4),Z=F[0],D=F[1],M=F[2],O=F[3];m=n.recurrentConv(m,Z),v=n.recurrentConv(v,D),g=n.recurrentConv(g,M),y=n.recurrentConv(y,O);var L=n.recurrentActivation.apply(Zs(c,m)),z=n.recurrentActivation.apply(Zs(l,v)),P=Zs(Os(z,o),Os(L,n.activation.apply(Zs(p,g)))),B=Os(n.recurrentActivation.apply(Zs(d,y)),n.activation.apply(P));return[B,B,P]}))}},{key:"getConfig",value:function(){var e=o((0,i.Z)(n.prototype),"getConfig",this).call(this),t=(e.units,function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}(e,["units"])),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},t),r)}},{key:"inputConv",value:function(e,t,n,r){var a=Ou(e,t,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?Pb(a,n,this.dataFormat):a}},{key:"recurrentConv",value:function(e,t){return Ou(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}]),n}(qI);QI.className="ConvLSTM2DCell",Gd.registerClass(QI);var $I=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){(0,m.Z)(this,n);var r=new QI(e);return t.call(this,Object.assign(Object.assign({},e),{cell:r}))}return(0,v.Z)(n,null,[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(JI);$I.className="ConvLSTM2D",Gd.registerClass($I);var eS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,e)).rate=Math.max(Math.min(e.rate,1),0),r.noiseShape=e.noiseShape,r.seed=e.seed,r.supportsMasking=!0,r}return(0,v.Z)(n,[{key:"getNoiseShape",value:function(e){if(null==this.noiseShape)return this.noiseShape;for(var t=e.shape,n=[],r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n}},{key:"call",value:function(e,t){var n=this;return xs((function(){n.invokeCallHook(e,t);var r=hx(e);if(0<n.rate&&n.rate<1){var a=null!=t.training&&t.training,i=n.getNoiseShape(r);return Wb((function(){return Bb(r,n.rate,i,n.seed)}),(function(){return r}),a)}return e}))}},{key:"getConfig",value:function(){var e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"dispose",value:function(){return o((0,i.Z)(n.prototype),"dispose",this).call(this)}}]),n}(Sx);eS.className="Dropout",Gd.registerClass(eS);var tS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,e)).inputSpec=[{ndim:3}],r}return(0,v.Z)(n,[{key:"getNoiseShape",value:function(e){var t=e.shape;return[t[0],1,t[2]]}}]),n}(eS);tS.className="SpatialDropout1D",Gd.registerClass(tS);var nS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;if((0,m.Z)(this,n),(r=t.call(this,e)).activation=null,r.useBias=!0,r.kernel=null,r.bias=null,r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){var a=null;null!=e.batchSize&&(a=e.batchSize),r.batchInputShape=[a,e.inputDim]}return r.units=e.units,Yy(r.units,"units"),r.activation=sI(e.activation),null!=e.useBias&&(r.useBias=e.useBias),r.kernelInitializer=cx(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.biasInitializer=cx(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelConstraint=Hx(e.kernelConstraint),r.biasConstraint=Hx(e.biasConstraint),r.kernelRegularizer=fI(e.kernelRegularizer),r.biasRegularizer=fI(e.biasRegularizer),r.activityRegularizer=fI(e.activityRegularizer),r.supportsMasking=!0,r.inputSpec=[{minNDim:2}],(0,c.Z)(r)}return(0,v.Z)(n,[{key:"build",value:function(e){var t=(e=dx(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(0,a.Z)({},-1,t)}],this.built=!0}},{key:"computeOutputShape",value:function(e){var t=(e=dx(e)).slice();return t[t.length-1]=this.units,t}},{key:"call",value:function(e,t){var n=this;return xs((function(){n.invokeCallHook(e,t);var r,a=hx(e),i=Qy(n.activation.getClassName());return null!=i?r=Mb(a,n.kernel.read(),i,n.bias?n.bias.read():null):(r=Mb(a,n.kernel.read()),null!=n.bias&&(r=Pb(r,n.bias.read())),null!=n.activation&&(r=n.activation.apply(r))),r}))}},{key:"getConfig",value:function(){var e={units:this.units,activation:iI(this.activation),useBias:this.useBias,kernelInitializer:ux(this.kernelInitializer),biasInitializer:ux(this.biasInitializer),kernelRegularizer:hI(this.kernelRegularizer),biasRegularizer:hI(this.biasRegularizer),activityRegularizer:hI(this.activityRegularizer),kernelConstraint:Ux(this.kernelConstraint),biasConstraint:Ux(this.biasConstraint)},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Sx);nS.className="Dense",Gd.registerClass(nS);var rS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),e=e||{},(r=t.call(this,e)).inputSpec=[{minNDim:3}],r.dataFormat=e.dataFormat,r}return(0,v.Z)(n,[{key:"computeOutputShape",value:function(e){e=dx(e);var t,n=(0,y.Z)(e.slice(1));try{for(n.s();!(t=n.n()).done;){if(null==t.value)throw new Ay('The shape of the input to "Flatten" is not fully defined (got '.concat(e.slice(1),'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.'))}}catch(r){n.e(r)}finally{n.f()}return[e[0],kb(e,1)]}},{key:"call",value:function(e,t){var n=this;return xs((function(){n.invokeCallHook(e,t);var r=hx(e);if("channelsFirst"===n.dataFormat&&r.rank>1){for(var a=[0],i=2;i<r.rank;++i)a.push(i);a.push(1),r=fh(r,a)}return function(e){if(e.rank<=1)throw new Ay("batchFlatten requires a minimum rank of 2. Got rank: ".concat(e.rank,"."));var t=[e.shape[0],kb(e.shape,1)];return pu(e,t)}(r)}))}},{key:"getConfig",value:function(){var e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);var t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Sx);rS.className="Flatten",Gd.registerClass(rS);var aS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,e)).supportsMasking=!0,r.activation=sI(e.activation),r}return(0,v.Z)(n,[{key:"call",value:function(e,t){var n=this;return xs((function(){n.invokeCallHook(e,t);var r=hx(e);return n.activation.apply(r)}))}},{key:"getConfig",value:function(){var e={activation:iI(this.activation)},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Sx);aS.className="Activation",Gd.registerClass(aS);var iS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,e)).n=e.n,r.inputSpec=[{ndim:2}],r}return(0,v.Z)(n,[{key:"computeOutputShape",value:function(e){return[e[0],this.n,e[1]]}},{key:"call",value:function(e,t){var n=this;return xs((function(){return function(e,t){return xs((function(){if(2!==e.shape.length)throw new Ay("repeat() expects a rank-2 tensor, but received a rank-".concat(e.shape.length," tensor."));return Zb(Cb(e,1),[1,t,1])}))}(e=hx(e),n.n)}))}},{key:"getConfig",value:function(){var e={n:this.n},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Sx);iS.className="RepeatVector",Gd.registerClass(iS);var oS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;(0,m.Z)(this,n),(r=t.call(this,e)).targetShape=e.targetShape;for(var a=0;a<r.targetShape.length;++a)r.isUnknown(r.targetShape[a])&&(r.targetShape[a]=null);return r}return(0,v.Z)(n,[{key:"isUnknown",value:function(e){return e<0||null==e}},{key:"fixUnknownDimension",value:function(e,t){for(var n="Total size of new array must be unchanged.",r=t.slice(),a=1,i=null,o=0;o<r.length;++o){var s=r[o];if(this.isUnknown(s)){if(null!==i)throw new Ay("Can only specifiy one unknown dimension.");i=o}else a*=s}var u=kb(e);if(null!==i){if(0===a||u%a!==0)throw new Ay(n);r[i]=u/a}else if(u!==a)throw new Ay(n);return r}},{key:"computeOutputShape",value:function(e){for(var t=!1,n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}},{key:"call",value:function(e,t){var n=this;return xs((function(){n.invokeCallHook(e,t);var r=hx(e),a=r.shape,i=a.slice(0,1).concat(n.fixUnknownDimension(a.slice(1),n.targetShape));return pu(r,i)}))}},{key:"getConfig",value:function(){var e={targetShape:this.targetShape},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Sx);oS.className="Reshape",Gd.registerClass(oS);var sS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;if((0,m.Z)(this,n),r=t.call(this,e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received ".concat(e.dims," instead."));var a=Sb(1,e.dims.length+1);if(!Aa.arraysEqual(e.dims.slice().sort(),a))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");return r.dims=e.dims,r.dimsIncludingBatch=[0].concat(r.dims),r.inputSpec=[new bx({ndim:r.dims.length+1})],(0,c.Z)(r)}return(0,v.Z)(n,[{key:"computeOutputShape",value:function(e){var t=(e=dx(e)).slice();return this.dims.forEach((function(n,r){t[r+1]=e[n]})),t}},{key:"call",value:function(e,t){return fh(hx(e),this.dimsIncludingBatch)}},{key:"getConfig",value:function(){var e={dims:this.dims},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Sx);sS.className="Permute",Gd.registerClass(sS);var uS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,r.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0,r}return(0,v.Z)(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=o((0,i.Z)(n.prototype),"getConfig",this).call(this),t={maskValue:this.maskValue};return Object.assign(t,e),t}},{key:"computeMask",value:function(e,t){var n=hx(e);return Vs(_l(n,this.maskValue),-1)}},{key:"call",value:function(e,t){var n=this;return xs((function(){n.invokeCallHook(e,t);var r=hx(e),a=Vs(_l(r,n.maskValue),-1,!0);return Os(r,cs(a,r.dtype))}))}}]),n}(Sx);uS.className="Masking",Gd.registerClass(uS);var cS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;if((0,m.Z)(this,n),(r=t.call(this,e)).embeddings=null,r.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){var a=null;null!=e.batchSize&&(a=e.batchSize),null==e.inputLength?r.batchInputShape=[a,null]:r.batchInputShape=[a].concat(zy(e.inputLength))}return r.inputDim=e.inputDim,Yy(r.inputDim,"inputDim"),r.outputDim=e.outputDim,Yy(r.outputDim,"outputDim"),r.embeddingsInitializer=cx(e.embeddingsInitializer||r.DEFAULT_EMBEDDINGS_INITIALIZER),r.embeddingsRegularizer=fI(e.embeddingsRegularizer),r.activityRegularizer=fI(e.activityRegularizer),r.embeddingsConstraint=Hx(e.embeddingsConstraint),r.maskZero=e.maskZero,r.supportsMasking=e.maskZero,r.inputLength=e.inputLength,(0,c.Z)(r)}return(0,v.Z)(n,[{key:"build",value:function(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}},{key:"warnOnIncompatibleInputShape",value:function(e){}},{key:"computeMask",value:function(e,t){var n=this;return xs((function(){return n.maskZero?(e=hx(e),_l(e,ac(e))):null}))}},{key:"computeOutputShape",value:function(e){if(e=dx(e),null==this.inputLength)return[].concat((0,g.Z)(e),[this.outputDim]);var t=zy(this.inputLength);if(t.length!==e.length-1)throw new Ay('"inputLength" is '.concat(this.inputLength,", but received input shape has shape ").concat(e));for(var n=0,r=0;r<t.length;++r){var a=t[r],i=e[r+1];if(null!=a&&null!=i&&a!==i)throw new Ay('"inputLength" is '.concat(this.inputLength,", but received input shape has shape ").concat(e));null==a&&(t[n]=i),n++}return[e[0]].concat((0,g.Z)(t),[this.outputDim])}},{key:"call",value:function(e,t){var n=this;return xs((function(){n.invokeCallHook(e,t);var r=hx(e);"int32"!==r.dtype&&(r=Tb(r,"int32"));var a=Ob(n.embeddings.read(),pu(r,[r.size]));return pu(a,dx(n.computeOutputShape(r.shape)))}))}},{key:"getConfig",value:function(){var e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:ux(this.embeddingsInitializer),embeddingsRegularizer:hI(this.embeddingsRegularizer),activityRegularizer:hI(this.activityRegularizer),embeddingsConstraint:Ux(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Sx);cS.className="Embedding",Gd.registerClass(cS);var lS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,e||{})).supportsMasking=!0,r}return(0,v.Z)(n,[{key:"mergeFunction",value:function(e){throw new Ry}},{key:"computeElementwiseOpOutputShape",value:function(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;for(var n=e.slice(0,e.length-t.length),r=0;r<t.length;++r){var a=e[e.length-t.length+r],i=t[r];if(null==a||null==i||a<0||i<0)n.push(null);else if(1===a)n.push(i);else if(1===i)n.push(a);else{if(a!==i)throw new Ay("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(a)}}return n}},{key:"build",value:function(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[dx(e)]),e.length<2)throw new Ay("A merge layer should be called on an Array of at least 2 inputs. Got ".concat(e.length," input(s)."));var t,n=[],r=(0,y.Z)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;null!=a&&null!==a[0]&&n.push(a[0])}}catch(c){r.e(c)}finally{r.f()}if((n=jy(n)).length>1)throw new Ay("Can not merge tensors with different batch sizes. Got tensors with shapes: ".concat(JSON.stringify(e),"."));for(var i=null==e[0]?null:e[0].slice(1),o=1;o<e.length;++o){var s=null==e[o]?null:e[o].slice(1);i=this.computeElementwiseOpOutputShape(i,s)}var u=e.map((function(e){return e.length}));-1===e.indexOf(null)&&1===jy(u).length?this.reshapeRequired=!1:this.reshapeRequired=!0}},{key:"call",value:function(e,t){var n=this;return xs((function(){if(n.reshapeRequired){var t=[],r=e.map((function(e){return e.rank}));if(-1===r.indexOf(null)){var a,i=Ib(r),o=(0,y.Z)(e);try{for(o.s();!(a=o.n()).done;){for(var s=a.value,u=s.rank,c=0;c<i-u;++c)s=Cb(s,1);t.push(s)}}catch(C){o.e(C)}finally{o.f()}return n.mergeFunction(t)}var l,p=!1,h=(0,y.Z)(e);try{for(h.s();!(l=h.n()).done;){var d=l.value,f=d.rank;if(null==f){var m=d.shape,v=m[0],g=m.slice(1).concat([v]),b=pu(d,[v].concat(kb(m.slice(1))));b=fh(b,[1,0]),b=pu(b,g),t.push(b),p=!0}else if(f>1){var x=Sb(1,f).concat([0]);t.push(fh(d,x)),p=!0}else t.push(d)}}catch(C){h.e(C)}finally{h.f()}var k=n.mergeFunction(t),w=k.rank;if(p)if(null==w){var I=k.shape,S=I[I.length-1],N=[S].concat(I.slice(0,I.length-1));k=pu(fh(pu(k,[-1,S]),[1,0]),N)}else if(w>1){var T=[w-1].concat(Sb(0,w-1));k=fh(k,T)}return k}return n.mergeFunction(e)}))}},{key:"computeOutputShape",value:function(e){var t;t=null==e[0]?null:e[0].slice(1);for(var n=1;n<e.length;++n){var r=null==e[n]?null:e[n].slice(1);t=this.computeElementwiseOpOutputShape(t,r)}var a,i=[],o=(0,y.Z)(e);try{for(o.s();!(a=o.n()).done;){var s=a.value;null!=s&&null!==s[0]&&i.push(s[0])}}catch(u){o.e(u)}finally{o.f()}return t=1===(i=jy(i)).length?i.concat(t):[null].concat(t)}},{key:"computeMask",value:function(e,t){return xs((function(){if(null==t)return null;if(!Array.isArray(t))throw new Ay("`mask` should be an Array");if(!Array.isArray(e))throw new Ay("`inputs` should be an Array");if(t.length!==e.length)throw new Ay("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (".concat(e.length," vs ").concat(t.length,")"));if(t.every((function(e){return null==e})))return null;t=t.map((function(e){return null==e?e:Ec(e,0)}));for(var n=t[0],r=1;r<t.length-1;++r)n=sl(n,t[r]);return n}))}}]),n}(Sx),pS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){return(0,m.Z)(this,n),t.call(this,e)}return(0,v.Z)(n,[{key:"mergeFunction",value:function(e){return xs((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=Zs(t,e[n]);return t}))}}]),n}(lS);pS.className="Add",Gd.registerClass(pS);var hS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){return(0,m.Z)(this,n),t.call(this,e)}return(0,v.Z)(n,[{key:"mergeFunction",value:function(e){return xs((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=Os(t,e[n]);return t}))}}]),n}(lS);hS.className="Multiply",Gd.registerClass(hS);var dS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){return(0,m.Z)(this,n),t.call(this,e)}return(0,v.Z)(n,[{key:"mergeFunction",value:function(e){return xs((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=Zs(t,e[n]);return Os(1/e.length,t)}))}}]),n}(lS);dS.className="Average",Gd.registerClass(dS);var fS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){return(0,m.Z)(this,n),t.call(this,e)}return(0,v.Z)(n,[{key:"mergeFunction",value:function(e){return xs((function(){for(var t=e[0],n=1;n<e.length;++n)t=gl(t,e[n]);return t}))}}]),n}(lS);fS.className="Maximum",Gd.registerClass(fS);var mS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){return(0,m.Z)(this,n),t.call(this,e)}return(0,v.Z)(n,[{key:"mergeFunction",value:function(e){return xs((function(){for(var t=e[0],n=1;n<e.length;++n)t=wl(t,e[n]);return t}))}}]),n}(lS);mS.className="Minimum",Gd.registerClass(mS);var vS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,e)).DEFAULT_AXIS=-1,null==e&&(e={}),r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r.supportsMasking=!0,r.reshapeRequired=!1,r}return(0,v.Z)(n,[{key:"build",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new Ay("A `Concatenate` layer should be called on a list of at least 2 inputs");var t,n=!0,r=(0,y.Z)(e);try{for(r.s();!(t=r.n()).done;){if(null!=t.value){n=!1;break}}}catch(p){r.e(p)}finally{r.f()}if(!n){for(var a=[],i=0;i<e.length;++i){var o=e[i].slice();o.splice(this.axis,1);var s,u=!1,c=(0,y.Z)(a);try{for(c.s();!(s=c.n()).done;){var l=s.value;if(Aa.arraysEqual(l,o)){u=!0;break}}}catch(p){c.e(p)}finally{c.f()}u||a.push(o)}if(a.length>1)throw new Ay("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}}},{key:"mergeFunction",value:function(e){var t=this;return xs((function(){return Rb(e,t.axis)}))}},{key:"computeOutputShape",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new Ay("A `Concatenate` layer should be called on a list of inputs.");var t,n=e,r=n[0].slice(),a=this.axis<0?r.length+this.axis:this.axis,i=(0,y.Z)(n.slice(1));try{for(i.s();!(t=i.n()).done;){var o=t.value;if(null==r[a]||null==o[a]){r[a]=null;break}r[a]+=o[a]}}catch(s){i.e(s)}finally{i.f()}return r}},{key:"computeMask",value:function(e,t){var n=this;if(null==t)return null;if(!Array.isArray(t))throw new Ay("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new Ay("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new Ay("Mismatch in the length of mask (".concat(t.length,") and the legnth of inputs (").concat(e.length,")"));return xs((function(){var r=!0;if(t.forEach((function(e){null==e||(r=!1)})),r)return null;for(var a=[],i=0;i<e.length;++i)null==t[i]?a.push(cs(Al(e[i]),"bool")):t[i].rank<e[i].rank?a.push(Ec(t[i],-1)):a.push(t[i]);var o=fu(a,n.axis);return Ws(o,-1,!1)}))}},{key:"getConfig",value:function(){var e={axis:this.axis},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(lS);function gS(e,t){for(;e<0;)e+=t;return e}vS.className="Concatenate",Gd.registerClass(vS);var yS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,e)).axes=e.axes,r.normalize=null!=e.normalize&&e.normalize,r.supportsMasking=!0,r.reshapeRequired=!1,r}return(0,v.Z)(n,[{key:"build",value:function(e){Aa.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0],n=e[1];if(t.length>3||n.length>3)throw new Ry("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);if(t[r[0]]!==n[r[1]])throw new Ay("Dimension incompatibility: ".concat(t[r[0]]," !== ").concat(n[r[1]]))}},{key:"mergeFunction",value:function(e){if(2!==e.length)throw new Ay("A `Dot` layer must be called on exactly 2 inputs, but received ".concat(e.length," input(s)."));var t,n=e[0],r=e[1];return t=Array.isArray(this.axes)?this.axes.map((function(t,n){return gS(t,e[n].shape.length)})):[gS(this.axes,n.shape.length),gS(this.axes,r.shape.length)],this.normalize&&(n=Ck(n,t[0]),r=Ck(r,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new Ry("batchDot is not implemented for tensors of 4D or higher rank yet");if(Aa.assert(e.shape.length>=2,(function(){return"batchDot requires the rank of x to be >= 2, but got ".concat(e.shape.length)})),Aa.assert(e.shape.length>=2,(function(){return"batchDot requires the rank of y to be >= 2, but got ".concat(t.shape.length)})),"number"==typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new Ry("batchDot is not implemented for complex64-type Tensors yet.");var r=e.shape.length,a=t.shape.length;null==n&&(n=[r-1,a-2]);var i=n;return xs((function(){var n,o;if(r>a){n=r-a;for(var s=[],u=0;u<n;++u)s.push(1);t=pu(t,t.shape.concat(s))}else if(a>r){n=a-r;for(var c=[],l=0;l<n;++l)c.push(1);e=pu(e,e.shape.concat(c))}else n=0;if(2===e.shape.length&&2===t.shape.length)o=i[0]===i[1]?Sc(Os(e,t),i[0]):Sc(Os(fh(e,[1,0]),t),i[1]);else{var p=i[0]!==e.shape.length-1,h=i[1]===t.shape.length-1;o=mu(e,t,p,h)}if(n>0){for(var d,f=[],m=d=r>a?r+a-3:r-1;m<d+n;++m)f.push(m);o=Hp(o,f)}return 1===o.shape.length&&(o=Ec(o,1)),o}))}(n,r,t)}},{key:"interpretAxes",value:function(e,t){return Array.isArray(this.axes)?this.axes:[gS(this.axes,e.length),gS(this.axes,t.length)]}},{key:"computeOutputShape",value:function(e){Aa.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new Ry("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);t.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);var a=t.concat(n);return 1===a.length&&a.push(1),a}},{key:"computeMask",value:function(e,t){return null}},{key:"getConfig",value:function(){var e={axes:this.axes,normalize:this.normalize},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(lS);yS.className="Dot",Gd.registerClass(yS);var bS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,e)).supportsMasking=!0,r.stddev=e.stddev,r}return(0,v.Z)(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=o((0,i.Z)(n.prototype),"getConfig",this).call(this),t={stddev:this.stddev};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return xs((function(){n.invokeCallHook(e,t);var r=hx(e);return Wb((function(){return Zs(Db(r.shape,0,n.stddev),r)}),(function(){return r}),t.training||!1)}))}}]),n}(Sx);bS.className="GaussianNoise",Gd.registerClass(bS);var xS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r}return(0,v.Z)(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=o((0,i.Z)(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return xs((function(){n.invokeCallHook(e,t);var r=hx(e);return n.rate>0&&n.rate<1?Wb((function(){var e=Math.sqrt(n.rate/(1-n.rate));return Os(r,Db(r.shape,1,e))}),(function(){return r}),t.training||!1):r}))}}]),n}(Sx);xS.className="GaussianDropout",Gd.registerClass(xS);var kS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r.noiseShape=e.noiseShape,r}return(0,v.Z)(n,[{key:"_getNoiseShape",value:function(e){return this.noiseShape||hx(e).shape}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=o((0,i.Z)(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return xs((function(){if(n.rate<1&&n.rate>0){var r=n._getNoiseShape(e);return Wb((function(){var t=hx(e),a=-1.7580993408473766,i=Oc(fp(r),n.rate);i=Tb(i,"float32");var o=Math.pow((1-n.rate)*(1+n.rate*Math.pow(a,2)),-.5),s=-o*a*n.rate,u=Zs(Os(t,i),Os(Zs(i,-1),a));return Zs(Os(u,o),s)}),(function(){return hx(e)}),t.training||!1)}return e}))}}]),n}(Sx);function wS(e,t,n,r,a){var i,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.001;if(2===e.rank)i=Iu(e,t,n,r,a,o);else if(3===e.rank)i=Su(e,t,n,r,a,o);else{if(4!==e.rank)throw new Ry("batchNormalization is not implemented for array of rank ".concat(e.rank," yet"));i=Nu(e,t,n,r,a,o)}return i}function IS(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return Aa.arraysEqual(r.slice().sort(),Sb(0,e.rank-1))?function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return xs((function(){var i=Nl(e,r),o=i.mean,s=i.variance;return[wS(e,o,s,n,t,a),o,s]}))}(e,t,n,r,a):function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return xs((function(){var i,o=Nl(e,r),s=o.mean,u=o.variance,c=[],l=(0,y.Z)(Sb(0,e.rank));try{for(l.s();!(i=l.n()).done;){var p=i.value;-1!==r.indexOf(p)?c.push(1):c.push(e.shape[p])}}catch(v){l.e(v)}finally{l.f()}var h=pu(s,c),d=pu(u,c),f=null==t?null:pu(t,c),m=null==n?null:pu(n,c);return[wS(e,h,d,m,f,a),s,u]}))}(e,t,n,r,a)}kS.className="AlphaDropout",Gd.registerClass(kS);var SS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),null==e&&(e={}),(r=t.call(this,e)).supportsMasking=!0,r.axis=null==e.axis?-1:e.axis,r.momentum=null==e.momentum?.99:e.momentum,r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=cx(e.betaInitializer||"zeros"),r.gammaInitializer=cx(e.gammaInitializer||"ones"),r.movingMeanInitializer=cx(e.movingMeanInitializer||"zeros"),r.movingVarianceInitializer=cx(e.movingVarianceInitializer||"ones"),r.betaConstraint=Hx(e.betaConstraint),r.gammaConstraint=Hx(e.gammaConstraint),r.betaRegularizer=fI(e.betaRegularizer),r.gammaRegularizer=fI(e.gammaRegularizer),r}return(0,v.Z)(n,[{key:"build",value:function(e){e=dx(e);var t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new Ay("Axis ".concat(t," of input tensor should have a defined dimension but the layer received an input with shape ").concat(JSON.stringify(e),"."));this.inputSpec=[new bx({ndim:e.length,axes:(0,a.Z)({},t,n)})];var r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}},{key:"call",value:function(e,t){var n=this;return xs((function(){var r=null!=t.training&&t.training,a=hx(e),i=a.shape,o=i.length,s=Sb(0,o),u=n.axis>=0?n.axis:n.axis+o;s.splice(u,1);var c=Dy(1,o);c[u]=i[u];var l=s.slice();l.sort();var p=!Aa.arraysEqual(l,Sb(0,o).slice(0,o-1));if(!r)return function(){if(p){var e=pu(n.movingMean.read(),c),t=pu(n.movingVariance.read(),c),r=n.center?pu(n.beta.read(),c):null,i=n.scale?pu(n.gamma.read(),c):null;return wS(a,e,t,r,i,n.epsilon)}return wS(a,n.movingMean.read(),n.movingVariance.read(),null==n.beta?null:n.beta.read(),null==n.gamma?null:n.gamma.read(),n.epsilon)}();var d=IS(a,n.gamma.read(),n.beta.read(),s,n.epsilon),f=(0,h.Z)(d,3),m=f[0],v=f[1],g=f[2],y=function(e,t,n){xs((function(){var r=1-n,a=e.read(),i=Os(al(a,t),r);e.write(al(a,i))}))};return y(n.movingMean,v,n.momentum),y(n.movingVariance,g,n.momentum),m}))}},{key:"getConfig",value:function(){var e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:ux(this.betaInitializer),gammaInitializer:ux(this.gammaInitializer),movingMeanInitializer:ux(this.movingMeanInitializer),movingVarianceInitializer:ux(this.movingVarianceInitializer),betaRegularizer:hI(this.betaRegularizer),gammaRegularizer:hI(this.gammaRegularizer),betaConstraint:Ux(this.betaConstraint),gammaConstraint:Ux(this.gammaConstraint)},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Sx);SS.className="BatchNormalization",Gd.registerClass(SS);var NS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;if((0,m.Z)(this,n),null==e&&(e={}),(r=t.call(this,e)).axis=null==e.axis?-1:e.axis,"number"==typeof r.axis){if(!Number.isInteger(r.axis))throw new Error("Expected axis to be an integer, but received ".concat(r.axis))}else{if(!Array.isArray(r.axis))throw new Error("Expected axis to be an integer or an array of integers, but received ".concat(JSON.stringify(r.axis)));var a,i=(0,y.Z)(r.axis);try{for(i.s();!(a=i.n()).done;){var o=a.value;if(!Number.isInteger(o))throw new Error("Expected axis to be an array of integers, but received ".concat(JSON.stringify(r.axis)))}}catch(s){i.e(s)}finally{i.f()}}return r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=cx(e.betaInitializer||"zeros"),r.gammaInitializer=cx(e.gammaInitializer||"ones"),r.betaRegularizer=fI(e.betaRegularizer),r.gammaRegularizer=fI(e.gammaRegularizer),r.supportsMasking=!0,(0,c.Z)(r)}return(0,v.Z)(n,[{key:"build",value:function(e){var t=(e=dx(e)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(var n=0;n<this.axis.length;++n)this.axis[n]<0&&(this.axis[n]+=t);var r,a=(0,y.Z)(this.axis);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i<0||i>=t)throw new Error("Invalid axis: ".concat(i))}}catch(s){a.e(s)}finally{a.f()}if(this.axis.length!==jy(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));var o=this.axis.map((function(t){return e[t]}));this.scale?this.gamma=this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,true):this.gamma=null,this.center?this.beta=this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,true):this.beta=null,this.built=!0}},{key:"call",value:function(e,t){var n=this,r=hx(e),a=r.shape,i=a.length;return xs((function(){var e,t=Nl(r,n.axis,!0),o=t.mean,s=t.variance,u=Dy(1,i),c=(0,y.Z)(n.axis);try{for(c.s();!(e=c.n()).done;){var l=e.value;u[l]=a[l]}}catch(g){c.e(g)}finally{c.f()}for(var p=function(e){return null!=e&&e.shape.length!==i?pu(e,u):e},h=n.scale?p(n.gamma.read()):null,d=n.center?p(n.beta.read()):null,f=[],m=[],v=0;v<i;++v)-1!==n.axis.indexOf(v)?(f.push(a[v]),m.push(1)):(f.push(1),m.push(a[v]));return o=Rc(o,f),s=Rc(s,f),null!=h&&(h=Rc(h,m)),null!=d&&(d=Rc(d,m)),wS(r,o,s,d,h,n.epsilon)}))}},{key:"getConfig",value:function(){var e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:ux(this.betaInitializer),gammaInitializer:ux(this.gammaInitializer),betaRegularizer:hI(this.betaRegularizer),gammaRegularizer:hI(this.gammaRegularizer)},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Sx);NS.className="LayerNormalization",Gd.registerClass(NS);var TS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;if((0,m.Z)(this,n),null==e&&(e={}),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)r.padding=[[1,1],[1,1]];else if("number"==typeof e.padding)r.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new Ay("ZeroPadding2D expects padding to be a length-2 array, but received a length-".concat(e.padding.length," array."));var a,i;if("number"==typeof e.padding[0])a=[e.padding[0],e.padding[0]],i=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new Ay("ZeroPadding2D expects height padding to be a length-2 array, but received a length-".concat(e.padding[0].length," array."));if(a=e.padding[0],2!==e.padding[1].length)throw new Ay("ZeroPadding2D expects width padding to be a length-2 array, but received a length-".concat(e.padding[1].length," array."));i=e.padding[1]}r.padding=[a,i]}return r.inputSpec=[new bx({ndim:4})],(0,c.Z)(r)}return(0,v.Z)(n,[{key:"computeOutputShape",value:function(e){var t,n;return e=dx(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}},{key:"call",value:function(e,t){var n=this;return xs((function(){return function(e,t,n){return xs((function(){if(4!==e.rank)throw new Ay("temporalPadding expects input tensor to be 4-D, but received a ".concat(e.rank,"-D tensor."));if(null==t&&(t=[[1,1],[1,1]]),2!==t.length||2!==t[0].length||2!==t[1].length)throw new Ay("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==n&&(n="channelsLast"),"channelsLast"!==n&&"channelsFirst"!==n)throw new Ay("Unknown data format: ".concat(n,". Supported data formats are 'channelsLast' and 'channelsFirst."));var r;return r="channelsFirst"===n?[[0,0],[0,0],t[0],t[1]]:[[0,0],t[0],t[1],[0,0]],Fl(e,r)}))}(hx(e),n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={padding:this.padding,dataFormat:this.dataFormat},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Sx);function CS(e,t,n,r,a,i){return xs((function(){cb(a),pb(i),lb(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=SI(e,a);var o,s="same"===r?"same":"valid";return o="max"===i?fl(e,t,n,s):hu(e,t,n,s),"channelsFirst"===a&&(o=fh(o,[0,3,1,2])),o}))}function _S(e,t,n,r,a,i){return xs((function(){cb(a),pb(i),lb(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=NI(e,a);var o,s="same"===r?"same":"valid";return o="max"===i?ml(e,t,n,s):du(e,t,n,s),"channelsFirst"===a&&(o=fh(o,[0,4,1,2,3])),o}))}TS.className="ZeroPadding2D",Gd.registerClass(TS);var ES=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;if((0,m.Z)(this,n),null==e.poolSize&&(e.poolSize=2),r=t.call(this,e),"number"==typeof e.poolSize)r.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!=typeof e.poolSize[0])throw new Ay("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ".concat(JSON.stringify(e.poolSize)));r.poolSize=e.poolSize}if(Yy(r.poolSize,"poolSize"),null==e.strides)r.strides=r.poolSize;else if("number"==typeof e.strides)r.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!=typeof e.strides[0])throw new Ay("strides for 1D convolutional layer must be a number or an Array of a single number, but received ".concat(JSON.stringify(e.strides)));r.strides=e.strides}return Yy(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,lb(r.padding),r.inputSpec=[new bx({ndim:3})],(0,c.Z)(r)}return(0,v.Z)(n,[{key:"computeOutputShape",value:function(e){var t=wI((e=dx(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}},{key:"call",value:function(e,t){var n=this;return xs((function(){n.invokeCallHook(e,t),e=Cb(hx(e),2);var r=n.poolingFunction(hx(e),[n.poolSize[0],1],[n.strides[0],1],n.padding,"channelsLast");return Hp(r,[2])}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Sx),AS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){return(0,m.Z)(this,n),t.call(this,e)}return(0,v.Z)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return cb(a),lb(r),CS(e,t,n,r,a,"max")}}]),n}(ES);AS.className="MaxPooling1D",Gd.registerClass(AS);var RS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){return(0,m.Z)(this,n),t.call(this,e)}return(0,v.Z)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return cb(a),lb(r),CS(e,t,n,r,a,"avg")}}]),n}(ES);RS.className="AveragePooling1D",Gd.registerClass(RS);var FS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;if((0,m.Z)(this,n),null==e.poolSize&&(e.poolSize=[2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new Ay("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides];return Yy(r.poolSize,"poolSize"),Yy(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,cb(r.dataFormat),lb(r.padding),r.inputSpec=[new bx({ndim:4})],(0,c.Z)(r)}return(0,v.Z)(n,[{key:"computeOutputShape",value:function(e){e=dx(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=wI(t,this.poolSize[0],this.padding,this.strides[0]),n=wI(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}},{key:"call",value:function(e,t){var n=this;return xs((function(){return n.invokeCallHook(e,t),n.poolingFunction(hx(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Sx),ZS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){return(0,m.Z)(this,n),t.call(this,e)}return(0,v.Z)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return cb(a),lb(r),CS(e,t,n,r,a,"max")}}]),n}(FS);ZS.className="MaxPooling2D",Gd.registerClass(ZS);var DS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){return(0,m.Z)(this,n),t.call(this,e)}return(0,v.Z)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return cb(a),lb(r),CS(e,t,n,r,a,"avg")}}]),n}(FS);DS.className="AveragePooling2D",Gd.registerClass(DS);var MS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;if((0,m.Z)(this,n),null==e.poolSize&&(e.poolSize=[2,2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new Ay("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides,e.strides];return Yy(r.poolSize,"poolSize"),Yy(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,cb(r.dataFormat),lb(r.padding),r.inputSpec=[new bx({ndim:5})],(0,c.Z)(r)}return(0,v.Z)(n,[{key:"computeOutputShape",value:function(e){e=dx(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=wI(t,this.poolSize[0],this.padding,this.strides[0]),n=wI(n,this.poolSize[1],this.padding,this.strides[1]),r=wI(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}},{key:"call",value:function(e,t){var n=this;return xs((function(){return n.invokeCallHook(e,t),n.poolingFunction(hx(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Sx),OS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){return(0,m.Z)(this,n),t.call(this,e)}return(0,v.Z)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return cb(a),lb(r),_S(e,t,n,r,a,"max")}}]),n}(MS);OS.className="MaxPooling3D",Gd.registerClass(OS);var LS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){return(0,m.Z)(this,n),t.call(this,e)}return(0,v.Z)(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return cb(a),lb(r),_S(e,t,n,r,a,"avg")}}]),n}(MS);LS.className="AveragePooling3D",Gd.registerClass(LS);var zS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,e)).inputSpec=[new bx({ndim:3})],r}return(0,v.Z)(n,[{key:"computeOutputShape",value:function(e){return[e[0],e[2]]}},{key:"call",value:function(e,t){throw new Ry}}]),n}(Sx),PS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){return(0,m.Z)(this,n),t.call(this,e||{})}return(0,v.Z)(n,[{key:"call",value:function(e,t){return xs((function(){var t=hx(e);return yl(t,1)}))}}]),n}(zS);PS.className="GlobalAveragePooling1D",Gd.registerClass(PS);var BS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){return(0,m.Z)(this,n),t.call(this,e||{})}return(0,v.Z)(n,[{key:"call",value:function(e,t){return xs((function(){var t=hx(e);return yc(t,1)}))}}]),n}(zS);BS.className="GlobalMaxPooling1D",Gd.registerClass(BS);var WS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,cb(r.dataFormat),r.inputSpec=[new bx({ndim:4})],r}return(0,v.Z)(n,[{key:"computeOutputShape",value:function(e){return"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}},{key:"call",value:function(e,t){throw new Ry}},{key:"getConfig",value:function(){var e={dataFormat:this.dataFormat},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Sx),VS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"call",value:function(e,t){var n=this;return xs((function(){var t=hx(e);return"channelsLast"===n.dataFormat?yl(t,[1,2]):yl(t,[2,3])}))}}]),n}(WS);VS.className="GlobalAveragePooling2D",Gd.registerClass(VS);var US=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"call",value:function(e,t){var n=this;return xs((function(){var t=hx(e);return"channelsLast"===n.dataFormat?yc(t,[1,2]):yc(t,[2,3])}))}}]),n}(WS);US.className="GlobalMaxPooling2D",Gd.registerClass(US);var GS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,e)).layer=e.layer,r}return(0,v.Z)(n,[{key:"build",value:function(e){this.built=!0}},{key:"trainable",get:function(){return null!=this.layer&&this.layer.trainable},set:function(e){null!=this.layer&&(this.layer.trainable=e)}},{key:"trainableWeights",get:function(){return this.layer.trainableWeights}},{key:"nonTrainableWeights",get:function(){return this.layer.nonTrainableWeights}},{key:"updates",get:function(){return this.layer._updates}},{key:"losses",get:function(){return this.layer.losses}},{key:"getWeights",value:function(){return this.layer.getWeights()}},{key:"setWeights",value:function(e){this.layer.setWeights(e)}},{key:"getConfig",value:function(){var e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"setFastWeightInitDuringBuild",value:function(e){o((0,i.Z)(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Tk(t.layer,n);delete t.layer;var a={layer:r};return Object.assign(a,t),new e(a)}}]),n}(Sx),HS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,e)).supportsMasking=!0,r}return(0,v.Z)(n,[{key:"build",value:function(e){if((e=dx(e)).length<3)throw new Ay("TimeDistributed layer expects an input shape >= 3D, but received input shape ".concat(JSON.stringify(e)));this.inputSpec=[{shape:e}];var t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),o((0,i.Z)(n.prototype),"build",this).call(this,e)}},{key:"computeOutputShape",value:function(e){var t=[(e=dx(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),r=e[1];return[n[0],r].concat(n.slice(1))}},{key:"call",value:function(e,t){var n=this;return xs((function(){return BI((function(e,r){return[hx(n.layer.call(e,t)),[]]}),e=hx(e),[],!1,null,null,!1,!0)[1]}))}}]),n}(GS);HS.className="TimeDistributed",Gd.registerClass(HS);var jS="concat",qS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;(0,m.Z)(this,n),r=t.call(this,e);var a=e.layer.getConfig(),i={};i.className=e.layer.getClassName(),i.config=a,r.forwardLayer=Tk(i),a.goBackwards=!0!==a.goBackwards;var o={};if(o.className=e.layer.getClassName(),o.config=a,r.backwardLayer=Tk(o),r.forwardLayer.name="forward_"+r.forwardLayer.name,r.backwardLayer.name="backward_"+r.backwardLayer.name,r.mergeMode=void 0===e.mergeMode?jS:e.mergeMode,function(e){Ky(sb,"BidirectionalMergeMode",e)}(r.mergeMode),e.weights)throw new Ry("weights support is not implemented for Bidirectional layer yet.");return r._stateful=e.layer.stateful,r.returnSequences=e.layer.returnSequences,r.returnState=e.layer.returnState,r.supportsMasking=!0,r._trainable=!0,r.inputSpec=e.layer.inputSpec,r.numConstants=null,r}return(0,v.Z)(n,[{key:"trainable",get:function(){return this._trainable},set:function(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}},{key:"getWeights",value:function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}},{key:"setWeights",value:function(e){var t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=this.forwardLayer.computeOutputShape(e);return Array.isArray(a)&&Array.isArray(a[0])||(a=[a]),this.returnState&&(r=a.slice(1)),t=a[0],"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):Ly(n)}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var s=PI(e,r,a,this.numConstants);if(e=s.inputs,r=s.initialState,a=s.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(null==r||0===r.length)&&null==a)return o((0,i.Z)(n.prototype),"apply",this).call(this,e,t);var u=[],c=[];if(null!=r){var l=r.length;if(l%2>0)throw new Ay("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=r,u.push.apply(u,(0,g.Z)(r));var p=r.map((function(e){return new bx({shape:e.shape})}));this.forwardLayer.stateSpec=p.slice(0,l/2),this.backwardLayer.stateSpec=p.slice(l/2),c.push.apply(c,(0,g.Z)(p))}if(null!=a)throw new Ry("Support for constants in Bidirectional layers is not implemented yet.");for(var h=u[0]instanceof xx,d=0,f=u;d<f.length;d++){if(f[d]instanceof xx!==h)throw new Ay("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}if(h){var m=[e].concat(u),v=this.inputSpec.concat(c),y=this.inputSpec;this.inputSpec=v;var b=o((0,i.Z)(n.prototype),"apply",this).call(this,m,t);return this.inputSpec=y,b}return o((0,i.Z)(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return xs((function(){var r,a,i,o,s=t.initialState;if(null==s)r=n.forwardLayer.call(e,t),a=n.backwardLayer.call(e,t);else{var u=s.slice(0,s.length/2),c=s.slice(s.length/2);r=n.forwardLayer.call(e,Object.assign(t,{initialState:u})),a=n.backwardLayer.call(e,Object.assign(t,{initialState:c}))}return n.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(a.slice(1))),r=r[0],a=a[0]),n.returnSequences&&(a=xp(a,1)),"concat"===n.mergeMode?o=Rb([r,a]):"sum"===n.mergeMode?o=Zs(r,a):"ave"===n.mergeMode?o=Os(.5,Zs(r,a)):"mul"===n.mergeMode?o=Os(r,a):null==n.mergeMode&&(o=[r,a]),n.returnState?null==n.mergeMode?o.concat(i):[o].concat(i):o}))}},{key:"resetStates",value:function(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}},{key:"build",value:function(e){var t=this;fb(this.forwardLayer.name,(function(){t.forwardLayer.build(e)})),fb(this.backwardLayer.name,(function(){t.backwardLayer.build(e)})),this.built=!0}},{key:"computeMask",value:function(e,t){var n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){var r=this.forwardLayer.states.map((function(e){return null}));return Array.isArray(n)?n.concat(r).concat(r):[n].concat(r).concat(r)}return n}},{key:"trainableWeights",get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}},{key:"nonTrainableWeights",get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}},{key:"setFastWeightInitDuringBuild",value:function(e){o((0,i.Z)(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e={mergeMode:this.mergeMode},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"fromConfig",value:function(e,t){var n=Tk(t.layer);if(delete t.layer,null!=t.numConstants)throw new Ry("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var r=t;return r.layer=n,new e(r)}}]),n}(GS);qS.className="Bidirectional",Gd.registerClass(qS);var KS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,e)).scale=e.scale,e.offset?r.offset=e.offset:r.offset=0,r}return(0,v.Z)(n,[{key:"getConfig",value:function(){var e={scale:this.scale,offset:this.offset},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"call",value:function(e,t){var n=this;return xs((function(){return"float32"!==(e=hx(e)).dtype&&(e=Tb(e,"float32")),Zs(Os(e,n.scale),n.offset)}))}}]),n}(Sx);KS.className="Rescaling",Gd.registerClass(KS);var XS=Pd.resizeBilinear,YS=Pd.cropAndResize,JS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,e)).height=e.height,r.width=e.width,r}return(0,v.Z)(n,[{key:"centerCrop",value:function(e,t,n,r,a,i,o,s){return xs((function(){var u,c=!1,l=[t/i,n/o,(r+t)/i,(a+n)/o],p=[];3===e.rank?(c=!0,u=jp([e])):u=e;for(var h=0;h<u.shape[0];h++)p.push(l);var d=Yi(p,[p.length,4]),f=mp(0,p.length,1,"int32"),m=YS(u,d,f,[r,a],"nearest");return Tb(c?hx(oh(m)):m,s)}))}},{key:"upsize",value:function(e,t,n,r){return xs((function(){return Tb(XS(e,[t,n]),r)}))}},{key:"call",value:function(e,t){var n=this;return xs((function(){var t=hx(e),r=t.dtype,a=t.shape,i=a[a.length-3],o=a[a.length-2],s=0;i!==n.height&&(s=Math.floor((i-n.height)/2));var u=0;return o!==n.width&&(0===(u=Math.floor((o-n.width)/2))&&(u=1)),s>=0&&u>=0?n.centerCrop(t,s,u,n.height,n.width,i,o,r):n.upsize(e,n.height,n.width,r)}))}},{key:"getConfig",value:function(){var e={height:this.height,width:this.width},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"computeOutputShape",value:function(e){var t=(e=dx(e)).length-3,n=e.length-2;return e[t]=this.height,e[n]=this.width,e}}]),n}(Sx);JS.className="CenterCrop",Gd.registerClass(JS);var QS=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,e)).numTokens=e.numTokens,e.outputMode?r.outputMode=e.outputMode:r.outputMode="multiHot",r}return(0,v.Z)(n,[{key:"getConfig",value:function(){var e={numTokens:this.numTokens,outputMode:this.outputMode},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"computeOutputShape",value:function(e){return null==(e=dx(e))?[this.numTokens]:"oneHot"===this.outputMode&&1!==e[e.length-1]?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}},{key:"call",value:function(e,t){var n=this;return xs((function(){var r;if("int32"!==(e=hx(e)).dtype&&(e=Tb(e,"int32")),"undefined"!=typeof t.countWeights){if("count"!==n.outputMode)throw new Ay("countWeights is not used when outputMode !== count.\n              Received countWeights=".concat(t.countWeights));r=hx(t.countWeights)}var a=yc(e),i=bc(e),o=Mc(n.numTokens,a).bufferSync().get(0),s=Oc(i,0).bufferSync().get(0);if(!o||!s)throw new Ay("Input values must be between 0 < values <= numTokens with numTokens=".concat(n.numTokens));return function(e,t,n,r){var a=hx(e);if("int32"!==a.dtype&&(a=Tb(a,"int32")),"int"===t)return a;var i=a.shape;if(0===a.rank&&(a=Ec(a,-1)),"oneHot"===t&&1!==a.shape[a.shape.length-1]&&(a=Ec(a,-1)),a.rank>2)throw new Ay("When outputMode is not int, maximum output rank is 2 Received outputMode ".concat(t," and input shape ").concat(i," which would result in output rank ").concat(a.rank,"."));var o,s=["multiHot","oneHot"].includes(t),u=a;if(o=qu(u,"undefined"!=typeof r&&"count"===t?r:[],n,s),"tfIdf"!==t)return o;if(r)return Os(o,r);throw new Ay("When outputMode is 'tfIdf', weights must be provided.")}(e,n.outputMode,n.numTokens,r)}))}}]),n}(Sx);QS.className="CategoryEncoding",Gd.registerClass(QS);var $S=new Set(["bilinear","nearest"]),eN=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;if((0,m.Z)(this,n),(r=t.call(this,e)).height=e.height,r.width=e.width,e.interpolation){if(!$S.has(e.interpolation))throw new Ay("Invalid interpolation parameter: ".concat(e.interpolation," is not implemented"));r.interpolation=e.interpolation}else r.interpolation="bilinear";return r.cropToAspectRatio=Boolean(e.cropToAspectRatio),(0,c.Z)(r)}return(0,v.Z)(n,[{key:"computeOutputShape",value:function(e){var t=(e=dx(e))[2];return[this.height,this.width,t]}},{key:"getConfig",value:function(){var e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=o((0,i.Z)(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"call",value:function(e,t){var n=this;return xs((function(){var t=[n.height,n.width];if("bilinear"===n.interpolation)return Pd.resizeBilinear(e,t,!n.cropToAspectRatio);if("nearest"===n.interpolation)return Pd.resizeNearestNeighbor(e,t,!n.cropToAspectRatio);throw new Error("Interpolation is ".concat(n.interpolation," but only ").concat((0,g.Z)($S)," are supported"))}))}}]),n}(Sx);function tN(e){return new Tx(e)}function nN(e){return new yI(e)}function rN(e){return new mI(e)}function aN(e){return new vI(e)}function iN(e){return new gI(e)}function oN(e){return new xI(e)}function sN(e){return new bI(e)}function uN(e){return new MI(e)}function cN(e){return new EI(e)}function lN(e){return new RI(e)}function pN(e){return new AI(e)}function hN(e){return new FI(e)}function dN(e){return new DI(e)}function fN(e){return new OI(e)}function mN(e){return new LI(e)}function vN(e){return new zI(e)}function gN(e){return new aS(e)}function yN(e){return new nS(e)}function bN(e){return new eS(e)}function xN(e){return new tS(e)}function kN(e){return new rS(e)}function wN(e){return new iS(e)}function IN(e){return new oS(e)}function SN(e){return new sS(e)}function NN(e){return new cS(e)}function TN(e){return new pS(e)}function CN(e){return new dS(e)}function _N(e){return new vS(e)}function EN(e){return new fS(e)}function AN(e){return new mS(e)}function RN(e){return new hS(e)}function FN(e){return new yS(e)}function ZN(e){return new SS(e)}function DN(e){return new NS(e)}function MN(e){return new TS(e)}function ON(e){return new RS(e)}function LN(e){return ON(e)}function zN(e){return ON(e)}function PN(e){return new DS(e)}function BN(e){return PN(e)}function WN(e){return PN(e)}function VN(e){return new LS(e)}function UN(e){return VN(e)}function GN(e){return VN(e)}function HN(e){return new PS(e)}function jN(e){return new VS(e)}function qN(e){return new BS(e)}function KN(e){return new US(e)}function XN(e){return new AS(e)}function YN(e){return new ZS(e)}function JN(e){return new OS(e)}function QN(e){return new jI(e)}function $N(e){return new HI(e)}function eT(e){return new KI(e)}function tT(e){return new qI(e)}function nT(e){return new GI(e)}function rT(e){return new UI(e)}function aT(e){return new $I(e)}function iT(e){return new QI(e)}function oT(e){return new WI(e)}function sT(e){return new XI(e)}function uT(e){return new qS(e)}function cT(e){return new HS(e)}eN.className="Resizing",Gd.registerClass(eN);var lT=qN,pT=KN,hT=XN,dT=YN;function fT(e){return new bS(e)}function mT(e){return new xS(e)}function vT(e){return new kS(e)}function gT(e){return new uS(e)}function yT(e){return new KS(e)}function bT(e){return new JS(e)}function xT(e){return new eN(e)}function kT(e){return new QS(e)}var wT={};function IT(e,t){return Lk(e,t)}function ST(e,t){return Vk(e,t)}function NT(e,t){return Uk(e,t)}function TT(e,t){return zk(e,t)}function CT(e,t){return Gk(e,t)}function _T(e,t){return Bk(e,t)}function ET(e,t){return Wk(e,t)}function AT(e,t){return Dk(e,t)}function RT(e,t){return Ek(e,t)}function FT(e,t){return Ak(e,t)}function ZT(e,t){return Ak(e,t)}function DT(e,t){return Ak(e,t)}function MT(e,t){return _k(e,t)}function OT(e,t){return _k(e,t)}function LT(e,t){return _k(e,t)}A(wT,{MAPE:function(){return ZT},MSE:function(){return OT},binaryAccuracy:function(){return IT},binaryCrossentropy:function(){return ST},categoricalAccuracy:function(){return TT},categoricalCrossentropy:function(){return CT},cosineProximity:function(){return AT},mape:function(){return DT},meanAbsoluteError:function(){return RT},meanAbsolutePercentageError:function(){return FT},meanSquaredError:function(){return MT},mse:function(){return LT},precision:function(){return _T},recall:function(){return ET},sparseCategoricalAccuracy:function(){return NT}});var zT={};A(zT,{modelFromJSON:function(){return Fw}});var PT={};function BT(e){return new lI(e)}function WT(e){return function(e){return uI(e),new lI({l1:null!=e?e.l1:null,l2:0})}(e)}function VT(e){return function(e){return uI(e),new lI({l2:null!=e?e.l2:null,l1:0})}(e)}A(PT,{l1:function(){return WT},l1l2:function(){return BT},l2:function(){return VT}});var UT=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){var e;return(0,m.Z)(this,n),(e=t.apply(this,arguments)).model=null,e}return(0,v.Z)(n,[{key:"setModel",value:function(e){if(!(e instanceof Aw))throw new Error("model must be a LayersModel, not some other Container");this.model=e}}]),n}(yk);function GT(e,t){return e<t}function HT(e,t){return e>t}var jT=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;if((0,m.Z)(this,n),r=t.call(this),null==e&&(e={}),e.restoreBestWeights)throw new Ry("restoreBestWeights = True is not implemented in EarlyStopping yet.");return r.monitor=e.monitor||"val_loss",r.minDelta=Math.abs(e.minDelta||0),r.patience=e.patience||0,r.verbose=e.verbose||0,r.mode=e.mode||"auto",r.baseline=e.baseline,-1===["auto","min","max"].indexOf(r.mode)&&(console.warn("EarlyStopping mode '".concat(r.mode,"' is invalid. Falling back to mode 'auto'.")),r.mode="auto"),"min"===r.mode?r.monitorFunc=GT:"max"===r.mode||-1!==r.monitor.indexOf("acc")?r.monitorFunc=HT:r.monitorFunc=GT,r.monitorFunc===GT&&(r.minDelta*=-1),(0,c.Z)(r)}return(0,v.Z)(n,[{key:"onTrainBegin",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.wait=0,this.stoppedEpoch=0,null!=this.baseline?this.best=this.baseline:this.best=this.monitorFunc===GT?1/0:-1/0;case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fk(n);case 2:null!=(r=this.getMonitorValue(n))&&(this.monitorFunc(r-this.minDelta,this.best)?(this.best=r,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=t,this.model.stopTraining=!0)));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.stoppedEpoch>0&&this.verbose&&console.log("Epoch ".concat(this.stoppedEpoch,": early stopping."));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMonitorValue",value:function(e){null==e&&(e={});var t=e[this.monitor];return null==t&&console.warn("Metric for EarlyStopping ".concat(this.monitor," is not available. Available metrics are: ").concat(Object.keys(e))),t}}]),n}(UT);var qT,KT,XT={earlyStopping:function(e){return new jT(e)}};Qe().registerFlag("KEEP_INTERMEDIATE_TENSORS",(function(){return!1}),(function(e){e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"}(qT||(qT={})),function(e){var t;(t=e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"}(KT||(KT={}));var YT={};function JT(e,t){var n={tfOpName:e,category:"custom",inputs:[],attrs:[],customExecutor:t};YT[e]=n}function QT(e){return YT[e]}function $T(e){delete YT[e]}function eC(e,t,n,r,a){var i=t.inputParams[e];if(i&&void 0!==i.inputIndexStart){var o=i.inputIndexStart,s=0===i.inputIndexEnd?void 0:void 0===i.inputIndexEnd?o+1:i.inputIndexEnd;if("tensor"===i.type)return tC(t.inputNames[i.inputIndexStart],n,r,a);if("tensors"===i.type)return t.inputNames.slice(o,s).map((function(e){return tC(e,n,r,a)}));var u=tC(t.inputNames.slice(o)[0],n,r,a),c=u.dataSync();return"number"===i.type?c[0]:Aa.toNestedArray(u.shape,c)}var l=t.attrParams[e];return l&&l.value}function tC(e,t,n,r){var a=aC(e),i=(0,h.Z)(a,2),o=i[0],s=i[1];if(null!=r){var u=r.getHashTableHandleByName(o);if(null!=u)return u}var c=n.currentContextIds.find((function(e){return!!t[rC(o,e)]}));return void 0!==c?t[rC(o,c)][s]:void 0}function nC(e,t){var n=aC(e),r=(0,h.Z)(n,3),a=r[0],i=r[1],o=r[2];return[rC(a,t&&t.currentContextId),i,o]}function rC(e,t){return t?"".concat(e,"-").concat(t):e}function aC(e){var t=e.split(":");if(1===t.length)return[e,0,void 0];var n=t[0],r=3===t.length?t[1]:void 0;return[n,Number(t[t.length-1]),r]}function iC(e,t,n){var r=eC("pad",e,t,n);if("explicit"===r){r=eC("explicitPaddings",e,t,n);for(var a=[[0,0],[0,0],[0,0],[0,0]],i=0;i<4;i++)a[i][0]=r[2*i],a[i][1]=r[2*i+1];return a}return r}function oC(e){return e.kept?e:ls(e)}var sC={};A(sC,{json:function(){return uC}});var uC=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],cC={};A(cC,{json:function(){return lC}});var lC=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],pC={};A(pC,{json:function(){return hC}});var hC=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],dC={};A(dC,{json:function(){return fC}});var fC=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],mC={};A(mC,{json:function(){return vC}});var vC=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],gC={};A(gC,{json:function(){return yC}});var yC=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],bC={};A(bC,{json:function(){return xC}});var xC=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],kC={};A(kC,{json:function(){return wC}});var wC=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],IC={};A(IC,{json:function(){return SC}});var SC=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],NC={};A(NC,{json:function(){return TC}});var TC=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],CC={};A(CC,{json:function(){return _C}});var _C=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],EC={};A(EC,{json:function(){return AC}});var AC=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}],RC={};A(RC,{json:function(){return FC}});var FC=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}],ZC={};A(ZC,{json:function(){return DC}});var DC=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],MC={};A(MC,{json:function(){return OC}});var OC=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}],LC={};A(LC,{json:function(){return zC}});var zC=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],PC={};A(PC,{json:function(){return BC}});var BC=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],WC={};A(WC,{json:function(){return VC}});var VC=[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],UC={};A(UC,{json:function(){return GC}});var GC=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],HC=function(){function e(){var t;(0,m.Z)(this,e);var n=[sC,cC,pC,dC,mC,gC,bC,kC,IC,NC,CC,EC,RC,ZC,MC,LC,PC,WC,UC],r=(t=[]).concat.apply(t,(0,g.Z)(n.map((function(e){return e.json}))));this.opMappers=r.reduce((function(e,t){return e[t.tfOpName]=t,e}),{})}return(0,v.Z)(e,[{key:"transformGraph",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.node,a=[],i=[],o=[],s=r.reduce((function(e,n){return e[n.name]=t.mapNode(n),n.op.startsWith("Placeholder")?a.push(e[n.name]):"Const"===n.op?i.push(e[n.name]):(null==n.input||0===n.input.length)&&o.push(e[n.name]),e}),{}),u=[],c=[],l={},p={};null!=n&&(l=this.mapSignatureEntries(n.inputs),p=this.mapSignatureEntries(n.outputs));var d=Object.keys(s);d.forEach((function(e){var t=s[e];t.inputNames.forEach((function(e,n){var r=nC(e),a=(0,h.Z)(r,3),i=a[0],o=a[2],u=s[i];if(null!=u.outputs){var c=u.outputs.indexOf(o);if(-1!==c){var l="".concat(i,":").concat(c);t.inputNames[n]=l}}t.inputs.push(u),u.children.push(t)}))})),0===Object.keys(p).length?d.forEach((function(e){var t=s[e];0===t.children.length&&c.push(t)})):Object.keys(p).forEach((function(e){var t=nC(e),n=(0,h.Z)(t,1)[0],r=s[n];null!=r&&(r.signatureKey=p[e],c.push(r))})),Object.keys(l).length>0?Object.keys(l).forEach((function(e){var t=nC(e),n=(0,h.Z)(t,1)[0],r=s[n];r&&(r.signatureKey=l[e],u.push(r))})):u=a;var f={};null!=e.library&&null!=e.library.function&&(f=e.library.function.reduce((function(e,n){return e[n.signature.name]=t.mapFunction(n),e}),{}));var m={nodes:s,inputs:u,outputs:c,weights:i,placeholders:a,signature:n,functions:f};return o.length>0&&(m.initNodes=o),m}},{key:"mapSignatureEntries",value:function(e){return Object.keys(e||{}).reduce((function(t,n){return t[e[n].name]=n,t}),{})}},{key:"mapNode",value:function(e){var t=QT(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});var n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map((function(e){return e.startsWith("^")?e.slice(1):e})),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return null!=t.inputs&&(n.inputParams=t.inputs.reduce((function(e,t){return e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e}),{})),null!=t.attrs&&(n.attrParams=t.attrs.reduce((function(t,n){var r,a=n.type;switch(n.type){case"string":void 0===(r=qC(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=qC(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":void 0===(r=r_(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=r_(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":void 0===(r=XC(e.attr,n.tfName,n.defaultValue||0))&&n.tfDeprecatedName&&(r=XC(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":void 0===(r=n_(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=n_(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":void 0===(r=KC(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=KC(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":void 0===(r=i_(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=i_(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":void 0===(r=t_(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=t_(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":void 0===(r=a_(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=a_(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":void 0===(r=QC(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=QC(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":void 0===(r=$C(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=$C(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":void 0===(r=JC(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=JC(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: ".concat(n.type," for op: ").concat(e.op))}return t[n.name]={value:r,type:a},t}),{})),n}},{key:"mapFunction",value:function(e){var t=this,n=e.nodeDef,r=[],a={};null!=n&&(a=n.reduce((function(e,n){return e[n.name]=t.mapNode(n),"Const"===n.op&&r.push(e[n.name]),e}),{}));var i=[],o=[];e.signature.inputArg.forEach((function(e){var t=nC(e.name),n=(0,h.Z)(t,1)[0],r={name:n,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:YC(e.type),type:"dtype"}},children:[]};r.signatureKey=e.name,i.push(r),a[n]=r})),Object.keys(a).forEach((function(e){var t=a[e];t.inputNames.forEach((function(e,n){var r=nC(e),i=(0,h.Z)(r,3),o=i[0],s=i[2],u=a[o];if(null!=u.outputs){var c=u.outputs.indexOf(s);if(-1!==c){var l="".concat(o,":").concat(c);t.inputNames[n]=l}}t.inputs.push(u),u.children.push(t)}))}));var s=e.ret;e.signature.outputArg.forEach((function(e){var t=nC(s[e.name]),n=(0,h.Z)(t,2),r=n[0],i=n[1],u=a[r];null!=u&&(u.defaultOutput=i,o.push(u))}));var u=this.mapArgsToSignature(e);return{nodes:a,inputs:i,outputs:o,weights:r,placeholders:[],signature:u}}},{key:"mapArgsToSignature",value:function(e){var t=this;return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((function(e,n){return e[n.name]=t.mapArgToTensorInfo(n),e}),{}),outputs:e.signature.outputArg.reduce((function(n,r){return n[r.name]=t.mapArgToTensorInfo(r,e.ret),n}),{})}}},{key:"mapArgToTensorInfo",value:function(e,t){var n=e.name;return null!=t&&(n=t[n]),{name:n,dtype:e.type}}}],[{key:"Instance",get:function(){return this._instance||(this._instance=new this)}}]),e}();function jC(e,t){var n=Array.isArray(e)?String.fromCharCode.apply(null,e):function(e){var t=Qe().global;if("undefined"!=typeof t.atob)return t.atob(e);if("undefined"!=typeof Buffer)return new Buffer(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(e);return t?n:n.toLowerCase()}function qC(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return null!=a?jC(a.s,r):n}function KC(e,t,n){var r=e[t];return r?r.b:n}function XC(e,t,n){var r=e[t]||{},a=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof a?a:parseInt(a,10)}function YC(e){switch("string"==typeof e&&(e=qT[e]),e){case qT.DT_FLOAT:case qT.DT_HALF:return"float32";case qT.DT_INT32:case qT.DT_INT64:case qT.DT_INT8:case qT.DT_UINT8:return"int32";case qT.DT_BOOL:return"bool";case qT.DT_DOUBLE:return"float32";case qT.DT_STRING:return"string";default:return null}}function JC(e,t,n){var r=e[t];return r&&r.func?r.func.name:n}function QC(e,t,n){var r=e[t];return r&&r.type?YC(r.type):n}function $C(e,t,n){var r=e[t];return r&&r.list&&r.list.type?r.list.type.map((function(e){return YC(e)})):n}function e_(e){if(!e.unknownRank)return null!=e.dim?e.dim.map((function(e){return"number"==typeof e.size?e.size:parseInt(e.size,10)})):[]}function t_(e,t,n){var r=e[t];return r&&r.shape?e_(r.shape):n}function n_(e,t,n){var r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((function(e){return"number"==typeof e?e:parseInt(e,10)})):n}function r_(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return a&&a.list&&a.list.s?a.list.s.map((function(e){return jC(e,r)})):n}function a_(e,t,n){var r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map((function(e){return e_(e)})):n}function i_(e,t,n){var r=e[t];return r&&r.list&&r.list.b?r.list.b:n}var o_=function(){function e(t,n,r){var a=this;(0,m.Z)(this,e),this.node=t,this.tensorMap=n,this.context=r,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map((function(e){return a.getInput(e)})),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce((function(e,t){return e[t]=a.getAttr(t),e}),{}))}return(0,v.Z)(e,[{key:"getInput",value:function(e){return tC(e,this.tensorMap,this.context)}},{key:"getAttr",value:function(e,t){var n=this.node.rawAttrs[e];if(null!=n.tensor)return tC(e,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return XC(this.node.rawAttrs,e,t);if(null!=n.s)return qC(this.node.rawAttrs,e,t);if(null!=n.b)return KC(this.node.rawAttrs,e,t);if(null!=n.shape)return t_(this.node.rawAttrs,e,t);if(null!=n.type)return QC(this.node.rawAttrs,e,t);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return n_(this.node.rawAttrs,e,t);if(null!=n.list.s)return r_(this.node.rawAttrs,e,t);if(null!=n.list.shape)return a_(this.node.rawAttrs,e,t);if(null!=n.list.b)return i_(this.node.rawAttrs,e,t);if(null!=n.list.type)return $C(this.node.rawAttrs,e,t)}return t}}]),e}(),s_={};A(s_,{OP_SCOPE_SUFFIX:function(){return ji},abs:function(){return Ls},acos:function(){return zs},acosh:function(){return Ps},add:function(){return Zs},addN:function(){return Bs},all:function(){return Ws},any:function(){return Vs},argMax:function(){return Us},argMin:function(){return Gs},asin:function(){return Hs},asinh:function(){return js},atan:function(){return qs},atan2:function(){return Ks},atanh:function(){return Xs},avgPool:function(){return hu},avgPool3d:function(){return du},basicLSTMCell:function(){return bu},batchNorm:function(){return wu},batchNorm2d:function(){return Iu},batchNorm3d:function(){return Su},batchNorm4d:function(){return Nu},batchToSpaceND:function(){return xu},bincount:function(){return Tu},booleanMaskAsync:function(){return dh},broadcastArgs:function(){return Cu},broadcastTo:function(){return _u},buffer:function(){return us},cast:function(){return cs},ceil:function(){return Eu},clipByValue:function(){return Ru},clone:function(){return ls},complex:function(){return Ki},concat:function(){return fu},concat1d:function(){return Fu},concat2d:function(){return Zu},concat3d:function(){return Du},concat4d:function(){return Mu},conv1d:function(){return Lu},conv2d:function(){return Ou},conv2dTranspose:function(){return Pu},conv3d:function(){return Bu},conv3dTranspose:function(){return Vu},cos:function(){return Uu},cosh:function(){return Gu},cosineWindow:function(){return Nh},cumprod:function(){return Hu},cumsum:function(){return ju},denseBincount:function(){return qu},depthToSpace:function(){return Ku},depthwiseConv2d:function(){return Xu},diag:function(){return Yu},dilation2d:function(){return Ju},div:function(){return Ms},divNoNan:function(){return ic},dot:function(){return oc},dropout:function(){return Ih},einsum:function(){return sc},elu:function(){return uc},enclosingPowerOfTwo:function(){return Sh},equal:function(){return nc},erf:function(){return cc},euclideanNorm:function(){return Cc},exp:function(){return _c},expandDims:function(){return Ec},expm1:function(){return Ac},eye:function(){return Fc},fft:function(){return Pp},fill:function(){return Au},floor:function(){return Zc},floorDiv:function(){return Ds},fused:function(){return _h},gather:function(){return Dc},gatherND:function(){return wh},greater:function(){return Mc},greaterEqual:function(){return Oc},ifft:function(){return Bp},imag:function(){return Lc},image:function(){return Pd},inTopKAsync:function(){return Ch},irfft:function(){return Wp},isFinite:function(){return zc},isInf:function(){return Pc},isNaN:function(){return Bc},leakyRelu:function(){return Wc},less:function(){return Vc},lessEqual:function(){return Uc},linalg:function(){return Bd},linspace:function(){return Gc},localResponseNormalization:function(){return Hc},log:function(){return jc},log1p:function(){return qc},logSigmoid:function(){return rl},logSoftmax:function(){return il},logSumExp:function(){return ol},logicalAnd:function(){return sl},logicalNot:function(){return ul},logicalOr:function(){return cl},logicalXor:function(){return ll},losses:function(){return Wd},lowerBound:function(){return dl},matMul:function(){return mu},max:function(){return yc},maxPool:function(){return fl},maxPool3d:function(){return ml},maxPoolWithArgmax:function(){return vl},maximum:function(){return gl},mean:function(){return yl},meshgrid:function(){return kl},min:function(){return bc},minimum:function(){return wl},mirrorPad:function(){return Il},mod:function(){return Sl},moments:function(){return Nl},movingAverage:function(){return mh},mul:function(){return Os},multiRNNCell:function(){return Tl},multinomial:function(){return Cl},neg:function(){return tl},norm:function(){return Tc},notEqual:function(){return _l},oneHot:function(){return El},ones:function(){return xl},onesLike:function(){return Al},op:function(){return qi},outerProduct:function(){return Rl},pad:function(){return Fl},pad1d:function(){return Zl},pad2d:function(){return Dl},pad3d:function(){return Ml},pad4d:function(){return Ol},pool:function(){return zl},pow:function(){return xc},prelu:function(){return Pl},print:function(){return ps},prod:function(){return Bl},raggedGather:function(){return Wl},raggedRange:function(){return Vl},raggedTensorToTensor:function(){return Ul},rand:function(){return Gl},randomGamma:function(){return pp},randomNormal:function(){return hp},randomStandardNormal:function(){return dp},randomUniform:function(){return fp},range:function(){return mp},real:function(){return vp},reciprocal:function(){return gp},relu:function(){return yp},relu6:function(){return bp},reshape:function(){return pu},reverse:function(){return xp},reverse1d:function(){return kp},reverse2d:function(){return wp},reverse3d:function(){return Ip},reverse4d:function(){return Sp},rfft:function(){return Up},round:function(){return Np},rsqrt:function(){return Tp},scalar:function(){return kc},scatterND:function(){return xh},searchSorted:function(){return hl},selu:function(){return Cp},separableConv2d:function(){return _p},setdiff1dAsync:function(){return Ap},sigmoid:function(){return vu},sign:function(){return Rp},signal:function(){return zd},sin:function(){return Fp},sinh:function(){return Zp},slice:function(){return gu},slice1d:function(){return Dp},slice2d:function(){return Mp},slice3d:function(){return Op},slice4d:function(){return Lp},softmax:function(){return zp},softplus:function(){return nl},spaceToBatchND:function(){return Ll},sparse:function(){return Vd},sparseToDense:function(){return kh},spectral:function(){return Ld},split:function(){return Vp},sqrt:function(){return wc},square:function(){return Ic},squaredDifference:function(){return Gp},squeeze:function(){return Hp},stack:function(){return jp},step:function(){return qp},stridedSlice:function(){return Kp},string:function(){return Ud},sub:function(){return al},sum:function(){return Sc},tan:function(){return Xp},tanh:function(){return yu},tensor:function(){return Yi},tensor1d:function(){return Yp},tensor2d:function(){return Jp},tensor3d:function(){return Qp},tensor4d:function(){return $p},tensor5d:function(){return eh},tensor6d:function(){return th},tile:function(){return Rc},topk:function(){return nh},transpose:function(){return fh},truncatedNormal:function(){return rh},unique:function(){return ah},unsortedSegmentSum:function(){return ih},unstack:function(){return oh},upperBound:function(){return sh},variable:function(){return uh},where:function(){return rc},whereAsync:function(){return ph},zeros:function(){return bl},zerosLike:function(){return ac}});var u_=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s_;switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[r.add(eC("a",e,t,n),eC("b",e,t,n))];case"AddN":return[r.addN(eC("tensors",e,t,n))];case"FloorMod":case"Mod":return[r.mod(eC("a",e,t,n),eC("b",e,t,n))];case"Mul":return[r.mul(eC("a",e,t,n),eC("b",e,t,n))];case"RealDiv":case"Div":return[r.div(eC("a",e,t,n),eC("b",e,t,n))];case"DivNoNan":return[r.divNoNan(eC("a",e,t,n),eC("b",e,t,n))];case"FloorDiv":return[r.floorDiv(eC("a",e,t,n),eC("b",e,t,n))];case"Sub":return[r.sub(eC("a",e,t,n),eC("b",e,t,n))];case"Minimum":return[r.minimum(eC("a",e,t,n),eC("b",e,t,n))];case"Maximum":return[r.maximum(eC("a",e,t,n),eC("b",e,t,n))];case"Pow":return[r.pow(eC("a",e,t,n),eC("b",e,t,n))];case"SquaredDifference":return[r.squaredDifference(eC("a",e,t,n),eC("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},c_=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s_;switch(e.op){case"Abs":case"ComplexAbs":return[r.abs(eC("x",e,t,n))];case"Acos":return[r.acos(eC("x",e,t,n))];case"Acosh":return[r.acosh(eC("x",e,t,n))];case"Asin":return[r.asin(eC("x",e,t,n))];case"Asinh":return[r.asinh(eC("x",e,t,n))];case"Atan":return[r.atan(eC("x",e,t,n))];case"Atan2":return[r.atan2(eC("x",e,t,n),eC("y",e,t,n))];case"Atanh":return[r.atanh(eC("x",e,t,n))];case"Ceil":return[r.ceil(eC("x",e,t,n))];case"Complex":return[r.complex(eC("real",e,t,n),eC("imag",e,t,n))];case"Cos":return[r.cos(eC("x",e,t,n))];case"Cosh":return[r.cosh(eC("x",e,t,n))];case"Elu":return[r.elu(eC("x",e,t,n))];case"Erf":return[r.erf(eC("x",e,t,n))];case"Exp":return[r.exp(eC("x",e,t,n))];case"Expm1":return[r.expm1(eC("x",e,t,n))];case"Floor":return[r.floor(eC("x",e,t,n))];case"Log":return[r.log(eC("x",e,t,n))];case"Log1p":return[r.log1p(eC("x",e,t,n))];case"Imag":return[r.imag(eC("x",e,t,n))];case"Neg":return[r.neg(eC("x",e,t,n))];case"Reciprocal":return[r.reciprocal(eC("x",e,t,n))];case"Real":return[r.real(eC("x",e,t,n))];case"Relu":return[r.relu(eC("x",e,t,n))];case"Round":return[r.round(eC("x",e,t,n))];case"Selu":return[r.selu(eC("x",e,t,n))];case"Sigmoid":return[r.sigmoid(eC("x",e,t,n))];case"Sin":return[r.sin(eC("x",e,t,n))];case"Sign":return[r.sign(eC("x",e,t,n))];case"Sinh":return[r.sinh(eC("x",e,t,n))];case"Softplus":return[r.softplus(eC("x",e,t,n))];case"Sqrt":return[r.sqrt(eC("x",e,t,n))];case"Square":return[r.square(eC("x",e,t,n))];case"Tanh":return[r.tanh(eC("x",e,t,n))];case"Tan":return[r.tan(eC("x",e,t,n))];case"ClipByValue":return[r.clipByValue(eC("x",e,t,n),eC("clipValueMin",e,t,n),eC("clipValueMax",e,t,n))];case"Relu6":return[r.relu6(eC("x",e,t,n))];case"Rsqrt":return[r.rsqrt(tC(e.inputNames[0],t,n))];case"Prod":return[r.prod(eC("x",e,t,n),eC("axes",e,t,n))];case"LeakyRelu":return[r.leakyRelu(eC("x",e,t,n),eC("alpha",e,t,n))];case"Prelu":return[r.prelu(eC("x",e,t,n),eC("alpha",e,t,n))];case"IsNan":return[r.isNaN(tC(e.inputNames[0],t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}};function l_(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if("number"!=typeof e&&"number"!=typeof t){Aa.assert(e.length===t.length,(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}));for(var r=0;r<e.length;r++){var a=e[r],i=t[r];Aa.assert(a<0||i<0||a===i,(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}}}function p_(e){return!("number"==typeof e||e.some((function(e){return e<0})))}function h_(e,t,n){var r=d_(e,n),a=!p_(r);if(a&&0===t.length)throw new Error("Tried to calculate elements of an empty list with non-fully-defined elementShape: ".concat(r));if(a&&t.forEach((function(e){r=d_(e.shape,r)})),!p_(r))throw new Error("Non-fully-defined elementShape: ".concat(r));return r}function d_(e,t){if("number"==typeof e)return t;if("number"==typeof t)return e;if(e.length!==t.length)throw new Error("Incompatible ranks during merge: ".concat(e," vs. ").concat(t));for(var n=[],r=0;r<e.length;++r){var a=e[r],i=t[r];if(a>=0&&i>=0&&a!==i)throw new Error("Incompatible shape during merge: ".concat(e," vs. ").concat(t));n[r]=a>=0?a:i}return n}var f_=function(){function e(t,n,r,a,i,o,s){(0,m.Z)(this,e),this.name=t,this.dtype=n,this.maxSize=r,this.elementShape=a,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.idTensor=kc(0),ws(this.idTensor)}return(0,v.Z)(e,[{key:"id",get:function(){return this.idTensor.id}},{key:"closed",get:function(){return this.closed_}},{key:"clearAndClose",value:function(e){this.tensors.forEach((function(t){(null==e||!e.has(t.tensor.id))&&t.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"read",value:function(e){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||e>=this.size())throw new Error("Tried to read from index ".concat(e,", but array size is: ").concat(this.size()));var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray ".concat(this.name,": Could not read index ").concat(e," twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?)."));return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}},{key:"readMany",value:function(e){var t=this;return e.map((function(e){return t.read(e)}))}},{key:"write",value:function(e,t){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index ".concat(e,", but array is not resizeable and size is: ").concat(this.maxSize));var n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,",\n          because the value dtype is ").concat(t.dtype,", but TensorArray dtype is ").concat(this.dtype,"."));if(0===this.size()&&(null==this.elementShape||0===this.elementShape.length)&&(this.elementShape=t.shape),l_(this.elementShape,t.shape,"TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,".")),n.read)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been read."));if(n.written)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been written."));n.tensor=t,ws(t),n.written=!0,this.tensors[e]=n}},{key:"writeMany",value:function(e,t){var n=this;if(e.length!==t.length)throw new Error("TensorArray ".concat(this.name,": could not write multiple tensors,because the index size: ").concat(e.length," is not the same as tensors size: ").concat(t.length,"."));e.forEach((function(e,r){return n.write(e,t[r])}))}},{key:"gather",value:function(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but gather requested dtype ").concat(t));if(e)e=e.slice(0,this.size());else{e=[];for(var n=0;n<this.size();n++)e.push(n)}if(0===e.length)return Yi([],[0].concat(this.elementShape));var r=this.readMany(e);return l_(this.elementShape,r[0].shape,"TensorArray shape mismatch: "),jp(r,0)}},{key:"concat",value:function(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but concat requested dtype ").concat(e));if(0===this.size())return Yi([],[0].concat(this.elementShape));for(var t=[],n=0;n<this.size();n++)t.push(n);var r=this.readMany(t);return l_(this.elementShape,r[0].shape,"TensorArray shape mismatch: tensor array shape (".concat(this.elementShape,") vs first tensor shape (").concat(r[0].shape,")")),fu(r,0)}},{key:"scatter",value:function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(t.shape[0]));var n=Math.max.apply(Math,(0,g.Z)(e));if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size (".concat(n,"  vs. ").concat(this.maxSize,")"));this.writeMany(e,oh(t,0))}},{key:"split",value:function(e,t){var n=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));var r=0,a=e.map((function(e){return r+=e}));if(r!==t.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(t.shape));if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths (".concat(this.maxSize," vs. ").concat(e.length,"), and the TensorArray is not marked as dynamically resizeable"));var i=0===r?0:t.size/r,o=[];xs((function(){t=pu(t,[1,r,i]);for(var s=0;s<e.length;++s){var u=[0,0===s?0:a[s-1],0],c=[1,e[s],i];o[s]=pu(gu(t,u,c),n.elementShape)}return o}));for(var s=[],u=0;u<e.length;u++)s[u]=u;this.writeMany(s,o)}}]),e}(),m_=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;(0,m.Z)(this,e),this.tensors=t,this.elementShape=n,this.elementDtype=r,null!=t&&t.forEach((function(e){if(r!==e.dtype)throw new Error("Invalid data types; op elements ".concat(r,", but list elements ").concat(e.dtype));l_(n,e.shape,"TensorList shape mismatch: "),ws(e)})),this.idTensor=kc(0),this.maxNumElements=a,ws(this.idTensor)}return(0,v.Z)(e,[{key:"id",get:function(){return this.idTensor.id}},{key:"copy",value:function(){return new e((0,g.Z)(this.tensors),this.elementShape,this.elementDtype)}},{key:"clearAndClose",value:function(e){this.tensors.forEach((function(t){(null==e||!e.has(t.id))&&t.dispose()})),this.tensors.length=0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"stack",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(-1!==r&&this.tensors.length!==r)throw new Error("Operation expected a list with ".concat(r," elements but got a list with ").concat(this.tensors.length," elements."));l_(e,this.elementShape,"TensorList shape mismatch: ");var a=h_(this.elementShape,this.tensors,e);return xs((function(){var e=n.tensors.map((function(e){return pu(e,a)}));return jp(e,0)}))}},{key:"popBack",value:function(e,t){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(0===this.size())throw new Error("Trying to pop from an empty list.");var n=h_(this.elementShape,this.tensors,e),r=this.tensors.pop();return r.kept=!1,l_(r.shape,e,"TensorList shape mismatch: "),pu(r,n)}},{key:"pushBack",value:function(e){if(e.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(this.elementDtype));if(l_(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");ws(e),this.tensors.push(e)}},{key:"resize",value:function(t){if(t<0)throw new Error("TensorListResize expects size to be non-negative. Got: ".concat(t));if(-1!==this.maxNumElements&&t>this.maxNumElements)throw new Error("TensorListResize input size ".concat(t," is greater maxNumElement ").concat(this.maxNumElements,"."));var n=new e([],this.elementShape,this.elementDtype,this.maxNumElements);n.tensors.length=t;for(var r=0;r<Math.min(this.tensors.length,t);++r)n.tensors[r]=this.tensors[r];return n}},{key:"getItem",value:function(e,t,n){if(n!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(this.elementDtype));if(e<0||e>this.tensors.length)throw new Error("Trying to access element ".concat(e," in a list with ").concat(this.tensors.length," elements."));if(null==this.tensors[e])throw new Error("element at index ".concat(e," is null."));l_(this.tensors[e].shape,t,"TensorList shape mismatch: ");var r=h_(this.elementShape,this.tensors,t);return pu(this.tensors[e],r)}},{key:"setItem",value:function(e,t){if(t.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t.dtype,", but list elements ").concat(this.elementDtype));if(e<0||-1!==this.maxNumElements&&e>=this.maxNumElements)throw new Error("Trying to set element ".concat(e," in a list with max ").concat(this.maxNumElements," elements."));l_(this.elementShape,t.shape,"TensorList shape mismatch: "),ws(t),null!=this.tensors[e]&&(this.tensors[e].kept=!1),this.tensors[e]=t}},{key:"gather",value:function(e,t,n){var r=this;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));l_(this.elementShape,n,"TensorList shape mismatch: "),e=e.slice(0,this.size());var a=h_(this.elementShape,this.tensors,n);return 0===e.length?Yi([],[0].concat(a)):xs((function(){var t=e.map((function(e){return pu(r.tensors[e],a)}));return jp(t,0)}))}},{key:"concat",value:function(e,t){var n=this;if(e&&e!==this.elementDtype)throw new Error("TensorList dtype is ".concat(this.elementDtype," but concat requested dtype ").concat(e));l_(this.elementShape,t,"TensorList shape mismatch: ");var r=h_(this.elementShape,this.tensors,t);return 0===this.size()?Yi([],[0].concat(r)):xs((function(){var e=n.tensors.map((function(e){return pu(e,r)}));return fu(e,0)}))}}]),e}();function v_(e,t,n){var r=e.dtype;if(e.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: ".concat(e.shape));if(e.dtype!==n)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(n));l_(e.shape.slice(1),t,"TensorList shape mismatch: ");var a=oh(e);return new m_(a,t,r)}function g_(e,t,n,r){return new m_([],e,t,r)}function y_(e,t,n,r){if(t.length!==e.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(t.length," vs. ").concat(e.shape[0]));var a=Math.max.apply(Math,(0,g.Z)(t));if(null!=r&&-1!==r&&a>=r)throw new Error("Max index must be < array size (".concat(a,"  vs. ").concat(r,")"));var i=new m_([],n,e.dtype,r),o=oh(e,0);return t.forEach((function(e,t){i.setItem(e,o[t])})),i}function b_(e,t,n){var r=0,a=t.map((function(e){return r+=e}));if(r!==e.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(e.shape));for(var i=d_(e.shape.slice(1),n),o=0===r?0:e.size/r,s=xs((function(){var n=[];e=pu(e,[1,r,o]);for(var s=0;s<t.length;++s){var u=[0,0===s?0:a[s-1],0],c=[1,t[s],o];n[s]=pu(gu(e,u,c),i)}return e.dispose(),n})),u=new m_([],n,e.dtype,t.length),c=0;c<s.length;c++)u.setItem(c,s[c]);return u}var x_=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,h,f,m,v,g,y,b,x,k,w,I,S,N,T,C,_,E,A,R,F,Z,D,M,O,L,z,P,B,W,V,U,G,H,j,q,K,X,Y,J,Q,$,ee,te,ne,re,ae,ie,oe,se,ue,ce,le,pe,he,de,fe,me,ve,ge,ye,be,xe,ke,we,Ie,Se,Ne,Te,Ce,_e,Ee,Ae,Re,Fe,Ze,De,Me,Oe,Le,ze,Pe,Be,We,Ve,Ue,Ge,He,je,qe,Ke,Xe,Ye,Je,Qe,$e;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="If"===e.t0||"StatelessIf"===e.t0?3:"While"===e.t0||"StatelessWhile"===e.t0?12:"LoopCond"===e.t0?30:"Switch"===e.t0?32:"Merge"===e.t0?42:"Enter"===e.t0?47:"Exit"===e.t0?49:"NextIteration"===e.t0?51:"TensorArrayV3"===e.t0?53:"TensorArrayWriteV3"===e.t0?55:"TensorArrayReadV3"===e.t0?57:"TensorArrayGatherV3"===e.t0?59:"TensorArrayScatterV3"===e.t0?61:"TensorArrayConcatV3"===e.t0?63:"TensorArraySplitV3"===e.t0?65:"TensorArraySizeV3"===e.t0?67:"TensorArrayCloseV3"===e.t0?69:"TensorListSetItem"===e.t0?71:"TensorListGetItem"===e.t0?73:"TensorListScatterV2"===e.t0||"TensorListScatter"===e.t0?75:"TensorListReserve"===e.t0||"EmptyTensorList"===e.t0?77:"TensorListGather"===e.t0?81:"TensorListStack"===e.t0?83:"TensorListFromTensor"===e.t0?85:"TensorListConcat"===e.t0||"TensorListConcatV2"===e.t0?87:"TensorListPushBack"===e.t0?89:"TensorListPopBack"===e.t0?91:"TensorListSplit"===e.t0?93:"TensorListLength"===e.t0?95:"TensorListResize"===e.t0?97:99;break;case 3:return a=eC("thenBranch",t,n,r),i=eC("elseBranch",t,n,r),o=eC("cond",t,n,r),s=eC("args",t,n,r),e.next=6,o.data();case 6:if(!e.sent[0]){e.next=10;break}e.t1=r.functionMap[a].executeFunctionAsync(s,r.tensorArrayMap,r.tensorListMap),e.next=11;break;case 10:e.t1=r.functionMap[i].executeFunctionAsync(s,r.tensorArrayMap,r.tensorListMap);case 11:return e.abrupt("return",e.t1);case 12:return u=eC("body",t,n,r),c=eC("cond",t,n,r),l=eC("args",t,n,r),e.next=17,r.functionMap[c].executeFunctionAsync(l,r.tensorArrayMap,r.tensorListMap);case 17:return p=e.sent,h=l.map((function(e){return e.id})),e.next=21,p[0].data();case 21:f=e.sent,p.forEach((function(e){!e.kept&&-1===h.indexOf(e.id)&&e.dispose()})),m=l,v=(0,d.Z)().mark((function e(){var t,n,a;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=m,e.next=3,r.functionMap[u].executeFunctionAsync(m,r.tensorArrayMap,r.tensorListMap);case 3:return m=e.sent,n=m.map((function(e){return e.id})),t.forEach((function(e){!e.kept&&-1===h.indexOf(e.id)&&-1===n.indexOf(e.id)&&e.dispose()})),e.next=8,r.functionMap[c].executeFunctionAsync(m,r.tensorArrayMap,r.tensorListMap);case 8:return a=e.sent,e.next=11,a[0].data();case 11:f=e.sent,a.forEach((function(e){!e.kept&&-1===h.indexOf(e.id)&&-1===n.indexOf(e.id)&&e.dispose()}));case 13:case"end":return e.stop()}}),e)}));case 25:if(!f[0]){e.next=29;break}return e.delegateYield(v(),"t2",27);case 27:e.next=25;break;case 29:return e.abrupt("return",m);case 30:return g=eC("pred",t,n,r),e.abrupt("return",[oC(g)]);case 32:return y=eC("pred",t,n,r),(b=eC("data",t,n,r)).kept||(b=oC(b)),e.next=36,y.data();case 36:if(!e.sent[0]){e.next=40;break}e.t3=[void 0,b],e.next=41;break;case 40:e.t3=[b,void 0];case 41:return e.abrupt("return",e.t3);case 42:if(x=t.inputNames.find((function(e){return void 0!==tC(e,n,r)})),!x){e.next=46;break}return k=tC(x,n,r),e.abrupt("return",[oC(k)]);case 46:return e.abrupt("return");case 47:return w=eC("frameName",t,n,r),I=eC("tensor",t,n,r),e.abrupt("return",(r.enterFrame(w),[oC(I)]));case 49:return S=eC("tensor",t,n,r),e.abrupt("return",(r.exitFrame(),[oC(S)]));case 51:return N=eC("tensor",t,n,r),e.abrupt("return",(r.nextIteration(),[oC(N)]));case 53:return T=eC("size",t,n,r),C=eC("dtype",t,n,r),_=eC("elementShape",t,n,r),E=eC("dynamicSize",t,n,r),A=eC("clearAfterRead",t,n,r),R=eC("identicalElementShapes",t,n,r),F=eC("name",t,n,r),Z=new f_(F,C,T,_,R,E,A),e.abrupt("return",(r.addTensorArray(Z),[Z.idTensor,kc(1)]));case 55:return D=eC("tensorArrayId",t,n,r),M=eC("index",t,n,r),O=eC("tensor",t,n,r),L=r.getTensorArray(D.id),e.abrupt("return",(L.write(M,O),[L.idTensor]));case 57:return z=eC("tensorArrayId",t,n,r),P=eC("index",t,n,r),e.abrupt("return",[r.getTensorArray(z.id).read(P)]);case 59:return B=eC("tensorArrayId",t,n,r),W=eC("indices",t,n,r),V=eC("dtype",t,n,r),e.abrupt("return",[r.getTensorArray(B.id).gather(W,V)]);case 61:return U=eC("tensorArrayId",t,n,r),G=eC("indices",t,n,r),H=eC("tensor",t,n,r),j=r.getTensorArray(U.id),e.abrupt("return",(j.scatter(G,H),[j.idTensor]));case 63:return q=eC("tensorArrayId",t,n,r),K=r.getTensorArray(q.id),X=eC("dtype",t,n,r),e.abrupt("return",[K.concat(X)]);case 65:return Y=eC("tensorArrayId",t,n,r),J=eC("tensor",t,n,r),Q=eC("lengths",t,n,r),$=r.getTensorArray(Y.id),e.abrupt("return",($.split(Q,J),[$.idTensor]));case 67:return ee=eC("tensorArrayId",t,n,r),te=r.getTensorArray(ee.id),e.abrupt("return",[kc(te.size(),"int32")]);case 69:return ne=eC("tensorArrayId",t,n,r),re=r.getTensorArray(ne.id),e.abrupt("return",(re.clearAndClose(),[re.idTensor]));case 71:return ae=eC("tensorListId",t,n,r),ie=eC("index",t,n,r),oe=eC("tensor",t,n,r),se=r.getTensorList(ae.id),e.abrupt("return",(se.setItem(ie,oe),[se.idTensor]));case 73:return ue=eC("tensorListId",t,n,r),ce=eC("index",t,n,r),le=eC("elementShape",t,n,r),pe=eC("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(ue.id).getItem(ce,le,pe)]);case 75:return he=eC("indices",t,n,r),de=eC("tensor",t,n,r),fe=eC("elementShape",t,n,r),me=eC("numElements",t,n,r),ve=y_(de,he,fe,me),e.abrupt("return",(r.addTensorList(ve),[ve.idTensor]));case 77:return ge=eC("elementShape",t,n,r),ye=eC("elementDType",t,n,r),be="TensorListReserve"===t.op?"numElements":"maxNumElements",xe=eC(be,t,n,r),ke="TensorListReserve"===t.op?-1:xe,we=g_(ge,ye,0,ke),e.abrupt("return",(r.addTensorList(we),[we.idTensor]));case 81:return Ie=eC("tensorListId",t,n,r),Se=eC("indices",t,n,r),Ne=eC("elementShape",t,n,r),Te=eC("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(Ie.id).gather(Se,Te,Ne)]);case 83:return Ce=eC("tensorListId",t,n,r),_e=eC("elementShape",t,n,r),Ee=eC("elementDType",t,n,r),Ae=eC("numElements",t,n,r),e.abrupt("return",[r.getTensorList(Ce.id).stack(_e,Ee,Ae)]);case 85:return Re=eC("tensor",t,n,r),Fe=eC("elementShape",t,n,r),Ze=eC("elementDType",t,n,r),De=v_(Re,Fe,Ze),e.abrupt("return",(r.addTensorList(De),[De.idTensor]));case 87:return Me=eC("tensorListId",t,n,r),Oe=r.getTensorList(Me.id),Le=eC("dtype",t,n,r),ze=eC("elementShape",t,n,r),e.abrupt("return",[Oe.concat(Le,ze)]);case 89:return Pe=eC("tensorListId",t,n,r),Be=eC("tensor",t,n,r),We=r.getTensorList(Pe.id),e.abrupt("return",(We.pushBack(Be),[We.idTensor]));case 91:return Ve=eC("tensorListId",t,n,r),Ue=eC("elementShape",t,n,r),Ge=eC("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(Ve.id).popBack(Ue,Ge)]);case 93:return He=eC("tensor",t,n,r),je=eC("elementShape",t,n,r),qe=eC("lengths",t,n,r),Ke=b_(He,qe,je),e.abrupt("return",(r.addTensorList(Ke),[Ke.idTensor]));case 95:return Xe=eC("tensorListId",t,n,r),Ye=r.getTensorList(Xe.id),e.abrupt("return",[kc(Ye.size(),"int32")]);case 97:return Je=eC("tensorListId",t,n,r),Qe=eC("size",t,n,r),$e=r.getTensorList(Je.id).resize(Qe),e.abrupt("return",(r.addTensorList($e),[$e.idTensor]));case 99:throw TypeError("Node type ".concat(t.op," is not implemented"));case 100:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();function k_(e,t,n){var r=eC("fusedOps",e,t,n),a=(0,h.Z)(r,2),i=a[0],o=a[1],s="biasadd"===i,u=!s,c="prelu"===o,l="fusedbatchnorm"===i,p=eC("numArgs",e,t,n);if(s){if(c&&2!==p)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!c&&s&&1!==p)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");var d=eC("strides",e,t,n),f=iC(e,t,n),m=eC("dataFormat",e,t,n).toUpperCase(),v=eC("dilations",e,t,n),g=eC("args",e,t,n),y=(0,h.Z)(g,2),b=y[0],x=y[1];return u&&(x=b,b=void 0),{stride:d,pad:f,dataFormat:m,dilations:v,biasArg:b,preluArg:x,activationFunc:o,leakyreluAlpha:eC("leakyreluAlpha",e,t,n)}}var w_=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s_;switch(e.op){case"Conv1D":var a=eC("stride",e,t,n),i=eC("pad",e,t,n),o=eC("dataFormat",e,t,n).toUpperCase(),s=eC("dilation",e,t,n);return[r.conv1d(eC("x",e,t,n),eC("filter",e,t,n),a,i,o,s)];case"Conv2D":var u=eC("strides",e,t,n),c=iC(e,t,n),l=eC("dataFormat",e,t,n).toUpperCase(),p=eC("dilations",e,t,n);return[r.conv2d(eC("x",e,t,n),eC("filter",e,t,n),[u[1],u[2]],c,l,[p[1],p[2]])];case"_FusedConv2D":var h=k_(e,t,n),d=h.stride,f=h.pad,m=h.dataFormat,v=h.dilations,g=h.biasArg,y=h.preluArg,b=h.activationFunc,x=h.leakyreluAlpha;return[r.fused.conv2d({x:eC("x",e,t,n),filter:eC("filter",e,t,n),strides:[d[1],d[2]],pad:f,dataFormat:m,dilations:[v[1],v[2]],bias:g,activation:b,preluActivationWeights:y,leakyreluAlpha:x})];case"FusedDepthwiseConv2dNative":var k=k_(e,t,n),w=k.stride,I=k.pad,S=k.dataFormat,N=k.dilations,T=k.biasArg,C=k.preluArg,_=k.activationFunc,E=k.leakyreluAlpha;return[r.fused.depthwiseConv2d({x:eC("x",e,t,n),filter:eC("filter",e,t,n),strides:[w[1],w[2]],pad:I,dataFormat:S,dilations:[N[1],N[2]],bias:T,activation:_,preluActivationWeights:C,leakyreluAlpha:E})];case"Conv2DBackpropInput":case"Conv2dTranspose":var A=eC("outputShape",e,t,n),R=eC("strides",e,t,n),F=iC(e,t,n);return[r.conv2dTranspose(eC("x",e,t,n),eC("filter",e,t,n),A,[R[1],R[2]],F)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":var Z=eC("strides",e,t,n),D=iC(e,t,n),M=eC("dilations",e,t,n),O=eC("dataFormat",e,t,n).toUpperCase();return[r.depthwiseConv2d(eC("input",e,t,n),eC("filter",e,t,n),[Z[1],Z[2]],D,O,[M[1],M[2]])];case"Conv3D":var L=eC("strides",e,t,n),z=eC("pad",e,t,n),P=eC("dataFormat",e,t,n).toUpperCase(),B=eC("dilations",e,t,n);return[r.conv3d(eC("x",e,t,n),eC("filter",e,t,n),[L[1],L[2],L[3]],z,P,[B[1],B[2],B[3]])];case"AvgPool":var W=eC("strides",e,t,n),V=eC("pad",e,t,n),U=eC("kernelSize",e,t,n);return[r.avgPool(eC("x",e,t,n),[U[1],U[2]],[W[1],W[2]],V)];case"MaxPool":var G=eC("strides",e,t,n),H=eC("pad",e,t,n),j=eC("kernelSize",e,t,n);return[r.maxPool(eC("x",e,t,n),[j[1],j[2]],[G[1],G[2]],H)];case"MaxPoolWithArgmax":var q=eC("strides",e,t,n),K=eC("pad",e,t,n),X=eC("kernelSize",e,t,n),Y=eC("includeBatchInIndex",e,t,n),J=r.maxPoolWithArgmax(eC("x",e,t,n),[X[1],X[2]],[q[1],q[2]],K,Y);return[J.result,J.indexes];case"AvgPool3D":var Q=eC("strides",e,t,n),$=eC("pad",e,t,n),ee=eC("kernelSize",e,t,n);return[r.avgPool3d(eC("x",e,t,n),[ee[1],ee[2],ee[3]],[Q[1],Q[2],Q[3]],$)];case"MaxPool3D":var te=eC("strides",e,t,n),ne=eC("pad",e,t,n),re=eC("kernelSize",e,t,n);return[r.maxPool3d(eC("x",e,t,n),[re[1],re[2],re[3]],[te[1],te[2],te[3]],ne)];case"Dilation2D":var ae=eC("strides",e,t,n),ie=eC("pad",e,t,n),oe=eC("dilations",e,t,n),se=ae[1],ue=ae[2],ce=oe[1],le=oe[2];return[r.dilation2d(eC("x",e,t,n),eC("filter",e,t,n),[se,ue],ie,[ce,le],"NHWC")];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},I_=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s_;switch(e.op){case"Fill":var a=eC("shape",e,t,n),i=eC("dtype",e,t,n),o=eC("value",e,t,n);return[r.fill(a,o,i)];case"LinSpace":var s=eC("start",e,t,n),u=eC("stop",e,t,n),c=eC("num",e,t,n);return[r.linspace(s,u,c)];case"Multinomial":var l=eC("logits",e,t,n),p=eC("numSamples",e,t,n),h=eC("seed",e,t,n);return[r.multinomial(l,p,h)];case"OneHot":var d=eC("indices",e,t,n),f=eC("depth",e,t,n),m=eC("onValue",e,t,n),v=eC("offValue",e,t,n),g=eC("dtype",e,t,n);return[r.oneHot(d,f,m,v,g)];case"Ones":return[r.ones(eC("shape",e,t,n),eC("dtype",e,t,n))];case"OnesLike":return[r.onesLike(eC("x",e,t,n))];case"RandomStandardNormal":return[r.randomStandardNormal(eC("shape",e,t,n),eC("dtype",e,t,n),eC("seed",e,t,n))];case"RandomUniform":return[r.randomUniform(eC("shape",e,t,n),eC("minval",e,t,n),eC("maxval",e,t,n),eC("dtype",e,t,n))];case"Range":var y=eC("start",e,t,n),b=eC("stop",e,t,n),x=eC("step",e,t,n);return[r.range(y,b,x,eC("dtype",e,t,n))];case"TruncatedNormal":var k=eC("shape",e,t,n),w=eC("mean",e,t,n),I=eC("stdDev",e,t,n),S=eC("seed",e,t,n);return[r.truncatedNormal(k,w,I,eC("dtype",e,t,n),S)];case"Zeros":return[r.zeros(eC("shape",e,t,n),eC("dtype",e,t,n))];case"ZerosLike":return[r.zerosLike(eC("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}};function S_(e,t,n){return{boxes:eC("boxes",e,t,n),scores:eC("scores",e,t,n),maxOutputSize:eC("maxOutputSize",e,t,n),iouThreshold:eC("iouThreshold",e,t,n),scoreThreshold:eC("scoreThreshold",e,t,n),softNmsSigma:eC("softNmsSigma",e,t,n)}}var N_=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n,r,a){var i,o,s,u,c,l,p,h,f,m,v,g,y,b,x,k,w,I,S,N,T,C,_,E,A,R=arguments;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=R.length>4&&void 0!==R[4]?R[4]:s_,e.t0=t.op,e.next="NonMaxSuppressionV5"===e.t0?4:"NonMaxSuppressionV4"===e.t0?15:"NonMaxSuppressionV3"===e.t0||"NonMaxSuppressionV2"===e.t0?26:"Where"===e.t0?31:"ListDiff"===e.t0?37:38;break;case 4:return o=S_(t,n,r),s=o.boxes,u=o.scores,c=o.maxOutputSize,l=o.iouThreshold,p=o.scoreThreshold,h=o.softNmsSigma,e.next=13,i.image.nonMaxSuppressionWithScoreAsync(s,u,c,l,p,h);case 13:return f=e.sent,e.abrupt("return",[f.selectedIndices,f.selectedScores]);case 15:return m=S_(t,n,r),v=m.boxes,g=m.scores,y=m.maxOutputSize,b=m.iouThreshold,x=m.scoreThreshold,k=eC("padToMaxOutputSize",t,n,r),e.next=24,i.image.nonMaxSuppressionPaddedAsync(v,g,y,b,x,k);case 24:return w=e.sent,e.abrupt("return",[w.selectedIndices,w.validOutputs]);case 26:return I=S_(t,n,r),S=I.boxes,N=I.scores,T=I.maxOutputSize,C=I.iouThreshold,_=I.scoreThreshold,e.next=29,i.image.nonMaxSuppressionAsync(S,N,T,C,_);case 29:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 31:return E=i.cast(eC("condition",t,n,r),"bool"),e.next=34,i.whereAsync(E);case 34:return e.t2=e.sent,A=[e.t2],e.abrupt("return",(E.dispose(),A));case 37:return e.abrupt("return",i.setdiff1dAsync(eC("x",t,n,r),eC("y",t,n,r)));case 38:throw TypeError("Node type ".concat(t.op," is not implemented"));case 39:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),T_=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s_;switch(e.op){case"LowerBound":var a=eC("sortedSequence",e,t,n),i=eC("values",e,t,n);return[r.lowerBound(a,i)];case"TopKV2":var o=eC("x",e,t,n),s=eC("k",e,t,n),u=eC("sorted",e,t,n),c=r.topk(o,s,u);return[c.values,c.indices];case"UpperBound":var l=eC("sortedSequence",e,t,n),p=eC("values",e,t,n);return[r.upperBound(l,p)];case"Unique":var h=eC("x",e,t,n),d=r.unique(h);return[d.values,d.indices];case"UniqueV2":var f=eC("x",e,t,n),m=eC("axis",e,t,n),v=r.unique(f,m);return[v.values,v.indices];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},C_=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s_;switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":var a=eC("default",e,t,n);return[tC(e.name,t,n)||a];case"Placeholder":return[tC(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":return[oC(eC("x",e,t,n))];case"IdentityN":return eC("x",e,t,n).map((function(e){return oC(e)}));case"Snapshot":return[oC(eC("x",e,t,n))];case"Shape":return[r.tensor1d(eC("x",e,t,n).shape,"int32")];case"ShapeN":return eC("x",e,t,n).map((function(e){return r.tensor1d(e.shape)}));case"Size":return[r.scalar(eC("x",e,t,n).size,"int32")];case"Rank":return[r.scalar(eC("x",e,t,n).rank,"int32")];case"NoOp":return[r.scalar(1)];case"Print":var i=eC("x",e,t,n),o=eC("data",e,t,n),s=eC("message",e,t,n),u=eC("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(s);for(var c=0;c<o.length;c++)console.log(Array.prototype.slice.call(o[c].dataSync()).slice(0,u));return[i];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},__=function(){function e(t,n){(0,m.Z)(this,e),this.keyDType=t,this.valueDType=n,this.handle=kc(0),this.tensorMap=new Map,ws(this.handle)}return(0,v.Z)(e,[{key:"id",get:function(){return this.handle.id}},{key:"clearAndClose",value:function(){this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),this.handle.dispose()}},{key:"size",value:function(){return this.tensorMap.size}},{key:"tensorSize",value:function(){return kc(this.size(),"int32")}},{key:"import",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkKeyAndValueTensor(t,n),e.next=3,t.data();case 3:return r=e.sent,e.abrupt("return",(this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),xs((function(){var e=oh(n),t=r.length,i=e.length;Aa.assert(t===i,(function(){return"The number of elements doesn't match, keys has ".concat(t," elements, the values has ").concat(i," elements.")}));for(var o=0;o<t;o++){var s=r[o],u=e[o];ws(u),a.tensorMap.set(s,u)}return a.handle}))));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkKeyAndValueTensor(t,n),e.next=3,t.data();case 3:return r=e.sent,e.abrupt("return",xs((function(){for(var e=[],t=0;t<r.length;t++){var i=r[t],o=a.findWithDefault(i,n);e.push(o)}return jp(e)})));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"findWithDefault",value:function(e,t){var n=this.tensorMap.get(e);return null!=n?n:t}},{key:"checkKeyAndValueTensor",value:function(e,t){if(e.dtype!==this.keyDType)throw new Error("Expect key dtype ".concat(this.keyDType,", but got ").concat(e.dtype));if(t.dtype!==this.valueDType)throw new Error("Expect value dtype ".concat(this.valueDType,", but got ").concat(t.dtype))}}]),e}(),E_=function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n,r,a){var i,o,s,u,c,l,p,h,f,m,v;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="HashTable"===e.t0||"HashTableV2"===e.t0?3:"InitializeTable"===e.t0||"InitializeTableV2"===e.t0||"LookupTableImport"===e.t0||"LookupTableImportV2"===e.t0?8:"LookupTableFind"===e.t0||"LookupTableFindV2"===e.t0?13:"LookupTableSize"===e.t0||"LookupTableSizeV2"===e.t0?18:20;break;case 3:if(null==(i=a.getHashTableHandleByName(t.name))){e.next=6;break}return e.abrupt("return",[i]);case 6:return o=eC("keyDType",t,n,r),s=eC("valueDType",t,n,r),u=new __(o,s),e.abrupt("return",(a.addHashTable(t.name,u),[u.handle]));case 8:return c=eC("tableHandle",t,n,r,a),l=eC("keys",t,n,r),p=eC("values",t,n,r),e.next=11,a.getHashTableById(c.id).import(l,p);case 11:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 13:return h=eC("tableHandle",t,n,r,a),f=eC("keys",t,n,r),m=eC("defaultValue",t,n,r),e.next=16,a.getHashTableById(h.id).find(f,m);case 16:return e.t2=e.sent,e.abrupt("return",[e.t2]);case 18:return v=eC("tableHandle",t,n,r,a),e.abrupt("return",[a.getHashTableById(v.id).tensorSize()]);case 20:throw TypeError("Node type ".concat(t.op," is not implemented"));case 21:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),A_=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s_;switch(e.op){case"ResizeBilinear":var a=eC("images",e,t,n),i=eC("size",e,t,n),o=eC("alignCorners",e,t,n),s=eC("halfPixelCenters",e,t,n);return[r.image.resizeBilinear(a,[i[0],i[1]],o,s)];case"ResizeNearestNeighbor":var u=eC("images",e,t,n),c=eC("size",e,t,n),l=eC("alignCorners",e,t,n),p=eC("halfPixelCenters",e,t,n);return[r.image.resizeNearestNeighbor(u,[c[0],c[1]],l,p)];case"CropAndResize":var h=eC("image",e,t,n),d=eC("boxes",e,t,n),f=eC("boxInd",e,t,n),m=eC("cropSize",e,t,n),v=eC("method",e,t,n),g=eC("extrapolationValue",e,t,n);return[r.image.cropAndResize(h,d,f,m,v,g)];case"ImageProjectiveTransformV3":var y=eC("images",e,t,n),b=eC("transforms",e,t,n),x=eC("outputShape",e,t,n),k=eC("fillValue",e,t,n),w=eC("interpolation",e,t,n),I=eC("fillMode",e,t,n);return[r.image.transform(y,b,w.toLowerCase(),I.toLowerCase(),k,x)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},R_=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s_;switch(e.op){case"Equal":return[r.equal(eC("a",e,t,n),eC("b",e,t,n))];case"NotEqual":return[r.notEqual(eC("a",e,t,n),eC("b",e,t,n))];case"Greater":return[r.greater(eC("a",e,t,n),eC("b",e,t,n))];case"GreaterEqual":return[r.greaterEqual(eC("a",e,t,n),eC("b",e,t,n))];case"Less":return[r.less(eC("a",e,t,n),eC("b",e,t,n))];case"LessEqual":return[r.lessEqual(eC("a",e,t,n),eC("b",e,t,n))];case"LogicalAnd":return[r.logicalAnd(eC("a",e,t,n),eC("b",e,t,n))];case"LogicalNot":return[r.logicalNot(eC("a",e,t,n))];case"LogicalOr":return[r.logicalOr(eC("a",e,t,n),eC("b",e,t,n))];case"Select":case"SelectV2":return[r.where(eC("condition",e,t,n),eC("a",e,t,n),eC("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},F_=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s_;switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[r.matMul(eC("a",e,t,n),eC("b",e,t,n),eC("transposeA",e,t,n),eC("transposeB",e,t,n))];case"Einsum":return[r.einsum.apply(r,[eC("equation",e,t,n)].concat((0,g.Z)(eC("tensors",e,t,n))))];case"Transpose":return[r.transpose(eC("x",e,t,n),eC("perm",e,t,n))];case"_FusedMatMul":var a=eC("fusedOps",e,t,n),i=(0,h.Z)(a,2),o=i[0],s=i[1],u="biasadd"===o,c="prelu"===s,l=eC("numArgs",e,t,n),p=eC("leakyreluAlpha",e,t,n);if(u){if(c&&2!==l)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!c&&1!==l)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var d=eC("args",e,t,n),f=(0,h.Z)(d,2),m=f[0],v=f[1];return[r.fused.matMul({a:eC("a",e,t,n),b:eC("b",e,t,n),transposeA:eC("transposeA",e,t,n),transposeB:eC("transposeB",e,t,n),bias:m,activation:s,preluActivationWeights:v,leakyreluAlpha:p})];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},Z_=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s_;switch(e.op){case"EuclideanNorm":return[r.euclideanNorm(eC("x",e,t,n),eC("axis",e,t,n),eC("keepDims",e,t,n))];case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[r.batchNorm(eC("x",e,t,n),eC("mean",e,t,n),eC("variance",e,t,n),eC("offset",e,t,n),eC("scale",e,t,n),eC("epsilon",e,t,n))];case"LRN":return[r.localResponseNormalization(eC("x",e,t,n),eC("radius",e,t,n),eC("bias",e,t,n),eC("alpha",e,t,n),eC("beta",e,t,n))];case"Softmax":return[r.softmax(eC("x",e,t,n))];case"LogSoftmax":return[r.logSoftmax(eC("x",e,t,n))];case"SparseToDense":return[r.sparseToDense(eC("sparseIndices",e,t,n),eC("outputShape",e,t,n),eC("sparseValues",e,t,n),eC("defaultValue",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},D_=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s_;switch(e.op){case"RaggedGather":var a=r.raggedGather(eC("paramsNestedSplits",e,t,n),eC("paramsDenseValues",e,t,n),eC("indices",e,t,n),eC("outputRaggedRank",e,t,n)),i=a.outputNestedSplits,o=a.outputDenseValues;return i.concat(o);case"RaggedRange":var s=r.raggedRange(eC("starts",e,t,n),eC("limits",e,t,n),eC("splits",e,t,n));return[s.rtNestedSplits,s.rtDenseValues];case"RaggedTensorToTensor":return[r.raggedTensorToTensor(eC("shape",e,t,n),eC("values",e,t,n),eC("defaultValue",e,t,n),eC("rowPartitionTensors",e,t,n),eC("rowPartitionTypes",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},M_=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s_;switch(e.op){case"Max":var a=eC("axis",e,t,n),i=eC("keepDims",e,t,n);return[r.max(eC("x",e,t,n),a,i)];case"Mean":var o=eC("axis",e,t,n),s=eC("keepDims",e,t,n);return[r.mean(eC("x",e,t,n),o,s)];case"Min":var u=eC("axis",e,t,n),c=eC("keepDims",e,t,n);return[r.min(eC("x",e,t,n),u,c)];case"Sum":var l=eC("axis",e,t,n),p=eC("keepDims",e,t,n);return[r.sum(eC("x",e,t,n),l,p)];case"All":var h=eC("axis",e,t,n),d=eC("keepDims",e,t,n);return[r.all(eC("x",e,t,n),h,d)];case"Any":var f=eC("axis",e,t,n),m=eC("keepDims",e,t,n);return[r.any(eC("x",e,t,n),f,m)];case"ArgMax":var v=eC("axis",e,t,n);return[r.argMax(eC("x",e,t,n),v)];case"ArgMin":var g=eC("axis",e,t,n);return[r.argMin(eC("x",e,t,n),g)];case"Prod":var y=eC("axis",e,t,n),b=eC("keepDims",e,t,n);return[r.prod(eC("x",e,t,n),y,b)];case"Cumprod":var x=eC("axis",e,t,n),k=eC("exclusive",e,t,n),w=eC("reverse",e,t,n);return[r.cumprod(eC("x",e,t,n),x,k,w)];case"Cumsum":var I=eC("axis",e,t,n),S=eC("exclusive",e,t,n),N=eC("reverse",e,t,n);return[r.cumsum(eC("x",e,t,n),I,S,N)];case"Bincount":var T=eC("x",e,t,n),C=eC("weights",e,t,n),_=eC("size",e,t,n);return[r.bincount(T,C,_)];case"DenseBincount":var E=eC("x",e,t,n),A=eC("weights",e,t,n),R=eC("size",e,t,n),F=eC("binaryOutput",e,t,n);return[r.denseBincount(E,A,R,F)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},O_=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s_;switch(e.op){case"ConcatV2":case"Concat":var a=eC("n",e,t,n),i=eC("axis",e,t,n),o=eC("tensors",e,t,n);return o=o.slice(0,a),[r.concat(o,i)];case"Gather":var s=eC("x",e,t,n),u=eC("indices",e,t,n);return[r.gather(s,r.cast(u,"int32"),0)];case"GatherV2":var c=eC("axis",e,t,n),l=eC("batchDims",e,t,n),p=eC("x",e,t,n),h=eC("indices",e,t,n);return[r.gather(p,r.cast(h,"int32"),c,l)];case"Reverse":for(var d=eC("dims",e,t,n),f=[],m=0;m<d.length;m++)d[m]&&f.push(m);var v=eC("x",e,t,n);return[r.reverse(v,f)];case"ReverseV2":var g=eC("axis",e,t,n),y=eC("x",e,t,n);return[r.reverse(y,g)];case"Slice":var b=eC("begin",e,t,n),x=eC("size",e,t,n);return[r.slice(eC("x",e,t,n),b,x)];case"StridedSlice":var k=eC("begin",e,t,n),w=eC("end",e,t,n),I=eC("strides",e,t,n),S=eC("beginMask",e,t,n),N=eC("endMask",e,t,n),T=eC("ellipsisMask",e,t,n),C=eC("newAxisMask",e,t,n),_=eC("shrinkAxisMask",e,t,n),E=eC("x",e,t,n);return[r.stridedSlice(E,k,w,I,S,N,T,C,_)];case"Pack":return xs((function(){var a=eC("axis",e,t,n),i=eC("tensors",e,t,n),o=i[0].shape,s=r.squeeze(i[0]).shape,u=i.map((function(e){var t=Aa.arraysEqual(e.shape,o);if(!t&&!Aa.arraysEqual(r.squeeze(e).shape,s))throw new Error("the input tensors shape does not match");return t?e:r.reshape(e,o)}));return[r.stack(u,a)]}));case"Unpack":var A=eC("axis",e,t,n),R=eC("tensor",e,t,n);return r.unstack(R,A);case"Tile":var F=eC("reps",e,t,n);return[r.tile(eC("x",e,t,n),F)];case"Split":case"SplitV":var Z=eC("axis",e,t,n),D=eC("numOrSizeSplits",e,t,n),M=eC("x",e,t,n);return r.split(M,D,Z);case"ScatterNd":var O=eC("indices",e,t,n),L=eC("values",e,t,n),z=eC("shape",e,t,n);return[r.scatterND(O,L,z)];case"GatherNd":var P=eC("x",e,t,n),B=eC("indices",e,t,n);return[r.gatherND(P,B)];case"SparseToDense":var W=eC("sparseIndices",e,t,n),V=eC("outputShape",e,t,n),U=eC("sparseValues",e,t,n),G=eC("defaultValue",e,t,n);return[r.sparseToDense(W,U,V,U.dtype===G.dtype?G:r.cast(G,U.dtype))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},L_=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s_;switch(e.op){case"SparseFillEmptyRows":var a=r.sparse.sparseFillEmptyRows(eC("indices",e,t,n),eC("values",e,t,n),eC("denseShape",e,t,n),eC("defaultValue",e,t,n));return[a.outputIndices,a.outputValues,a.emptyRowIndicator,a.reverseIndexMap];case"SparseReshape":var i=r.sparse.sparseReshape(eC("inputIndices",e,t,n),eC("inputShape",e,t,n),eC("newShape",e,t,n));return[i.outputIndices,i.outputShape];case"SparseSegmentMean":return[r.sparse.sparseSegmentMean(eC("data",e,t,n),eC("indices",e,t,n),eC("segmentIds",e,t,n))];case"SparseSegmentSum":return[r.sparse.sparseSegmentSum(eC("data",e,t,n),eC("indices",e,t,n),eC("segmentIds",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},z_=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s_;switch(e.op){case"FFT":return[r.fft(eC("x",e,t,n))];case"IFFT":return[r.ifft(eC("x",e,t,n))];case"RFFT":return[r.rfft(eC("x",e,t,n))];case"IRFFT":return[r.irfft(eC("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},P_=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s_;switch(e.op){case"StringNGrams":var a=r.string.stringNGrams(eC("data",e,t,n),eC("dataSplits",e,t,n),eC("separator",e,t,n),eC("nGramWidths",e,t,n),eC("leftPad",e,t,n),eC("rightPad",e,t,n),eC("padWidth",e,t,n),eC("preserveShortSequences",e,t,n));return[a.nGrams,a.nGramsSplits];case"StringSplit":var i=r.string.stringSplit(eC("input",e,t,n),eC("delimiter",e,t,n),eC("skipEmpty",e,t,n));return[i.indices,i.values,i.shape];case"StringToHashBucketFast":return[r.string.stringToHashBucketFast(eC("input",e,t,n),eC("numBuckets",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},B_=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s_;switch(e.op){case"Cast":return[r.cast(eC("x",e,t,n),eC("dtype",e,t,n))];case"ExpandDims":var a=eC("axis",e,t,n);return[r.expandDims(eC("x",e,t,n),a)];case"Squeeze":var i=eC("axis",e,t,n);return[r.squeeze(eC("x",e,t,n),i)];case"Reshape":return[r.reshape(eC("x",e,t,n),eC("shape",e,t,n))];case"MirrorPad":return[r.mirrorPad(eC("x",e,t,n),eC("padding",e,t,n),eC("mode",e,t,n))];case"PadV2":case"Pad":return[r.pad(eC("x",e,t,n),eC("padding",e,t,n),eC("constantValue",e,t,n))];case"SpaceToBatchND":var o=eC("blockShape",e,t,n),s=eC("paddings",e,t,n);return[r.spaceToBatchND(eC("x",e,t,n),o,s)];case"BatchToSpaceND":var u=eC("blockShape",e,t,n),c=eC("crops",e,t,n);return[r.batchToSpaceND(eC("x",e,t,n),u,c)];case"DepthToSpace":var l=eC("blockSize",e,t,n),p=eC("dataFormat",e,t,n).toUpperCase();return[r.depthToSpace(eC("x",e,t,n),l,p)];case"BroadcastTo":return[r.broadcastTo(eC("x",e,t,n),eC("shape",e,t,n))];case"BroadcastArgs":return[r.broadcastArgs(eC("s0",e,t,n),eC("s1",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}};function W_(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:xs,i=function(e,t,n){switch(e.category){case"arithmetic":return a((function(){return u_(e,t,n)}));case"basic_math":return a((function(){return c_(e,t,n)}));case"control":return x_(e,t,n);case"convolution":return a((function(){return w_(e,t,n)}));case"creation":return a((function(){return I_(e,t,n)}));case"dynamic":return N_(e,t,n);case"evaluation":return a((function(){return T_(e,t,n)}));case"image":return a((function(){return A_(e,t,n)}));case"graph":return a((function(){return C_(e,t,n)}));case"logical":return a((function(){return R_(e,t,n)}));case"matrices":return a((function(){return F_(e,t,n)}));case"normalization":return a((function(){return Z_(e,t,n)}));case"ragged":return a((function(){return D_(e,t,n)}));case"reduction":return a((function(){return M_(e,t,n)}));case"slice_join":return a((function(){return O_(e,t,n)}));case"sparse":return a((function(){return L_(e,t,n)}));case"spectral":return a((function(){return z_(e,t,n)}));case"string":return a((function(){return P_(e,t,n)}));case"transformation":return a((function(){return B_(e,t,n)}));case"hash_table":return E_(e,t,n,r);case"custom":var i=QT(e.op);if(i&&i.customExecutor)return i.customExecutor(new o_(e,t,n));throw TypeError("Custom op ".concat(e.op," is not registered."));default:throw TypeError("Unknown op '".concat(e.op,"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()"))}}(e,t,n);return Aa.isPromise(i)?i.then((function(e){return[].concat(e)})):[].concat(i)}var V_=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};(0,m.Z)(this,e),this.weightMap=t,this.tensorArrayMap=n,this.tensorListMap=r,this.functionMap=a,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return(0,v.Z)(e,[{key:"newFrame",value:function(e,t){return{id:e,frameName:t,iterationId:0}}},{key:"currentContext",get:function(){return this.contexts},set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}},{key:"currentContextId",get:function(){return this._currentContextIds[0]}},{key:"currentContextIds",get:function(){return this._currentContextIds}},{key:"generateCurrentContextIds",value:function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e}},{key:"contextIdforContexts",value:function(e){return e?e.map((function(e){return 0===e.id&&0===e.iterationId?"":"".concat(e.frameName,"-").concat(e.iterationId)})).join("/"):""}},{key:"enterFrame",value:function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}},{key:"exitFrame",value:function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}},{key:"nextIteration",value:function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}},{key:"getWeight",value:function(e){return this.weightMap[e]}},{key:"addTensorArray",value:function(e){this.tensorArrayMap[e.id]=e}},{key:"getTensorArray",value:function(e){return this.tensorArrayMap[e]}},{key:"addTensorList",value:function(e){this.tensorListMap[e.id]=e}},{key:"getTensorList",value:function(e){return this.tensorListMap[e]}},{key:"dispose",value:function(e){for(var t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(var n in this.tensorListMap)this.tensorListMap[n].clearAndClose(e)}}]),e}();function U_(e,t,n,r){var a=new Set,i=[],o=null,s=null,u=new Set,c=Object.keys(e).map((function(e){return aC(e)[0]})),l=[];null!=r&&(l=r.map((function(e){return aC(e.name)[0]})));for(var p=(0,g.Z)(t);p.length>0;){var h=p.pop();if((q_(h)||K_(h)||X_(h))&&null==o&&(s=(o=h).children.map((function(e){return e.name})).filter((function(e){return a.has(e)}))),a.add(h.name),null==n[h.name]&&-1===c.indexOf(h.name)&&-1===l.indexOf(h.name)){if(0===h.inputs.length){i.push(h.name);continue}h.inputs.forEach((function(e){u.has(e.name)||(u.add(e.name),p.push(e))}))}}return{inputs:e,outputs:t,usedNodes:a,missingInputs:i,dynamicNode:o,syncInputs:s}}var G_=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],H_=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],j_=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function q_(e){return G_.indexOf(e.op)>=0}function K_(e){return H_.indexOf(e.op)>=0}function X_(e){return j_.indexOf(e.op)>=0}var Y_=function(){function e(t,n){var r=this;(0,m.Z)(this,e),this.graph=t,this.parent=n,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,null!=t.functions&&Object.keys(t.functions).forEach((function(n){r._functionExecutorMap[n]=new e(t.functions[n],r)}))}return(0,v.Z)(e,[{key:"weightIds",get:function(){return this.parent?this.parent.weightIds:this._weightIds}},{key:"functionExecutorMap",get:function(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}},{key:"weightMap",get:function(){return this.parent?this.parent.weightMap:this._weightMap},set:function(e){var t,n=Object.keys(e).map((function(t){return e[t].map((function(e){return e.id}))}));this._weightIds=(t=[]).concat.apply(t,(0,g.Z)(n)),this._weightMap=e}},{key:"resourceManager",set:function(e){this._resourceManager=e}},{key:"inputs",get:function(){return this._inputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"outputs",get:function(){return this._outputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"inputNodes",get:function(){return this._inputs.map((function(e){return e.signatureKey||e.name}))}},{key:"outputNodes",get:function(){return this._outputs.map((function(e){var t=e.signatureKey||e.name;return e.defaultOutput?"".concat(t,":").concat(e.defaultOutput):t}))}},{key:"functions",get:function(){var e=this;return Object.keys(this._functions).reduce((function(t,n){return t[n]=e._functions[n].signature,t}),{})}},{key:"getCompilationKey",value:function(e,t){var n=e.map((function(e){return e.name})).sort(),r=t.map((function(e){return e.name})).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}},{key:"compile",value:function(e,t){var n=U_(e,t,this.weightMap,this._initNodes),r=n.missingInputs,a=n.dynamicNode,i=n.syncInputs;if(null!=a)throw new Error("This execution contains the node '".concat(a.name,"', which has the dynamic op '").concat(a.op,"'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [").concat(i,"]"));if(r.length>0){var o=t.map((function(e){return e.name})),s=Object.keys(e);throw new Error("Cannot compute the outputs [".concat(o,"] from the provided inputs [").concat(s,"]. Missing the following inputs: [").concat(r,"]"))}return function(e,t,n){var r=n.usedNodes,a=n.inputs,i=[],o=Object.keys(a).map((function(e){return aC(e)[0]})).map((function(t){return e.nodes[t]})),s=e.initNodes;o.forEach((function(e){r.has(e.name)&&i.push(e)})),e.weights.forEach((function(e){r.has(e.name)&&i.push(e)})),null!=s&&s.forEach((function(e){r.has(e.name)&&i.push(e)}));for(var u=new Set,c=[];i.length>0;){var l=i.pop();u.add(l.name),t[l.name]||c.push(l),l.children.forEach((function(e){!u.has(e.name)&&r.has(e.name)&&e.inputs.every((function(e){return u.has(e.name)}))&&i.push(e)}))}return c}(this.graph,this.weightMap,n)}},{key:"cloneAndKeepTensor",value:function(e){if(null==e)return null;var t=e.clone();return ws(t),t}},{key:"cloneTensorList",value:function(e){var t=this;return e?e.map((function(e){return t.cloneAndKeepTensor(e)})):null}},{key:"cloneTensorMap",value:function(e){var t=this;return Object.fromEntries(Object.entries(e).map((function(e){var n=(0,h.Z)(e,2),r=n[0],a=n[1];return[r,t.cloneTensorList(a)]})))}},{key:"execute",value:function(e,t){var n=this;this.disposeIntermediateTensors(),e=this.mapInputs(e);var r=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var a=r.map((function(e){return n.graph.nodes[aC(e)[0]]})),i=t.map((function(e){return aC(e)[0]})),o=i.map((function(e){return n.graph.nodes[e]}));0===o.length&&(o=this._outputs);var s=this.getCompilationKey(a,o),u=this.compiledMap.get(s);null==u&&(u=this.compile(e,o),this.compiledMap.set(s,u));try{this.keepIntermediateTensors=Qe().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(p){this.keepIntermediateTensors=!1,console.warn(p.message)}var c={},l={};return xs((function(){var r=new V_(n.weightMap,c,l,n.functionExecutorMap),a=Object.assign({},n.weightMap);n.keepIntermediateTensors&&(n.clonedTensorsMap=n.cloneTensorMap(n.weightMap)),Object.keys(e).forEach((function(t){var r=aC(t),i=(0,h.Z)(r,2),o=i[0],s=[];s[i[1]]=e[t],a[o]=s,n.keepIntermediateTensors&&(n.clonedTensorsMap[o]=n.cloneTensorList(s))}));for(var o=n.getFrozenTensorIds(a),s={},p=0;p<u.length;p++){var d=u[p];if(!a[d.name]){var f=W_(d,a,r,n._resourceManager);if(Aa.isPromise(f))throw new Error("The execution of the op '".concat(d.op,"' returned a promise. Please use model.executeAsync() instead."));a[d.name]=f,n.keepIntermediateTensors&&(n.clonedTensorsMap[d.name]=n.cloneTensorList(f)),n.checkTensorForDisposal(d.name,d,a,r,o,i,s)}}return null==n.parent&&r.dispose(o),t.map((function(e){return tC(e,a,r)}))}))}},{key:"getFrozenTensorIds",value:function(e){var t=[].concat.apply([],Object.keys(e).map((function(t){return e[t]})).map((function(e){return e.map((function(e){return e.id}))})));return new Set(t)}},{key:"checkTensorForDisposal",value:function(e,t,n,r,a,i,o){"control"===t.category||-1!==i.indexOf(e)||(n[e].forEach((function(e){null!=e&&(o[e.id]=(o[e.id]||0)+t.children.length)})),t.inputs.forEach((function(e){if("control"!==e.category){var t=function(e,t,n){return t[rC(e,n.currentContextId)]}(e.name,n,r);null!=t&&t.forEach((function(e){if(e&&!e.kept&&!a.has(e.id)){var t=o[e.id];1===t?(e.dispose(),delete o[e.id]):null!=t&&o[e.id]--}}))}})))}},{key:"executeAsync",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._executeAsync(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"disposeIntermediateTensors",value:function(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach((function(e){var t,n=(0,y.Z)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;r&&!r.isDisposed&&r.dispose()}}catch(a){n.e(a)}finally{n.f()}})),this.clonedTensorsMap=null)}},{key:"getIntermediateTensors",value:function(){return this.clonedTensorsMap}},{key:"_executeAsync",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,h=arguments;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=h.length>2&&void 0!==h[2]&&h[2],a=h.length>3&&void 0!==h[3]?h[3]:{},i=h.length>4&&void 0!==h[4]?h[4]:{},this.disposeIntermediateTensors(),r||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),n=this.mapOutputs(n),this.checkOutputs(n));try{this.keepIntermediateTensors=Qe().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(d){this.keepIntermediateTensors=!1,console.warn(d.message)}return o=new V_(this.weightMap,a,i,this.functionExecutorMap),this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),e.next=9,this.executeWithControlFlow(t,o,n,r);case 9:return s=e.sent,u=n.map((function(e){return tC(e,s,o)})),c=u.map((function(e){return e.id})),l=Object.keys(t).map((function(e){return t[e].id})),p=new Set([].concat((0,g.Z)(c),(0,g.Z)(l),(0,g.Z)(this.weightIds))),e.abrupt("return",(Object.values(s).forEach((function(e){e.forEach((function(e){e&&!e.isDisposed&&!p.has(e.id)&&e.dispose()}))})),null==this.parent&&o.dispose(p),u));case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"executeFunctionAsync",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n,r){var a,i=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.reduce((function(e,t,n){return e[i.inputs[n].name]=t,e}),{}),e.abrupt("return",this._executeAsync(a,this.outputNodes,!0,n,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"executeWithControlFlow",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n,r,a){var i,o,s,u,c,l,p,f,m,v,y,b,x,k,w,I,S,N=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Object.keys(t),o=i.map((function(e){return N.graph.nodes[aC(e)[0]]})),s=r.map((function(e){return aC(e)[0]})),u=s.map((function(e){return N.graph.nodes[e]})),0===u.length&&(u=this._outputs),c=U_(t,u,this.weightMap,this._initNodes),l=c.usedNodes,p=c.missingInputs,f=c.dynamicNode,m=c.syncInputs,v=[].concat((0,g.Z)(o),(0,g.Z)(this.graph.weights),(0,g.Z)(this._initNodes||[])).map((function(e){return{node:e,contexts:n.currentContext}})),y=Object.assign({},this.weightMap),Object.keys(t).forEach((function(e){var n=aC(e),r=(0,h.Z)(n,2),a=r[0],i=[];i[r[1]]=t[e],y[a]=i})),b={},x=this.getFrozenTensorIds(y),k={};case 5:if(!(v.length>0)){e.next=11;break}return w=this.processStack(o,v,n,y,k,x,s,b,l),e.next=9,Promise.all(w);case 9:e.next=5;break;case 11:if(null==f&&!a&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),I=u.filter((function(e){return!q_(e)&&!tC(e.name,y,n)})).map((function(e){return e.name})),!(I.length>0)){e.next=16;break}throw S="",null!=f&&(S="Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [".concat(m,"]")),new Error("Cannot compute the outputs [".concat(I,"] from the provided inputs [").concat(i,"]. Consider providing the following inputs: [").concat(p,"]. ").concat(S));case 16:return e.abrupt("return",y);case 17:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"processStack",value:function(e,t,n,r,a,i,o,s,u){for(var c=this,l=[],p=function(){var e,p,d=t.pop();n.currentContext=d.contexts;var f="";if("Enter"===d.node.op&&eC("isConstant",d.node,r,n)&&(e=nC(d.node.name,n),p=(0,h.Z)(e,1),f=p[0]),null==r[d.node.name]){var m,v,g=W_(d.node,r,n,c._resourceManager);f||(m=nC(d.node.name,n),v=(0,h.Z)(m,1),f=v[0]);var y=n.currentContext;Aa.isPromise(g)?l.push(g.then((function(e){return r[f]=e,c.keepIntermediateTensors&&(c.clonedTensorsMap[f]=c.cloneTensorList(e)),n.currentContext=y,c.checkTensorForDisposal(f,d.node,r,n,i,o,s),c.processChildNodes(d.node,t,n,r,a,u),e}))):(r[f]=g,c.keepIntermediateTensors&&(c.clonedTensorsMap[f]=c.cloneTensorList(g)),c.checkTensorForDisposal(f,d.node,r,n,i,o,s),c.processChildNodes(d.node,t,n,r,a,u))}else c.processChildNodes(d.node,t,n,r,a,u)};t.length>0;)p();return l}},{key:"processChildNodes",value:function(e,t,n,r,a,i){e.children.forEach((function(e){var o=nC(e.name,n),s=(0,h.Z)(o,1)[0];a[s]||!i.has(e.name)||("Merge"===e.op?e.inputNames.some((function(e){return!!tC(e,r,n)}))&&(a[s]=!0,t.push({contexts:n.currentContext,node:e})):e.inputNames.every((function(e){return!!tC(e,r,n)}))&&(a[s]=!0,t.push({contexts:n.currentContext,node:e})))}))}},{key:"dispose",value:function(){var e=this;Object.keys(this.weightMap).forEach((function(t){return e.weightMap[t].forEach((function(e){return e.dispose()}))}))}},{key:"checkInputShapeAndType",value:function(e){var t=this;Object.keys(e).forEach((function(n){var r=e[n],a=aC(n),i=(0,h.Z)(a,1)[0],o=t.graph.nodes[i];if(o.attrParams.shape&&o.attrParams.shape.value){var s=o.attrParams.shape.value,u=s.length===r.shape.length&&r.shape.every((function(e,t){return-1===s[t]||s[t]===e}));Aa.assert(u,(function(){return"The shape of dict['".concat(o.name,"'] provided in model.execute(dict) must be [").concat(s,"], but was [").concat(r.shape,"]")}))}o.attrParams.dtype&&o.attrParams.dtype.value&&Aa.assert(r.dtype===o.attrParams.dtype.value,(function(){return"The dtype of dict['".concat(o.name,"'] provided in model.execute(dict) must be ").concat(o.attrParams.dtype.value,", but was ").concat(r.dtype)}))}))}},{key:"mapInputs",value:function(e){var t,n,r={};for(var a in e){var i=null===(n=null===(t=this._signature)||void 0===t?void 0:t.inputs)||void 0===n?void 0:n[a];null!=i?r[i.name]=e[a]:r[a]=e[a]}return r}},{key:"checkInputs",value:function(e){var t=this,n=Object.keys(e).filter((function(e){var n=aC(e),r=(0,h.Z)(n,1)[0];return null==t.graph.nodes[r]}));if(n.length>0)throw new Error("The dict provided in model.execute(dict) has keys: [".concat(n,"] that are not part of graph"))}},{key:"mapOutputs",value:function(e){var t=this;return e.map((function(e){var n,r,a=null===(r=null===(n=t._signature)||void 0===n?void 0:n.outputs)||void 0===r?void 0:r[e];return null!=a?a.name:e}),{})}},{key:"checkOutputs",value:function(e){var t=this;e.forEach((function(e){var n=aC(e),r=(0,h.Z)(n,1)[0];if(!t.graph.nodes[r])throw new Error("The output '".concat(e,"' is not found in the graph"))}))}}]),e}(),J_=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,m.Z)(this,e),this.hashTableNameToHandle=t,this.hashTableMap=n}return(0,v.Z)(e,[{key:"addHashTable",value:function(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}},{key:"getHashTableHandleByName",value:function(e){return this.hashTableNameToHandle[e]}},{key:"getHashTableById",value:function(e){return this.hashTableMap[e]}},{key:"dispose",value:function(){for(var e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(var t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}]),e}(),Q_="?tfjs-format=file",$_="model.json",eE=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:rf;(0,m.Z)(this,e),this.modelUrl=t,this.loadOptions=n,this.version="n/a",this.io=r,null==n&&(this.loadOptions={}),this.resourceManager=new J_}return(0,v.Z)(e,[{key:"modelVersion",get:function(){return this.version}},{key:"inputNodes",get:function(){return this.executor.inputNodes}},{key:"outputNodes",get:function(){return this.executor.outputNodes}},{key:"inputs",get:function(){return this.executor.inputs}},{key:"outputs",get:function(){return this.executor.outputs}},{key:"weights",get:function(){return this.executor.weightMap}},{key:"metadata",get:function(){return this.artifacts.userDefinedMetadata}},{key:"modelSignature",get:function(){return this.signature}},{key:"modelStructuredOutputKeys",get:function(){return this.structuredOutputKeys}},{key:"findIOHandler",value:function(){var e=this.modelUrl;if(null!=e.load)this.handler=e;else if(null!=this.loadOptions.requestInit)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{var t=this.io.getLoadHandlers(e,this.loadOptions);if(0===t.length)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one (".concat(t.length,") load handlers for URL '").concat([e],"'"));this.handler=t[0]}}},{key:"load",value:function(){var e=this;if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");var t=this.handler.load();return Aa.isPromise(t)?t.then((function(t){return e.loadSync(t)})):this.loadSync(t)}},{key:"loadSync",value:function(e){this.artifacts=e;var t=this.artifacts.modelTopology,n=this.artifacts.signature;if(null!=this.artifacts.userDefinedMetadata){var r=this.artifacts.userDefinedMetadata;null!=r.signature&&(n=r.signature),null!=r.structuredOutputKeys&&(this.structuredOutputKeys=r.structuredOutputKeys)}this.signature=n,this.version="".concat(t.versions.producer,".").concat(t.versions.minConsumer);var a=this.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new Y_(HC.Instance.transformGraph(t,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(a),this.executor.resourceManager=this.resourceManager,null!=e.modelInitializer&&null!=e.modelInitializer.node){var i=HC.Instance.transformGraph(e.modelInitializer);this.initializer=new Y_(i),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0}},{key:"save",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=7;break}if(0!==(r=this.io.getSaveHandlers(t)).length){e.next=4;break}throw new Error("Cannot find any save handlers for URL '".concat(t,"'"));case 4:if(!(r.length>1)){e.next=6;break}throw new Error("Found more than one (".concat(r.length,") save handlers for URL '").concat(t,"'"));case 6:t=r[0];case 7:if(null!=t.save){e.next=9;break}throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 9:return e.abrupt("return",t.save(this.artifacts));case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"addStructuredOutputNames",value:function(e){var t=this;if(this.structuredOutputKeys){var n={};return(e instanceof hi?[e]:e).forEach((function(e,r){return n[t.structuredOutputKeys[r]]=e})),n}return e}},{key:"predict",value:function(e,t){var n=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(n)}},{key:"predictAsync",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.executeAsync(t,this.outputNodes);case 2:return r=e.sent,e.abrupt("return",this.addStructuredOutputNames(r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"normalizeInputs",value:function(e){var t,n=this;if(!(e instanceof hi)&&!Array.isArray(e)){var r=null===(t=this.signature)||void 0===t?void 0:t.inputs;if(null!=r)for(var a in r){var i=r[a];null!=i.resourceId&&(e[a]=this.resourceIdToCapturedInput[i.resourceId])}return e}e=Array.isArray(e)?e:[e];var o=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+o!==this.inputNodes.length)throw new Error("Input tensor count mismatch, the graph model has ".concat(this.inputNodes.length-o," non-resource placeholders, while there are ").concat(e.length," input tensors provided."));var s=0;return this.inputNodes.reduce((function(t,r){var a,i,o,u=null===(o=null===(i=null===(a=n.signature)||void 0===a?void 0:a.inputs)||void 0===i?void 0:i[r])||void 0===o?void 0:o.resourceId;return t[r]=null!=u?n.resourceIdToCapturedInput[u]:e[s++],t}),{})}},{key:"normalizeOutputs",value:function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}},{key:"executeInitializerGraph",value:function(){return null==this.initializer?[]:null==this.initializerSignature?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}},{key:"executeInitializerGraphAsync",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null==this.initializer?[]:null==this.initializerSignature?this.initializer.executeAsync({},[]):this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs)));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setResourceIdToCapturedInput",value:function(e){if(this.resourceIdToCapturedInput={},this.initializerSignature)for(var t=this.initializerSignature.outputs,n=Object.keys(t),r=0;r<n.length;r++){var a=t[n[r]];this.resourceIdToCapturedInput[a.resourceId]=e[r]}}},{key:"execute",value:function(e,t){null==this.resourceIdToCapturedInput&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var n=this.executor.execute(e,t);return n.length>1?n:n[0]}},{key:"executeAsync",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null==this.resourceIdToCapturedInput,!e.t0){e.next=7;break}return e.t1=this,e.next=5,this.executeInitializerGraphAsync();case 5:e.t2=e.sent,e.t1.setResourceIdToCapturedInput.call(e.t1,e.t2);case 7:return t=this.normalizeInputs(t),n=this.normalizeOutputs(n),e.next=11,this.executor.executeAsync(t,n);case 11:return r=e.sent,e.abrupt("return",r.length>1?r:r[0]);case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getIntermediateTensors",value:function(){return this.executor.getIntermediateTensors()}},{key:"disposeIntermediateTensors",value:function(){this.executor.disposeIntermediateTensors()}},{key:"convertTensorMapToTensorsMap",value:function(e){return Object.keys(e).reduce((function(t,n){return t[n]=[e[n]],t}),{})}},{key:"dispose",value:function(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&ks(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}}]),e}();function tE(e){return nE.apply(this,arguments)}function nE(){return nE=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r,a,i=arguments;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:{},r=i.length>2&&void 0!==i[2]?i[2]:rf,null!=t){e.next=4;break}throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");case 4:return null==n&&(n={}),n.fromTFHub&&"string"==typeof t&&(t=aE(t)),a=new eE(t,n,r),e.next=8,a.load();case 8:return e.abrupt("return",a);case 9:case"end":return e.stop()}}),e)}))),nE.apply(this,arguments)}function rE(e){if(null==e)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide model artifacts or an IOHandler that loads the model");var t;if(e instanceof Array){var n=(0,h.Z)(e,2),r=n[0],a=n[1];if(!r)throw new Error("modelJSON must be the first element of the array");if(!a||!(a instanceof ArrayBuffer))throw new Error("An ArrayBuffer of weights must be the second element of the array");if(!("modelTopology"in r))throw new Error("Model JSON is missing 'modelTopology'");if(!("weightsManifest"in r))throw new Error("Model JSON is missing 'weightsManifest'");var i=rf.getWeightSpecs(r.weightsManifest),o=rf.getModelArtifactsForJSONSync(r,i,a);t=rf.fromMemorySync(o)}else if("load"in e)t=e;else{if(!("modelTopology"in e&&"weightSpecs"in e&&"weightData"in e))throw new Error("Unknown model format");t=rf.fromMemorySync(e)}var s=new eE(t);return s.load(),s}function aE(e){return e.endsWith("/")||(e+="/"),"".concat(e).concat($_).concat(Q_)}var iE="4.2.0",oE={};A(oE,{CSVDataset:function(){return tA},Dataset:function(){return VE},FileDataSource:function(){return vA},TextLineDataset:function(){return KE},URLDataSource:function(){return gA},array:function(){return GE},csv:function(){return yA},func:function(){return bA},generator:function(){return xA},microphone:function(){return IA},version_data:function(){return NA},webcam:function(){return kA},zip:function(){return HE}});var sE=R(U()),uE=R(U());function cE(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set;if(null==e)return null;if("function"==typeof Blob&&e instanceof Blob)return e.slice();if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse){if(mE(e)){var i=Array.isArray(e)?[]:{};for(var o in r.add(e),e){var s=cE(e[o],t,n,r);i[o]=s}return r.delete(e),e.__proto__&&(i.__proto__=e.__proto__),i}throw new Error("Can't recurse into non-iterable type: ".concat(e))}return n.set(e,a.value),a.value}function lE(e){return pE(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:hE)}function pE(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set,r=e[0];if(n.has(r))throw new Error("Circular references are not supported.");var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse){if(mE(r)){var i=Array.isArray(r)?[]:{};n.add(r);var o=function(r){var a=pE(e.map((function(e){return e[r]})),t,n);i[r]=a};for(var s in r)o(s);return n.delete(r),i}throw new Error("Can't recurse into non-iterable type: ".concat(r))}return a.value}function hE(e){return null===e?null:mE(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}function dE(e,t){return fE.apply(this,arguments)}function fE(){return fE=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i,o,s,u;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new Map,cE(t,n,r),a=0,i=Array.from(r.keys());case 3:if(!(a<i.length)){e.next=14;break}if(o=i[a],s=r.get(o),!Aa.isPromise(s)){e.next=11;break}return e.next=9,s;case 9:u=e.sent,r.set(o,u);case 11:a++,e.next=3;break;case 14:return e.abrupt("return",cE(t,n,r));case 15:case"end":return e.stop()}}),e)}))),fE.apply(this,arguments)}function mE(e){var t=!1;Qe().get("IS_BROWSER")?t=e instanceof TextDecoder:t=e instanceof G().StringDecoder;return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"==typeof e&&!(e instanceof hi)&&!(e instanceof Promise)&&!t)}function vE(e){return function(e,t){return cE(e,t)}(e,gE)}function gE(e){return e instanceof hi?{value:e.clone(),recurse:!1}:mE(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}var yE=function(){function e(t){if((0,m.Z)(this,e),this.capacity=t,this.begin=0,this.end=0,null==t)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}return(0,v.Z)(e,[{key:"wrap",value:function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}},{key:"get",value:function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}},{key:"set",value:function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}},{key:"length",value:function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}},{key:"isFull",value:function(){return this.length()===this.capacity}},{key:"isEmpty",value:function(){return 0===this.length()}},{key:"push",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}},{key:"pushAll",value:function(e){var t,n=(0,y.Z)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.push(r)}}catch(a){n.e(a)}finally{n.f()}}},{key:"pop",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e}},{key:"unshift",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}},{key:"shift",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}},{key:"shuffleExcise",value:function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}}]),e}(),bE=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.call(this,n.INITIAL_CAPACITY)}return(0,v.Z)(n,[{key:"isFull",value:function(){return!1}},{key:"push",value:function(e){o((0,i.Z)(n.prototype),"isFull",this).call(this)&&this.expand(),o((0,i.Z)(n.prototype),"push",this).call(this,e)}},{key:"unshift",value:function(e){o((0,i.Z)(n.prototype),"isFull",this).call(this)&&this.expand(),o((0,i.Z)(n.prototype),"unshift",this).call(this,e)}},{key:"expand",value:function(){for(var e=2*this.capacity,t=new Array(e),n=this.length(),r=0;r<n;r++)t[r]=this.get(this.wrap(this.begin+r));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}]),n}(yE);function xE(e){return new TE(e)}function kE(e){return new CE(e)}function wE(e,t){return new zE(e,t)}function IE(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:SE.FAIL;return new PE(e,t)}bE.INITIAL_CAPACITY=32;var SE,NE=function(){function e(){(0,m.Z)(this,e)}return(0,v.Z)(e,[{key:"toArray",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,this.next();case 3:n=e.sent;case 4:if(n.done){e.next=11;break}return t.push(n.value),e.next=8,this.next();case 8:n=e.sent;case 9:e.next=4;break;case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toArrayForTest",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n,r;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.prefetch(100),n=[],e.next=4,t.next();case 4:r=e.sent;case 5:if(r.done){e.next=12;break}return n.push(r.value),e.next=9,t.next();case 9:r=e.sent;case 10:e.next=5;break;case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resolveFully",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:t=e.sent;case 3:if(t.done){e.next=9;break}return e.next=6,this.next();case 6:t=e.sent;case 7:e.next=3;break;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resolveWhile",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:n=e.sent,r=t(n.value);case 4:if(n.done||!r){e.next=11;break}return e.next=7,this.next();case 7:n=e.sent,r=t(n.value);case 9:e.next=4;break;case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleErrors",value:function(e){return new DE(this,e)}},{key:"filter",value:function(e){return new FE(this,e)}},{key:"map",value:function(e){return new ZE(this,e)}},{key:"mapAsync",value:function(e){return new ME(this,e)}},{key:"serialMapAsync",value:function(e){return new ME(this,e).serial()}},{key:"flatmap",value:function(e){return new LE(this,e)}},{key:"forEachAsync",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.map(t).resolveFully());case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"serialForEach",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.serialMapAsync(t).resolveWhile((function(e){return!0===e})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"rowMajorBatch",value:function(e){return new RE(this,e,!(arguments.length>1&&void 0!==arguments[1])||arguments[1])}},{key:"columnMajorBatch",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:hE;return this.rowMajorBatch(e,t).map((function(e){return lE(e,n)}))}},{key:"concatenate",value:function(e,t){return new zE(xE([this,e]),t)}},{key:"take",value:function(e){return e<0||null==e?this:new AE(this,e)}},{key:"skip",value:function(e){return e<0||null==e?this:new EE(this,e)}},{key:"prefetch",value:function(e){return new BE(this,e)}},{key:"shuffle",value:function(e,t){return new WE(this,e,t)}},{key:"serial",value:function(){return new _E(this)}}]),e}(),TE=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this)).items=e,r.trav=0,r}return(0,v.Z)(n,[{key:"summary",value:function(){return"Array of ".concat(this.items.length," items")}},{key:"next",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.trav>=this.items.length)){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return t=this.items[this.trav],e.abrupt("return",(this.trav++,{value:vE(t),done:!1}));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(NE),CE=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this)).nextFn=e,r}return(0,v.Z)(n,[{key:"summary",value:function(){return"Function call"}},{key:"next",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",this.nextFn());case 4:throw e.prev=4,e.t0=e.catch(0),e.t0.message="Error thrown while iterating through a dataset: ".concat(e.t0.message),e.t0;case 7:case"end":return e.stop()}}),e,this,[[0,4]])})));return function(){return e.apply(this,arguments)}}()}]),n}(NE),_E=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this)).upstream=e,r.lastRead=Promise.resolve({value:null,done:!1}),r}return(0,v.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Serial")}},{key:"next",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.upstream.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(NE),EE=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var a;return(0,m.Z)(this,n),(a=t.call(this)).upstream=e,a.maxCount=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return(0,v.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Skip")}},{key:"next",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.count++<this.maxCount)){e.next=9;break}return e.next=3,this.upstream.next();case 3:if(!(t=e.sent).done){e.next=6;break}return e.abrupt("return",t);case 6:ks(t.value);case 7:e.next=0;break;case 9:return e.abrupt("return",this.upstream.next());case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(NE),AE=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var a;return(0,m.Z)(this,n),(a=t.call(this)).upstream=e,a.maxCount=r,a.count=0,a}return(0,v.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Take")}},{key:"next",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(NE),RE=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var a,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return(0,m.Z)(this,n),(a=t.call(this)).upstream=e,a.batchSize=r,a.enableSmallLastBatch=i,a.lastRead=Promise.resolve({value:null,done:!1}),a}return(0,v.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> RowMajorBatch")}},{key:"next",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[];case 1:if(!(t.length<this.batchSize)){e.next=10;break}return e.next=4,this.upstream.next();case 4:if(!(n=e.sent).done){e.next=7;break}return e.abrupt("return",this.enableSmallLastBatch&&t.length>0?{value:t,done:!1}:{value:null,done:!0});case 7:t.push(n.value);case 8:e.next=1;break;case 10:return e.abrupt("return",{value:t,done:!1});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(NE),FE=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var a;return(0,m.Z)(this,n),(a=t.call(this)).upstream=e,a.predicate=r,a.lastRead=Promise.resolve({value:null,done:!1}),a}return(0,v.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Filter")}},{key:"next",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done&&!this.predicate(t.value)){e.next=5;break}return e.abrupt("return",t);case 5:ks(t.value);case 6:e.next=0;break;case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(NE),ZE=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var a;return(0,m.Z)(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return(0,v.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Map")}},{key:"next",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n,r,a,i,o,s;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:n=xi.getTensorsInContainer(t.value),r=this.transform(t.value),a=xi.getTensorsInContainer(r),i=(0,y.Z)(n);try{for(i.s();!(o=i.n()).done;)s=o.value,xi.isTensorInList(s,a)||s.dispose()}catch(u){i.e(u)}finally{i.f()}return e.abrupt("return",{value:r,done:!1});case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(NE),DE=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var a;return(0,m.Z)(this,n),(a=t.call(this)).upstream=e,a.handler=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return(0,v.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> handleErrors")}},{key:"next",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.upstream.next();case 3:return e.abrupt("return",e.sent);case 6:if(e.prev=6,e.t0=e.catch(0),this.handler(e.t0)){e.next=10;break}return e.abrupt("return",{value:null,done:!0});case 10:e.next=0;break;case 12:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()}]),n}(NE),ME=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var a;return(0,m.Z)(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return(0,v.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> AsyncMap")}},{key:"next",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n,r,a,i,o,s;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:return n=xi.getTensorsInContainer(t.value),e.next=8,this.transform(t.value);case 8:r=e.sent,a=xi.getTensorsInContainer(r),i=(0,y.Z)(n);try{for(i.s();!(o=i.n()).done;)s=o.value,xi.isTensorInList(s,a)||s.dispose()}catch(u){i.e(u)}finally{i.f()}return e.abrupt("return",{value:r,done:!1});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(NE),OE=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){var e;return(0,m.Z)(this,n),(e=t.call(this)).outputQueue=new bE,e.lastRead=Promise.resolve({value:null,done:!1}),e}return(0,v.Z)(n,[{key:"next",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.outputQueue.length()){e.next=7;break}return e.next=3,this.pump();case 3:if(e.sent){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:e.next=0;break;case 7:return e.abrupt("return",{value:this.outputQueue.shift(),done:!1});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(NE),LE=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var a;return(0,m.Z)(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return(0,v.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Flatmap")}},{key:"pump",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n,r,a,i,o,s;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",!1);case 5:n=xi.getTensorsInContainer(t.value),r=this.transform(t.value),a=xi.getTensorsInContainer(r),this.outputQueue.pushAll(r),i=(0,y.Z)(n);try{for(i.s();!(o=i.n()).done;)s=o.value,xi.isTensorInList(s,a)||s.dispose()}catch(u){i.e(u)}finally{i.f()}return e.abrupt("return",!0);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(OE),zE=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var a;return(0,m.Z)(this,n),(a=t.call(this)).baseErrorHandler=r,a.lastRead=null,a.iterator=null,a.moreIterators=e,a}return(0,v.Z)(n,[{key:"summary",value:function(){return"TODO: fill in upstream of chained summaries -> Chained"}},{key:"next",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.readFromChain(this.lastRead),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"readFromChain",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(null!=this.iterator){e.next=9;break}return e.next=5,this.moreIterators.next();case 5:if(!(n=e.sent).done){e.next=8;break}return e.abrupt("return",{value:null,done:!0});case 8:this.iterator=n.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler));case 9:return e.next=11,this.iterator.next();case 11:return r=e.sent,e.abrupt("return",r.done?(this.iterator=null,this.readFromChain(t)):r);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(NE);!function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"}(SE||(SE={}));var PE=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:SE.FAIL;return(0,m.Z)(this,n),(r=t.call(this)).iterators=e,r.mismatchMode=a,r.count=0,r.currentPromise=null,r}return(0,v.Z)(n,[{key:"summary",value:function(){return"{TODO: fill in upstream of zip summaries} -> Zip"}},{key:"nextState",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r,a,i;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(e){return e instanceof NE?{value:e.next().then((function(e){return n++,e.done&&r++,e.value})),recurse:!1}:{value:null,recurse:!0}},e.next=3,t;case 3:return n=0,r=0,e.next=6,dE(this.iterators,a);case 6:if(i=e.sent,n!==r){e.next=9;break}return e.abrupt("return",{value:null,done:!0});case 9:if(!(r>0)){e.next=15;break}e.t0=this.mismatchMode,e.next=e.t0===SE.FAIL?13:e.t0===SE.SHORTEST?14:(e.t0,SE.LONGEST,15);break;case 13:throw new Error("Zipped streams should have the same length. Mismatched at element ".concat(this.count,"."));case 14:return e.abrupt("return",{value:null,done:!0});case 15:return e.abrupt("return",(this.count++,{value:i,done:!1}));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"next",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.currentPromise=this.nextState(this.currentPromise),this.currentPromise));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(NE),BE=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var a;return(0,m.Z)(this,n),(a=t.call(this)).upstream=e,a.bufferSize=r,a.buffer=new yE(r),a}return(0,v.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Prefetch")}},{key:"refill",value:function(){for(;!this.buffer.isFull();){var e=this.upstream.next();this.buffer.push(e)}}},{key:"next",value:function(){return this.refill(),this.buffer.shift()}}]),n}(NE),WE=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r,a){var i;return(0,m.Z)(this,n),(i=t.call(this,e,r)).upstream=e,i.windowSize=r,i.upstreamExhausted=!1,i.random=uE.alea(a||Aa.now().toString()),i.lastRead=Promise.resolve({value:null,done:!1}),i}return(0,v.Z)(n,[{key:"next",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"randomInt",value:function(e){return Math.floor(this.random()*e)}},{key:"chooseIndex",value:function(){return this.randomInt(this.buffer.length())}},{key:"serialNext",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.upstreamExhausted||this.refill();case 1:if(this.buffer.isEmpty()){e.next=13;break}return t=this.chooseIndex(),e.next=5,this.buffer.shuffleExcise(t);case 5:if(!(n=e.sent).done){e.next=10;break}this.upstreamExhausted=!0,e.next=11;break;case 10:return e.abrupt("return",(this.refill(),n));case 11:e.next=1;break;case 13:return e.abrupt("return",{value:null,done:!0});case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(BE),VE=function(){function e(){(0,m.Z)(this,e),this.size=null}return(0,v.Z)(e,[{key:"batch",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this;return Aa.assert(e>0,(function(){return"batchSize needs to be positive, but it is\n      ".concat(e)})),t=this.size===1/0||null==this.size?this.size:n?Math.ceil(this.size/e):Math.floor(this.size/e),UE((0,f.Z)((0,d.Z)().mark((function t(){return(0,d.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.iterator();case 2:return t.abrupt("return",t.sent.columnMajorBatch(e,n,jE));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"concatenate",value:function(e){var t,n=this;return t=this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null,UE((0,f.Z)((0,d.Z)().mark((function t(){return(0,d.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.t0=t.sent,t.next=5,e.iterator();case 5:return t.t1=t.sent,t.abrupt("return",t.t0.concatenate.call(t.t0,t.t1));case 7:case"end":return t.stop()}}),t)}))),t)}},{key:"filter",value:function(e){var t,n=this;return t=this.size===1/0?1/0:null,UE((0,f.Z)((0,d.Z)().mark((function t(){return(0,d.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.filter((function(t){return xs((function(){return e(t)}))})));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"forEachAsync",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.iterator();case 2:return e.abrupt("return",e.sent.forEachAsync(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"map",value:function(e){var t=this;return UE((0,f.Z)((0,d.Z)().mark((function n(){return(0,d.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.map((function(t){return xs((function(){return e(t)}))})));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"mapAsync",value:function(e){var t=this;return UE((0,f.Z)((0,d.Z)().mark((function n(){return(0,d.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.mapAsync(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"prefetch",value:function(e){if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var t=this;return UE((0,f.Z)((0,d.Z)().mark((function n(){return(0,d.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.prefetch(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"repeat",value:function(e){var t,n=this;return t=null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null,UE((0,f.Z)((0,d.Z)().mark((function t(){var r;return(0,d.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=kE((0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.iterator();case 2:return e.t0=e.sent,e.t1=!1,e.abrupt("return",{value:e.t0,done:e.t1});case 5:case"end":return e.stop()}}),e)})))),t.abrupt("return",wE(r.take(e)));case 2:case"end":return t.stop()}}),t)}))),t)}},{key:"skip",value:function(e){var t,n=this;return t=null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null,UE((0,f.Z)((0,d.Z)().mark((function t(){return(0,d.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.skip(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"shuffle",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting bufferSize to the dataset size (".concat(this.size," elements)"));var r=this,a=sE.alea(t||Aa.now().toString());return UE((0,f.Z)((0,d.Z)().mark((function t(){var i;return(0,d.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=a.int32(),n&&(i+=a.int32()),t.next=4,r.iterator();case 4:return t.abrupt("return",t.sent.shuffle(e,i.toString()));case 5:case"end":return t.stop()}}),t)}))),this.size)}},{key:"take",value:function(e){var t,n=this;return t=null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null,UE((0,f.Z)((0,d.Z)().mark((function t(){return(0,d.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.take(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"toArray",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArray());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toArrayForTest",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArrayForTest());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function UE(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new(function(n){(0,l.Z)(a,n);var r=(0,p.Z)(a);function a(){var e;return(0,m.Z)(this,a),(e=r.apply(this,arguments)).size=t,e}return(0,v.Z)(a,[{key:"iterator",value:function(){var t=(0,f.Z)((0,d.Z)().mark((function t(){return(0,d.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e());case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}]),a}(VE))}function GE(e){return UE((0,f.Z)((0,d.Z)().mark((function t(){return(0,d.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",xE(e));case 1:case"end":return t.stop()}}),t)}))),e.length)}function HE(e){if(!mE(e))throw new Error("The argument to zip() must be an object or array.");var t;if(Array.isArray(e))for(var n=0;n<e.length;n++)t=null==t?e[n].size:Math.min(t,e[n].size);else if(e instanceof Object)for(var r in e)t=null==t?e[r].size:Math.min(t,e[r].size);return UE((0,f.Z)((0,d.Z)().mark((function t(){var n;return(0,d.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,dE(e,(function(e){if(e instanceof VE)return{value:e.iterator(),recurse:!1};if(mE(e))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")}));case 2:return n=t.sent,t.abrupt("return",IE(n,SE.SHORTEST));case 4:case"end":return t.stop()}}),t)}))),t)}function jE(e){return null===e?null:function(e){return null==e||function(e){return null===e||"object"!=typeof e&&"function"!=typeof e}(e)||Array.isArray(e)||"object"==typeof e&&e instanceof hi||Aa.isTypedArray(e)}(e[0])?{value:qE(e),recurse:!1}:{value:null,recurse:!0}}function qE(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof hi?jp(e):Yi(e)}VE.MAX_BUFFER_SIZE=1e4;var KE=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this)).input=e,r}return(0,v.Z)(n,[{key:"iterator",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.input.iterator();case 2:return e.abrupt("return",e.sent.decodeUTF8().split("\n").map((function(e){return e.endsWith("\r")&&(e=e.slice(0,-1)),e})));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(VE),XE='"',YE=Symbol("out"),JE=Symbol("field"),QE=Symbol("quote"),$E=Symbol("quoteafterquote"),eA=Symbol("quoteinquote"),tA=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var a;return(0,m.Z)(this,n),(a=t.call(this)).input=e,a.hasHeader=!0,a.fullColumnNames=null,a.columnNamesValidated=!1,a.columnConfigs=null,a.configuredColumnsOnly=!1,a.delimiter=",",a.delimWhitespace=!1,a.base=new KE(e),r||(r={}),a.hasHeader=!1!==r.hasHeader,a.fullColumnNames=r.columnNames,a.columnConfigs=r.columnConfigs,a.configuredColumnsOnly=r.configuredColumnsOnly,r.delimWhitespace?(Aa.assert(null==r.delimiter,(function(){return"Delimiter should not be provided when delimWhitespace is true."})),a.delimWhitespace=!0,a.delimiter=" "):a.delimiter=r.delimiter?r.delimiter:",",a}return(0,v.Z)(n,[{key:"columnNames",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.columnNamesValidated,e.t0){e.next=4;break}return e.next=4,this.setColumnNames();case 4:return e.abrupt("return",this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setColumnNames",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n,r,a,i,o,s=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.maybeReadHeaderLine();case 2:if(t=e.sent,this.fullColumnNames||t){e.next=5;break}throw new Error("Column names must be provided if there is no header line.");case 5:if(this.fullColumnNames&&t&&Aa.assert(t.length===this.fullColumnNames.length,(function(){return"The length of provided columnNames ("+s.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+t.length.toString()+")."})),this.fullColumnNames||(this.fullColumnNames=t),n=this.fullColumnNames.reduce((function(e,t){return e[t]=e[t]+1||1,e}),{}),r=Object.keys(n).filter((function(e){return n[e]>1})),Aa.assert(0===r.length,(function(){return"Duplicate column names found: "+r.toString()})),!this.columnConfigs){e.next=16;break}a=0,i=Object.keys(this.columnConfigs);case 9:if(!(a<i.length)){e.next=16;break}if(o=i[a],-1!==this.fullColumnNames.indexOf(o)){e.next=13;break}throw new Error('The key "'+o+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").");case 13:a++,e.next=9;break;case 16:this.columnNamesValidated=!0;case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"maybeReadHeaderLine",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasHeader){e.next=12;break}return e.next=3,this.base.iterator();case 3:return e.next=5,e.sent.next();case 5:if(!(t=e.sent).done){e.next=8;break}throw new Error("No data was found for CSV parsing.");case 8:return n=t.value,e.abrupt("return",this.parseRow(n,!1));case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"iterator",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.columnNamesValidated,e.t0){e.next=4;break}return e.next=4,this.setColumnNames();case 4:return e.next=6,this.base.iterator();case 6:return t=e.sent,e.abrupt("return",(this.hasHeader&&(t=t.skip(1)),t.map((function(e){return n.makeDataElement(e)}))));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"makeDataElement",value:function(e){for(var t=this.parseRow(e),n={},r={},a=0;a<this.fullColumnNames.length;a++){var i=this.fullColumnNames[a],o=this.columnConfigs?this.columnConfigs[i]:null;if(!this.configuredColumnsOnly||o){var s=t[a],u=null;if(""===s)if(o&&void 0!==o.default)u=o.default;else{if(o&&(o.required||o.isLabel))throw new Error("Required column ".concat(i," is empty in this line: ").concat(e));u=void 0}else{var c=Number(s);if(isNaN(c))u=o&&"bool"===o.dtype?this.getBoolean(s):s;else if(o&&o.dtype)switch(o.dtype){case"float32":default:u=c;break;case"int32":u=Math.floor(c);break;case"bool":u=this.getBoolean(s)}else u=c}o&&o.isLabel?r[i]=u:n[i]=u}}return 0===Object.keys(r).length?n:{xs:n,ys:r}}},{key:"getBoolean",value:function(e){return"1"===e||"true"===e.toLowerCase()?1:0}},{key:"parseRow",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[],r=0,a=e.length,i=YE,o=0;o<a;o++)switch(i){case YE:switch(e.charAt(o)){case XE:r=o+1,i=QE;break;case this.delimiter:if(r=o+1," "===this.delimiter&&this.delimWhitespace)break;n.push(""),i=YE;break;default:i=JE,r=o}break;case JE:if(e.charAt(o)===this.delimiter)n.push(e.substring(r,o)),i=YE,r=o+1;break;case QE:if(e.charAt(o)===XE)i=$E;break;case $E:switch(e.charAt(o)){case this.delimiter:n.push(e.substring(r,o-1)),i=YE,r=o+1;break;case XE:i=QE;break;default:i=eA}break;case eA:if(e.charAt(o)===XE)i=QE}if(i===$E?n.push(e.substring(r,a-1)):n.push(e.substring(r)),t&&n.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have ".concat(this.fullColumnNames.length," elements in a row, but got ").concat(n));return n}}]),n}(VE),nA=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;(0,m.Z)(this,n),(r=t.call(this)).microphoneConfig=e,r.isClosed=!1,r.fftSize=e.fftSize||1024;var a=Math.log2(r.fftSize);if(r.fftSize<0||a<4||a>14||!Number.isInteger(a))throw new Error("Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got ".concat(r.fftSize));if(r.numFrames=e.numFramesPerSpectrogram||43,r.sampleRateHz=e.sampleRateHz,r.columnTruncateLength=e.columnTruncateLength||r.fftSize,r.audioTrackConstraints=e.audioTrackConstraints,r.smoothingTimeConstant=e.smoothingTimeConstant||0,r.includeSpectrogram=!1!==e.includeSpectrogram,r.includeWaveform=!0===e.includeWaveform,!r.includeSpectrogram&&!r.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return r}return(0,v.Z)(n,[{key:"summary",value:function(){return"microphone"}},{key:"start",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({audio:null==this.audioTrackConstraints||this.audioTrackConstraints,video:!1});case 3:this.stream=e.sent,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),new Error("Error thrown while initializing video stream: ".concat(e.t0.message));case 9:if(this.stream){e.next=11;break}throw new Error("Could not obtain audio from microphone.");case 11:if(t=window.AudioContext||window.webkitAudioContext,this.audioContext=new t,this.sampleRateHz){e.next=16;break}this.sampleRateHz=this.audioContext.sampleRate,e.next=18;break;case 16:if(this.audioContext.sampleRate===this.sampleRateHz){e.next=18;break}throw new Error("Mismatch in sampling rate: Expected: ".concat(this.sampleRateHz,"; Actual: ").concat(this.audioContext.sampleRate));case 18:n=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,n.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize);case 20:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"next",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n,r,a,i;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isClosed){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return e.next=4,this.getAudioData();case 4:return r=e.sent,this.includeSpectrogram&&(a=this.flattenQueue(r.freqDataQueue),t=this.getTensorFromAudioDataArray(a,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(i=this.flattenQueue(r.timeDataQueue),n=this.getTensorFromAudioDataArray(i,[this.numFrames*this.fftSize,1])),e.abrupt("return",{value:{spectrogram:t,waveform:n},done:!1});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"capture",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:return e.abrupt("return",e.sent.value);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAudioData",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n,r,a=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],n=[],r=0,e.abrupt("return",new Promise((function(e){var i=setInterval((function(){a.includeSpectrogram&&(a.analyser.getFloatFrequencyData(a.freqData),a.freqData[0]===-1/0&&e({freqDataQueue:t,timeDataQueue:n}),t.push(a.freqData.slice(0,a.columnTruncateLength))),a.includeWaveform&&(a.analyser.getFloatTimeDomainData(a.timeData),n.push(a.timeData.slice())),++r===a.numFrames&&(clearInterval(i),e({freqDataQueue:t,timeDataQueue:n}))}),a.fftSize/a.sampleRateHz*1e3)})));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),null!=this.stream&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())}},{key:"toArray",value:function(){throw new Error("Can not convert infinite audio stream to array.")}},{key:"getSampleRate",value:function(){return this.sampleRateHz}},{key:"flattenQueue",value:function(e){var t=e[0].length,n=new Float32Array(e.length*t);return e.forEach((function(e,r){return n.set(e,r*t)})),n}},{key:"getTensorFromAudioDataArray",value:function(e,t){var n=new Float32Array(Aa.sizeFromShape(t));return n.set(e,n.length-e.length),Yi(n,t)}}],[{key:"create",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,r,a=arguments;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:{},Qe().get("IS_BROWSER")){e.next=3;break}throw new Error("microphone API is only supported in browser environment.");case 3:return r=new n(t),e.next=6,r.start();case 6:return e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(NE),rA=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var a;if((0,m.Z)(this,n),(a=t.call(this)).webcamVideoElement=e,a.webcamConfig=r,a.isClosed=!0,a.resize=!1,a.needToResize())if(a.resize=!0,a.cropSize=[a.webcamConfig.resizeHeight,a.webcamConfig.resizeWidth],a.cropBoxInd=Yp([0],"int32"),a.webcamConfig.centerCrop){var i=1*a.webcamConfig.resizeWidth/a.webcamVideoElement.width,o=1*a.webcamConfig.resizeHeight/a.webcamVideoElement.height,s=(1-i)/2,u=(1-o)/2,l=s+i,p=o+u;a.cropBox=Jp([u,s,p,l],[1,4])}else a.cropBox=Jp([0,0,1,1],[1,4]);return(0,c.Z)(a)}return(0,v.Z)(n,[{key:"summary",value:function(){return"webcam"}},{key:"start",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.webcamConfig.facingMode&&Aa.assert("user"===this.webcamConfig.facingMode||"environment"===this.webcamConfig.facingMode,(function(){return"Invalid webcam facing mode: ".concat(t.webcamConfig.facingMode,". Please provide 'user' or 'environment'")})),e.prev=1,e.next=4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}});case 4:this.stream=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),e.t0.message="Error thrown while initializing video stream: ".concat(e.t0.message),e.t0;case 10:if(this.stream){e.next=12;break}throw new Error("Could not obtain video from webcam.");case 12:try{this.webcamVideoElement.srcObject=this.stream}catch(C0){console.log(C0),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return e.abrupt("return",(this.webcamVideoElement.play(),this.isClosed=!1,new Promise((function(e){t.webcamVideoElement.onloadedmetadata=function(){e()}}))));case 14:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"next",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isClosed){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:e.prev=2,t=Df.fromPixels(this.webcamVideoElement),e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(2),new Error("Error thrown converting video to pixels: ".concat(JSON.stringify(e.t0)));case 9:if(!this.resize){e.next=22;break}return e.prev=10,e.abrupt("return",{value:this.cropAndResizeFrame(t),done:!1});case 14:throw e.prev=14,e.t1=e.catch(10),new Error("Error thrown cropping the video: ".concat(e.t1.message));case 17:return e.prev=17,t.dispose(),e.finish(17);case 20:e.next=23;break;case 22:return e.abrupt("return",{value:t,done:!1});case 23:case"end":return e.stop()}}),e,this,[[2,6],[10,14,17,20]])})));return function(){return e.apply(this,arguments)}}()},{key:"needToResize",value:function(){return!(!this.webcamConfig.resizeWidth||!this.webcamConfig.resizeHeight||this.webcamVideoElement.width===this.webcamConfig.resizeWidth&&this.webcamVideoElement.height===this.webcamConfig.resizeHeight)}},{key:"cropAndResizeFrame",value:function(e){var t=this;return xs((function(){var n,r=Ec(cs(e,"float32"),0),a=(n=Pd.cropAndResize(r,t.cropBox,t.cropBoxInd,t.cropSize,"bilinear")).shape;return pu(n,a.slice(1))}))}},{key:"capture",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:return e.abrupt("return",e.sent.value);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){this.stream.getTracks().forEach((function(e){return e.stop()}));try{this.webcamVideoElement.srcObject=null}catch(C0){console.log(C0),this.webcamVideoElement.src=null}this.isClosed=!0}},{key:"toArray",value:function(){throw new Error("Can not convert infinite video stream to array.")}}],[{key:"create",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var r,a,i=arguments;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>1&&void 0!==i[1]?i[1]:{},Qe().get("IS_BROWSER")){e.next=3;break}throw new Error("tf.data.webcam is only supported in browser environment.");case 3:if(t){e.next=7;break}if(t=document.createElement("video"),r.resizeWidth&&r.resizeHeight){e.next=6;break}throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");case 6:t.width=r.resizeWidth,t.height=r.resizeHeight;case 7:return a=new n(t,r),e.next=10,a.start();case 10:return e.abrupt("return",a);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),n}(NE),aA=(0,v.Z)((function e(){(0,m.Z)(this,e)})),iA=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"split",value:function(e){return new oA(this,e)}}]),n}(NE),oA=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var a;return(0,m.Z)(this,n),(a=t.call(this)).upstream=e,a.impl=new sA(e,r),a}return(0,v.Z)(n,[{key:"summary",value:function(){return this.impl.summary()}},{key:"next",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.impl.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(iA),sA=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var a;return(0,m.Z)(this,n),(a=t.call(this)).upstream=e,a.separator=r,a.carryover="",a}return(0,v.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Split('").concat(this.separator,"')")}},{key:"pump",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n,r,a,i;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",""!==this.carryover&&(this.outputQueue.push(this.carryover),this.carryover="",!0));case 5:(n=t.value.split(this.separator))[0]=this.carryover+n[0],r=(0,y.Z)(n.slice(0,-1));try{for(r.s();!(a=r.n()).done;)i=a.value,this.outputQueue.push(i)}catch(o){r.e(o)}finally{r.f()}return e.abrupt("return",(this.carryover=n[n.length-1],!0));case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(OE),uA=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"decodeUTF8",value:function(){return new cA(this)}}]),n}(NE),cA=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this)).upstream=e,r.impl=new lA(e),r}return(0,v.Z)(n,[{key:"summary",value:function(){return this.impl.summary()}},{key:"next",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.impl.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(iA),lA=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;if((0,m.Z)(this,n),(r=t.call(this)).upstream=e,Qe().get("IS_BROWSER"))r.decoder=new TextDecoder("utf-8");else{var a=G().StringDecoder;r.decoder=new a("utf8")}return(0,c.Z)(r)}return(0,v.Z)(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Utf8")}},{key:"pump",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n,r;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",!1);case 5:return n=t.value,e.abrupt("return",(r=Qe().get("IS_BROWSER")?this.decoder.decode(n,{stream:!0}):this.decoder.write(Buffer.from(n.buffer)),this.outputQueue.push(r),!0));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(OE),pA=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,m.Z)(this,n),(r=t.call(this)).file=e,r.options=a,Aa.assert(e instanceof Uint8Array||!!Qe().get("IS_BROWSER")&&(e instanceof File||e instanceof Blob),(function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."})),r.offset=a.offset||0,r.chunkSize=a.chunkSize||1048576,r}return(0,v.Z)(n,[{key:"summary",value:function(){return"FileChunks ".concat(this.file)}},{key:"next",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size))){e.next=4;break}e.t0={value:null,done:!0},e.next=9;break;case 4:return e.next=6,new Promise((function(e,n){var r=t.offset+t.chunkSize;if(t.file instanceof Uint8Array)e(new Uint8Array(t.file.slice(t.offset,r)));else{var a=new FileReader;a.onload=function(t){var r=a.result;if(r instanceof ArrayBuffer&&(r=new Uint8Array(r)),!(r instanceof Uint8Array))return n(new TypeError("FileReader returned unknown type."));e(r)},a.onabort=function(e){return n(new Error("Aborted"))},a.onerror=function(e){return n(new Error(e.type))};var i=t.file.slice(t.offset,r);a.readAsArrayBuffer(i)}t.offset=r}));case 6:e.t1=e.sent,e.t2=!1,e.t0={value:e.t1,done:e.t2};case 9:return e.abrupt("return",e.t0);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(uA);function hA(e){return dA.apply(this,arguments)}function dA(){return dA=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r,a,i,o,s,u=arguments;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>1&&void 0!==u[1]?u[1]:{},r=u.length>2?u[2]:void 0,"string"==typeof t?a=t:(a=t.url,i=fA(t)),e.next=5,(r||Aa.fetch)(a,i);case 5:if(!(o=e.sent).ok){e.next=15;break}return e.t0=Uint8Array,e.next=10,o.arrayBuffer();case 10:return e.t1=e.sent,s=new e.t0(e.t1),e.abrupt("return",new pA(s,n));case 15:throw new Error(o.statusText);case 16:case"end":return e.stop()}}),e)}))),dA.apply(this,arguments)}var fA=function(e){return{method:e.method,headers:e.headers,body:e.body,mode:e.mode,credentials:e.credentials,cache:e.cache,redirect:e.redirect,referrer:e.referrer,integrity:e.integrity}};function mA(e){return"string"==typeof e&&"file://"===e.slice(0,7)}var vA=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,m.Z)(this,n),(r=t.call(this)).input=e,r.options=a,r}return(0,v.Z)(n,[{key:"iterator",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return mA(this.input)&&Qe().get("IS_NODE")&&(t=H(),this.input=t.readFileSync(this.input.slice(7))),e.abrupt("return",new pA(this.input,this.options));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(aA),gA=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,m.Z)(this,n),(r=t.call(this)).url=e,r.fileOptions=a,r}return(0,v.Z)(n,[{key:"iterator",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",mA(this.url)?new vA(this.url,this.fileOptions).iterator():hA(this.url,this.fileOptions));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(aA);function yA(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new tA(new gA(e),t)}function bA(e){var t=kE(e);return UE((0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)}))))}function xA(e){return UE((0,f.Z)((0,d.Z)().mark((function t(){var n;return(0,d.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e();case 2:return n=t.sent,t.abrupt("return",kE((function(){return n.next()})));case 4:case"end":return t.stop()}}),t)}))))}function kA(e,t){return wA.apply(this,arguments)}function wA(){return wA=(0,f.Z)((0,d.Z)().mark((function e(t,n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",rA.create(t,n));case 1:case"end":return e.stop()}}),e)}))),wA.apply(this,arguments)}function IA(e){return SA.apply(this,arguments)}function SA(){return SA=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",nA.create(t));case 1:case"end":return e.stop()}}),e)}))),SA.apply(this,arguments)}var NA="4.2.0";function TA(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&Aa.assert("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors in the CPU backend.")}))}))}var CA=wv.whereImpl,_A=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){var e;return(0,m.Z)(this,n),(e=t.call(this)).blockSize=48,e.firstUse=!0,e.data=new $((0,s.Z)(e),gs()),e}return(0,v.Z)(n,[{key:"nextDataId",value:function(){return n.nextDataId++}},{key:"write",value:function(e,t,n){this.firstUse&&(this.firstUse=!1,Qe().get("IS_NODE")&&vm.warn("\n============================\nHi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. \n============================"));var r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&Aa.isString(n[0])){var a=n.map((function(e){return Aa.encodeString(e)}));r=this.write(a,e,t)}else r=this.write(n,e,t);return{dataId:r,shape:e,dtype:t}}},{key:"refCount",value:function(e){return this.data.has(e)?this.data.get(e).refCount:0}},{key:"incRef",value:function(e){this.data.get(e).refCount++}},{key:"decRef",value:function(e){this.data.has(e)&&this.data.get(e).refCount--}},{key:"move",value:function(e,t,n,r,a){this.data.set(e,{values:t,dtype:r,refCount:a})}},{key:"numDataIds",value:function(){return this.data.numDataIds()}},{key:"read",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readSync(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readSync",value:function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensorInfos;if("complex64"===n){var a=this.readSync(r.real.dataId),i=this.readSync(r.imag.dataId);return vm.mergeRealAndImagArrays(a,i)}return Aa.convertBackendValuesAndArrayBuffer(this.data.get(e).values,n)}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId);if("string"===e.dtype)try{var n=t.map((function(e){return Aa.decodeString(e)}));return us(e.shape,e.dtype,n)}catch(v$){throw new Error("Failed to decode encoded string bytes into utf-8")}return us(e.shape,e.dtype,t)}},{key:"makeOutput",value:function(e,t,n){return gs().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,e),this)}},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;var n=this.data.get(e).complexTensorInfos;null!=n&&(this.disposeData(n.real.dataId,!0),this.disposeData(n.imag.dataId,!0)),this.data.delete(e)}return!0}},{key:"disposeIntermediateTensorInfo",value:function(e){this.disposeData(e.dataId)}},{key:"time",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Aa.now(),e.abrupt("return",(t(),{kernelMs:Aa.now()-n}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"memory",value:function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}},{key:"where",value:function(e){TA([e],"where");var t=this.readSync(e.dataId);return CA(e.shape,t)}},{key:"dispose",value:function(){}},{key:"floatPrecision",value:function(){return 32}},{key:"epsilon",value:function(){return o((0,i.Z)(n.prototype),"epsilon",this).call(this)}}]),n}(ee);_A.nextDataId=0;var EA={};function AA(e){for(var t=new Float32Array(e.length),n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}A(EA,{addImpl:function(){return HA},bincountImpl:function(){return XA},bincountReduceImpl:function(){return YA},castImpl:function(){return BA},ceilImpl:function(){return eR},concatImpl:function(){return rR},equalImpl:function(){return aR},expImpl:function(){return sR},expm1Impl:function(){return lR},floorImpl:function(){return dR},gatherNdImpl:function(){return vR},gatherV2Impl:function(){return gR},greaterEqualImpl:function(){return kR},greaterImpl:function(){return yR},lessEqualImpl:function(){return CR},lessImpl:function(){return SR},linSpaceImpl:function(){return AR},logImpl:function(){return RR},maxImpl:function(){return DR},maximumImpl:function(){return MR},minimumImpl:function(){return zR},multiplyImpl:function(){return WR},negImpl:function(){return HR},notEqualImpl:function(){return qR},prodImpl:function(){return $R},raggedGatherImpl:function(){return aF},raggedRangeImpl:function(){return oF},raggedTensorToTensorImpl:function(){return pF},rangeImpl:function(){return hF},rsqrtImpl:function(){return dF},scatterImpl:function(){return vF},sigmoidImpl:function(){return gF},simpleAbsImpl:function(){return AA},sliceImpl:function(){return xF},sparseFillEmptyRowsImpl:function(){return IF},sparseReshapeImpl:function(){return SF},sparseSegmentReductionImpl:function(){return NF},sqrtImpl:function(){return TF},squaredDifferenceImpl:function(){return EF},stridedSliceImpl:function(){return FF},stringNGramsImpl:function(){return DF},stringSplitImpl:function(){return OF},stringToHashBucketFastImpl:function(){return LF},subImpl:function(){return zF},tileImpl:function(){return VF},topKImpl:function(){return HF},transposeImpl:function(){return YR},uniqueImpl:function(){return jF}});var RA={kernelName:rt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs.x,n=e.backend;TA(t,"abs");var r=new Float32Array(Aa.sizeFromShape(t.shape));return r=AA(n.data.get(t.dataId).values),n.makeOutput(r,t.shape,t.dtype)}};function FA(e){return function(t,n,r,a,i){var o=vm.assertAndGetBroadcastShape(t,n),s=o.length,u=Aa.computeStrides(o),c=Aa.sizeFromShape(o),l=Aa.getTypedArrayFromDType(i,c),p=t.length,h=n.length,d=Aa.computeStrides(t),f=Aa.computeStrides(n),m=vm.getBroadcastDims(t,o),v=vm.getBroadcastDims(n,o);if(m.length+v.length===0)for(var g=0;g<l.length;++g)l[g]=e(r[g%r.length],a[g%a.length]);else for(var y=function(){var t=Aa.indexToLoc(b,s,u),n=t.slice(-p);m.forEach((function(e){return n[e]=0}));var i=Aa.locToIndex(n,p,d),o=t.slice(-h);v.forEach((function(e){return o[e]=0}));var c=Aa.locToIndex(o,h,f);l[b]=e(r[i],a[c])},b=0;b<l.length;++b)y();return[l,o]}}function ZA(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=n.makeTensorInfo(r.shape,"complex64");return n.data.get(s.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",i),imag:n.makeTensorInfo(a.shape,"float32",o)},s}var DA={kernelName:Et,backendName:"cpu",kernelFunc:ZA};function MA(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"float32";if("complex64"===n)return ZA({inputs:{real:MA(e,t,"float32"),imag:MA(e,t,"float32")},backend:e});var r=Aa.makeZerosTypedArray(Aa.sizeFromShape(t),n);return e.makeTensorInfo(t,n,r)}function OA(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var LA={kernelName:yn,backendName:"cpu",kernelFunc:OA};function zA(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.real,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var PA={kernelName:mr,backendName:"cpu",kernelFunc:zA};function BA(e,t,n,r){if("int32"===r)return[t,"int32",Int32Array.from(e)];if("bool"===r){var a=Aa.toTypedArray([0],n),i=FA((function(e,t){return e!==t?1:0}))(t,[],e,a,"bool"),o=(0,h.Z)(i,2),s=o[0];return[o[1],"bool",s]}throw new Error("Error in Cast: failed to cast ".concat(n," to ").concat(r))}function WA(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dtype;if("complex64"===i){if("complex64"===a.dtype)return OA({inputs:{x:a},backend:n});var o=MA(n,a.shape,a.dtype),s=WA({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),u=ZA({inputs:{real:s,imag:o},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}if("complex64"===a.dtype){var c=zA({inputs:{input:a},backend:n}),l=WA({inputs:{x:c},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(c),l}if(!Aa.hasEncodingLoss(a.dtype,i)){var p=OA({inputs:{x:a},backend:n});return{dataId:p.dataId,shape:p.shape,dtype:i}}var d=BA(n.data.get(a.dataId).values,a.shape,a.dtype,i),f=(0,h.Z)(d,3),m=f[0],v=f[1],g=f[2];return n.makeTensorInfo(m,v,g)}var VA={kernelName:Tt,backendName:"cpu",kernelFunc:WA};function UA(e,t,n,r){return null==n?function(n){var a=n.inputs,i=n.backend,o=a.a,s=a.b,u=i;TA([o,s],e);var c=u.data.get(o.dataId).values,l=u.data.get(s.dataId).values,p="string"===o.dtype?vm.fromUint8ToStringArray(c):c,d="string"===o.dtype?vm.fromUint8ToStringArray(l):l,f=r||o.dtype,m=t(o.shape,s.shape,p,d,f),v=(0,h.Z)(m,2),g=v[0],y=v[1];return u.makeTensorInfo(y,f,g)}:function(e){var a=e.inputs,i=e.backend,o=a.a,s=a.b,u=i;if("complex64"===o.dtype||"complex64"===s.dtype){var c=WA({inputs:{x:o},backend:u,attrs:{dtype:"complex64"}}),l=u.data.get(c.dataId),p=l.complexTensorInfos.real,d=l.complexTensorInfos.imag,f=u.data.get(p.dataId).values,m=u.data.get(d.dataId).values,v=WA({inputs:{x:s},backend:u,attrs:{dtype:"complex64"}}),g=u.data.get(v.dataId),y=g.complexTensorInfos.real,b=g.complexTensorInfos.imag,x=u.data.get(y.dataId).values,k=u.data.get(b.dataId).values,w=n(o.shape,s.shape,f,m,x,k),I=(0,h.Z)(w,3),S=I[0],N=I[1],T=I[2],C=u.makeTensorInfo(T,"float32",S),_=u.makeTensorInfo(T,"float32",N),E=ZA({inputs:{real:C,imag:_},backend:u});return u.disposeIntermediateTensorInfo(c),u.disposeIntermediateTensorInfo(v),u.disposeIntermediateTensorInfo(C),u.disposeIntermediateTensorInfo(_),E}var A=u.data.get(o.dataId).values,R=u.data.get(s.dataId).values,F=r||o.dtype,Z=t(o.shape,s.shape,A,R,F),D=(0,h.Z)(Z,2),M=D[0],O=D[1];return u.makeTensorInfo(O,F,M)}}function GA(e){return function(t,n,r,a,i,o){var s=vm.assertAndGetBroadcastShape(t,n),u=Aa.sizeFromShape(s),c=s.length,l=Aa.computeStrides(s),p=Aa.getTypedArrayFromDType("float32",u),h=Aa.getTypedArrayFromDType("float32",u),d=vm.getBroadcastDims(t,s),f=vm.getBroadcastDims(n,s),m=vm.mergeRealAndImagArrays(r,a),v=vm.mergeRealAndImagArrays(i,o),g=t.length,y=Aa.computeStrides(t),b=n.length,x=Aa.computeStrides(n);if(d.length+f.length===0)for(var k=0;k<p.length;k++){var w=k%m.length,I=k%v.length,S=e(m[2*w],m[2*w+1],v[2*I],v[2*I+1]);p[k]=S.real,h[k]=S.imag}else for(var N=function(){var t=Aa.indexToLoc(T,c,l),n=t.slice(-g);d.forEach((function(e){return n[e]=0}));var r=Aa.locToIndex(n,g,y),a=t.slice(-b);f.forEach((function(e){return a[e]=0}));var i=Aa.locToIndex(a,b,x),o=e(m[2*r],m[2*r+1],v[2*i],v[2*i+1]);p[T]=o.real,h[T]=o.imag},T=0;T<p.length;T++)N();return[p,h,s]}}var HA=FA((function(e,t){return e+t})),jA=GA((function(e,t,n,r){return{real:e+n,imag:t+r}})),qA=UA(ot,HA,jA),KA={kernelName:ot,backendName:"cpu",kernelFunc:qA};function XA(e,t,n,r,a){for(var i=Aa.sizeFromShape(r),o=Aa.makeZerosTypedArray(a,n),s=0;s<e.length;s++){var u=e[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(o[u]+=i>0?t[s]:1)}return o}function YA(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.shape[0],i=e.shape[1],o=us([a,n],t.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=e.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=n||(r?o.set(1,s,c):t.size>0?o.set(o.get(s,c)+t.get(s,u),s,c):o.set(o.get(s,c)+1,s,c))}return o}function JA(e){return function(t,n,r){for(var a=Aa.getTypedArrayFromDType(n,t.length),i=0;i<t.length;++i)a[i]=e(t[i],r);return a}}function QA(e,t,n){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;if(TA(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");for(var u=o,c=u.data.get(s.dataId).values,l=Aa.sizeFromShape(s.shape),p=n||s.dtype,h=Aa.getArrayFromDType(p,l),d=0;d<l;++d)h[d]=t(c[d],i);return u.makeTensorInfo(s.shape,p,h)}}function $A(e,t,n){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;if(TA(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");var u=o,c=u.data.get(s.dataId).values,l=n||s.dtype,p=t(c,l,i);return u.makeTensorInfo(s.shape,l,p)}}var eR=JA((function(e){return Math.ceil(e)})),tR=$A(Ct,eR),nR={kernelName:Ct,backendName:"cpu",kernelFunc:tR};function rR(e,t,n,r){var a=Aa.getArrayFromDType(n,Aa.sizeFromShape(t));if(r&&"string"!==n){var i=0;e.forEach((function(e){var t=Aa.sizeFromShape(e.shape);a.set(e.vals,i),i+=t}))}else{var o=0;e.forEach((function(e){for(var r="string"===n?vm.fromUint8ToStringArray(e.vals):e.vals,i=0,s=0;s<e.shape[0];++s)for(var u=s*t[1]+o,c=0;c<e.shape[1];++c)a[u+c]=r[i++];o+=e.shape[1]}))}return a}var aR=FA((function(e,t){return e===t?1:0})),iR=UA(rn,aR,null,"bool"),oR={kernelName:rn,backendName:"cpu",kernelFunc:iR},sR=JA((function(e){return Math.exp(e)})),uR=$A(an,sR,"float32"),cR={kernelName:an,backendName:"cpu",kernelFunc:uR},lR=JA((function(e){return Math.expm1(e)})),pR=$A(sn,lR),hR={kernelName:sn,backendName:"cpu",kernelFunc:pR},dR=JA((function(e){return Math.floor(e)})),fR=$A(pn,dR),mR={kernelName:pn,backendName:"cpu",kernelFunc:fR};function vR(e,t,n,r,a,i,o,s,u){for(var c=us([r,i],n),l=0;l<r;l++){for(var p=[],h=0,d=0;d<a;d++){var f=e[l*a+d];h+=f*o[d],p.push(f)}if(h<0||h>=u/i)throw new Error("Invalid indices: ".concat(p," does not index into ").concat(s));for(var m=0;m<i;m++)c.values[l*i+m]=t.get.apply(t,(0,g.Z)(t.indexToLoc(h*i+m)))}return c}function gR(e,t,n){for(var r=us(n,e.dtype),a=0;a<r.size;++a){var i=r.indexToLoc(a).slice(),o=i[0],s=i[2],u=t.locToIndex([o,s]);i[2]=t.values[u];var c=e.locToIndex(i);0<=c&&c<e.values.length&&(r.values[a]=e.values[c])}return r}var yR=FA((function(e,t){return e>t?1:0})),bR=UA(vn,yR,null,"bool"),xR={kernelName:vn,backendName:"cpu",kernelFunc:bR},kR=FA((function(e,t){return e>=t?1:0})),wR=UA(gn,kR,null,"bool"),IR={kernelName:gn,backendName:"cpu",kernelFunc:wR},SR=FA((function(e,t){return e<t?1:0})),NR=UA(Nn,SR,null,"bool"),TR={kernelName:Nn,backendName:"cpu",kernelFunc:NR},CR=FA((function(e,t){return e<=t?1:0})),_R=UA(Tn,CR,null,"bool"),ER={kernelName:Tn,backendName:"cpu",kernelFunc:_R};function AR(e,t,n){var r=(t-e)/(n-1),a=Aa.makeZerosTypedArray(n,"float32");a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+r;return a}var RR=JA((function(e){return Math.log(e)})),FR=$A(_n,RR),ZR={kernelName:_n,backendName:"cpu",kernelFunc:FR};function DR(e,t,n,r){for(var a=Aa.getTypedArrayFromDType(r,Aa.sizeFromShape(n)),i=0;i<a.length;++i){for(var o=i*t,s=e[o],u=0;u<t;++u){var c=e[o+u];(Number.isNaN(c)||c>s)&&(s=c)}a[i]=s}return a}var MR=FA((function(e,t){return Math.max(e,t)})),OR=UA(Pn,MR),LR={kernelName:Pn,backendName:"cpu",kernelFunc:OR},zR=FA((function(e,t){return Math.min(e,t)})),PR=UA(qn,zR),BR={kernelName:qn,backendName:"cpu",kernelFunc:PR},WR=FA((function(e,t){return e*t})),VR=GA((function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})),UR=UA(Jn,WR,VR),GR={kernelName:Jn,backendName:"cpu",kernelFunc:UR};function HR(e,t,n){var r=Aa.createScalarValue(-1,n);return WR([],t,r,e,n)}var jR={kernelName:Qn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x;TA(r,"neg");var a=HR(n.data.get(r.dataId).values,r.shape,r.dtype),i=(0,h.Z)(a,2),o=i[0],s=i[1];return n.makeTensorInfo(s,r.dtype,o)}},qR=FA((function(e,t){return e!==t?1:0})),KR=UA($n,qR,null,"bool"),XR={kernelName:$n,backendName:"cpu",kernelFunc:KR};function YR(e,t,n,r,a){for(var i=t.length,o=Aa.sizeFromShape(t),s=Aa.computeStrides(t),u=Aa.computeStrides(a),c=Aa.getTypedArrayFromDType(n,Aa.sizeFromShape(a)),l=0;l<o;++l){for(var p=Aa.indexToLoc(l,i,s),h=new Array(p.length),d=0;d<h.length;d++)h[d]=p[r[d]];c[Aa.locToIndex(h,i,u)]=e[l]}return c}function JR(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.perm;TA(a,"transpose");for(var o=a.shape.length,s=new Array(o),u=0;u<s.length;u++)s[u]=a.shape[i[u]];var c=YR(r.data.get(a.dataId).values,a.shape,a.dtype,i,s);return{dataId:r.write(c,s,a.dtype),shape:s,dtype:a.dtype}}var QR={kernelName:ia,backendName:"cpu",kernelFunc:JR};function $R(e,t,n,r){for(var a=vm.computeOutAndReduceShapes(e,r),i=(0,h.Z)(a,2),o=i[0],s=i[1],u=wi(t,"int32"),c=Aa.makeZerosTypedArray(Aa.sizeFromShape(o),u),l=Aa.sizeFromShape(s),p=0;p<c.length;++p){for(var d=p*l,f=1,m=0;m<l;++m)f*=n[d+m];c[p]=f}return{outVals:c,outShape:o,outDtype:u}}var eF={kernelName:lr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;TA(a,"prod");var s=a.shape.length,u=Aa.parseAxisParam(i,a.shape),c=vm.getAxesPermutation(u,s),l=u,p=a,h=[];null!=c&&(p=JR({inputs:{x:a},backend:n,attrs:{perm:c}}),h.push(p),l=vm.getInnerMostAxes(l.length,s));var d=n.data.get(p.dataId).values,f=$R(p.shape,p.dtype,d,l),m=f.outVals,v=f.outShape,g=f.outDtype,y=v;return o&&(y=vm.expandShapeToKeepDim(v,u)),h.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(y,g,m)}};function tF(e,t,n,r){var a=[],i=0,o=t.length-1+n.length,s=new Array(o).fill(null).map((function(){return[0]}));!function(e,t){for(var n=0;n<e.length;++n){var r=e[n],a=n===e.length-1?t:e[n+1].length;if(0===r.length)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>a)throw new Error("Ragged splits must not point past values");for(var i=1;i<r.length;++i)if(r[i-1]>r[i])throw new Error("Ragged splits must be sorted in ascending order")}}(n,r);for(var u=1,c=0;c<t.length-1;++c){u*=t[c];for(var l=t[c+1],p=1;p<u+1;++p)s[c].push(p*l)}for(var h=0;h<e.length;++h){for(var d=e[h],f=e[h]+1,m=0;m<n.length;++m){var v=n[m],g=m+t.length-1;if(g>=0)for(var y=s[g],b=y[y.length-1]-v[d],x=d;x<f;++x)s[g].push(v[x+1]+b);d=v[d],f=v[f]}f!==d&&(a.push([d,f]),i+=f-d)}return{outSplits:s,valueSlices:a,numValues:i}}function nF(e,t){for(var n=e.slice(0,t);n.length<t;)n.push(1);for(var r=t;r<e.length;r++)n[t-1]*=e[r];return n}function rF(e,t,n,r,a){var i=t.slice();i[0]=a;var o=Aa.getArrayFromDType(n,Aa.sizeFromShape(i)),s=e.length;return function(e,t,n,r,a,i){var o,s=nF(t,2)[1],u=nF(i,2)[1],c=0,l=(0,y.Z)(n);try{for(l.s();!(o=l.n()).done;)for(var p=o.value,h=p[0];h<p[1];++h){for(var d=0;d<r;++d)a[c*u+d]=e[h*s+d];++c}}catch(f){l.e(f)}finally{l.f()}}(e,t,r,0===s?0:s/t[0],o,i),[o,i]}function aF(e,t,n,r,a,i,o,s){if(0===e.length)throw new Error("paramsNestedSplits must be non empty");if(0===t[0].length)throw new Error("Split tensors must not be scalars");if(function(e,t,n){e.forEach((function(e,r){if(e<0||e>=n){var a=Aa.indexToLoc(r,t.length,Aa.computeStrides(t)).join(",");throw new Error("indices[".concat(a,"] = ").concat(e," is not in [0, ").concat(n,")"))}}))}(i,o,t[0][0]-1),0===r.length)throw new Error("params.rank must be nonzero");var u=tF(i,o,e,r[0]),c=u.outSplits,l=u.valueSlices,p=u.numValues,h=function(e){for(var t=[],n=function(){var n=e[r].length,a=Aa.getArrayFromDType("int32",n);t.push(a),e[r].forEach((function(e,t){return a[t]=e}))},r=0;r<e.length;++r)n();return t}(c),d=rF(n,r,a,l,p);return[h,d[0],d[1]]}var iF=2147483647;function oF(e,t,n,r,a,i,o){if(t.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");var s=0===t.length,u=0===a.length,c=0===o.length,l=[];s||l.push(t[0]),u||l.push(a[0]),c||l.push(o[0]);for(var p=1;p<l.length;++p)if(l[p]!==l[p-1])throw new Error("starts, limits, and deltas must have the same shape");var h=0===l.length?1:l[0],d=Aa.getArrayFromDType("int32",h+1);d[0]=0;for(var f=0;f<h;++f){var m=s?e[0]:e[f],v=u?r[0]:r[f],g=c?i[0]:i[f];if(0===g)throw new Error("Requires delta != 0");var y=void 0;if(g>0&&v<m||g<0&&v>m)y=0;else if((y=Math.ceil(Math.abs((v-m)/g)))>iF)throw new Error("Requires ((limit - start) / delta) <= ".concat(iF));d[f+1]=d[f]+y}for(var b=d[h],x=Aa.getArrayFromDType(n,b),k=0,w=0;w<h;++w)for(var I=d[w+1]-d[w],S=s?e[0]:e[w],N=c?i[0]:i[w],T=0;T<I;++T)x[k++]=S,S+=N;return[d,x]}var sF=vm.RowPartitionType,uF=function(){function e(t,n,r,a,i,o,s,u,c,l){(0,m.Z)(this,e),this.shape=t,this.shapeShape=n,this.values=r,this.valuesShape=a,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=vm.getRowPartitionTypesHelper(l),this.raggedRank=vm.getRaggedRank(this.rowPartitionTypes)}return(0,v.Z)(e,[{key:"getRowPartitionTypeByDimension",value:function(e){return this.rowPartitionTypes[0]===sF.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}},{key:"getRowPartitionTensor",value:function(e){return this.rowPartitionTypes[0]===sF.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}},{key:"getMaxWidth",value:function(t){var n=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case sF.VALUE_ROWIDS:return e.getMaxWidthValueRowID(n);case sF.ROW_SPLITS:return e.getMaxWidthRowSplit(n);default:throw new Error("Cannot handle partition type ".concat(sF[this.getRowPartitionTypeByDimension(t-1)]))}}},{key:"tensorShapeFromTensor",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(0===t.length){if(-1===e[0])return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return lF(e,n)}},{key:"calculateOutputSize",value:function(e){var t=this.valuesShape,n=this.defaultValueShape;vm.validateDefaultValueShape(n,t);var r=this.tensorShapeFromTensor(this.shape,this.shapeShape),a=vm.combineRaggedTensorToTensorShapes(this.raggedRank,r,t);a[0]<0&&(a[0]=e);for(var i=1;i<=this.raggedRank;++i)a[i]<0&&(a[i]=this.getMaxWidth(i));return a}},{key:"calculateFirstParentOutputIndex",value:function(e,t,n){for(var r=Math.min(e,n),a=[],i=0,o=0;o<r;++o,i+=t)a.push(i);for(var s=r;s<e;++s)a.push(-1);return Aa.assert(a.length===e,(function(){return"Final length of result must be equal to firstDimension."})),a}},{key:"calculateOutputIndexRowSplit",value:function(e,t,n,r){for(var a=e.length,i=[],o=0;o<a-1;++o){var s=e[o+1]-e[o],u=Math.min(r,s),c=t[o];-1===c&&(u=0);for(var l=0;l<u;++l)i.push(c),c+=n;for(var p=0;p<s-u;++p)i.push(-1)}if(a>0&&i.length!==e[a-1])throw new Error("Invalid row split size.");return i}},{key:"calculateOutputIndexValueRowID",value:function(e,t,n,r){var a=e.length,i=[];if(0===a)return[];var o=0,s=e[0];if(s>=t.length)throw new Error("Got currentValueRowId=".concat(s,", which is not less than ").concat(t.length));var u=t[s];i.push(u);for(var c=1;c<a;++c){var l=e[c];if(l===s)u>=0&&(++o<r?u+=n:u=-1);else{if(o=0,s=l,l>=t.length)throw new Error("Got nextValueRowId=".concat(l," which is not less than ").concat(t.length));u=t[l]}i.push(u)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}},{key:"calculateOutputIndex",value:function(e,t,n,r){var a=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case sF.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(a,t,n,r);case sF.ROW_SPLITS:if(a.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(a.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(a,t,n,r);default:throw new Error("Unsupported partition type: ".concat(sF[i]))}}},{key:"getFirstDimensionSize",value:function(){var e=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case sF.FIRST_DIM_SIZE:return e[0];case sF.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case sF.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(sF[t]))}}},{key:"compute",value:function(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var e=this.getFirstDimensionSize(),t=this.calculateOutputSize(e),n=new Array(this.raggedRank+1);n[n.length-1]=1;for(var r=n.length-2;r>=0;--r)n[r]=n[r+1]*t[r+1];var a=lF(t,!1),i=Aa.getArrayFromDType(this.valuesDType,Aa.sizeFromShape(a));if(n[0]*t[0]>0){for(var o=this.calculateFirstParentOutputIndex(e,n[0],t[0]),s=1;s<=this.raggedRank;++s)o=this.calculateOutputIndex(s-1,o,n[s],t[s]);this.setOutput(this.raggedRank,o,i,a)}return[a,i]}},{key:"setOutput",value:function(e,t,n,r){if(0!==n.length){var a=this.values,i=n,o=r.slice();o=o.slice(e+1);var s=Aa.sizeFromShape(o),u=t.length,c=this.defaultValue;if(c.length!==s&&1!==c.length){var l=this.defaultValueShape;xs((function(){var e=pu(c,l);c=_u(e,o).dataSync()}))}for(var p=0,h=0,d=0,f=0;f<=u;++f){var m=f<u?t[f]:-1;if(m!==d){if(h<d){var v=a.subarray(p*s);cF(i.subarray(h*s),v,(d-h)*s)}if(f>=u){var g=n.length;m=Math.floor(g/s)}if(m>d)if(1===this.defaultValue.length)i.subarray(d*s,m*s).fill(this.defaultValue[0]),d=m;else for(;m>d;){cF(i.slice(d*s),c,s),++d}m<0?(p=f+1,h=d):(p=f,d=(h=d)+1)}else++d}}}}],[{key:"getMaxWidthRowSplit",value:function(e){var t=e.length;if(0===t||1===t)return 0;for(var n=0,r=0;r<t-1;++r){var a=e[r+1]-e[r];a>n&&(n=a)}return n}},{key:"getMaxWidthValueRowID",value:function(e){var t=e.length;if(0===t)return 0;for(var n=0,r=e[0],a=0,i=1;i<t;++i){var o=e[i];o!==r&&(r=o,a=Math.max(i-n,a),n=i)}return Math.max(t-n,a)}}]),e}();function cF(e,t,n){for(var r=0;r<n;r++)e[r]=t[r]}function lF(e,t){var n,r=[],a=(0,y.Z)(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i<0){if(!t)throw new Error("Dimension ".concat(i," must be >= 0"));if(i<-1)throw new Error("Dimension ".concat(i," must be >= -1"));i=-1}r.push(i)}}catch(o){a.e(o)}finally{a.f()}return r}function pF(e,t,n,r,a,i,o,s,u,c){return new uF(e,t,n,r,a,i,o,s,u,c).compute()}function hF(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return Aa.makeZerosTypedArray(0,r);var a=Math.abs(Math.ceil((t-e)/n)),i=Aa.makeZerosTypedArray(a,r);t<e&&1===n&&(n=-1),i[0]=e;for(var o=1;o<i.length;o++)i[o]=i[o-1]+n;return i}var dF=JA((function(e){return 1/Math.sqrt(e)})),fF=$A(Tr,dF),mF={kernelName:Tr,backendName:"cpu",kernelFunc:fF};function vF(e,t,n,r,a,i,o,s,u,c){var l=[r/a,a],p=e.values,h=t.values;if(0===r)return us(n,t.dtype);var d=us(l,t.dtype);"string"==typeof u||"number"==typeof u?d.values.fill(u):"boolean"==typeof u&&d.values.fill(+u);for(var f=0;f<i;f++){for(var m=[],v=0,g=0;g<o;g++){var y=p[f*o+g];m.push(y),v+=y*s[g]}if(v<0||v>=r/a)throw new Error("Invalid indices: ".concat(m," does not index into ").concat(n));for(var b=0;b<a;b++)c?d.values[v*a+b]+=h[f*a+b]:d.values[v*a+b]=0===t.rank?h[0]:h[f*a+b]}return d}var gF=JA((function(e){return 1/(1+Math.exp(-e))})),yF=QA(Mr,(function(e){return 1/(1+Math.exp(-e))})),bF={kernelName:Mr,backendName:"cpu",kernelFunc:yF};function xF(e,t,n,r,a){var i=Gf.isSliceContinous(r,t,n),o=Aa.sizeFromShape(n),s=Aa.computeStrides(r);if(i){var u=Gf.computeFlatOffset(t,s);return"string"===a?e.slice(u,u+o):e.subarray(u,u+o)}for(var c=us(r,a,"string"===a?vm.fromUint8ToStringArray(e):e),l=us(n,a),p=0;p<l.size;++p){var h=l.indexToLoc(p),d=h.map((function(e,n){return e+t[n]}));l.set.apply(l,[c.get.apply(c,(0,g.Z)(d))].concat((0,g.Z)(h)))}return"string"===a?vm.fromStringArrayToUint8(l.values):l.values}function kF(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.size;TA(a,"slice");var s=Gf.parseSliceParams(a,i,o),u=(0,h.Z)(s,2),c=u[0],l=u[1];Gf.assertParamsValid(a,c,l);var p=xF(n.data.get(a.dataId).values,c,l,a.shape,a.dtype);return n.makeTensorInfo(l,a.dtype,p)}var wF={kernelName:Rr,backendName:"cpu",kernelFunc:kF};function IF(e,t,n,r,a,i,o){var s=t[0],u=i[0],c=new Array(u),l=new Array(s),p=t[1];if(0===u){if(0!==s)throw new Error(vm.getSparseFillEmptyRowsIndicesDenseShapeMismatch(s));return[Aa.getArrayFromDType(n,0),[0,p],Aa.getArrayFromDType(a,0),c,l]}for(var h=!0,d=0,f=new Array(u).fill(0),m=0;m<s;++m){var v=e[m*p];if(v<0)throw new Error(vm.getSparseFillEmptyRowsNegativeIndexErrorMessage(m,v));if(v>=u)throw new Error(vm.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(m,v,u));++f[v],h=h&&v>=d,d=v}for(var g=!0,y=0;y<u;++y){var b=0===f[y];c[y]=b,g=g&&!b,f[y]=Math.max(f[y],1),y>0&&(f[y]+=f[y-1])}if(g&&h){for(var x=e,k=r,w=0;w<s;++w)l[w]=w;return[x,[s,p],k,c,l]}for(var I=f[u-1],S=Aa.getArrayFromDType(n,I*p),N=Aa.getArrayFromDType(a,I),T=new Array(u).fill(0),C=0;C<s;++C){var _=e[C*p],E=T[_],A=(0===_?0:f[_-1])+E;T[_]++;for(var R=0;R<p;++R)S[A*p+R]=e[C*p+R];N[A]=r[C],l[C]=A}for(var F=0;F<u;++F)if(0===T[F]){var Z=0===F?0:f[F-1];S[Z*p+0]=F;for(var D=1;D<p;++D)S[Z*p+D]=0;N[Z]=o}return[S,[I,p],N,c,l]}function SF(e,t,n,r,a){for(var i=Aa.sizeFromShape(r),o=t[0],s=a.length,u=[],c=1,l=-1,p=0;p<s;++p){var h=a[p];if(-1===h){if(-1!==l)throw new Error(vm.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(l,p));l=p,u.push(1)}else{if(h<0)throw new Error(vm.getSparseReshapeNegativeOutputDimErrorMessage(p,h));c*=h,u.push(h)}}if(-1!==l){if(c<=0)throw new Error(vm.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());var d=Math.trunc(i/c);if(c*d!==i)throw new Error(vm.getSparseReshapeInputOutputMultipleErrorMessage(r,u));u[l]=d}if(Aa.sizeFromShape(u)!==i)throw new Error(vm.getSparseReshapeInputOutputMismatchErrorMessage(r,u));var f=r.length,m=[];if(f>0){m[f-1]=1;for(var v=f-2;v>=0;--v)m[v]=m[v+1]*r[v+1]}var g=[];if(s>0){g[s-1]=1;for(var y=s-2;y>=0;--y)g[y]=g[y+1]*u[y+1]}for(var b=Aa.getArrayFromDType(n,o*s),x=0;x<o;++x){for(var k=0,w=0;w<f;++w)k+=e[x*f+w]*m[w];for(var I=0;I<s;++I)b[x*s+I]=Math.trunc(k/g[I]),k%=g[I]}return[b,[o,s],u]}function NF(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=r.length,u=[t[0],e.length/t[0]],c=u[1],l=s>0?a[s-1]+1:0;if(l<0)throw new Error(vm.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var p=t.slice();p[0]=l;var h=p.reduce((function(e,t){return e*t}),1),d=Aa.getArrayFromDType(n,h);if(0===s)return l>0&&d.fill(o),[d,p];if(l<=0)throw new Error(vm.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());for(var f=0,m=1,v=0,g=a[f];;){var y=0;if(m<s){if(g===(y=a[m])){++m;continue}if(g>=y)throw new Error(vm.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(g<0||g>=l)throw new Error(vm.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(g,l));g>v&&d.fill(o,v*c,g*c);for(var b=f;b<m;++b){var x=r[b];if(x<0||x>=u[0])throw new Error(vm.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(b,r[b],u[0]));for(var k=0;k<c;k++)d[g*c+k]+=e[x*c+k]}if(i)for(var w=0;w<c;w++)d[g*c+w]/=m-f;if(f=m,v=g+1,g=y,++m>s)break}return v<l&&d.fill(o,v*c,l*c),[d,p]}var TF=JA((function(e){return Math.sqrt(e)})),CF=QA(Lr,(function(e){return Math.sqrt(e)})),_F={kernelName:Lr,backendName:"cpu",kernelFunc:CF},EF=FA((function(e,t){var n=e-t;return n*n})),AF=UA(qr,EF),RF={kernelName:qr,backendName:"cpu",kernelFunc:AF};function FF(e,t,n,r){for(var a=us(e,t.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*n[u]+r[u];a.set.apply(a,[t.get.apply(t,s)].concat((0,g.Z)(o)))}return a}var ZF=function(){function e(t,n,r,a,i,o){(0,m.Z)(this,e),this.separator=Aa.encodeString(t),this.nGramWidths=n,this.leftPad=Aa.encodeString(r),this.rightPad=Aa.encodeString(a),this.padWidth=i,this.preserveShort=o}return(0,v.Z)(e,[{key:"getPadWidth",value:function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}},{key:"getNumNGrams",value:function(e,t){var n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}},{key:"createNGrams",value:function(e,t,n,r,a,i){for(var o=this,s=function(){var s=o.getPadWidth(i),c=Math.max(0,s-u),l=Math.max(0,s-(a-(u+1))),p=i-(c+l),h=t+(c>0?0:u-s),d=0;d+=c*o.leftPad.length;for(var f=0;f<p;++f)d+=e[h+f].length;d+=l*o.rightPad.length,d+=(c+l+p-1)*o.separator.length,n[r+u]=new Uint8Array(d);for(var m=n[r+u],v=0,g=function(e){return e.forEach((function(e){return m[v++]=e}))},y=0;y<c;++y)g(o.leftPad),g(o.separator);for(var b=0;b<p-1;++b)g(e[h+b]),g(o.separator);if(p>0){g(e[h+p-1]);for(var x=0;x<l;++x)g(o.separator),g(o.rightPad)}else{for(var k=0;k<l-1;++k)g(o.rightPad),g(o.separator);g(o.rightPad)}},u=0;u<a;++u)s()}},{key:"compute",value:function(e,t){var n=this,r=e.length,a=t.length;if(a>0){var i=t[0];if(0!==i)throw new Error("First split value must be 0, got ".concat(i));for(var o=1;o<a;++o){var s=t[o]>=i;if(!(s=s&&t[o]<=r))throw new Error("Invalid split value ".concat(t[o],", must be in [").concat(i,", ").concat(r,"]"));i=t[o]}if(i!==r)throw new Error("Last split value must be data size. Expected ".concat(r,", got ").concat(i))}var u=a-1,c=Aa.getArrayFromDType("int32",a);if(0===r||0===a){for(var l=new Array(r),p=0;p<=u;++p)c[p]=0;return[l,c]}c[0]=0;for(var h=function(){var e=t[d]-t[d-1],r=0;n.nGramWidths.forEach((function(t){r+=n.getNumNGrams(e,t)})),n.preserveShort&&e>0&&0===r&&(r=1),c[d]=c[d-1]+r},d=1;d<=u;++d)h();for(var f=new Array(c[u]),m=function(r){var a=t[r],i=c[r];if(n.nGramWidths.forEach((function(o){var s=t[r+1]-t[r],u=n.getNumNGrams(s,o);n.createNGrams(e,a,f,i,u,o),i+=u})),n.preserveShort&&i===c[r]){var o=t[r+1]-t[r];if(0===o)return"continue";var s=o+2*n.padWidth;n.createNGrams(e,a,f,i,1,s)}},v=0;v<u;++v)m(v);return[f,c]}}]),e}();function DF(e,t,n,r,a,i,o,s){return new ZF(n,r,a,i,o,s).compute(e,t)}function MF(e,t,n,r){if(e.length)if(0!==t.length)if(1!==t.length){for(var a=0,i=0;i<e.length+1;i++)if(i===e.length||-1!==t.indexOf(e[i])){var o=e.subarray(a,i);(!n||0!==o.length)&&r.push(o),a=i+1}}else{for(var s=t[0],u=e.indexOf(s);-1!==u;){var c=e.subarray(0,u);(!n||0!==c.length)&&r.push(c),u=(e=e.subarray(u+1)).indexOf(s)}(!n||0!==e.length)&&r.push(e)}else for(var l=0;l<e.length;++l)r.push(e.subarray(l,l+1))}function OF(e,t,n){for(var r=e.length,a=[],i=0,o=0,s=new Array(r),u=0;u<r;++u){var c=a.length;MF(e[u],t,n,a);var l=a.length-c;s[u]=l,i+=l,o=Math.max(o,l)}for(var p=Aa.getArrayFromDType("int32",2*i),h=new Array(i),d=[r,o],f=0,m=0;m<r;++m)for(var v=0;v<s[m];++v)p[2*f]=m,p[2*f+1]=v,h[f]=a[f],++f;return[p,h,d]}function LF(e,t){for(var n=Aa.getArrayFromDType("int32",e.length),r=0;r<e.length;++r)n[r]=Aa.fingerPrint64(e[r]).modulo(t).getLowBitsUnsigned();return n}var zF=FA((function(e,t){return e-t})),PF=GA((function(e,t,n,r){return{real:e-n,imag:t-r}})),BF=UA($r,zF,PF),WF={kernelName:$r,backendName:"cpu",kernelFunc:BF};function VF(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];for(var a=us(n,e.dtype),i=0;i<a.values.length;++i){for(var o=a.indexToLoc(i),s=new Array(e.rank),u=0;u<s.length;u++)s[u]=o[u]%e.shape[u];var c=e.locToIndex(s);a.values[i]=e.values[c]}return a}var UF=function(e,t){var n=t.value-e.value;return 0===n?e.index-t.index:n};function GF(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length-1;r>n;){if(r-n>600){var a=r-n+1,i=t-n+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2);GF(e,t,Math.max(n,Math.floor(t-i*s/a+u)),Math.min(r,Math.floor(t+(a-i)*s/a+u)))}var c=e[t],l=n,p=r;for(Aa.swap(e,n,t),UF(e[r],c)>0&&Aa.swap(e,n,r);l<p;){for(Aa.swap(e,l,p),l++,p--;UF(e[l],c)<0;)l+=1;for(;UF(e[p],c)>0;)p-=1}0===UF(e[n],c)?Aa.swap(e,n,p):(p+=1,Aa.swap(e,p,r)),p<=t&&(n=p+1),t<=p&&(r=p-1)}}function HF(e,t,n,r,a){for(var i=t[t.length-1],o=e.length/i,s=i,u=Aa.getTypedArrayFromDType(n,o*r),c=Aa.getTypedArrayFromDType("int32",o*r),l=function(){var t=p*s,n=e.subarray(t,t+s),i=new Array(n.length);n.forEach((function(e,t){return i[t]={value:e,index:t}})),r<i.length&&(GF(i,r),i=i.slice(0,r)),a&&i.sort(UF);for(var o=p*r,l=u.subarray(o,o+r),h=c.subarray(o,o+r),d=0;d<r;d++)l[d]=i[d].value,h[d]=i[d].index},p=0;p<o;p++)l();var h=t.slice();return h[h.length-1]=r,[us(h,n,u),us(h,"int32",c)]}function jF(e,t,n,r){for(var a=Aa.parseAxisParam(t,n)[0],i=[1,n[0],1],o=0;o<a;o++)i[0]*=n[o];i[1]=n[a];for(var s=a+1;s<n.length;s++)i[2]*=n[s];for(var u={},c=new Int32Array(n[a]),l=new ci(i,r,e),p=[],h=1===i[0]&&1===i[2],d=0;d<n[a];d++){var f=void 0;if(h)f=e[d].toString();else{for(var m=[],v=0;v<i[0];v++)for(var g=0;g<i[2];g++)m.push(l.get(v,d,g));f=m.join(",")}if(void 0!==u[f])c[d]=u[f];else{var y=Object.keys(u).length;u[f]=y,c[d]=y,p.push(d)}}var b=i.slice();b[1]=Object.keys(u).length;var x=new ci(b,r);p.forEach((function(e,t){for(var n=0;n<i[0];n++)for(var r=0;r<i[2];r++)x.set(l.get(n,e,r),n,t,r)}));var k=n.slice();return k[a]=b[1],{outputValues:x.values,outputShape:k,indices:c}}As("cpu",(function(){return new _A}),1);var qF=QA(en,(function(e){return e>=0?e:Math.exp(e)-1})),KF={kernelName:en,backendName:"cpu",kernelFunc:qF};function XF(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.alpha;TA([a],"leakyRelu");for(var o=Aa.sizeFromShape(a.shape),s=n.data.get(a.dataId).values,u=Aa.getTypedArrayFromDType("float32",o),c=0;c<s.length;c++)u[c]=s[c]<0?i*s[c]:s[c];return n.makeTensorInfo(a.shape,"float32",u)}var YF={kernelName:Sn,backendName:"cpu",kernelFunc:XF},JF=FA((function(e,t){return e<0?t*e:e}));function QF(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha;TA([r,a],"prelu");var i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=JF(r.shape,a.shape,i,o,"float32"),u=(0,h.Z)(s,2),c=u[0],l=u[1];return n.makeTensorInfo(l,"float32",c)}var $F={kernelName:cr,backendName:"cpu",kernelFunc:QF},eZ=QA(gr,(function(e){return Math.max(0,e)})),tZ={kernelName:gr,backendName:"cpu",kernelFunc:eZ},nZ=QA(Ir,(function(e){return Math.min(Math.max(0,e),6)})),rZ={kernelName:Ir,backendName:"cpu",kernelFunc:nZ};function aZ(e,t,n,r,a){if("linear"===n)return OA({inputs:{x:t},backend:e});if("relu"===n)return eZ({inputs:{x:t},backend:e});if("elu"===n)return qF({inputs:{x:t},backend:e});if("relu6"===n)return nZ({inputs:{x:t},backend:e});if("prelu"===n)return QF({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return XF({inputs:{x:t},backend:e,attrs:{alpha:a}});if("sigmoid"===n)return yF({inputs:{x:t},backend:e});throw new Error("Activation ".concat(n," has not been implemented for the CPU backend."))}function iZ(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,o=Aa.sizeFromShape(a.shape),s=Aa.inferFromImplicitShape(i,o),u=Aa.sizeFromShape(s);Aa.assert(o===u,(function(){return"The new shape (".concat(s,") has ").concat(u," elements and the old shape (").concat(a.shape,") has ").concat(o," elements. The new shape and old shape must have the same number of elements.")})),n.incRef(a.dataId);var c=n.data.get(a.dataId);if(null!=c.complexTensorInfos){var l=c.complexTensorInfos.real,p=c.complexTensorInfos.imag;l.shape=s,p.shape=s}return{dataId:a.dataId,shape:s,dtype:a.dtype}}var oZ={kernelName:yr,backendName:"cpu",kernelFunc:iZ};function sZ(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=r.transposeA,s=r.transposeB;TA([a,i],"matMul");var u=a.shape.length,c=i.shape.length,l=o?a.shape[u-2]:a.shape[u-1],p=s?i.shape[c-1]:i.shape[c-2],d=o?a.shape[u-1]:a.shape[u-2],f=s?i.shape[c-2]:i.shape[c-1],m=a.shape.slice(0,-2),v=i.shape.slice(0,-2),g=Aa.sizeFromShape(m),y=Aa.sizeFromShape(v),b=Qu.assertAndGetBroadcastShape(a.shape.slice(0,-2),i.shape.slice(0,-2)).concat([d,f]);Aa.assert(l===p,(function(){return"Error in matMul: inner shapes (".concat(l,") and (").concat(p,") of Tensors with shapes ").concat(a.shape," and ").concat(i.shape," and transposeA=").concat(o," and transposeB=").concat(s," must match.")}));for(var x=s?[y,f,p]:[y,p,f],k=iZ({inputs:{x:a},backend:n,attrs:{shape:o?[g,l,d]:[g,d,l]}}),w=iZ({inputs:{x:i},backend:n,attrs:{shape:x}}),I=o?k.shape[1]:k.shape[2],S=o?k.shape[2]:k.shape[1],N=s?w.shape[1]:w.shape[2],T=Math.max(g,y),C=n.data.get(k.dataId).values,_=n.data.get(w.dataId).values,E=Aa.computeStrides(k.shape),A=Aa.computeStrides(w.shape),R=o?[E[0],1,E[1]]:[E[0],E[1],1],F=(0,h.Z)(R,3),Z=F[0],D=F[1],M=F[2],O=s?[1,A[1],A[0]]:[A[1],1,A[0]],L=(0,h.Z)(O,3),z=L[0],P=L[1],B=L[2],W=S*N,V=us([T,S,N],k.dtype),U=V.values,G=n.blockSize,H=0;H<T;H++)for(var j=H%g,q=H%y,K=0;K<S;K+=G)for(var X=Math.min(K+G,S),Y=0;Y<N;Y+=G)for(var J=Math.min(Y+G,N),Q=0;Q<I;Q+=G)for(var $=Math.min(Q+G,I),ee=K;ee<X;ee++)for(var te=Y;te<J;te++){for(var ne=0,re=Q;re<$;re++){ne+=C[j*Z+ee*D+re*M]*_[re*z+te*P+q*B]}U[H*W+(ee*N+te)]+=ne}return n.disposeIntermediateTensorInfo(k),n.disposeIntermediateTensorInfo(w),n.makeTensorInfo(b,V.dtype,V.values)}var uZ={kernelName:kt,backendName:"cpu",kernelFunc:sZ};var cZ={kernelName:fa,backendName:"cpu",kernelFunc:function(e){var t,n,r,a=e.inputs,i=e.backend,o=e.attrs,s=a.a,u=a.b,c=a.bias,l=a.preluActivationWeights,p=o.transposeA,h=o.transposeB,d=o.activation,f=o.leakyreluAlpha,m=[];t=sZ({inputs:{a:s,b:u},attrs:{transposeA:p,transposeB:h},backend:i}),c&&(n=qA({inputs:{a:t,b:c},backend:i}),m.push(t),t=n),d&&(r=aZ(i,t,d,l,f),m.push(t),t=r);for(var v=0,g=m;v<g.length;v++){var y=g[v];i.disposeIntermediateTensorInfo(y)}return t}},lZ=QA(at,(function(e){return Math.acos(e)})),pZ={kernelName:at,backendName:"cpu",kernelFunc:lZ},hZ=QA(it,(function(e){return Math.acosh(e)})),dZ={kernelName:it,backendName:"cpu",kernelFunc:hZ};var fZ={kernelName:st,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t;TA(t,"addN");for(var a=r.map((function(e){return n.data.get(e.dataId).values})),i=us(r[0].shape,r[0].dtype),o=i.values,s=0;s<r.length;s++)for(var u=a[s],c=0;c<o.length;c++)o[c]+=u[c];return n.makeTensorInfo(i.shape,i.dtype,i.values)}};var mZ={kernelName:ut,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;TA(a,"all");var s=Aa.parseAxisParam(i,a.shape),u=s,c=vm.getAxesPermutation(u,a.shape.length),l=a;null!=c&&(l=JR({inputs:{x:a},backend:n,attrs:{perm:c}}),u=vm.getInnerMostAxes(u.length,a.shape.length)),vm.assertAxesAreInnerMostDims("all",u,l.shape.length);for(var p=vm.computeOutAndReduceShapes(l.shape,u),d=(0,h.Z)(p,2),f=d[0],m=d[1],v=Aa.sizeFromShape(m),g=Aa.makeZerosTypedArray(Aa.sizeFromShape(f),l.dtype),y=n.data.get(l.dataId).values,b=0;b<g.length;++b){for(var x=b*v,k=y[x],w=0;w<v;++w){var I=y[x+w];k=k&&I}g[b]=k}null!=c&&n.disposeIntermediateTensorInfo(l);var S=n.makeTensorInfo(f,l.dtype,g);if(o){var N=iZ({inputs:{x:S},backend:n,attrs:{shape:vm.expandShapeToKeepDim(f,s)}});return n.disposeIntermediateTensorInfo(S),N}return S}};var vZ={kernelName:ct,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;TA(a,"any");var s=Aa.parseAxisParam(i,a.shape),u=s,c=vm.getAxesPermutation(u,a.shape.length),l=a;null!=c&&(l=JR({inputs:{x:a},backend:n,attrs:{perm:c}}),u=vm.getInnerMostAxes(u.length,a.shape.length)),vm.assertAxesAreInnerMostDims("any",u,l.shape.length);for(var p=vm.computeOutAndReduceShapes(l.shape,u),d=(0,h.Z)(p,2),f=d[0],m=d[1],v=Aa.sizeFromShape(m),g=Aa.makeZerosTypedArray(Aa.sizeFromShape(f),l.dtype),y=n.data.get(l.dataId).values,b=0;b<g.length;++b){for(var x=b*v,k=y[x],w=0;w<v;++w){var I=y[x+w];k=k||I}g[b]=k}null!=c&&n.disposeIntermediateTensorInfo(l);var S=n.makeTensorInfo(f,l.dtype,g);if(o){var N=iZ({inputs:{x:S},backend:n,attrs:{shape:vm.expandShapeToKeepDim(f,s)}});return n.disposeIntermediateTensorInfo(S),N}return S}};var gZ={kernelName:lt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis;TA(a,"argMax");var o=Aa.parseAxisParam(i,a.shape),s=vm.getAxesPermutation(o,a.shape.length),u=a,c=[];null!=s&&(u=JR({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=vm.getInnerMostAxes(o.length,u.shape.length)),o=[o[0]],vm.assertAxesAreInnerMostDims("argMax",o,u.shape.length);for(var l=vm.computeOutAndReduceShapes(u.shape,o),p=(0,h.Z)(l,2),d=p[0],f=p[1],m=Aa.sizeFromShape(d),v=Aa.makeZerosTypedArray(m,"int32"),g=Aa.sizeFromShape(f),y=n.data.get(u.dataId).values,b=0;b<v.length;++b){for(var x=b*g,k=y[x],w=0,I=0;I<g;++I){var S=y[x+I];S>k&&(k=S,w=I)}v[b]=w}return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(d,"int32",v)}};var yZ={kernelName:pt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis;TA(a,"argMin");var o=Aa.parseAxisParam(i,a.shape),s=vm.getAxesPermutation(o,a.shape.length),u=a,c=[];null!=s&&(u=JR({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=vm.getInnerMostAxes(o.length,u.shape.length)),o=[o[0]],vm.assertAxesAreInnerMostDims("argMin",o,u.shape.length);for(var l=vm.computeOutAndReduceShapes(u.shape,o),p=(0,h.Z)(l,2),d=p[0],f=p[1],m=Aa.sizeFromShape(d),v=Aa.makeZerosTypedArray(m,"int32"),g=Aa.sizeFromShape(f),y=n.data.get(u.dataId).values,b=0;b<v.length;++b){for(var x=b*g,k=y[x],w=0,I=0;I<g;++I){var S=y[x+I];S<k&&(k=S,w=I)}v[b]=w}return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(d,"int32",v)}},bZ=QA(ht,(function(e){return Math.asin(e)})),xZ={kernelName:ht,backendName:"cpu",kernelFunc:bZ},kZ=QA(dt,(function(e){return Math.asinh(e)})),wZ={kernelName:dt,backendName:"cpu",kernelFunc:kZ},IZ=QA(ft,(function(e){return Math.atan(e)})),SZ={kernelName:ft,backendName:"cpu",kernelFunc:IZ},NZ=FA((function(e,t){return Math.atan2(e,t)})),TZ=UA(vt,NZ),CZ={kernelName:vt,backendName:"cpu",kernelFunc:TZ},_Z=QA(mt,(function(e){return Math.atanh(e)})),EZ={kernelName:mt,backendName:"cpu",kernelFunc:_Z};function AZ(e,t,n,r,a,i){for(var o=a.strideHeight,s=a.strideWidth,u=a.dilationHeight,c=a.dilationWidth,l=a.effectiveFilterHeight,p=a.effectiveFilterWidth,h=a.padInfo.top,d=a.padInfo.left,f="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=us(a.outShape,n),v=m.values,g=a.outShape[1]*a.outShape[2]*a.outShape[3],y=a.outShape[2]*a.outShape[3],b=a.outShape[3],x=0;x<a.batchSize;++x)for(var k=x*g,w=x*r[0],I=0;I<a.inChannels;++I)for(var S=0;S<a.outHeight;++S)for(var N=S*o-h,T=Math.max(0,N),C=Math.min(a.inHeight,l+N),_=k+S*y,E=0;E<a.outWidth;++E){for(var A=E*s-d,R=Math.max(0,A),F=Math.min(a.inWidth,p+A),Z=f,D=0,M=0,O=T;O<C;O+=u){for(var L=w+O*r[1],z=R;z<F;z+=c){var P=e[L+z*r[2]+I];"max"===i&&P>Z?Z=P:"avg"===i&&(D+=P,M++)}if(isNaN(Z))break}v[_+E*b+I]="avg"===i?D/M:Z}return m}function RZ(e,t,n,r){for(var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=us(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,c=r.dilationHeight,l=r.dilationWidth,p=r.effectiveFilterHeight,h=r.effectiveFilterWidth,d=r.padInfo.top,f=r.padInfo.left,m=us(t,n,e),v=0;v<r.batchSize;++v)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.outHeight;++y){for(var b=y*s-d,x=b;x<0;)x+=c;for(var k=Math.min(r.inHeight,p+b),w=0;w<r.outWidth;++w){for(var I=w*u-f,S=I;S<0;)S+=l;for(var N=Math.min(r.inWidth,h+I),T=Number.NEGATIVE_INFINITY,C=-1,_=x;_<k;_+=c)for(var E=_-b,A=S;A<N;A+=l){var R=A-I,F=m.get(v,_,A,g);F>T&&(T=F,C=a?i?((v*r.inHeight+_)*r.inWidth+A)*r.inChannels+g:(_*r.inWidth+A)*r.inChannels+g:E*h+R)}o.set(C,v,y,w,g)}}return o}function FZ(e,t,n,r,a,i){for(var o=a.strideDepth,s=a.strideHeight,u=a.strideWidth,c=a.dilationDepth,l=a.dilationHeight,p=a.dilationWidth,h=a.effectiveFilterDepth,d=a.effectiveFilterHeight,f=a.effectiveFilterWidth,m=a.padInfo.front,v=a.padInfo.top,g=a.padInfo.left,y="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=us(a.outShape,n),x=b.values,k=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],w=a.outShape[2]*a.outShape[3]*a.outShape[4],I=a.outShape[3]*a.outShape[4],S=a.outShape[4],N=0;N<a.batchSize;++N)for(var T=N*k,C=N*r[0],_=0;_<a.inChannels;++_)for(var E=0;E<a.outDepth;++E){for(var A=E*o-m,R=A;R<0;)R+=c;for(var F=Math.min(a.inDepth,h+A),Z=T+E*w,D=0;D<a.outHeight;++D){for(var M=D*s-v,O=M;O<0;)O+=l;for(var L=Math.min(a.inHeight,d+M),z=Z+D*I,P=0;P<a.outWidth;++P){for(var B=P*u-g,W=B;W<0;)W+=p;for(var V=Math.min(a.inWidth,f+B),U=z+P*S,G=y,H=0,j=0,q=R;q<F;q+=c){for(var K=C+q*r[1],X=O;X<L;X+=l){for(var Y=K+X*r[2],J=W;J<V;J+=p){var Q=e[Y+J*r[3]+_];if("max"===i&&Q>G?G=Q:"avg"===i&&(H+=Q,j++),isNaN(G))break}if(isNaN(G))break}if(isNaN(G))break}x[U+_]="avg"===i?H/Math.max(j,1):G}}}return b}var ZZ={kernelName:gt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;TA(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;Aa.assert(vm.eitherStridesOrDilationsAreOne(o,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(1,"'")}));var c,l=vm.computePool2DInfo(a.shape,i,o,1,s,u);if(1===l.filterWidth&&1===l.filterHeight&&Aa.arraysEqual(l.inShape,l.outShape))c=OA({inputs:{x:a},backend:n});else{var p=n.data.get(a.dataId).values,h=Aa.computeStrides(a.shape),d=AZ(p,a.shape,a.dtype,h,l,"avg");c=n.makeTensorInfo(l.outShape,a.dtype,d.values)}return c}};var DZ={kernelName:bt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;TA(a,"avgPool3d");var l=vm.computePool3DInfo(a.shape,i,o,1,s,u,c),p=FZ(n.data.get(a.dataId).values,a.shape,a.dtype,Aa.computeStrides(a.shape),l,"avg");return n.makeTensorInfo(p.shape,"float32",p.values)}};var MZ={kernelName:xt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;TA([a,i],"avgPool3DGrad");for(var l=vm.computePool3DInfo(i.shape,o,s,1,u,c),p=l.strideDepth,h=l.strideHeight,d=l.strideWidth,f=l.filterDepth,m=l.filterHeight,v=l.filterWidth,g=l.dilationDepth,y=l.dilationHeight,b=l.dilationWidth,x=l.effectiveFilterDepth,k=l.effectiveFilterHeight,w=l.effectiveFilterWidth,I=x-1-l.padInfo.front,S=w-1-l.padInfo.left,N=k-1-l.padInfo.top,T=us(i.shape,"float32"),C=1/(f*m*v),_=n.bufferSync(a),E=0;E<l.batchSize;++E)for(var A=0;A<l.inChannels;++A)for(var R=0;R<l.inDepth;++R)for(var F=0;F<l.inHeight;++F)for(var Z=0;Z<l.inWidth;++Z){for(var D=R-I,M=F-N,O=Z-S,L=0,z=0;z<x;z+=g){var P=(D+z)/p;if(!(P<0||P>=l.outDepth||Math.floor(P)!==P))for(var B=0;B<k;B+=y){var W=(M+B)/h;if(!(W<0||W>=l.outHeight||Math.floor(W)!==W))for(var V=0;V<w;V+=b){var U=(O+V)/d;if(!(U<0||U>=l.outWidth||Math.floor(U)!==U))L+=_.get(E,P,W,U,A)}}}T.set(L*C,E,R,F,Z,A)}return n.makeTensorInfo(T.shape,T.dtype,T.values)}};var OZ={kernelName:yt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;TA([a,i],"avgPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,l=vm.computePool2DInfo(o.shape,s,u,1,c),p=l.strideHeight,h=l.strideWidth,d=l.filterHeight,f=l.filterWidth,m=l.dilationHeight,v=l.dilationWidth,g=l.effectiveFilterHeight,y=l.effectiveFilterWidth,b=y-1-l.padInfo.left,x=g-1-l.padInfo.top,k=us(o.shape,"float32"),w=1/(d*f),I=n.data.get(a.dataId).values,S=us(a.shape,"float32",I),N=0;N<l.batchSize;++N)for(var T=0;T<l.inChannels;++T)for(var C=0;C<l.inHeight;++C)for(var _=0;_<l.inWidth;++_){for(var E=C-x,A=_-b,R=0,F=0;F<g;F+=m){var Z=(E+F)/p;if(!(Z<0||Z>=l.outHeight||Math.floor(Z)!==Z))for(var D=0;D<y;D+=v){var M=(A+D)/h;if(!(M<0||M>=l.outWidth||Math.floor(M)!==M))R+=S.get(N,Z,M,T)}}k.set(R*w,N,C,_,T)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}};var LZ={kernelName:dn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.scale,o=t.offset,s=t.mean,u=t.variance;Aa.assert(s.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),Aa.assert(null==o||s.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),Aa.assert(null==i||s.shape.length===i.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),TA([a,s,u,i,o],"batchNorm");var c=r.varianceEpsilon;null==c&&(c=.001);for(var l=n.data.get(a.dataId).values,p=n.data.get(s.dataId).values,h=n.data.get(u.dataId).values,d=i?n.data.get(i.dataId).values:new Float32Array([1]),f=o?n.data.get(o.dataId).values:new Float32Array([0]),m=new Float32Array(l.length),v=f.length,g=d.length,y=h.length,b=p.length,x=0,k=0,w=0,I=0,S=0;S<l.length;++S)m[S]=f[x++]+(l[S]-p[k++])*d[w++]/Math.sqrt(h[I++]+c),x>=v&&(x=0),k>=b&&(k=0),w>=g&&(w=0),I>=y&&(I=0);return n.makeTensorInfo(a.shape,a.dtype,m)}};var zZ={kernelName:wt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;TA([a],"batchToSpaceND");var s=i.reduce((function(e,t){return e*t})),u=vm.getReshaped(a.shape,i,s),c=vm.getPermuted(u.length,i.length),l=vm.getReshapedPermuted(a.shape,i,s),p=vm.getSliceBeginCoords(o,i.length),h=vm.getSliceSize(l,o,i.length),d=iZ({inputs:{x:a},backend:n,attrs:{shape:u}}),f=JR({inputs:{x:d},backend:n,attrs:{perm:c}}),m=iZ({inputs:{x:f},backend:n,attrs:{shape:l}}),v=kF({inputs:{x:m},backend:n,attrs:{begin:p,size:h}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),v}};var PZ={kernelName:It,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=XA(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,s)}};var BZ={kernelName:Nt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.s0,a=t.s1,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=vm.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},WZ=QA(_t,(function(e,t){var n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e})),VZ={kernelName:_t,backendName:"cpu",kernelFunc:WZ},UZ={kernelName:At,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs.x,n=e.backend,r=new Float32Array(Aa.sizeFromShape(t.shape)),a=n.data.get(t.dataId),i=a.complexTensorInfos.real,o=a.complexTensorInfos.imag,s=n.data.get(i.dataId).values,u=n.data.get(o.dataId).values,c=0;c<s.length;c++){var l=s[c],p=u[c];r[c]=Math.hypot(l,p)}return n.makeOutput(r,t.shape,"float32")}};function GZ(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.imag,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var HZ={kernelName:xn,backendName:"cpu",kernelFunc:GZ};function jZ(e){var t=e.inputs,n=e.backend,r=e.attrs.axis,a=Aa.parseAxisParam(r,t[0].shape)[0],i=t.map((function(e){return e.shape}));vm.assertParamsConsistent(i,a);var o=vm.computeOutShape(t.map((function(e){return e.shape})),a);if(0===Aa.sizeFromShape(o))return n.makeTensorInfo(o,t[0].dtype,[]);var s=t.filter((function(e){return Aa.sizeFromShape(e.shape)>0}));if(1===s.length)return OA({inputs:{x:s[0]},backend:n});if("complex64"===s[0].dtype){var u=s.map((function(e){return zA({inputs:{input:e},backend:n})})),c=s.map((function(e){return GZ({inputs:{input:e},backend:n})})),l=jZ({inputs:u,backend:n,attrs:{axis:a}}),p=jZ({inputs:c,backend:n,attrs:{axis:a}}),h=ZA({inputs:{real:l,imag:p},backend:n});return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(p),h}var d=s.map((function(e){var t=[-1,Aa.sizeFromShape(e.shape.slice(a))];return iZ({inputs:{x:e},backend:n,attrs:{shape:t}})})),f=d.map((function(e){return{vals:n.data.get(e.dataId).values,shape:e.shape}}));o=vm.computeOutShape(d.map((function(e){return e.shape})),1);var m=1===d[0].shape[0],v=rR(f,o,t[0].dtype,m),g=vm.computeOutShape(s.map((function(e){return e.shape})),a),y=n.makeTensorInfo(g,t[0].dtype,v);return d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),y}var qZ={kernelName:Rt,backendName:"cpu",kernelFunc:jZ};function KZ(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dilations,l=r.dimRoundingMode;TA([a,i],"conv2d");for(var p=vm.convertConv2DDataFormat(u),h=vm.computeConv2DInfo(a.shape,i.shape,o,c,s,l,!1,p),d=h.filterHeight,f=h.filterWidth,m=h.dilationHeight,v=h.dilationWidth,g=h.padInfo.left,y=h.padInfo.top,b="channelsLast"===h.dataFormat,x=new ci(h.outShape,a.dtype),k=Aa.computeStrides(a.shape),w=Aa.computeStrides(i.shape),I=k[0],S=b?k[1]:k[2],N=b?k[2]:1,T=b?1:k[1],C=x.strides[0],_=b?x.strides[1]:x.strides[2],E=b?x.strides[2]:1,A=b?1:x.strides[1],R=n.data.get(a.dataId).values,F=n.data.get(i.dataId).values,Z=x.values,D=0;D<h.batchSize;++D)for(var M=D*I,O=D*C,L=0;L<h.outHeight;++L)for(var z=O+L*_,P=L*h.strideHeight-y,B=0;B<d;++B){var W=P+B*m;if(!(W<0||W>=h.inHeight))for(var V=B*w[0],U=M+W*S,G=0;G<h.outWidth;++G)for(var H=z+G*E,j=G*h.strideWidth-g,q=0;q<f;++q){var K=j+q*v;if(!(K<0||K>=h.inWidth))for(var X=U+K*N,Y=V+q*w[1],J=0;J<h.inChannels;++J){for(var Q=R[X+J*T],$=0;$<h.outChannels;++$)Z[H+$*A]+=Q*F[Y+$];Y+=h.outChannels}}}return n.makeTensorInfo(x.shape,x.dtype,Z)}var XZ={kernelName:Ft,backendName:"cpu",kernelFunc:KZ};var YZ={kernelName:Zt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape;TA([a,i],"conv2dBackpropFilter");for(var p=vm.convertConv2DDataFormat(u),h=vm.computeConv2DInfo(a.shape,l,o,1,s,c,!1,p),d=h.strideHeight,f=h.strideWidth,m=h.filterHeight,v=h.filterWidth,g="channelsLast"===h.dataFormat,y=new ci(h.filterShape,"float32"),b=h.padInfo.left,x=h.padInfo.top,k=n.data.get(a.dataId).values,w=n.data.get(i.dataId).values,I=new ci(a.shape,a.dtype,k),S=new ci(i.shape,i.dtype,w),N=0;N<m;++N)for(var T=Math.max(0,Math.ceil((x-N)/d)),C=Math.min(h.outHeight,(h.inHeight+x-N)/d),_=0;_<v;++_)for(var E=Math.max(0,Math.ceil((b-_)/f)),A=Math.min(h.outWidth,(h.inWidth+b-_)/f),R=0;R<h.inChannels;++R)for(var F=0;F<h.outChannels;++F){for(var Z=0,D=0;D<h.batchSize;++D)for(var M=T;M<C;++M)for(var O=N+M*d-x,L=E;L<A;++L){var z=_+L*f-b;Z+=g?I.get(D,O,z,R)*S.get(D,M,L,F):I.get(D,R,O,z)*S.get(D,F,M,L)}y.set(Z,N,_,R,F)}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};var JZ={kernelName:Dt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode;TA([a,i],"conv2dBackpropInput");var p=Aa.computeStrides(i.shape),d=Aa.computeStrides(a.shape),f=vm.convertConv2DDataFormat(c),m=vm.computeConv2DInfo(o,i.shape,s,1,u,l,!1,f),v=new ci(m.inShape,"float32"),g=v.values,y=n.data.get(a.dataId).values,b=n.data.get(i.dataId).values,x=(0,h.Z)(p,3),k=x[0],w=x[1],I=x[2],S=m.batchSize,N=m.filterHeight,T=m.filterWidth,C=m.inChannels,_=m.inHeight,E=m.inWidth,A=m.outChannels,R=m.outHeight,F=m.outWidth,Z=m.strideHeight,D=m.strideWidth;f=m.dataFormat;for(var M=N-1-m.padInfo.top,O=T-1-m.padInfo.left,L="channelsLast"===f,z=v.strides[0],P=L?v.strides[1]:v.strides[2],B=L?v.strides[2]:1,W=L?1:v.strides[1],V=d[0],U=L?d[1]:d[2],G=L?d[2]:1,H=L?1:d[1],j=0;j<S;++j)for(var q=0;q<C;++q)for(var K=0;K<_;++K)for(var X=K-M,Y=Math.max(0,Math.ceil(X/Z)),J=Math.min(R,(N+X)/Z),Q=0;Q<E;++Q){for(var $=Q-O,ee=Math.max(0,Math.ceil($/D)),te=Math.min(F,(T+$)/D),ne=0,re=Y;re<J;++re)for(var ae=re*Z-X,ie=ee;ie<te;++ie)for(var oe=V*j+U*re+G*ie,se=k*(N-1-ae)+w*(T-1-(ie*D-$))+I*q,ue=0;ue<A;++ue){ne+=y[oe+H*ue]*b[se+ue]}g[z*j+P*K+B*Q+W*q]=ne}return n.makeTensorInfo(v.shape,v.dtype,v.values)}};var QZ={kernelName:Mt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations;TA([a,i],"conv3d");for(var c=vm.computeConv3DInfo(a.shape,i.shape,o,u,s),l=c.filterDepth,p=c.filterHeight,h=c.filterWidth,d=c.dilationDepth,f=c.dilationHeight,m=c.dilationWidth,v=c.padInfo,g=v.front,y=v.left,b=v.top,x=new ci(c.outShape,a.dtype),k=n.data.get(a.dataId).values,w=n.data.get(i.dataId).values,I=x.values,S=Aa.computeStrides(a.shape),N=Aa.computeStrides(i.shape),T=0;T<c.batchSize;++T)for(var C=T*S[0],_=T*x.strides[0],E=0;E<c.outDepth;++E)for(var A=_+E*x.strides[1],R=E*c.strideDepth-g,F=0;F<l;++F){var Z=R+F*d;if(!(Z<0||Z>=c.inDepth))for(var D=F*N[0],M=C+Z*S[1],O=0;O<c.outHeight;++O)for(var L=A+O*x.strides[2],z=O*c.strideHeight-b,P=0;P<p;++P){var B=z+P*f;if(!(B<0||B>=c.inHeight))for(var W=D+P*N[1],V=M+B*S[2],U=0;U<c.outWidth;++U)for(var G=L+U*c.outChannels,H=U*c.strideWidth-y,j=0;j<h;++j){var q=H+j*m;if(!(q<0||q>=c.inWidth))for(var K=W+j*N[2],X=V+q*c.inChannels,Y=K,J=0;J<c.inChannels;++J){for(var Q=k[X+J],$=0;$<c.outChannels;++$)I[G+$]+=Q*w[Y+$];Y+=c.outChannels}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};var $Z={kernelName:Ot,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.filterShape;TA([a,i],"conv3dBackpropFilterV2");for(var c=Aa.computeStrides(a.shape),l=Aa.computeStrides(i.shape),p=vm.computeConv3DInfo(a.shape,u,o,1,s),d=p.strideDepth,f=p.strideHeight,m=p.strideWidth,v=p.filterDepth,g=p.filterHeight,y=p.filterWidth,b=new ci(p.filterShape,"float32"),x=b.values,k=(0,h.Z)(b.strides,4),w=k[0],I=k[1],S=k[2],N=k[3],T=n.data.get(i.dataId).values,C=(0,h.Z)(l,4),_=C[0],E=C[1],A=C[2],R=C[3],F=n.data.get(a.dataId).values,Z=(0,h.Z)(c,4),D=Z[0],M=Z[1],O=Z[2],L=Z[3],z=p.padInfo.front,P=p.padInfo.left,B=p.padInfo.top,W=0;W<v;++W)for(var V=Math.max(0,Math.ceil((z-W)/d)),U=Math.min(p.outDepth,(p.inDepth+z-W)/d),G=W*w,H=0;H<g;++H)for(var j=Math.max(0,Math.ceil((B-H)/f)),q=Math.min(p.outHeight,(p.inHeight+B-H)/f),K=H*I+G,X=0;X<y;++X)for(var Y=Math.max(0,Math.ceil((P-X)/m)),J=Math.min(p.outWidth,(p.inWidth+P-X)/m),Q=X*S+K,$=0;$<p.inChannels;++$)for(var ee=$*N+Q,te=0;te<p.outChannels;++te){for(var ne=0,re=0;re<p.batchSize;++re)for(var ae=re*D,ie=re*_,oe=V;oe<U;++oe)for(var se=(W+oe*d-z)*M+ae,ue=oe*E+ie,ce=j;ce<q;++ce)for(var le=(H+ce*f-B)*O+se,pe=ce*A+ue,he=Y;he<J;++he){var de=he*R+pe;ne+=F[(X+he*m-P)*L+le+$]*T[de+te]}x[ee+te]=ne}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};var eD={kernelName:Lt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.pad,s=r.strides,u=r.inputShape;TA([a],"conv3dBackpropInputV2");for(var c=Aa.computeStrides(a.shape),l=Aa.computeStrides(i.shape),p=vm.computeConv3DInfo(u,i.shape,s,1,o),d=new ci(p.inShape,"float32"),f=d.values,m=(0,h.Z)(d.strides,4),v=m[0],g=m[1],y=m[2],b=m[3],x=n.data.get(a.dataId).values,k=(0,h.Z)(c,4),w=k[0],I=k[1],S=k[2],N=k[3],T=n.data.get(i.dataId).values,C=(0,h.Z)(l,4),_=C[0],E=C[1],A=C[2],R=C[3],F=p.batchSize,Z=p.filterDepth,D=p.filterHeight,M=p.filterWidth,O=p.inChannels,L=p.inDepth,z=p.inHeight,P=p.inWidth,B=p.outChannels,W=p.outDepth,V=p.outHeight,U=p.outWidth,G=p.strideDepth,H=p.strideHeight,j=p.strideWidth,q=Z-1-p.padInfo.front,K=D-1-p.padInfo.top,X=M-1-p.padInfo.left,Y=0;Y<F;++Y)for(var J=0;J<O;++J)for(var Q=0;Q<L;++Q)for(var $=Q-q,ee=Math.max(0,Math.ceil($/G)),te=Math.min(W,(Z+$)/G),ne=0;ne<z;++ne)for(var re=ne-K,ae=Math.max(0,Math.ceil(re/H)),ie=Math.min(V,(D+re)/H),oe=0;oe<P;++oe){for(var se=oe-X,ue=Math.max(0,Math.ceil(se/j)),ce=Math.min(U,(M+se)/j),le=0,pe=ee;pe<te;++pe)for(var he=pe*G-$,de=ae;de<ie;++de)for(var fe=de*H-re,me=ue;me<ce;++me)for(var ve=w*Y+I*pe+S*de+N*me,ge=_*(Z-1-he)+E*(D-1-fe)+A*(M-1-(me*j-se))+R*J,ye=0;ye<B;++ye){le+=x[ve+ye]*T[ge+ye]}f[v*Y+g*Q+y*ne+b*oe+J]=le}return n.makeTensorInfo(d.shape,d.dtype,d.values)}},tD=QA(zt,(function(e){return Math.cos(e)})),nD={kernelName:zt,backendName:"cpu",kernelFunc:tD},rD=QA(Pt,(function(e){return Math.cosh(e)})),aD={kernelName:Pt,backendName:"cpu",kernelFunc:rD};var iD={kernelName:Vt,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,o=t.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=(0,h.Z)(a.shape,4),p=l[0],d=l[1],f=l[2],m=l[3],v=i.shape[0],g=(0,h.Z)(s,2),y=g[0],b=g[1],x=us([v,y,b,m],"float32"),k=n.data.get(i.dataId).values,w=n.data.get(o.dataId).values,I=n.data.get(a.dataId).values,S=Aa.computeStrides(a.shape),N=Aa.computeStrides(x.shape),T=0;T<v;T++){var C=4*T,_=k[C],E=k[C+1],A=k[C+2],R=k[C+3],F=w[T];if(!(F>=p))for(var Z=y>1?(A-_)*(d-1)/(y-1):0,D=b>1?(R-E)*(f-1)/(b-1):0,M=0;M<y;M++){var O=y>1?_*(d-1)+M*Z:.5*(_+A)*(d-1);if(O<0||O>d-1)for(var L=0;L<b;L++)for(var z=0;z<m;z++){var P=z+L*N[2]+M*N[1]+T*N[0];x.values[P]=c}else if("bilinear"===u)for(var B=Math.floor(O),W=Math.ceil(O),V=O-B,U=0;U<b;U++){var G=b>1?E*(f-1)+U*D:.5*(E+R)*(f-1);if(G<0||G>f-1)for(var H=0;H<m;H++){var j=H+U*N[2]+M*N[1]+T*N[0];x.values[j]=c}else for(var q=Math.floor(G),K=Math.ceil(G),X=G-q,Y=0;Y<m;Y++){var J=Y+q*S[2]+B*S[1]+F*S[0],Q=I[J],$=I[J=Y+K*S[2]+B*S[1]+F*S[0]],ee=I[J=Y+q*S[2]+W*S[1]+F*S[0]],te=Q+($-Q)*X,ne=ee+(I[J=Y+K*S[2]+W*S[1]+F*S[0]]-ee)*X;J=Y+U*N[2]+M*N[1]+T*N[0],x.values[J]=te+(ne-te)*V}}else for(var re=0;re<b;++re){var ae=b>1?E*(f-1)+re*D:.5*(E+R)*(f-1);if(ae<0||ae>f-1)for(var ie=0;ie<m;ie++){var oe=ie+re*N[2]+M*N[1]+T*N[0];x.values[oe]=c}else for(var se=Math.round(ae),ue=Math.round(O),ce=0;ce<m;ce++){var le=ce+se*S[2]+ue*S[1]+F*S[0],pe=ce+re*N[2]+M*N[1]+T*N[0];x.values[pe]=I[le]}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};var oD={kernelName:Bt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;TA(a,"cumprod");var u=vm.getAxesPermutation([i],a.shape.length),c=a;null!=u&&(c=JR({inputs:{x:a},backend:n,attrs:{perm:u}}));var l=vm.getInnerMostAxes(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumprod in CPU expects an inner-most axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var p=wi(c.dtype,"int32"),h=Aa.makeOnesTypedArray(Aa.sizeFromShape(c.shape),p),d=n.data.get(c.dataId).values,f=c.shape[c.shape.length-1],m=s?function(e,t){return e+f-t-1}:function(e,t){return e+t},v=0;v<d.length;v+=f)for(var g=0;g<f;g++){var y=m(v,g);if(0===g)h[y]=o?1:d[y];else{var b=m(v,g-1);h[y]=o?d[b]*h[b]:d[y]*h[b]}}var x=n.makeTensorInfo(c.shape,p,h);if(null!=u){var k=JR({inputs:{x:x},backend:n,attrs:{perm:vm.getUndoAxesPermutation(u)}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(c),k}return x}};var sD={kernelName:Wt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;TA(a,"cumsum");var u=vm.getAxesPermutation([i],a.shape.length),c=a;null!=u&&(c=JR({inputs:{x:a},backend:n,attrs:{perm:u}}));var l=vm.getInnerMostAxes(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var p=wi(c.dtype,"int32"),h=Aa.makeZerosTypedArray(Aa.sizeFromShape(c.shape),p),d=n.data.get(c.dataId).values,f=c.shape[c.shape.length-1],m=s?function(e,t){return e+f-t-1}:function(e,t){return e+t},v=0;v<d.length;v+=f)for(var g=0;g<f;g++){var y=m(v,g);if(0===g)h[y]=o?0:d[y];else{var b=m(v,g-1);h[y]=o?d[b]+h[b]:d[y]+h[b]}}var x=n.makeTensorInfo(c.shape,p,h);if(null!=u){var k=JR({inputs:{x:x},backend:n,attrs:{perm:vm.getUndoAxesPermutation(u)}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(c),k}return x}};var uD={kernelName:Ut,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=XA(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,u)}if(2===a.shape.length){var c=YA(n.bufferSync(a),n.bufferSync(i),o,s);return n.makeTensorInfo(c.shape,i.dtype,c.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank".concat(a.shape.length,"."))}};var cD={kernelName:Gt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat;Aa.assert("NHWC"===o,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(o)}));for(var s=a.shape[0],u=a.shape[1],c=a.shape[2],l=a.shape[3],p=u*i,h=c*i,d=l/(i*i),f=n.data.get(a.dataId).values,m=new Float32Array(s*p*h*d),v=0,g=0;g<s;++g)for(var y=0;y<p;++y)for(var b=Math.floor(y/i),x=y%i,k=0;k<h;++k)for(var w=Math.floor(k/i),I=(x*i+k%i)*d,S=0;S<d;++S){var N=S+I+l*(w+c*(b+u*g));m[v++]=f[N]}return n.makeTensorInfo([s,p,h,d],a.dtype,m)}};function lD(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode;TA([a,i],"depthwiseConv2DNative");var l=Aa.computeStrides(a.shape),p=Aa.computeStrides(i.shape),h=u;null==h&&(h=[1,1]),Aa.assert(vm.eitherStridesOrDilationsAreOne(o,h),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(h,"'")}));for(var d=vm.computeConv2DInfo(a.shape,i.shape,o,h,s,c,!0),f=d.filterHeight,m=d.filterWidth,v=d.dilationHeight,g=d.dilationWidth,y=d.padInfo,b=y.left,x=y.top,k=d.outChannels/d.inChannels,w=new ci(d.outShape,a.dtype),I=n.data.get(a.dataId).values,S=n.data.get(i.dataId).values,N=w.values,T=0;T<d.batchSize;++T)for(var C=T*l[0],_=T*w.strides[0],E=0;E<d.outHeight;++E)for(var A=_+E*w.strides[1],R=E*d.strideHeight-x,F=0;F<f;++F){var Z=R+F*v;if(!(Z<0||Z>=d.inHeight))for(var D=F*p[0],M=C+Z*l[1],O=0;O<d.outWidth;++O)for(var L=A+O*w.strides[2],z=O*d.strideWidth-b,P=0;P<m;++P){var B=z+P*g;if(!(B<0||B>=d.inWidth))for(var W=D+P*p[1],V=M+B*d.inChannels,U=L,G=W,H=0;H<d.inChannels;++H){for(var j=I[V+H],q=0;q<k;++q)N[U+q]+=j*S[G+q];U+=k,G+=k}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}var pD={kernelName:Ht,backendName:"cpu",kernelFunc:lD};var hD={kernelName:jt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape;TA([a,i],"depthwiseConv2dNativeBackpropFilter");for(var p=vm.computeConv2DInfo(a.shape,l,o,s,u,c,!0),h=p.strideHeight,d=p.strideWidth,f=p.filterHeight,m=p.filterWidth,v=new ci(p.filterShape,"float32"),g=p.padInfo.left,y=p.padInfo.top,b=p.outChannels/p.inChannels,x=n.data.get(a.dataId).values,k=new ci(a.shape,a.dtype,x),w=n.data.get(i.dataId).values,I=new ci(i.shape,i.dtype,w),S=0;S<f;++S)for(var N=Math.max(0,Math.ceil((y-S)/h)),T=Math.min(p.outHeight,(p.inHeight+y-S)/h),C=0;C<m;++C)for(var _=Math.max(0,Math.ceil((g-C)/d)),E=Math.min(p.outWidth,(p.inWidth+g-C)/d),A=0;A<p.outChannels;++A){for(var R=Math.trunc(A/b),F=A%b,Z=0,D=0;D<p.batchSize;++D)for(var M=N;M<T;++M)for(var O=S+M*h-y,L=_;L<E;++L){var z=C+L*d-g;Z+=k.get(D,O,z,R)*I.get(D,M,L,A)}v.set(Z,S,C,R,F)}return n.makeTensorInfo(v.shape,v.dtype,v.values)}};var dD={kernelName:qt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.inputShape;TA([a,i],"depthwiseConv2DNativeBackpropInput");for(var p=Aa.computeStrides(a.shape),d=Aa.computeStrides(i.shape),f=vm.computeConv2DInfo(l,i.shape,o,s,u,c,!0),m=new ci(f.inShape,"float32"),v=m.values,g=(0,h.Z)(m.strides,3),y=g[0],b=g[1],x=g[2],k=n.data.get(a.dataId).values,w=(0,h.Z)(p,3),I=w[0],S=w[1],N=w[2],T=n.data.get(i.dataId).values,C=(0,h.Z)(d,3),_=C[0],E=C[1],A=C[2],R=f.batchSize,F=f.filterHeight,Z=f.filterWidth,D=f.inChannels,M=f.inHeight,O=f.inWidth,L=f.outChannels,z=f.outHeight,P=f.outWidth,B=f.strideHeight,W=f.strideWidth,V=F-1-f.padInfo.top,U=Z-1-f.padInfo.left,G=L/D,H=0;H<R;++H)for(var j=0;j<D;++j)for(var q=0;q<M;++q)for(var K=q-V,X=Math.max(0,Math.ceil(K/B)),Y=Math.min(z,(F+K)/B),J=0;J<O;++J){for(var Q=J-U,$=Math.max(0,Math.ceil(Q/W)),ee=Math.min(P,(Z+Q)/W),te=0,ne=X;ne<Y;++ne)for(var re=ne*B-K,ae=$;ae<ee;++ae)for(var ie=I*H+S*ne+N*ae,oe=_*(F-1-re)+E*(Z-1-(ae*W-Q))+A*j,se=0;se<G;++se){te+=k[ie+(j*G+se)]*T[oe+se]}v[y*H+b*q+x*J+j]=te}return n.makeTensorInfo(m.shape,m.dtype,m.values)}};var fD={kernelName:Kt,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=t.x,a=Aa.sizeFromShape(r.shape),i=n.data.get(r.dataId).values,o=us([a,a],r.dtype),s=o.values,u=0;u<i.length;u++)s[u*a+u]=i[u];var c=[].concat((0,g.Z)(r.shape),(0,g.Z)(r.shape));return n.makeTensorInfo(c,o.dtype,o.values)}},mD={kernelName:Xt,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=n,l=c.data.get(a.dataId).values,p=a.shape.length,h=c.data.get(i.dataId).values,d=i.shape.length,f=vm.computeDilation2DInfo(a.shape,i.shape,o,s,"NHWC",u),m=f.batchSize,v=f.inHeight,g=f.inWidth,y=f.inChannels,b=f.outHeight,x=f.outWidth,k=f.padInfo,w=f.strideHeight,I=f.strideWidth,S=f.filterHeight,N=f.filterWidth,T=f.dilationHeight,C=f.dilationWidth,_=f.outShape,E=Aa.sizeFromShape(_),A=_.length,R=Aa.getArrayFromDType(a.dtype,E),F=0;F<m;++F)for(var Z=0;Z<b;++Z)for(var D=Z*w-k.top,M=0;M<x;++M)for(var O=M*I-k.left,L=0;L<y;++L){for(var z=Number.MIN_SAFE_INTEGER,P=0;P<S;++P){var B=D+P*T;if(B>=0&&B<v)for(var W=0;W<N;++W){var V=O+W*C;if(V>=0&&V<g){var U=Aa.locToIndex([F,B,V,L],p,Aa.computeStrides(a.shape)),G=Aa.locToIndex([P,W,L],d,Aa.computeStrides(i.shape)),H=l[U]+h[G];H>z&&(z=H)}}}R[Aa.locToIndex([F,Z,M,L],A,Aa.computeStrides(_))]=z}return{dataId:c.write(Aa.toTypedArray(R,a.dtype),_,a.dtype),shape:_,dtype:a.dtype}}},vD={kernelName:Jt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations,l=n,p=Aa.toNestedArray(a.shape,l.data.get(a.dataId).values),h=Aa.toNestedArray(i.shape,l.data.get(i.dataId).values),d=vm.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),f=d.batchSize,m=d.inHeight,v=d.inWidth,g=d.inChannels,y=d.outHeight,b=d.outWidth,x=d.padInfo,k=d.strideHeight,w=d.strideWidth,I=d.filterHeight,S=d.filterWidth,N=d.dilationHeight,T=d.dilationWidth,C=d.outShape;Aa.assert(o.rank===C.length,(function(){return"Error in ".concat(Jt,", dy must have the same rank as output ").concat(C.length,", but got ").concat(o.rank)}));for(var _=Aa.toNestedArray(C,l.data.get(o.dataId).values),E=Aa.makeZerosNestedTypedArray(i.shape,i.dtype),A=0;A<f;++A)for(var R=0;R<y;++R)for(var F=R*k-x.top,Z=0;Z<b;++Z)for(var D=Z*w-x.left,M=0;M<g;++M){for(var O=Number.MIN_SAFE_INTEGER,L=0,z=0,P=0;P<I;++P){var B=F+P*N;if(B>=0&&B<m)for(var W=0;W<S;++W){var V=D+W*T;if(V>=0&&V<v){var U=p[A][B][V][M]+h[P][W][M];U>O&&(O=U,L=P,z=W)}}}E[L][z][M]+=_[A][R][Z][M]}return{dataId:l.write(Aa.toTypedArray(E,a.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},gD={kernelName:Yt,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations,l=n,p=Aa.toNestedArray(a.shape,l.data.get(a.dataId).values),h=Aa.toNestedArray(i.shape,l.data.get(i.dataId).values),d=vm.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),f=d.batchSize,m=d.inHeight,v=d.inWidth,g=d.inChannels,y=d.outHeight,b=d.outWidth,x=d.padInfo,k=d.strideHeight,w=d.strideWidth,I=d.filterHeight,S=d.filterWidth,N=d.dilationHeight,T=d.dilationWidth,C=d.outShape;Aa.assert(o.rank===C.length,(function(){return"Error in ".concat(Yt,", dy must have the same rank as output ").concat(C.length,", but got ").concat(o.rank)}));for(var _=Aa.toNestedArray(C,l.data.get(o.dataId).values),E=Aa.makeZerosNestedTypedArray(a.shape,a.dtype),A=0;A<f;++A)for(var R=0;R<y;++R)for(var F=R*k-x.top,Z=0;Z<b;++Z)for(var D=Z*w-x.left,M=0;M<g;++M){for(var O=Number.MIN_SAFE_INTEGER,L=F<0?0:F,z=D<0?0:D,P=0;P<I;++P){var B=F+P*N;if(B>=0&&B<m)for(var W=0;W<S;++W){var V=D+W*T;if(V>=0&&V<v){var U=p[A][B][V][M]+h[P][W][M];U>O&&(O=U,L=B,z=V)}}}E[A][L][z][M]+=_[A][R][Z][M]}return{dataId:l.write(Aa.toTypedArray(E,a.dtype),a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}};function yD(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.axis,s=a.keepDims;TA(i,"sum");var u=(t="bool"===i.dtype?WA({inputs:{x:i},backend:r,attrs:{dtype:"int32"}}):OA({inputs:{x:i},backend:r})).shape.length,c=Aa.parseAxisParam(o,t.shape),l=vm.getAxesPermutation(c,u),p=c,d=t;null!=l&&(d=JR({inputs:{x:t},backend:r,attrs:{perm:l}}),p=vm.getInnerMostAxes(p.length,u)),vm.assertAxesAreInnerMostDims("sum",p,d.shape.length);for(var f=vm.computeOutAndReduceShapes(d.shape,p),m=(0,h.Z)(f,2),v=m[0],g=m[1],y=MA(r,v,vm.upcastType(d.dtype,"int32")),b=Aa.sizeFromShape(g),x=r.data.get(y.dataId).values,k=r.data.get(d.dataId).values,w=0;w<x.length;++w){for(var I=w*b,S=0,N=0;N<b;++N)S+=k[I+N];x[w]=S}if(s){var T=y;y=iZ({inputs:{x:y},backend:r,attrs:{shape:vm.expandShapeToKeepDim(y.shape,c)}}),r.disposeIntermediateTensorInfo(T)}return r.disposeIntermediateTensorInfo(t),null!=l&&r.disposeIntermediateTensorInfo(d),y}var bD={kernelName:zr,backendName:"cpu",kernelFunc:yD};var xD={kernelName:$t,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.equation,a=t,i=vm.decodeEinsumEquation(r,a.length),o=i.allDims,s=i.summedDims,u=i.idDims;vm.checkEinsumDimSizes(o.length,u,a);for(var c=vm.getEinsumComputePath(s,u),l=c.path,p=c.steps,h=p.length,d=null,f=o.length,m=[],v=0;v<h;++v){var g,b=(0,y.Z)(p[v]);try{for(b.s();!(g=b.n()).done;){var x=g.value,k=vm.getEinsumPermutation(f,u[x]),w=k.permutationIndices,I=k.expandDims,S=void 0;vm.isIdentityPermutation(w)?S=a[x]:(S=JR({inputs:{x:a[x]},backend:n,attrs:{perm:w}}),m.push(S));for(var N=S.shape.slice(),T=0;T<I.length;++T)N.splice(I[T],0,1);Aa.arraysEqual(S.shape,N)||(S=iZ({inputs:{x:S},backend:n,attrs:{shape:N}}),m.push(S)),null===d?d=S:(d=UR({inputs:{a:S,b:d},backend:n}),m.push(d))}}catch(A){b.e(A)}finally{b.f()}v<h-1&&(l[v]>=0&&(d=yD({inputs:{x:d},backend:n,attrs:{axis:l[v]-(o.length-f),keepDims:!1}}),m.push(d)),f--)}for(var C=0,_=m;C<_.length;C++){var E=_[C];E!==d&&n.disposeIntermediateTensorInfo(E)}return d}};var kD={kernelName:tn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y;TA([r,a],"eluGrad");for(var i=new Float32Array(Aa.sizeFromShape(a.shape)),o=n.data.get(a.dataId).values,s=n.data.get(r.dataId).values,u=0;u<o.length;++u){var c=o[u];i[u]=c>=1?s[u]:s[u]*(c+1)}return n.makeTensorInfo(a.shape,"float32",i)}},wD=vm.ERF_P,ID=vm.ERF_A1,SD=vm.ERF_A2,ND=vm.ERF_A3,TD=vm.ERF_A4,CD=vm.ERF_A5,_D=QA(nn,(function(e){var t=Math.sign(e),n=Math.abs(e),r=1/(1+wD*n);return t*(1-((((CD*r+TD)*r+ND)*r+SD)*r+ID)*r*Math.exp(-n*n))})),ED={kernelName:nn,backendName:"cpu",kernelFunc:_D};function AD(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.input,i=r.dim,o=a.shape.length,s=a.shape.slice(),u=i;return i<0&&(Aa.assert(-(o+1)<=i,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+i+1),s.splice(u,0,1),iZ({inputs:{x:a},backend:n,attrs:{shape:s}})}var RD={kernelName:on,backendName:"cpu",kernelFunc:AD},FD=FA((function(e,t){return e/t})),ZD=UA(Qt,FD),DD={kernelName:Qt,backendName:"cpu",kernelFunc:ZD};function MD(e,t,n){for(var r=e.shape,a=r[0],i=r[1],o=n.data.get(e.dataId),s=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,c=[a,i],l=Aa.sizeFromShape(c),p=Aa.getTypedArrayFromDType("float32",l),h=Aa.getTypedArrayFromDType("float32",l),d=0;d<a;d++){for(var f=kF({inputs:{x:s},backend:n,attrs:{begin:[d,0],size:[1,i]}}),m=kF({inputs:{x:u},backend:n,attrs:{begin:[d,0],size:[1,i]}}),v=ZA({inputs:{real:f,imag:m},backend:n}),g=OD(v,t,n),y=g.real,b=g.imag,x=vm.mergeRealAndImagArrays(y,b),k=0;k<i;k++){var w=vm.getComplexWithIndex(x,k);p[d*i+k]=w.real,h[d*i+k]=w.imag}n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v)}var I=n.makeTensorInfo(c,"float32",p),S=n.makeTensorInfo(c,"float32",h),N=ZA({inputs:{real:I,imag:S},backend:n});return n.disposeIntermediateTensorInfo(I),n.disposeIntermediateTensorInfo(S),N}function OD(e,t,n){var r=Aa.sizeFromShape(e.shape),a=n.data.get(e.dataId),i=n.data.get(a.complexTensorInfos.real.dataId).values,o=n.data.get(a.complexTensorInfos.imag.dataId).values;if(function(e){return 0===(e&e-1)}(r)){var s=LD(i,o,r,t,n),u=[e.shape[0],e.shape[1]];if(t){var c=n.makeTensorInfo(u,"float32",s.real),l=n.makeTensorInfo(u,"float32",s.imag),p=n.makeTensorInfo([],"float32",Aa.createScalarValue(r,"float32")),h=OA({inputs:{x:p},backend:n}),d=DD.kernelFunc({inputs:{a:c,b:p},backend:n}),f=DD.kernelFunc({inputs:{a:l,b:h},backend:n}),m=n.data.get(d.dataId).values,v=n.data.get(f.dataId).values;return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),{real:m,imag:v}}return s}var g=function(e,t,n){for(var r=new Float32Array(2*t),a=0;a<t;a++){for(var i=0,o=0,s=0;s<t;s++){var u=vm.exponent(a*s,t,n),c=vm.getComplexWithIndex(e,s);i+=c.real*u.real-c.imag*u.imag,o+=c.real*u.imag+c.imag*u.real}n&&(i/=t,o/=t),vm.assignToTypedArray(r,i,o,a)}return r}(vm.mergeRealAndImagArrays(i,o),r,t);return vm.splitRealAndImagArrays(g)}function LD(e,t,n,r,a){if(1===n)return{real:e,imag:t};var i=vm.mergeRealAndImagArrays(e,t),o=n/2,s=vm.complexWithEvenIndex(i),u=s.real,c=s.imag,l=[u.length],p=a.makeTensorInfo(l,"float32",u),h=a.makeTensorInfo(l,"float32",c),d=ZA({inputs:{real:p,imag:h},backend:a}),f=vm.complexWithOddIndex(i),m=f.real,v=f.imag,g=[m.length],y=a.makeTensorInfo(g,"float32",m),b=a.makeTensorInfo(g,"float32",v),x=ZA({inputs:{real:y,imag:b},backend:a}),k=LD(u,c,o,r,a),w=k.real,I=k.imag,S=[w.length],N=a.makeTensorInfo(S,"float32",w),T=a.makeTensorInfo(S,"float32",I),C=ZA({inputs:{real:N,imag:T},backend:a}),_=LD(m,v,o,r,a),E=_.real,A=_.imag,R=[E.length],F=a.makeTensorInfo(R,"float32",E),Z=a.makeTensorInfo(R,"float32",A),D=ZA({inputs:{real:F,imag:Z},backend:a}),M=vm.exponents(n,r),O=[M.real.length],L=a.makeTensorInfo(O,"float32",M.real),z=a.makeTensorInfo(O,"float32",M.imag),P=ZA({inputs:{real:L,imag:z},backend:a}),B=UR({inputs:{a:P,b:D},backend:a}),W=qA({inputs:{a:C,b:B},backend:a}),V=BF({inputs:{a:C,b:B},backend:a}),U=zA({inputs:{input:W},backend:a}),G=zA({inputs:{input:V},backend:a}),H=GZ({inputs:{input:W},backend:a}),j=GZ({inputs:{input:V},backend:a}),q=jZ({inputs:[U,G],backend:a,attrs:{axis:0}}),K=jZ({inputs:[H,j],backend:a,attrs:{axis:0}}),X=a.data.get(q.dataId).values,Y=a.data.get(K.dataId).values;return a.disposeIntermediateTensorInfo(p),a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(d),a.disposeIntermediateTensorInfo(y),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(x),a.disposeIntermediateTensorInfo(N),a.disposeIntermediateTensorInfo(T),a.disposeIntermediateTensorInfo(C),a.disposeIntermediateTensorInfo(F),a.disposeIntermediateTensorInfo(Z),a.disposeIntermediateTensorInfo(D),a.disposeIntermediateTensorInfo(L),a.disposeIntermediateTensorInfo(z),a.disposeIntermediateTensorInfo(P),a.disposeIntermediateTensorInfo(B),a.disposeIntermediateTensorInfo(W),a.disposeIntermediateTensorInfo(V),a.disposeIntermediateTensorInfo(U),a.disposeIntermediateTensorInfo(H),a.disposeIntermediateTensorInfo(G),a.disposeIntermediateTensorInfo(j),a.disposeIntermediateTensorInfo(q),a.disposeIntermediateTensorInfo(K),{real:X,imag:Y}}var zD={kernelName:un,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,a=Aa.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],o=iZ({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=MD(o,!1,n),u=iZ({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}};function PD(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype||Aa.inferDtype(a),o=Aa.getArrayFromDType(i,Aa.sizeFromShape(r));return function(e,t,n){e.fill(t)}(o,a),t.makeTensorInfo(r,i,o)}var BD={kernelName:cn,backendName:"cpu",kernelFunc:PD};var WD={kernelName:ln,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=(e.attrs,e.backend),r=t.image,a=n,i=Aa.getTypedArrayFromDType(r.dtype,Aa.sizeFromShape(r.shape)),o=(0,h.Z)(r.shape,4),s=o[0],u=o[1],c=o[2],l=o[3],p=a.data.get(r.dataId).values,d=0;d<s;d++)for(var f=d*c*u*l,m=0;m<u;m++)for(var v=m*(c*l),g=0;g<c;g++)for(var y=g*l,b=0;b<l;b++){var x=Math.round(c-g-1),k=f+v+y+b,w=p[k];if(x>=0&&x<c)w=p[f+v+x*l+b];i[k]=w}return{dataId:a.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},VD=FA((function(e,t){return Math.floor(e/t)})),UD=UA(hn,VD,null,"int32"),GD={kernelName:hn,backendName:"cpu",kernelFunc:UD};var HD={kernelName:ma,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,p=r.dilations,h=r.dimRoundingMode,d=r.activation,f=r.leakyreluAlpha,m=KZ({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:p,dimRoundingMode:h}});if(o){var v=m;if("NCHW"===l&&1===o.shape.length&&1!==o.shape[0]){var g=iZ({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});m=qA({inputs:{a:m,b:g},backend:n}),n.disposeIntermediateTensorInfo(g)}else m=qA({inputs:{a:m,b:o},backend:n});n.disposeIntermediateTensorInfo(v)}if(d){var y=m;if("NCHW"===l&&"prelu"===d&&1===s.shape.length&&1!==s.shape[0]){var b=iZ({inputs:{x:s},backend:n,attrs:{shape:[s.shape[0],1,1]}});m=aZ(n,m,d,b,f),n.disposeIntermediateTensorInfo(b)}else m=aZ(n,m,d,s,f);n.disposeIntermediateTensorInfo(y)}return m}};var jD={kernelName:va,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,p=r.dilations,h=r.dimRoundingMode,d=r.activation,f=r.leakyreluAlpha,m=lD({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:p,dimRoundingMode:h}});if(o){var v=m;m=qA({inputs:{a:m,b:o},backend:n}),n.disposeIntermediateTensorInfo(v)}if(d){var g=m;m=aZ(n,m,d,s,f),n.disposeIntermediateTensorInfo(g)}return m}};var qD={kernelName:mn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,i=Aa.sizeFromShape(r.shape),o=a.shape,s=o[o.length-1],u=vm.prepareAndValidate(r,a),c=(0,h.Z)(u,4),l=c[0],p=c[1],d=c[2],f=c[3];if(0===p)return n.makeTensorInfo(l,r.dtype,[]);var m=vR(n.data.get(a.dataId).values,n.bufferSync(r),r.dtype,p,s,d,f,r.shape,i);return n.makeTensorInfo(l,r.dtype,m.values)}};var KD={kernelName:fn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims;TA([a,i],"gatherV2");for(var u=Aa.parseAxisParam(o,a.shape)[0],c=n.data.get(i.dataId).values,l=a.shape[u],p=function(){var e=c[h];Aa.assert(e<=l-1&&e>=0,(function(){return"GatherV2: the index value ".concat(e," is not in [0, ").concat(l-1,"]")}))},h=0;h<c.length;++h)p();var d=s;null==s&&(d=0);var f=Aa.sizeFromShape(i.shape),m=vm.segment_util.collectGatherOpShapeInfo(a,i,u,d),v=iZ({inputs:{x:a},backend:n,attrs:{shape:[m.batchSize,m.outerSize,m.dimSize,m.sliceSize]}}),g=iZ({inputs:{x:i},backend:n,attrs:{shape:[m.batchSize,f/m.batchSize]}}),y=[m.batchSize,m.outerSize,f/m.batchSize,m.sliceSize],b=n.bufferSync(g),x=gR(n.bufferSync(v),b,y);return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),n.makeTensorInfo(m.outputShape,x.dtype,x.values)}};var XD={kernelName:bn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,a=Aa.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],o=iZ({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=MD(o,!0,n),u=iZ({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}},YD=QA(kn,(function(e){return Number.isFinite(e)?1:0}),"bool"),JD={kernelName:kn,backendName:"cpu",kernelFunc:YD},QD=QA(wn,(function(e){return Math.abs(e)===1/0?1:0}),"bool"),$D={kernelName:wn,backendName:"cpu",kernelFunc:QD},eM=QA(In,(function(e){return Number.isNaN(e)?1:0}),"bool"),tM={kernelName:In,backendName:"cpu",kernelFunc:eM};var nM={kernelName:Cn,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=AR(n.start,n.stop,n.num);return t.makeTensorInfo([r.length],"float32",r)}},rM=QA(En,(function(e){return Math.log1p(e)})),aM={kernelName:En,backendName:"cpu",kernelFunc:rM},iM=FA((function(e,t){return e&&t})),oM=UA(An,iM,null,"bool"),sM={kernelName:An,backendName:"cpu",kernelFunc:oM},uM=QA(Rn,(function(e){return e?0:1}),"bool"),cM={kernelName:Rn,backendName:"cpu",kernelFunc:uM},lM=FA((function(e,t){return e||t})),pM=UA(Fn,lM,null,"bool"),hM={kernelName:Fn,backendName:"cpu",kernelFunc:pM};var dM={kernelName:On,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta;TA(a,"LRN");var c=a.shape[3],l=c-1,p=n.data.get(a.dataId).values,h=Aa.sizeFromShape(a.shape),d=new Float32Array(h);function f(e){for(var t=e%c,n=e-t+Math.max(0,t-i),r=e-t+Math.min(t+i,l),a=0;n<=r;n++){var o=p[n];a+=o*o}return a}for(var m=0;m<h;m++){var v=f(m),g=p[m]*Math.pow(o+s*v,-u);d[m]=g}return n.makeTensorInfo(a.shape,a.dtype,d)}};var fM={kernelName:Ln,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta;TA(o,"LRNGrad");for(var p=Aa.sizeFromShape(o.shape),h=o.shape[3],d=n.data.get(o.dataId).values,f=n.data.get(a.dataId).values,m=n.data.get(i.dataId).values,v=new Float32Array(p),g=p,y=0;y<g;y++){for(var b=y%h,x=y-b+Math.max(0,b-s),k=y-b+Math.min(h,b+s+1),w=0,I=x;I<k;I++)w+=Math.pow(f[I],2);w=c*w+u;for(var S=x;S<k;S++){var N=-2*c*l*f[S]*m[y]/w;y===S&&(N+=Math.pow(w,-l)),N*=d[y],v[S]+=N}}return n.makeTensorInfo(o.shape,a.dtype,v)}};function mM(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reductionIndices,o=r.keepDims,s=n,u=a.shape,c=u.length,l=Aa.parseAxisParam(i,u),p=l,d=vm.getAxesPermutation(p,c),f=s.data.get(a.dataId).values;if(null!=d){for(var m=new Array(c),v=0;v<m.length;v++)m[v]=u[d[v]];f=YR(f,u,a.dtype,d,m),p=vm.getInnerMostAxes(p.length,c),u=m}TA(a,"max"),vm.assertAxesAreInnerMostDims("max",p,c);var g=vm.computeOutAndReduceShapes(u,p),y=(0,h.Z)(g,2),b=y[0],x=y[1],k=DR(f,Aa.sizeFromShape(x),b,a.dtype),w=s.write(k,b,a.dtype),I=b;return o&&(I=vm.expandShapeToKeepDim(b,l)),{dataId:w,shape:I,dtype:a.dtype}}var vM={kernelName:zn,backendName:"cpu",kernelFunc:mM};var gM={kernelName:Bn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;TA(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;Aa.assert(vm.eitherStridesOrDilationsAreOne(o,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(1,"'")}));var c,l=vm.computePool2DInfo(a.shape,i,o,1,s,u);if(1===l.filterWidth&&1===l.filterHeight&&Aa.arraysEqual(l.inShape,l.outShape))c=OA({inputs:{x:a},backend:n});else{var p=n.data.get(a.dataId).values,h=Aa.computeStrides(a.shape),d=AZ(p,a.shape,a.dtype,h,l,"max");c=n.makeTensorInfo(l.outShape,a.dtype,d.values)}return c}};var yM={kernelName:Vn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;TA(a,"maxPool3d");var l=vm.computePool3DInfo(a.shape,i,o,1,s,u,c),p=FZ(n.data.get(a.dataId).values,a.shape,a.dtype,Aa.computeStrides(a.shape),l,"max");return n.makeTensorInfo(p.shape,"float32",p.values)}};var bM={kernelName:Un,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;TA([a,i],"maxPool3DGrad");for(var l=vm.computePool3DInfo(i.shape,o,s,1,u,c),p=function(e,t){for(var n=us(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,p=t.effectiveFilterWidth,h=t.padInfo.front,d=t.padInfo.top,f=t.padInfo.left,m=0;m<t.batchSize;++m)for(var v=0;v<t.inChannels;++v)for(var g=0;g<t.outDepth;++g){for(var y=g*r-h,b=y;b<0;)b+=o;for(var x=Math.min(t.inDepth,c+y),k=0;k<t.outHeight;++k){for(var w=k*a-d,I=w;I<0;)I+=s;for(var S=Math.min(t.inHeight,l+w),N=0;N<t.outWidth;++N){for(var T=N*i-f,C=T;C<0;)C+=u;for(var _=Math.min(t.inWidth,p+T),E=Number.NEGATIVE_INFINITY,A=-1,R=b;R<x;R+=o)for(var F=R-y,Z=I;Z<S;Z+=s)for(var D=Z-w,M=C;M<_;M+=u){var O=M-T,L=e.get(m,R,Z,M,v);L>=E&&(E=L,A=F*l*p+D*l+O)}n.set(A,m,g,k,N,v)}}}return n}(n.bufferSync(i),l),h=l.strideDepth,d=l.strideHeight,f=l.strideWidth,m=l.dilationDepth,v=l.dilationHeight,g=l.dilationWidth,y=l.effectiveFilterDepth,b=l.effectiveFilterHeight,x=l.effectiveFilterWidth,k=y-1-l.padInfo.front,w=x-1-l.padInfo.left,I=b-1-l.padInfo.top,S=us(i.shape,"float32"),N=n.bufferSync(a),T=0;T<l.batchSize;++T)for(var C=0;C<l.inChannels;++C)for(var _=0;_<l.inDepth;++_)for(var E=0;E<l.inHeight;++E)for(var A=0;A<l.inWidth;++A){for(var R=_-k,F=E-I,Z=A-w,D=0,M=0;M<y;M+=m){var O=(R+M)/h;if(!(O<0||O>=l.outDepth||Math.floor(O)!==O))for(var L=0;L<b;L+=v){var z=(F+L)/d;if(!(z<0||z>=l.outHeight||Math.floor(z)!==z))for(var P=0;P<x;P+=g){var B=(Z+P)/f;if(!(B<0||B>=l.outWidth||Math.floor(B)!==B)){var W=y*b*x-1-p.get(T,O,z,B,C)===M*b*x+L*x+P?1:0;if(0!==W)D+=N.get(T,O,z,B,C)*W}}}}S.set(D,T,_,E,A,C)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}};var xM={kernelName:Wn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;TA([i,t.output],"maxPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,p=vm.computePool2DInfo(o.shape,s,u,1,c,l),h=n.data.get(o.dataId).values,d=us(p.outShape,o.dtype,RZ(h,o.shape,o.dtype,p).values),f=p.strideHeight,m=p.strideWidth,v=p.dilationHeight,g=p.dilationWidth,y=p.effectiveFilterHeight,b=p.effectiveFilterWidth,x=b-1-p.padInfo.left,k=y-1-p.padInfo.top,w=us(o.shape,"float32"),I=n.data.get(a.dataId).values,S=us(a.shape,"float32",I),N=0;N<p.batchSize;++N)for(var T=0;T<p.inChannels;++T)for(var C=0;C<p.inHeight;++C)for(var _=0;_<p.inWidth;++_){for(var E=C-k,A=_-x,R=0,F=0;F<y;F+=v){var Z=(E+F)/f;if(!(Z<0||Z>=p.outHeight||Math.floor(Z)!==Z))for(var D=0;D<b;D+=g){var M=(A+D)/m;if(!(M<0||M>=p.outWidth||Math.floor(M)!==M)){var O=y*b-1-d.get(N,Z,M,T)===F*b+D?1:0;if(0!==O)R+=S.get(N,Z,M,T)*O}}}w.set(R,N,C,_,T)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}};var kM={kernelName:Gn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.includeBatchInIndex,c=r;TA(a,"MaxPoolWithArgmax");var l=c.data.get(a.dataId).values,p=vm.computePool2DInfo(a.shape,i,o,[1,1],s),d=function(e,t,n,r,a){var i=AZ(e,0,n,Aa.computeStrides(t),a,"max"),o=RZ(e,t,n,a,!0,r);return[i.values,o.values]}(l,a.shape,a.dtype,u,p),f=(0,h.Z)(d,2),m=f[0],v=f[1],g=c.write(m,p.outShape,a.dtype),y=c.write(v,p.outShape,a.dtype);return[{dataId:g,shape:p.outShape,dtype:a.dtype},{dataId:y,shape:p.outShape,dtype:"int32"}]}};var wM={kernelName:Hn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=Aa.parseAxisParam(i,a.shape),u=vm.computeOutAndReduceShapes(a.shape,s)[1],c=Aa.sizeFromShape(u),l=[],p=n.makeTensorInfo([],"float32",new Float32Array([c]));l.push(p);var h=WA({inputs:{x:a},backend:n,attrs:{dtype:"float32"}});l.push(h);var d=ZD({inputs:{a:h,b:p},backend:n});l.push(d);var f=yD({inputs:{x:d},backend:n,attrs:{axis:i,keepDims:o}});return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),f}};var IM={kernelName:jn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;TA(a,"min");var s=Aa.parseAxisParam(i,a.shape),u=s,c=vm.getAxesPermutation(u,a.shape.length),l=a;null!=c&&(l=JR({inputs:{x:a},backend:n,attrs:{perm:c}}),u=vm.getInnerMostAxes(u.length,a.shape.length)),vm.assertAxesAreInnerMostDims("min",u,l.shape.length);for(var p=vm.computeOutAndReduceShapes(l.shape,u),d=(0,h.Z)(p,2),f=d[0],m=d[1],v=Aa.sizeFromShape(m),g=Aa.makeZerosTypedArray(Aa.sizeFromShape(f),l.dtype),y=n.data.get(l.dataId).values,b=0;b<g.length;++b){for(var x=b*v,k=y[x],w=0;w<v;++w){var I=y[x+w];(Number.isNaN(I)||I<k)&&(k=I)}g[b]=k}null!=c&&n.disposeIntermediateTensorInfo(l);var S=n.makeTensorInfo(f,l.dtype,g);if(o){var N=iZ({inputs:{x:S},backend:n,attrs:{shape:vm.expandShapeToKeepDim(f,s)}});return n.disposeIntermediateTensorInfo(S),N}return S}};var SM={kernelName:Kn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode;TA(a,"mirrorPad");for(var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=i.map((function(e){return e[0]})),c=i.map((function(e,t){return e[0]+a.shape[t]})),l="reflect"===o?0:1,p=n.data.get(a.dataId).values,h=a.shape.length,d=Aa.computeStrides(a.shape),f=Aa.sizeFromShape(s),m=s.length,v=Aa.computeStrides(s),g=Aa.getTypedArrayFromDType(a.dtype,f),y=0;y<f;y++){for(var b=Aa.indexToLoc(y,m,v),x=0;x<m;x++)b[x]<u[x]?b[x]=2*u[x]-b[x]-l:b[x]>=c[x]&&(b[x]=2*(c[x]-1)-b[x]+l);b=b.map((function(e,t){return e-u[t]}));var k=Aa.locToIndex(b,h,d);g[y]=p[k]}return{dataId:n.write(g,s,a.dtype),shape:s,dtype:a.dtype}}},NM=FA((function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})),TM=UA(Xn,NM),CM={kernelName:Xn,backendName:"cpu",kernelFunc:TM},_M=R(U());function EM(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.dim,o=a.shape.length,s=i;if(-1===s&&(s=o-1),s!==o-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(o," and dim was ").concat(s));var u=Aa.parseAxisParam([s],a.shape),c=mM({inputs:{x:a},backend:n,attrs:{reductionIndices:u,keepDims:!1}}),l=vm.expandShapeToKeepDim(c.shape,u),p=iZ({inputs:{x:c},backend:n,attrs:{shape:l}}),h=BF({inputs:{a:a,b:p},backend:n}),d=uR({inputs:{x:h},backend:n}),f=yD({inputs:{x:d},backend:n,attrs:{axis:u,keepDims:!1}}),m=iZ({inputs:{x:f},backend:n,attrs:{shape:l}}),v=ZD({inputs:{a:d,b:m},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),v}var AM={kernelName:Wr,backendName:"cpu",kernelFunc:EM};var RM={kernelName:Yn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized;TA(a,"multinomial");for(var u=s?a:EM({inputs:{logits:a},backend:n,attrs:{dim:-1}}),c=u.shape[0],l=u.shape[1],p=n.data.get(u.dataId).values,h=[c,i],d=Aa.makeZerosTypedArray(Aa.sizeFromShape(h),"int32"),f=0;f<c;++f){var m=f*l,v=new Float32Array(l-1);v[0]=p[m];for(var g=1;g<v.length;++g)v[g]=v[g-1]+p[m+g];for(var y=_M.alea(o.toString()),b=f*i,x=0;x<i;++x){var k=y();d[b+x]=v.length;for(var w=0;w<v.length;w++)if(k<v[w]){d[b+x]=w;break}}}return s||n.disposeIntermediateTensorInfo(u),n.makeTensorInfo(h,"int32",d)}},FM=wv.nonMaxSuppressionV3Impl;var ZM={kernelName:er,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold;TA(a,"NonMaxSuppression");var c=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,p=FM(c,l,o,s,u).selectedIndices;return n.makeTensorInfo([p.length],"int32",new Int32Array(p))}},DM=wv.nonMaxSuppressionV4Impl;var MM={kernelName:tr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize;TA(a,"NonMaxSuppressionPadded");var l=n.data.get(a.dataId).values,p=n.data.get(i.dataId).values,h=DM(l,p,o,s,u,c),d=h.selectedIndices,f=h.validOutputs;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}},OM=wv.nonMaxSuppressionV5Impl;var LM={kernelName:nr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma;TA(a,"NonMaxSuppressionWithScore");var l=n.data.get(a.dataId).values,p=n.data.get(i.dataId).values,h=OM(l,p,o,s,u,c),d=h.selectedIndices,f=h.selectedScores;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([f.length],"float32",new Float32Array(f))]}};var zM={kernelName:ar,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.dtype,o=r.depth,s=r.onValue,u=r.offValue;TA(a,"oneHot");var c=Aa.sizeFromShape(a.shape),l=new Float32Array(c*o);l.fill(u);for(var p=n.data.get(a.dataId).values,h=0;h<c;++h)p[h]>=0&&p[h]<o&&(l[h*o+p[h]]=s);return n.makeTensorInfo([].concat((0,g.Z)(a.shape),[o]),i,l)}};function PM(e){var t=e.inputs,n=e.backend,r=t.x;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){var a=zA({inputs:{input:r},backend:n}),i=PM({inputs:{x:a},backend:n}),o=GZ({inputs:{input:r},backend:n}),s=PM({inputs:{x:o},backend:n}),u=ZA({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return PD({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var BM={kernelName:la,backendName:"cpu",kernelFunc:PM};var WM={kernelName:rr,backendName:"cpu",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===a.dtype){var i=zA({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=GZ({inputs:{input:a},backend:r}),u=PM({inputs:{x:s},backend:r}),c=ZA({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return PD({backend:r,attrs:{shape:a.shape,value:1,dtype:a.dtype}})}};function VM(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return AD({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){Aa.assertShapesMatch(a,e.shape,"All tensors passed to stack must have matching shapes"),Aa.assert(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=jZ({inputs:t.map((function(e){var t=AD({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),s}var UM={kernelName:ir,backendName:"cpu",kernelFunc:VM};var GM={kernelName:or,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue;TA(a,"pad");var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=i.map((function(e){return e[0]})),c=n.data.get(a.dataId).values,l=Aa.sizeFromShape(a.shape),p=a.shape.length,h=Aa.computeStrides(a.shape),d=Aa.sizeFromShape(s),f=s.length,m=Aa.computeStrides(s),v=Aa.getTypedArrayFromDType(a.dtype,d);0!==o&&v.fill(o);for(var g=0;g<l;g++){var y=Aa.indexToLoc(g,p,h).map((function(e,t){return e+u[t]}));v[Aa.locToIndex(y,f,m)]=c[g]}return{dataId:n.write(v,s,a.dtype),shape:s,dtype:a.dtype}}},HM=FA((function(e,t){return Math.pow(e,t)})),jM=UA(ur,HM),qM={kernelName:ur,backendName:"cpu",kernelFunc:jM};var KM={kernelName:pr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.paramsNestedSplits,i=t.paramsDenseValues,o=t.indices,s=(r.outputRaggedRank,a.map((function(e){return n.data.get(e.dataId).values}))),u=a.map((function(e){return e.shape})),c=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values,p=aF(s,u,c,i.shape,i.dtype,l,o.shape),d=(0,h.Z)(p,3),f=d[0],m=d[1],v=d[2],g=f.map((function(e){return n.makeTensorInfo([e.length],"int32",e)})),y=n.makeTensorInfo(v,i.dtype,m);return g.concat([y])}};var XM={kernelName:hr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.starts,a=t.limits,i=t.deltas,o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,c=oF(o,r.shape,r.dtype,s,a.shape,u,i.shape),l=(0,h.Z)(c,2),p=l[0],d=l[1];return[n.makeTensorInfo([p.length],"int32",p),n.makeTensorInfo([d.length],r.dtype,d)]}};var YM={kernelName:dr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.shape,i=t.values,o=t.defaultValue,s=t.rowPartitionTensors,u=r.rowPartitionTypes,c=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,p=n.data.get(o.dataId).values,d=s.map((function(e){return n.data.get(e.dataId).values})),f=s.map((function(e){return e.shape})),m=pF(c,a.shape,l,i.shape,i.dtype,p,o.shape,d,f,u),v=(0,h.Z)(m,2),g=v[0],y=v[1];return n.makeTensorInfo(g,i.dtype,y)}};var JM={kernelName:fr,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.dtype,o=hF(r,a,n.step,i);return t.makeTensorInfo([o.length],i,o)}},QM=QA(vr,(function(e){return 1/e})),$M={kernelName:vr,backendName:"cpu",kernelFunc:QM};var eO={kernelName:kr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size;TA(a,"resizeBilinear");for(var u=Aa.computeStrides(a.shape),c=(0,h.Z)(s,2),l=c[0],p=c[1],d=(0,h.Z)(a.shape,4),f=d[0],m=d[1],v=d[2],g=d[3],y=n.data.get(a.dataId).values,b=new Float32Array(Aa.sizeFromShape([f,l,p,g])),x=[i&&l>1?m-1:m,i&&p>1?v-1:v],k=[i&&l>1?l-1:l,i&&p>1?p-1:p],w=0,I=x[0]/k[0],S=x[1]/k[1],N=0;N<f;N++)for(var T=0;T<l;T++){var C=void 0;C=o?I*(T+.5)-.5:I*T;for(var _=Math.max(0,Math.floor(C)),E=C-_,A=Math.min(m-1,Math.ceil(C)),R=N*u[0]+_*u[1],F=N*u[0]+A*u[1],Z=0;Z<p;Z++){var D=void 0;D=o?S*(Z+.5)-.5:S*Z;for(var M=Math.max(0,Math.floor(D)),O=D-M,L=Math.min(v-1,Math.ceil(D)),z=R+M*u[2],P=F+M*u[2],B=R+L*u[2],W=F+L*u[2],V=0;V<g;V++){var U=y[z+V],G=y[P+V],H=U+(y[B+V]-U)*O,j=H+(G+(y[W+V]-G)*O-H)*E;b[w++]=j}}}return n.makeTensorInfo([f,l,p,g],"float32",b)}};var tO={kernelName:wr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners;TA([i,a],"resizeBilinearGrad");for(var s=Aa.computeStrides(a.shape),u=(0,h.Z)(a.shape,4),c=u[0],l=u[1],p=u[2],d=u[3],f=(0,h.Z)(i.shape,3),m=f[1],v=f[2],g=new Float32Array(c*l*p*d),y=[o&&m>1?l-1:l,o&&v>1?p-1:p],b=[o&&m>1?m-1:m,o&&v>1?v-1:v],x=y[0]/b[0],k=y[1]/b[1],w=n.data.get(i.dataId).values,I=0,S=0;S<c;S++)for(var N=S*s[0],T=0;T<m;T++)for(var C=T*x,_=Math.floor(C),E=Math.min(Math.ceil(C),l-1),A=N+_*s[1],R=N+E*s[1],F=C-_,Z=1-F,D=0;D<v;D++)for(var M=D*k,O=Math.floor(M),L=Math.min(Math.ceil(M),p-1),z=M-O,P=1-z,B=A+O*s[2],W=A+L*s[2],V=R+O*s[2],U=R+L*s[2],G=Z*P,H=Z*z,j=F*P,q=F*z,K=0;K<d;K++){var X=w[I++];g[B+K]+=X*G,g[W+K]+=X*H,g[V+K]+=X*j,g[U+K]+=X*q}return n.makeTensorInfo([c,p,l,d],"float32",g)}};var nO={kernelName:br,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size;TA(a,"resizeNearestNeighbor");for(var u=Aa.computeStrides(a.shape),c=(0,h.Z)(s,2),l=c[0],p=c[1],d=(0,h.Z)(a.shape,4),f=d[0],m=d[1],v=d[2],g=d[3],y=n.data.get(a.dataId).values,b=new Float32Array(f*l*p*g),x=[i&&l>1?m-1:m,i&&p>1?v-1:v],k=[i&&l>1?l-1:l,i&&p>1?p-1:p],w=x[0]/k[0],I=x[1]/k[1],S=0,N=0;N<f;N++)for(var T=N*u[0],C=0;C<l;C++){var _=o?w*(C+.5):w*C,E=Math.min(m-1,i?Math.round(_):Math.floor(_));o&&(E=Math.max(0,E));for(var A=T+E*u[1],R=0;R<p;R++){var F=o?I*(R+.5):I*R,Z=Math.min(v-1,i?Math.round(F):Math.floor(F));o&&(Z=Math.max(0,Z));for(var D=A+Z*u[2],M=0;M<g;M++){var O=y[D+M];b[S++]=O}}}return n.makeTensorInfo([f,l,p,g],a.dtype,b)}};var rO={kernelName:xr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners;TA([i,a],"resizeNearestNeighborGrad");for(var s=Aa.computeStrides(a.shape),u=Aa.computeStrides(i.shape),c=(0,h.Z)(a.shape,4),l=c[0],p=c[1],d=c[2],f=c[3],m=(0,h.Z)(i.shape,3),v=m[1],g=m[2],y=new Float32Array(l*p*d*f),b=n.data.get(i.dataId).values,x=[o&&v>1?p-1:p,o&&g>1?d-1:d],k=[o&&v>1?v-1:v,o&&g>1?g-1:g],w=x[0]/k[0],I=x[1]/k[1],S=1/w,N=1/I,T=2*Math.ceil(S)+2,C=2*Math.ceil(N)+2,_=0;_<l;_++)for(var E=_*s[0],A=0;A<p;A++)for(var R=E+A*s[1],F=Math.floor(A*S),Z=Math.floor(F-T/2),D=0;D<d;D++)for(var M=R+D*s[2],O=Math.floor(D*N),L=Math.floor(O-C/2),z=0;z<f;z++){for(var P=0,B=0;B<T;B++){var W=B+Z;if(!(W<0||W>=v)){var V=E+W*u[1],U=W*w;if(A===Math.min(p-1,o?Math.round(U):Math.floor(U)))for(var G=0;G<C;G++){var H=G+L;if(!(H<0||H>=g)){var j=V+H*u[2],q=H*I;D===Math.min(d-1,o?Math.round(q):Math.floor(q))&&(P+=b[j+z])}}}}y[M+z]=P}return n.makeTensorInfo(a.shape,a.dtype,y)}};var aO={kernelName:Sr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims;TA(a,"reverse");var o=a.shape.length,s=Aa.parseAxisParam(i,a.shape);if(0===o)return OA({inputs:{x:a},backend:n});for(var u=new ci(a.shape,a.dtype),c=n.bufferSync(a),l=function(){var e=u.indexToLoc(p),t=e.slice();s.forEach((function(e){return t[e]=a.shape[e]-1-t[e]})),u.set.apply(u,[c.get.apply(c,(0,g.Z)(t))].concat((0,g.Z)(e)))},p=0;p<u.size;p++)l();return n.makeTensorInfo(u.shape,u.dtype,u.values)}},iO={kernelName:da,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=n.radians,o=n.fillValue,s=n.center,u=r,c=Aa.getTypedArrayFromDType(a.dtype,Aa.sizeFromShape(a.shape)),l=(0,h.Z)(a.shape,4),p=l[0],d=l[1],f=l[2],m=l[3],v=vm.getImageCenter(s,d,f),g=(0,h.Z)(v,2),y=g[0],b=g[1],x=Math.sin(i),k=Math.cos(i),w=u.data.get(a.dataId).values,I=0;I<p;I++)for(var S=I*f*d*m,N=0;N<d;N++)for(var T=N*(f*m),C=0;C<f;C++)for(var _=C*m,E=0;E<m;E++){var A=[p,N,C,E],R=A[2],F=A[1],Z=(R-y)*k-(F-b)*x,D=(R-y)*x+(F-b)*k;Z=Math.round(Z+y),D=Math.round(D+b);var M=o;if("number"!=typeof o&&(M=3===E?255:o[E]),Z>=0&&Z<f&&D>=0&&D<d)M=w[S+D*(f*m)+Z*m+E];c[S+T+_+E]=M}return{dataId:u.write(c,a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},oO=QA(Nr,(function(e){var t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2===0?t:t+1})),sO={kernelName:Nr,backendName:"cpu",kernelFunc:oO};var uO={kernelName:Cr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=vm.calculateShapes(i,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,p=s.strides,h=s.outputSize,d=vF(n.bufferSync(a),n.bufferSync(i),o,h,l,c,u,p,0,!0);return n.makeTensorInfo(o,d.dtype,d.values)}};function cO(e,t){for(var n=0,r=e.length,a=0;n<r;)e[a=Math.floor((n+r)/2)]<t?n=a+1:r=a;return r}function lO(e,t){for(var n=0,r=e.length,a=0;n<r;)e[a=Math.floor((n+r)/2)]<=t?n=a+1:r=a;return r}var pO={kernelName:_r,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sortedSequence,i=t.values,o=r.side,s=function(e,t,n,r,a,i){for(var o=Aa.getArrayFromDType("int32",n*a),s=0;s<n;++s)for(var u=e.slice(s*r,(s+1)*r),c=s*a,l=0;l<a;++l)o[c+l]="left"===i?cO(u,t[l+c]):lO(u,t[l+c]);return o}(n.data.get(a.dataId).values,n.data.get(i.dataId).values,a.shape[0],a.shape[1],i.shape[1],o);return n.makeTensorInfo(i.shape,"int32",s)}};var hO={kernelName:Er,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e;TA([r,a,i],"select");for(var o=r.shape.length,s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,l=wi(a.dtype,i.dtype),p=Aa.makeZerosTypedArray(Aa.sizeFromShape(a.shape),l),h=0,d=0===o||o>1||1===a.shape.length?1:Aa.sizeFromShape(a.shape.slice(1)),f=0;f<s.length;f++)for(var m=0;m<d;m++)1===s[f]?p[h++]=u[f]:p[h++]=c[f];return n.makeTensorInfo(a.shape,l,p)}},dO=vm.SELU_SCALEALPHA,fO=vm.SELU_SCALE,mO=QA(Ar,(function(e){return e>=0?fO*e:dO*(Math.exp(e)-1)})),vO={kernelName:Ar,backendName:"cpu",kernelFunc:mO},gO=QA(Dr,(function(e){return e<0?-1:e>0?1:0})),yO={kernelName:Dr,backendName:"cpu",kernelFunc:gO},bO=QA(Fr,(function(e){return Math.sin(e)})),xO={kernelName:Fr,backendName:"cpu",kernelFunc:bO},kO=QA(Zr,(function(e){return Math.sinh(e)})),wO={kernelName:Zr,backendName:"cpu",kernelFunc:kO},IO=Math.log(1.1920928955078125e-7)+2,SO=QA(Or,(function(e){var t=e>-IO,n=e<IO,r=Math.exp(e);return n?r:t?e:Math.log(1+r)})),NO={kernelName:Or,backendName:"cpu",kernelFunc:SO};var TO={kernelName:Pr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings;TA([a],"spaceToBatchND");var s=Aa.sizeFromShape(i),u=[[0,0]];u.push.apply(u,(0,g.Z)(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=GM.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),p=vm.getReshaped(l.shape,i,s,!1),h=vm.getPermuted(p.length,i.length,!1),d=vm.getReshapedPermuted(l.shape,i,s,!1),f=iZ({inputs:{x:l},backend:n,attrs:{shape:p}}),m=JR({inputs:{x:f},backend:n,attrs:{perm:h}}),v=iZ({inputs:{x:m},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),v}};var CO={kernelName:Vr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.indices,a=t.values,i=t.denseShape,o=t.defaultValue;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n        ".concat(i.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n        ".concat(a.shape));if(0!==o.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(o.shape));var s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values[0],p=IF(s,r.shape,r.dtype,u,a.dtype,c,l),d=(0,h.Z)(p,5),f=d[0],m=d[1],v=d[2],g=d[3],y=d[4];return[n.makeTensorInfo(m,r.dtype,f),n.makeTensorInfo([m[0]],a.dtype,v),n.makeTensorInfo([g.length],"bool",new Uint8Array(g.map((function(e){return Number(e)})))),n.makeTensorInfo([y.length],r.dtype,new Int32Array(y))]}};var _O={kernelName:Ur,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.inputIndices,a=t.inputShape,i=t.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape\n        ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(n.data.get(a.dataId).values),s=n.data.get(r.dataId).values,u=Array.from(n.data.get(i.dataId).values),c=SF(s,r.shape,r.dtype,o,u),l=(0,h.Z)(c,3),p=l[0],d=l[1],f=l[2];return[n.makeTensorInfo(d,r.dtype,p),n.makeTensorInfo([f.length],i.dtype,new Int32Array(f))]}};var EO={kernelName:Gr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n          ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n          ".concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,c=NF(o,r.shape,r.dtype,s,u,!0),l=(0,h.Z)(c,2),p=l[0],d=l[1];return n.makeTensorInfo(d,r.dtype,p)}};var AO={kernelName:Hr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n         ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n         ".concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,c=NF(o,r.shape,r.dtype,s,u),l=(0,h.Z)(c,2),p=l[0],d=l[1];return n.makeTensorInfo(d,r.dtype,p)}};var RO={kernelName:jr,backendName:"cpu",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.sparseIndices,o=n.sparseValues,s=n.defaultValue,u=a.outputShape,c=vm.calculateShapes(o,i,u),l=c.sliceRank,p=c.numUpdates,h=c.sliceSize,d=c.strides,f=c.outputSize,m=!1,v=r.bufferSync(i);switch(o.dtype){case"bool":t=vF(v,r.bufferSync(o),u,f,h,p,l,d,Boolean(r.data.get(s.dataId).values[0]),m);break;case"float32":t=vF(v,r.bufferSync(o),u,f,h,p,l,d,r.data.get(s.dataId).values[0],m);break;case"int32":t=vF(v,r.bufferSync(o),u,f,h,p,l,d,r.data.get(s.dataId).values[0],m);break;case"string":t=vF(v,r.bufferSync(o),u,f,h,p,l,d,Aa.decodeString(r.data.get(s.dataId).values[0]),m);break;default:throw new Error("Unsupported type ".concat(o.dtype))}return r.makeTensorInfo(u,t.dtype,t.values)}};var FO={kernelName:Br,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.numOrSizeSplits,o=r.axis,s=Aa.parseAxisParam(o,a.shape)[0],u=vm.prepareSplitSize(a,i,s),c=new Array(a.shape.length).fill(0),l=a.shape.slice();return u.map((function(e){var t=(0,g.Z)(l);t[s]=e;var r=kF({inputs:{x:a},backend:n,attrs:{begin:c,size:t}});return c[s]+=e,r}))}},ZO={kernelName:Kr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n;TA(r,"square");for(var i=a.data.get(r.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];o[s]=u*u}return{dataId:a.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},DO=QA(pa,(function(e,t){var n=t;return isNaN(e)?NaN:e>0?1:n.alpha})),MO={kernelName:pa,backendName:"cpu",kernelFunc:DO};var OO={kernelName:Xr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.end,s=r.strides,u=r.beginMask,c=r.endMask,l=r.ellipsisMask,p=r.newAxisMask,h=r.shrinkAxisMask;TA(a,"stridedSlice");var d,f=Gf.sliceInfo(a.shape,i,o,s,u,c,l,p,h),m=f.finalShapeSparse,v=f.finalShape,g=f.isIdentity,y=f.sliceDim0,b=f.isSimpleSlice,x=f.begin,k=f.end,w=f.strides;if(g)d=iZ({inputs:{x:a},backend:n,attrs:{shape:v}});else if(y||b){Aa.assert(a.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(a.shape.length)}));var I=Gf.computeOutShape(x,k,w),S=kF({inputs:{x:a},backend:n,attrs:{begin:x,size:I}});d=iZ({inputs:{x:S},backend:n,attrs:{shape:v}}),n.disposeIntermediateTensorInfo(S)}else{var N=FF(m,n.bufferSync(a),w,x);d=n.makeTensorInfo(v,N.dtype,N.values)}return d}};var LO={kernelName:Yr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=r.separator,i=r.nGramWidths,o=r.leftPad,s=r.rightPad,u=r.padWidth,c=r.preserveShortSequences,l=t.data,p=t.dataSplits,d=DF(n.data.get(l.dataId).values,n.data.get(p.dataId).values,a,i,o,s,u,c),f=(0,h.Z)(d,2),m=f[0],v=f[1];return[n.makeTensorInfo([m.length],"string",m),n.makeTensorInfo(p.shape,"int32",v)]}};var zO={kernelName:Jr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.skipEmpty,a=t.input,i=t.delimiter;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error("Input must be a vector, got shape: ".concat(a.shape));if(0!==i.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(i.shape));var o=OF(n.data.get(a.dataId).values,n.data.get(i.dataId).values[0],r),s=(0,h.Z)(o,3),u=s[0],c=s[1],l=s[2],p=c.length;return[n.makeTensorInfo([p,2],"int32",u),n.makeTensorInfo([p],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(l))]}};var PO={kernelName:Qr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.numBuckets,a=t.input;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");var i=LF(n.data.get(a.dataId).values,r);return n.makeTensorInfo(a.shape,"int32",i)}},BO=QA(ea,(function(e){return Math.tan(e)})),WO={kernelName:ea,backendName:"cpu",kernelFunc:BO},VO=QA(ta,(function(e){return Math.tanh(e)}));var UO={kernelName:na,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;TA(a,"tile");var o=VF(n.bufferSync(a),i);return n.makeTensorInfo(o.shape,o.dtype,o.values)}};var GO={kernelName:ra,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,o=r.sorted;TA(a,"topk");var s=HF(n.data.get(a.dataId).values,a.shape,a.dtype,i,o),u=(0,h.Z)(s,2),c=u[0],l=u[1];return[n.makeTensorInfo(c.shape,c.dtype,c.values),n.makeTensorInfo(l.shape,l.dtype,l.values)]}};var HO={kernelName:aa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=t.transforms,o=n.interpolation,s=n.fillMode,u=n.fillValue,c=n.outputShape,l=(0,h.Z)(a.shape,4),p=l[0],d=l[1],f=l[2],m=l[3],v=null!=c?c:[d,f],g=(0,h.Z)(v,2),y=g[0],b=g[1],x=[p,y,b,m],k=Aa.computeStrides(a.shape),w=k[0],I=k[1],S=k[2],N=Aa.computeStrides(x),T=N[0],C=N[1],_=N[2],E=Aa.getTypedArrayFromDType(a.dtype,Aa.sizeFromShape(x));E.fill(u);for(var A=r.data.get(a.dataId).values,R=r.data.get(i.dataId).values,F=0;F<p;++F){for(var Z=1===i.shape[0]?R:R.subarray(8*F,8*F+8),D=0;D<y;++D)for(var M=0;M<b;++M)for(var O=0;O<m;++O){var L=void 0,z=Z[6]*M+Z[7]*D+1;if(0!==z){var P=(Z[0]*M+Z[1]*D+Z[2])/z,B=(Z[3]*M+Z[4]*D+Z[5])/z,W=jO(P,f,s),V=jO(B,d,s);switch(o){case"nearest":L=KO(A,d,f,w,I,S,F,V,W,O,u);break;case"bilinear":L=XO(A,d,f,w,I,S,F,V,W,O,u);break;default:throw new Error("Error in Transform: Expect 'nearest' or 'bilinear', but got ".concat(o))}E[F*T+D*C+M*_+O]=L}}return r.makeTensorInfo(x,a.dtype,E)}return{dataId:r.write(E,x,a.dtype),shape:a.shape,dtype:a.dtype}}};function jO(e,t,n){switch(n){case"reflect":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var r=2*t;n<r&&(n=r*Math.trunc(-n/r)+n),n=n<-t?n+r:-n-1}else if(n>t-1)if(t<=1)n=0;else{var a=2*t;(n-=a*Math.trunc(n/a))>=t&&(n=a-n-1)}return Aa.clamp(0,n,t-1)}(e,t);case"wrap":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var r=t-1;n+=t*(Math.trunc(-n/r)+1)}else if(n>t-1)if(t<=1)n=0;else{var a=t-1;n-=t*Math.trunc(n/a)}return Aa.clamp(0,n,t-1)}(e,t);case"nearest":return function(e,t){return Aa.clamp(0,e,t-1)}(e,t);default:return function(e,t){return e}(e)}}function qO(e,t,n,r,a,i,o,s,u,c,l){return 0<=s&&s<t&&0<=u&&u<n?e[o*r+s*a+u*i+c]:l}function KO(e,t,n,r,a,i,o,s,u,c,l){return qO(e,t,n,r,a,i,o,Math.round(s),Math.round(u),c,l)}function XO(e,t,n,r,a,i,o,s,u,c,l){var p=Math.floor(s),h=Math.floor(u),d=p+1,f=h+1;return(d-s)*((f-u)*qO(e,t,n,r,a,i,o,p,h,c,l)+(u-h)*qO(e,t,n,r,a,i,o,p,f,c,l))+(s-p)*((f-u)*qO(e,t,n,r,a,i,o,d,h,c,l)+(u-h)*qO(e,t,n,r,a,i,o,d,f,c,l))}var YO={kernelName:oa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;TA(i,"unique");var o=jF(r.data.get(i.dataId).values,a,i.shape,i.dtype),s=o.outputValues,u=o.outputShape,c=o.indices;return[r.makeTensorInfo(u,i.dtype,s),r.makeTensorInfo([c.length],"int32",c)]}};var JO={kernelName:sa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a.shape.length,s=a.shape[i],u=new Array(o-1),c=0,l=0;l<o;l++)l!==i&&(u[c++]=a.shape[l]);var p=new Array(o).fill(0),h=a.shape.slice();h[i]=1;for(var d=new Array(s),f=0;f<d.length;f++){p[i]=f;var m=kF({inputs:{x:a},backend:n,attrs:{begin:p,size:h}});d[f]=iZ({inputs:{x:m},backend:n,attrs:{shape:u}}),n.disposeIntermediateTensorInfo(m)}return d}};for(var QO={kernelName:ua,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.segmentIds,o=r.numSegments;TA(a,"unsortedSegmentSum");for(var s=[],u=[],c=a.shape.length-i.shape.length,l=i,p=0;p<c;++p){var h=AD({inputs:{input:l},backend:n,attrs:{dim:p+1}});l=h,u.push(h)}for(var d=0;d<o;++d){var f=Aa.createScalarValue(d,"int32"),m=n.makeTensorInfo([],"int32",f),v=iR({inputs:{a:m,b:l},backend:n}),g=WA({inputs:{x:v},backend:n,attrs:{dtype:"float32"}}),y=UR({inputs:{a:g,b:a},backend:n}),b=yD({inputs:{x:y},backend:n,attrs:{axis:0,keepDims:!1}});s.push(b),u.push(m),u.push(v),u.push(g),u.push(y),u.push(b)}var x=VM({inputs:s,backend:n,attrs:{axis:0}});return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),x}},$O=0,eL=[cZ,RA,pZ,dZ,KA,fZ,mZ,vZ,gZ,yZ,xZ,wZ,SZ,CZ,EZ,ZZ,DZ,MZ,OZ,uZ,LZ,zZ,PZ,BZ,VA,nR,VZ,DA,UZ,qZ,XZ,YZ,JZ,QZ,$Z,eD,nD,aD,iD,oD,sD,uD,cD,pD,hD,dD,fD,mD,vD,gD,xD,KF,kD,oR,ED,cR,RD,hR,zD,BD,WD,mR,GD,HD,jD,qD,KD,xR,IR,LA,XD,HZ,JD,$D,tM,YF,TR,ER,nM,ZR,aM,sM,cM,hM,dM,fM,vM,LR,gM,yM,bM,xM,kM,wM,IM,BR,SM,CM,RM,GR,jR,ZM,MM,LM,XR,zM,WM,UM,GM,qM,$F,eF,KM,XM,YM,JM,PA,DD,$M,tZ,rZ,oZ,eO,tO,nO,rO,aO,iO,sO,mF,uO,pO,hO,vO,bF,yO,xO,wO,wF,AM,NO,TO,CO,_O,EO,AO,RO,FO,_F,ZO,RF,MO,OO,LO,zO,PO,WF,bD,WO,{kernelName:ta,backendName:"cpu",kernelFunc:VO},UO,GO,HO,QR,YO,JO,QO,BM];$O<eL.length;$O++){Sa(eL[$O])}var tL={};A(tL,{assertNotComplex:function(){return lz},bindCanvasToFramebuffer:function(){return BL},bindColorTextureToFramebuffer:function(){return WL},bindTextureToProgramUniformSampler:function(){return PL},bindTextureUnit:function(){return ML},bindVertexBufferToProgramAttribute:function(){return DL},callAndCheck:function(){return dL},canBeRepresented:function(){return vL},createFragmentShader:function(){return xL},createFramebuffer:function(){return ZL},createProgram:function(){return NL},createStaticIndexBuffer:function(){return EL},createStaticVertexBuffer:function(){return _L},createTexture:function(){return RL},createVertexShader:function(){return bL},getBatchDim:function(){return qL},getExtensionOrThrow:function(){return yL},getFramebufferErrorMessage:function(){return GL},getMaxTexturesInShader:function(){return nz},getNumChannels:function(){return AL},getProgramUniformLocation:function(){return zL},getProgramUniformLocationOrThrow:function(){return LL},getRowsCols:function(){return KL},getShapeAs3D:function(){return XL},getTextureShapeFromLogicalShape:function(){return YL},getWebGLDisjointQueryTimerVersion:function(){return rz},getWebGLErrorMessage:function(){return gL},getWebGLMaxTextureSize:function(){return $L},hasExtension:function(){return az},isCapableOfRenderingToFloatTexture:function(){return oz},isDownloadFloatTextureEnabled:function(){return sz},isReshapeFree:function(){return QL},isWebGLFenceEnabled:function(){return cz},isWebGLVersionEnabled:function(){return iz},linkProgram:function(){return TL},logShaderSourceAndInfoLog:function(){return SL},resetMaxTextureSize:function(){return ez},resetMaxTexturesInShader:function(){return tz},unbindColorTextureFromFramebuffer:function(){return VL},unbindTextureUnit:function(){return OL},validateFramebuffer:function(){return UL},validateProgram:function(){return CL},validateTextureSize:function(){return FL}});var nL,rL,aL,iL={},oL={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function sL(e,t){iL[e]=t}function uL(e,t){if(!(e in iL)||null!=t){var n=function(e,t){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var n=null==t?function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e):t;return n.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete iL[e]}),!1),Qe().getBool("SOFTWARE_WEBGL_ENABLED")&&(oL.failIfMajorPerformanceCaveat=!1),1===e?n.getContext("webgl",oL)||n.getContext("experimental-webgl",oL):n.getContext("webgl2",oL)}(e,t);if(null===n)return console.log("Could not get context for WebGL version",e),null;iL[e]=n}var r=iL[e];return null==r||r.isContextLost()?(delete iL[e],uL(e)):(r.disable(r.DEPTH_TEST),r.disable(r.STENCIL_TEST),r.disable(r.BLEND),r.disable(r.DITHER),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SAMPLE_COVERAGE),r.enable(r.SCISSOR_TEST),r.enable(r.CULL_FACE),r.cullFace(r.BACK),iL[e])}function cL(e,t){return[t,e]}function lL(e){var t=Aa.sizeFromShape(e),n=Math.ceil(t/4);return Aa.sizeToSquarishShape(n)}function pL(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function hL(e,t){var n,r,a,i,o,s,u,c,l,p,h=e;return 2===Qe().getNumber("WEBGL_VERSION")?(n=h.R32F,r=h.R16F,a=h.RGBA16F,i=h.RGBA32F,o=h.RED,u=4,c=1,l=h.HALF_FLOAT,p=h.FLOAT,s=h.RGBA8):(n=e.RGBA,r=e.RGBA,a=e.RGBA,i=h.RGBA,o=e.RGBA,u=4,c=4,l=null!=t?t.HALF_FLOAT_OES:null,p=e.FLOAT,s=e.RGBA),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:s,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:l,textureTypeFloat:p}}function dL(e,t){var n=t();return Qe().getBool("DEBUG")&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+gL(e,t))}(e),n}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(nL||(nL={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(rL||(rL={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(aL||(aL={}));var fL=5.96e-8,mL=65504;function vL(e){return!!(Qe().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||fL<Math.abs(e)&&Math.abs(e)<mL)}function gL(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(t)}}function yL(e,t){return HL(e,(function(){return e.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}function bL(e,t){var n=HL(e,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(dL(e,(function(){return e.shaderSource(n,t)})),dL(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function xL(e,t){var n=HL(e,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(dL(e,(function(){return e.shaderSource(n,t)})),dL(e,(function(){return e.compileShader(n)})),Qe().get("ENGINE_COMPILE_ONLY"))return n;if(!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw SL(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}var kL,wL,IL=/ERROR: [0-9]+:([0-9]+):/g;function SL(e,t){var n=IL.exec(t);if(null==n)return console.log("Couldn't parse line number in error: ".concat(t)),void console.log(e);for(var r=+n[1],a=e.split("\n"),i=a.length.toString().length+2,o=a.map((function(e,t){return Aa.rightPad((t+1).toString(),i)+e})),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);var c=o.slice(0,r-1),l=o.slice(r-1,r),p=o.slice(r);console.log(c.join("\n")),console.log(t.split("\n")[0]),console.log("%c ".concat(Aa.rightPad(l[0],s)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(p.join("\n"))}function NL(e){return HL(e,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}function TL(e,t){if(dL(e,(function(){return e.linkProgram(t)})),!Qe().get("ENGINE_COMPILE_ONLY")&&!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function CL(e,t){if(dL(e,(function(){return e.validateProgram(t)})),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function _L(e,t){var n=HL(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return dL(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),dL(e,(function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}function EL(e,t){var n=HL(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return dL(e,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)})),dL(e,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}function AL(){return 2===Qe().getNumber("WEBGL_VERSION")?1:4}function RL(e){return HL(e,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}function FL(e,t){var n=Qe().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="[".concat(e,"x").concat(t,"]");throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n){var a="[".concat(e,"x").concat(t,"]"),i="[".concat(n,"x").concat(n,"]");throw new Error("Requested texture size "+a+" greater than WebGL maximum on this browser / GPU "+i+".")}}function ZL(e){return HL(e,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function DL(e,t,n,r,a,i,o){var s=e.getAttribLocation(t,n);return-1!==s&&(dL(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),dL(e,(function(){return e.vertexAttribPointer(s,a,e.FLOAT,!1,i,o)})),dL(e,(function(){return e.enableVertexAttribArray(s)})),!0)}function ML(e,t,n){jL(e,n),dL(e,(function(){return e.activeTexture(e.TEXTURE0+n)})),dL(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)}))}function OL(e,t){jL(e,t),dL(e,(function(){return e.activeTexture(e.TEXTURE0+t)})),dL(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function LL(e,t,n){return HL(e,(function(){return e.getUniformLocation(t,n)}),'uniform "'+n+'" not present in program.')}function zL(e,t,n){return e.getUniformLocation(t,n)}function PL(e,t,n,r){dL(e,(function(){return ML(e,t,r)})),dL(e,(function(){return e.uniform1i(n,r)}))}function BL(e){dL(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)})),dL(e,(function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)})),dL(e,(function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)}))}function WL(e,t,n){dL(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),dL(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}))}function VL(e,t){dL(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)})),dL(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function UL(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+GL(e,t))}function GL(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(t)}}function HL(e,t,n){var r=dL(e,(function(){return t()}));if(null==r)throw new Error(n);return r}function jL(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n){var a="[gl.TEXTURE0, gl.TEXTURE".concat(n,"]");throw new Error("textureUnit must be in ".concat(a,"."))}}function qL(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return Aa.sizeFromShape(e.slice(0,e.length-t))}function KL(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function XL(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[qL(e)].concat((0,g.Z)(KL(e)))),t}function YL(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Qe().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=Qe().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");r===1/0&&Qe().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=n/2),t&&(n*=2,r*=2,e=e.map((function(t,n){return n>=e.length-2?Aa.nearestLargerEven(e[n]):e[n]})),1===e.length&&(e=[2,e[0]])),2!==e.length&&(e=Aa.squeezeShape(e).newShape);var a=Aa.sizeFromShape(e),i=null;e.length<=1&&a<=n?i=[1,a]:2===e.length&&e[0]<=n&&e[1]<=n?i=e:3===e.length&&e[0]*e[1]<=n&&e[2]<=n?i=[e[0]*e[1],e[2]]:3===e.length&&e[0]<=n&&e[1]*e[2]<=n?i=[e[0],e[1]*e[2]]:4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n?i=[e[0]*e[1]*e[2],e[3]]:4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n&&(i=[e[0],e[1]*e[2]*e[3]]);var o=null!=i&&Math.max.apply(Math,(0,g.Z)(i))>r&&Math.min.apply(Math,(0,g.Z)(i))<=(t?2:1)&&Math.min.apply(Math,(0,g.Z)(i))>0;if(null==i||o)if(t){var s,u,c=qL(e),l=2,p=2;e.length&&(s=KL(e),l=(u=(0,h.Z)(s,2))[0],p=u[1]),a=c*(l/2)*(p/2),i=Aa.sizeToSquarishShape(a).map((function(e){return 2*e}))}else i=Aa.sizeToSquarishShape(a);return i}function JL(e){return e%2===0}function QL(e,t){if(e=e.slice(-2),t=t.slice(-2),Aa.arraysEqual(e,t)||!e.length||!t.length||0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r||JL(n)&&JL(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&JL(e[0])&&JL(t[0])}function $L(e){if(null==kL){var t=uL(e);kL=t.getParameter(t.MAX_TEXTURE_SIZE)}return kL}function ez(){kL=null}function tz(){wL=null}function nz(e){if(null==wL){var t=uL(e);wL=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,wL)}function rz(e){if(0===e)return 0;var t=uL(e);return az(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:az(t,"EXT_disjoint_timer_query")?1:0}function az(e,t){return null!=e.getExtension(t)}function iz(e){try{if(null!=uL(e))return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function oz(e){if(0===e)return!1;var t=uL(e);if(1===e){if(!az(t,"OES_texture_float"))return!1}else if(!az(t,"EXT_color_buffer_float"))return!1;return uz(t)}function sz(e){if(0===e)return!1;var t=uL(e);if(1!==e){if(az(t,"EXT_color_buffer_float"))return uz(t);var n="EXT_color_buffer_half_float";if(az(t,n)){var r=t.getExtension(n);return function(e,t){var n=hL(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);var a=1,i=1;e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,a,i,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var s=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(o),s}(t,r)}return!1}return!(!az(t,"OES_texture_float")||!az(t,"WEBGL_color_buffer_float"))&&uz(t)}function uz(e){var t=hL(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function cz(e){return 2===e&&null!=uL(e).fenceSync}function lz(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&Aa.assert("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors in the WebGL backend.")}))}))}var pz=Qe();function hz(){var e,t,n,r,a,i,o,s,u,c;return 2===Qe().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",i="outputColor",o="out vec4 outputColor;",s=Qe().getBool("WEBGL2_ISNAN_CUSTOM")?"\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ":"",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",i="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function dz(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=Aa.computeStrides(t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / ").concat(t),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * ").concat(t):"index -= ".concat(e[a]," * ").concat(t);return"".concat(i,"; ").concat(o,";")})).join("")}function fz(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=Aa.computeStrides(t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / outShapeStrides[").concat(a,"]"),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * outShapeStrides[").concat(a,"]"):"index -= ".concat(e[a]," * outShapeStrides[").concat(a,"]");return"".concat(i,"; ").concat(o,";")})).join("")}function mz(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=function(e,t){var n=e.length,r=e.map((function(e){return"".concat(t,"[").concat(e,"]")})),a=new Array(n-1);a[n-2]=r[n-1];for(var i=n-3;i>=0;--i)a[i]="(".concat(a[i+1]," * ").concat(r[i+1],")");return a}(e.map((function(e,t){return t})),t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / ").concat(r[a]),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * ").concat(r[a]):"index -= ".concat(e[a]," * ").concat(r[a]);return"".concat(i,"; ").concat(o,";")})).join("")}function vz(e){var t=Aa.computeStrides(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}pz.registerFlag("HAS_WEBGL",(function(){return pz.getNumber("WEBGL_VERSION")>0})),pz.registerFlag("WEBGL_VERSION",(function(){return iz(2)?2:iz(1)?1:0})),pz.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(function(){return!1})),pz.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===pz.get("WEBGL_VERSION")})),pz.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),pz.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),pz.registerFlag("WEBGL_PACK",(function(){return pz.getBool("HAS_WEBGL")})),pz.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return pz.getBool("WEBGL_PACK")})),pz.registerFlag("WEBGL_PACK_CLIP",(function(){return pz.getBool("WEBGL_PACK")})),pz.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return pz.getBool("WEBGL_PACK")})),pz.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return pz.getBool("WEBGL_PACK")})),pz.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return pz.getBool("WEBGL_PACK")})),pz.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return pz.getBool("WEBGL_PACK")})),pz.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return pz.getBool("WEBGL_PACK")})),pz.registerFlag("WEBGL_PACK_REDUCE",(function(){return pz.getBool("WEBGL_PACK")})),pz.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return pz.getBool("WEBGL_PACK")})),pz.registerFlag("WEBGL_CONV_IM2COL",(function(){return pz.getBool("WEBGL_PACK")})),pz.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return $L(pz.getNumber("WEBGL_VERSION"))})),pz.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return nz(pz.getNumber("WEBGL_VERSION"))})),pz.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=pz.getNumber("WEBGL_VERSION");return 0===e?0:rz(e)})),pz.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return pz.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Oi.isMobile()})),pz.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return oz(pz.getNumber("WEBGL_VERSION"))})),pz.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!pz.getBool("WEBGL_FORCE_F16_TEXTURES")&&pz.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),pz.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return sz(pz.getNumber("WEBGL_VERSION"))})),pz.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return cz(pz.getNumber("WEBGL_VERSION"))})),pz.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return pz.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),pz.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(function(){return-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ".concat(e,"."))})),pz.registerFlag("WEBGL_FLUSH_THRESHOLD",(function(){return Oi.isMobile()?1:-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ".concat(e,"."))})),pz.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 128})),pz.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(function(){return!1})),pz.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 1e5})),pz.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(function(){return 128})),pz.registerFlag("WEBGL_EXP_CONV",(function(){return!1})),pz.registerFlag("SOFTWARE_WEBGL_ENABLED",(function(){return pz.getBool("IS_TEST")})),pz.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",(function(){return 1/0})),pz.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",(function(){return!1})),pz.registerFlag("WEBGL2_ISNAN_CUSTOM",(function(){return!1})),pz.registerFlag("ENGINE_COMPILE_ONLY",(function(){return!1}));var gz="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",yz=vm.getBroadcastDims;function bz(e,t,n){var r=[];if(e.forEach((function(e){var t=Aa.sizeFromShape(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform?r.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(r.push("uniform sampler2D ".concat(e.name,";")),r.push("uniform int offset".concat(e.name,";"))),n.enableShapeUniforms){switch(Ez(n.packedInputs,e.shapeInfo.logicalShape,e.shapeInfo.texShape).uniformShape.length){case 1:r.push("uniform int ".concat(e.name,"Shape;"));break;case 2:r.push("uniform ivec2 ".concat(e.name,"Shape;"));break;case 3:r.push("uniform ivec3 ".concat(e.name,"Shape;"));break;case 4:r.push("uniform ivec4 ".concat(e.name,"Shape;"))}r.push("uniform ivec2 ".concat(e.name,"TexShape;"))}})),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach((function(e){r.push("uniform ".concat(e.type," ").concat(e.name).concat(e.arrayIndex?"[".concat(e.arrayIndex,"]"):"",";"))}));var a,i,o=r.join("\n"),s=e.map((function(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,a="";a+=n?kz(e,r):xz(e,r);var i=e.shapeInfo.logicalShape,o=t.logicalShape;return i.length<=o.length&&(a+=n?function(e,t){var n,r=e.name,a=r.charAt(0).toUpperCase()+r.slice(1),i="get"+a+"AtOutCoords",o=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,u=yz(e.shapeInfo.logicalShape,t.logicalShape),c=_z(s),l=s-o,p=["x","y","z","w","u","v"];n=0===o?"":s<2&&u.length>=1?"coords = 0;":u.map((function(e){return"coords.".concat(p[e+l]," = 0;")})).join("\n");var h="";h=s<2&&o>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(p[t+l])})).join(", ");var d="return outputValue;",f=1===Aa.sizeFromShape(e.shapeInfo.logicalShape),m=1===Aa.sizeFromShape(t.logicalShape);if(1!==o||f||m){if(f&&!m)d=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var v=o-2,g=o-1;u.indexOf(v)>-1&&u.indexOf(g)>-1?d="return vec4(outputValue.x);":u.indexOf(v)>-1?d="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(g)>-1&&(d="return vec4(outputValue.xx, outputValue.zz);")}}else d="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(i,"() {\n      ").concat(c," coords = getOutputCoords();\n      ").concat(n,"\n      vec4 outputValue = get").concat(a,"(").concat(h,");\n      ").concat(d,"\n    }\n  ")}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",i=t.texShape,o=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&Aa.arraysEqual(o,i))return"\n      float ".concat(a,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");var c,l=_z(u),p=yz(e.shapeInfo.logicalShape,t.logicalShape),h=u-s,d=["x","y","z","w","u","v"];c=0===s?"":u<2&&p.length>=1?"coords = 0;":p.map((function(e){return"coords.".concat(d[e+h]," = 0;")})).join("\n");var f="";return f=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(d[t+h])})).join(", "),"\n    float ".concat(a,"() {\n      ").concat(l," coords = getOutputCoords();\n      ").concat(c,"\n      return get").concat(r,"(").concat(f,");\n    }\n  ")}(e,t)),a}(e,t,n.packedInputs,n.enableShapeUniforms)})).join("\n"),u=t.texShape,c=hz(),l=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(c),p=function(e){return"".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat(wz,"\n    ").concat(Iz,"\n    ").concat(Sz,"\n  ")}(c);return t.isPacked?(a=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===r[0]?n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(r[1],".0);\n      }\n    "):1===r[1]?n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(r[0],".0);\n      }\n    "):n?"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      return 2 * (resTexRC.x * ").concat(r[1]," + resTexRC.y);\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(Aa.arraysEqual(e,t))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(r[0],", ").concat(r[1],"));\n      }\n    ");var a=Math.ceil(e[1]/2);return n?"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[2]/2),i=a*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t,n);default:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";for(var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[e.length-1]/2),i=a*Math.ceil(e[e.length-2]/2),o=i,s="",u="b, r, c",c=2;c<e.length-1;c++)o*=e[e.length-c-1],s="\n      int b".concat(c," = index / ").concat(o,";\n      index -= b").concat(c," * ").concat(o,";\n    ")+s,u="b".concat(c,", ")+u;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      ").concat(s,"\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec").concat(e.length,"(").concat(u,");\n    }\n  ")}(e,t,n)}}(t.logicalShape,u,n.enableShapeUniforms),i=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(c)):(a=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){return 1===t[0]?n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(t[1],".0);\n      }\n    "):1===t[1]?n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(t[0],".0);\n      }\n    "):n?"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      return resTexRC.x * ").concat(t[1]," + resTexRC.y;\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){return Aa.arraysEqual(e,t)?n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    "):1===e[1]?n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    "):1===e[0]?n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    "):n?"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n)return"\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ".concat(fz(["r","c","d"],e),"\n    return ivec3(r, c, d);\n  }\n");var r=dz(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(r,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t,n);case 4:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ".concat(fz(["r","c","d","d2"],e),"\n      return ivec4(r, c, d, d2);\n    }\n  ");var r=dz(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(r,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t,n);case 5:return function(e,t){var n=dz(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){var n=dz(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error("".concat(e.length,"-D output sampling is not yet supported"))}}(t.logicalShape,u,n.enableShapeUniforms),i=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(c)),n.packedInputs&&(p+=Nz),[p,l,i,o,a,s,n.userCode].join("\n")}function xz(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(r,"() {return ").concat(n,";}");var a=(0,h.Z)(e.shapeInfo.texShape,2),i=a[0],o=a[1];if(1===i&&1===o)return"\n      float ".concat(r,"() {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");var s=Tz(n);if(t)return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");var u=(0,h.Z)(e.shapeInfo.texShape,2),c=u[0],l=u[1];return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(c,", ").concat(l,", ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e,t);case 1:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int index) {\n        ").concat(Cz(e),"\n      }\n    ");var a=e.shapeInfo.texShape,i=a[0],o=a[1];if(1===o&&1===i)return"\n      float ".concat(r,"(int index) {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");var s=Tz(n);return 1===o?t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[0]));\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / ").concat(i,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):1===i?t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / ").concat(o,".0, 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):t?"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  "):"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(i,", ").concat(o,", index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape;if(null!=i&&Aa.arraysEqual(n,i)){if(t)return"\n      float ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var o=i[0],s=i[1];return"\n    float ".concat(a,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}var u=Aa.squeezeShape(n),c=u.newShape,l=u.keptDims,p=c;if(p.length<n.length){var h=Az(e,p),d=["row","col"];return"\n      ".concat(xz(h,t),"\n      float ").concat(a,"(int row, int col) {\n        return ").concat(a,"(").concat(Rz(d,l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(n[1],", 1)));\n        ").concat(Cz(e),"\n      }\n    ");var f=i[0],m=i[1],v=Tz(r);return 1===m?t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(").concat(r,"TexShape[0]));\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(f,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):1===f?t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(").concat(r,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(m,".0, 0.5);\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):t?"\n      float ".concat(a,"(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(r,"Shape[1] + col + ").concat(v,";\n        vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n  float ".concat(a,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(n[1]," + col + ").concat(v,";\n    vec2 uv = uvFromFlat(").concat(f,", ").concat(m,", index);\n    return sampleTexture(").concat(r,", uv);\n  }\n")}(e,t);case 3:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[1]*n[2],o=n[2],s=Aa.squeezeShape(n),u=s.newShape,c=s.keptDims,l=u;if(l.length<n.length){var p=Az(e,l),h=["row","col","depth"];return"\n        ".concat(xz(p,t),"\n        float ").concat(a,"(int row, int col, int depth) {\n          return ").concat(a,"(").concat(Rz(h,c),");\n        }\n      ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(i,", ").concat(o,", 1)));\n        ").concat(Cz(e),"\n      }\n    ");var d=e.shapeInfo.texShape,f=d[0],m=d[1],v=e.shapeInfo.flatOffset;if(m===i&&null==v)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        int stride1 = ").concat(r,"Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n        float ".concat(a,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(o,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(m,".0, ").concat(f,".0);\n          return sampleTexture(").concat(r,", uv);\n        }\n      ");if(m===o&&null==v)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(").concat(r,"Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(n[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(m,".0, ").concat(f,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");var g=Tz(r);return t?"\n    float ".concat(a,"(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ").concat(r,"Shape[1] * ").concat(r,"Shape[2];\n      int stride1 = ").concat(r,"Shape[2];\n      int index = row * stride0 + col * stride1 + depth + ").concat(g,";\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n      return sampleTexture(").concat(r,", uv);\n    }\n    "):"\n      float ".concat(a,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(i," + col * ").concat(o," + depth + ").concat(g,";\n        vec2 uv = uvFromFlat(").concat(f,", ").concat(m,", index);\n        return sampleTexture(").concat(r,", uv);\n      }\n  ")}(e,t);case 4:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[3],o=n[2]*i,s=n[1]*o,u=Aa.squeezeShape(n),c=u.newShape,l=u.keptDims;if(c.length<n.length){var p=Az(e,c),h=["row","col","depth","depth2"];return"\n      ".concat(xz(p,t),"\n      float ").concat(a,"(int row, int col, int depth, int depth2) {\n        return ").concat(a,"(").concat(Rz(h,l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(s,", ").concat(o,", ").concat(i,", 1)));\n        ").concat(Cz(e),"\n      }\n    ");var d=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,m=f[0],v=f[1],g="int stride2 = ".concat(r,"Shape[3];"),y="int stride1 = ".concat(r,"Shape[2] * stride2;"),b="int stride0 = ".concat(r,"Shape[1] * stride1;");if(v===s&&null==d)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        ").concat(g,"\n        ").concat(y,"\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(o,", ").concat(i,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");if(v===i&&null==d)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(r,"Shape[1] * ").concat(r,"Shape[2], ").concat(r,"Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(n[1]*n[2],", ").concat(n[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var x=Tz(r);return t?"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ").concat(g,"\n      ").concat(y,"\n      ").concat(b,"\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index + ").concat(x,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," +\n          depth * ").concat(i," + depth2;\n      vec2 uv = uvFromFlat(").concat(m,", ").concat(v,", index + ").concat(x,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}(e,t);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],i=t[3]*a,o=t[2]*i,s=t[1]*o,u=Aa.squeezeShape(t),c=u.newShape,l=u.keptDims;if(c.length<t.length){var p=Az(e,c),h=["row","col","depth","depth2","depth3"];return"\n      ".concat(xz(p),"\n      float ").concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(r,"(").concat(Rz(h,l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(s,", ").concat(o,", ").concat(i,", ").concat(a,")) +\n          depth3;\n        ").concat(Cz(e),"\n      }\n    ");var d=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,m=f[0],v=f[1];if(v===s&&null==d)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(o,", ").concat(i,", ").concat(a,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(v===a&&null==d)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3],",\n               ").concat(t[2]*t[3],", ").concat(t[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var g=Tz(n);return"\n    float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," + depth * ").concat(i," +\n          depth2 * ").concat(a," + depth3 + ").concat(g,";\n      vec2 uv = uvFromFlat(").concat(m,", ").concat(v,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=Aa.squeezeShape(t),i=a.newShape,o=a.keptDims;if(i.length<t.length){var s=Az(e,i),u=["row","col","depth","depth2","depth3","depth4"];return"\n      ".concat(xz(s),"\n      float ").concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(r,"(").concat(Rz(u,o),");\n      }\n    ")}var c=t[5],l=t[4]*c,p=t[3]*l,h=t[2]*p,d=t[1]*h;if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(d,", ").concat(h,", ").concat(p,", ").concat(l,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(c,", 1)));\n        ").concat(Cz(e),"\n      }\n    ");var f=e.shapeInfo.flatOffset,m=e.shapeInfo.texShape,v=m[0],g=m[1];if(g===d&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(h,", ").concat(p,", ").concat(l,", ").concat(c,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(g,".0, ").concat(v,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(g===c&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3]*t[4],",\n               ").concat(t[2]*t[3]*t[4],",\n               ").concat(t[3]*t[4],",\n               ").concat(t[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(g,".0, ").concat(v,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var y=Tz(n);return"\n    float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(d," + col * ").concat(h," + depth * ").concat(p," +\n          depth2 * ").concat(l," + depth3 * ").concat(c," + depth4 + ").concat(y,";\n      vec2 uv = uvFromFlat(").concat(v,", ").concat(g,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);default:throw new Error("".concat(n.length,"-D input sampling is not yet supported"))}}function kz(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=hz();return"\n    vec4 ".concat(n,"() {\n      return ").concat(r.texture2D,"(").concat(t,", halfCR);\n    }\n  ")}(e);case 1:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=hz();if(t)return"\n    vec4 ".concat(r,"(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ");var o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return"\n    vec4 ".concat(r,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(o[0],", ").concat(o[1],", index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=i[0],s=i[1],u=hz();if(null!=i&&Aa.arraysEqual(n,i))return t?"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n\n        return ").concat(u.texture2D,"(").concat(r,", uv);\n      }\n    "):"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n\n        return ").concat(u.texture2D,"(").concat(r,", uv);\n      }\n    ");if(t)return"\n    vec4 ".concat(a,"(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ").concat(u.texture2D,"(").concat(r,", uv);\n    }\n  ");var c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],l=Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(l,", ").concat(c[0],", ").concat(c[1],", row, col);\n      return ").concat(u.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===n[0]){var s=[1,2],u=Az(e,n.slice(1)),c=["b","row","col"];return"\n        ".concat(kz(u,t),"\n        vec4 ").concat(a,"(int b, int row, int col) {\n          return ").concat(a,"(").concat(Rz(c,s),");\n        }\n      ")}var l=hz();if(t)return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ").concat(l.texture2D,"(").concat(r,", uv);\n    }\n  ");var p=o[0],h=o[1],d=Math.ceil(n[2]/2),f=d*Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(p,", ").concat(h,", ").concat(f,", ").concat(d,", b, row, col);\n      return ").concat(l.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);default:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=hz();if(t)return"\n    vec4 ".concat(r,"(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(").concat(n,"Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(n,"Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ").concat(n,"Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ");for(var i=e.shapeInfo.logicalShape,o=i.length,s=e.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=u[0],l=u[1],p=Math.ceil(i[o-1]/2),h=p*Math.ceil(i[o-2]/2),d="int b, int row, int col",f="b * ".concat(h," + (row / 2) * ").concat(p," + (col / 2)"),m=2;m<o-1;m++)d="int b".concat(m,", ")+d,h*=i[o-m-1],f="b".concat(m," * ").concat(h," + ")+f;return"\n    vec4 ".concat(r,"(").concat(d,") {\n      int index = ").concat(f,";\n      int texR = index / ").concat(l,";\n      int texC = index - texR * ").concat(l,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(l,", ").concat(c,");\n      return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t)}}var wz="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Iz="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Sz="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Nz="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Tz(e){return"offset".concat(e)}function Cz(e){var t=e.name,n=Aa.sizeFromShape(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function _z(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function Ez(e,t,n){var r=Aa.squeezeShape(t),a=r.newShape,i=r.keptDims,o=t.length,s=e&&3===o&&1===t[0],u=s?t.slice(1):a,c=!e&&o>1&&!Aa.arraysEqual(t,n)&&a.length<o||s;return{useSqueezeShape:c,uniformShape:c?u:t,keptDims:i}}function Az(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function Rz(e,t){return t.map((function(t){return e[t]})).join(", ")}function Fz(e,t,n){var r,a,i,o,s={},u={},c={},l=[],p=null;o=e.getUniformLocation(n,"NAN",!1),1===Qe().getNumber("WEBGL_VERSION")&&(p=e.getUniformLocation(n,"INFINITY",!1));for(var h=!1,d=0;d<t.variableNames.length;d++){var f=t.variableNames[d];s[f]=e.getUniformLocation(n,f,h),s["offset".concat(f)]=e.getUniformLocation(n,"offset".concat(f),h),t.enableShapeUniforms&&(u["".concat(f,"Shape")]=e.getUniformLocation(n,"".concat(f,"Shape"),h),c["".concat(f,"TexShape")]=e.getUniformLocation(n,"".concat(f,"TexShape"),h))}return t.enableShapeUniforms&&(r=e.getUniformLocation(n,"outShape",h),i=e.getUniformLocation(n,"outShapeStrides",h),a=e.getUniformLocation(n,"outTexShape",h)),t.customUniforms&&t.customUniforms.forEach((function(t,r){l[r]=e.getUniformLocation(n,t.name,h)})),{uniformLocations:s,customUniformLocations:l,infLoc:p,nanLoc:o,inShapesLocations:u,inTexShapesLocations:c,outShapeLocation:r,outShapeStridesLocation:i,outTexShapeLocation:a}}function Zz(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but was executed with ").concat(t.length," inputs"));e.forEach((function(e,n){var r=e.logicalShape,a=t[n],i=a.shape;if(!Aa.arraysEqual(r,i))throw Error("Binary was compiled with different shapes than the current args. Shapes ".concat(r," and ").concat(i," must match"));if(!e.isUniform||!a.isUniform){var o=e.texShape,s=a.isUniform?null:a.texData.texShape;if(!Aa.arraysEqual(o,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape ".concat(o," and ").concat(s," must match"))}}))}function Dz(e){return Qe().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}var Mz=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=nL.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=hz();this.outputShape=t,this.enableShapeUniforms=Dz(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?fz(["r","c","d"],t):dz(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),Oz=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=nL.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=hz();this.outputShape=t,this.enableShapeUniforms=Dz(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?fz(["r","c","d"],t):dz(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),Lz=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.variableNames=["A"],this.outTexUsage=rL.DOWNLOAD;var n=hz();this.outputShape=t,this.userCode="\n      ".concat(gz,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(n.output," = encode_float(x);\n      }\n    ")})),zz=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=rL.DOWNLOAD;var n=hz();this.outputShape=t,this.userCode="\n      ".concat(gz,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(n.output," = encode_float(x);\n      }\n    ")})),Pz={R:0,G:1,B:2,A:3},Bz=(0,v.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"RGBA";(0,m.Z)(this,e),this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];var a=hz();this.outputShape=t,this.enableShapeUniforms=Dz(this.outputShape.length);var i="result";n&&(i="floor(result * 255. + 0.5)");for(var o="",s=0;s<r.length;s++){var u=r[s];o+="\n          if(offset == ".concat(s,") {\n            result = values[").concat(Pz[u],"];\n          }")}this.userCode="\n      ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":vz(t),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int flatIndex = getFlatIndex(coords);\n        float result = 0.;\n        int offset = imod(flatIndex, ").concat(r.length,");\n\n        flatIndex = idiv(flatIndex, ").concat(r.length,", 1.);\n\n        int r = flatIndex / texShape[1];\n        if (r < texShape[0]) {\n          int c = imod(flatIndex, texShape[1]);\n          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n          vec4 values = ").concat(a.texture2D,"(A, uv);\n          ").concat(o,"\n        }\n        ").concat(a.output," = vec4(").concat(i,", 0., 0., 0.);\n      }\n    ")})),Wz=(0,v.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,m.Z)(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];var r=hz();this.outputShape=t,this.enableShapeUniforms=Dz(this.outputShape.length);var a="",i="result";n&&(i="floor(result * 255. + 0.5)");for(var o=0;o<=1;o++)for(var s=0;s<=1;s++){var u=2*o+s;a+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(s," < ").concat(this.enableShapeUniforms?"outShape[2]":"".concat(t[2]),") {\n          localCoords[2] += ").concat(s,";\n          if (localCoords[1] + ").concat(o," < ").concat(this.enableShapeUniforms?"outShape[1]":"".concat(t[1]),") {\n            localCoords[1] += ").concat(o,";\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ").concat(r.texture2D,"(A, uv);\n\n            if (offset == 0) {\n              result[").concat(u,"] = values[0];\n            } else if (offset == 1) {\n              result[").concat(u,"] = values[1];\n            } else if (offset == 2) {\n              result[").concat(u,"] = values[2];\n            } else {\n              result[").concat(u,"] = values[3];\n            }\n          }\n        }\n        ")}this.userCode="\n        ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":vz(t),"\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ").concat(a,"\n\n          ").concat(r.output," = ").concat(i,";\n        }\n    ")})),Vz={};function Uz(e){var t=hz();return bL(e,"".concat(t.version,"\n    precision highp float;\n    ").concat(t.attribute," vec3 clipSpacePos;\n    ").concat(t.attribute," vec2 uv;\n    ").concat(t.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}function Gz(e){return _L(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function Hz(e){return EL(e,new Uint16Array([0,1,2,2,1,3]))}function jz(e,t,n,r,a,i){FL(t,n);var o=RL(e),s=e.TEXTURE_2D;return dL(e,(function(){return e.bindTexture(s,o)})),dL(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),dL(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),dL(e,(function(){return e.texParameteri(s,e.TEXTURE_MIN_FILTER,e.NEAREST)})),dL(e,(function(){return e.texParameteri(s,e.TEXTURE_MAG_FILTER,e.NEAREST)})),1===Qe().getNumber("WEBGL_VERSION")?dL(e,(function(){return e.texImage2D(s,0,r,t,n,0,a,i,null)})):dL(e,(function(){return e.texStorage2D(s,1,r,t,n)})),dL(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),{texture:o,texShape:[n,t]}}function qz(e){return e.internalFormatFloat}function Kz(e,t,n,r){var a=cL(t,n),i=(0,h.Z)(a,2);return jz(e,i[0],i[1],qz(r),r.textureFormatFloat,e.FLOAT)}function Xz(e){return e.internalFormatHalfFloat}function Yz(e,t,n,r){var a=cL(t,n),i=(0,h.Z)(a,2);return jz(e,i[0],i[1],Xz(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function Jz(e){return e.downloadTextureFormat}function Qz(e,t,n,r){var a=cL(t,n),i=(0,h.Z)(a,2);return jz(e,i[0],i[1],Jz(r),e.RGBA,e.UNSIGNED_BYTE)}function $z(e){return e.internalFormatPackedFloat}function eP(e,t,n,r){var a=pL(t,n),i=(0,h.Z)(a,2);return jz(e,i[0],i[1],$z(r),e.RGBA,e.FLOAT)}function tP(e){return e.internalFormatPackedHalfFloat}function nP(e,t,n,r){var a=pL(t,n),i=(0,h.Z)(a,2);return jz(e,i[0],i[1],tP(r),e.RGBA,r.textureTypeHalfFloat)}function rP(e,t,n){return dL(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),DL(e,t,"clipSpacePos",n,3,20,0)&&DL(e,t,"uv",n,2,20,12)}function aP(e,t,n,r,a,i){var o,s,u;dL(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),a instanceof Uint8Array?(o=new Uint8Array(n*r*4),s=e.UNSIGNED_BYTE,u=e.RGBA):(o=new Float32Array(n*r*4),s=e.FLOAT,u=i.internalFormatPackedFloat),o.set(a),2===Qe().getNumber("WEBGL_VERSION")?dL(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,s,o)})):dL(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,u,n,r,0,e.RGBA,s,o)})),dL(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function iP(e,t,n){dL(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),n.data instanceof Uint8Array?2===Qe().getNumber("WEBGL_VERSION")?dL(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data)})):dL(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)})):2===Qe().getNumber("WEBGL_VERSION")?dL(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n)})):dL(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)})),dL(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function oP(e,t,n,r){var a=e.createBuffer();dL(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)}));var i=16*t*n;return dL(e,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ)})),dL(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)})),dL(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),a}function sP(e,t,n){var r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}function uP(e,t,n,r){var a=cL(t,n),i=(0,h.Z)(a,2),o=i[0],s=i[1],u=new Uint8Array(function(e,t){return e*t}(t*n,4));return dL(e,(function(){return e.readPixels(0,0,o,s,r.downloadTextureFormat,e.UNSIGNED_BYTE,u)})),new Float32Array(u.buffer)}function cP(e,t,n,r,a,i,o,s){var u=e,c=new Float32Array(function(e,t){var n=pL(e,t),r=(0,h.Z)(n,2);return r[0]*r[1]*4}(i,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function lP(e,t,n){var r=new Float32Array(t*n*4);return dL(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)})),r}A(Vz,{bindVertexProgramAttributeStreams:function(){return rP},createBufferFromOutputTexture:function(){return oP},createFloat16MatrixTexture:function(){return Yz},createFloat16PackedMatrixTexture:function(){return nP},createFloat32MatrixTexture:function(){return Kz},createIndexBuffer:function(){return Hz},createPackedMatrixTexture:function(){return eP},createUnsignedBytesMatrixTexture:function(){return Qz},createVertexBuffer:function(){return Gz},createVertexShader:function(){return Uz},downloadByteEncodedFloatMatrixFromOutputTexture:function(){return uP},downloadFloat32MatrixFromBuffer:function(){return sP},downloadMatrixFromPackedOutputTexture:function(){return lP},downloadPackedMatrixFromBuffer:function(){return cP},getInternalFormatForFloat16MatrixTexture:function(){return Xz},getInternalFormatForFloat16PackedMatrixTexture:function(){return tP},getInternalFormatForFloat32MatrixTexture:function(){return qz},getInternalFormatForPackedMatrixTexture:function(){return $z},getInternalFormatForUnsignedBytesMatrixTexture:function(){return Jz},uploadDenseMatrixToTexture:function(){return aP},uploadPixelDataToTexture:function(){return iP}});var pP=function(){function e(t){(0,m.Z)(this,e),this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];var n=Qe().getNumber("WEBGL_VERSION");if(null!=t?(this.gl=t,sL(n,t)):this.gl=uL(n),t=this.gl,2===Qe().getNumber("WEBGL_VERSION")){var r=t;this.createVertexArray=function(){return dL(r,(function(){return r.createVertexArray()}))},this.bindVertexArray=function(e){return dL(r,(function(){return r.bindVertexArray(e)}))},this.deleteVertexArray=function(e){return dL(r,(function(){return r.deleteVertexArray(e)}))},this.getVertexArray=function(){return dL(r,(function(){return r.getParameter(r.VERTEX_ARRAY_BINDING)}))}}else if(null!=t){var a=t.getExtension("OES_vertex_array_object");if(null==a)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=function(){return dL(t,(function(){return a.createVertexArrayOES()}))},this.bindVertexArray=function(e){return dL(t,(function(){return a.bindVertexArrayOES(e)}))},this.deleteVertexArray=function(e){return dL(t,(function(){return a.deleteVertexArrayOES(e)}))},this.getVertexArray=function(){return dL(t,(function(){return t.getParameter(a.VERTEX_ARRAY_BINDING_OES)}))}}var i="WEBGL_color_buffer_float",o="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===Qe().getNumber("WEBGL_VERSION")){var s="OES_texture_half_float";if(this.textureFloatExtension=yL(this.gl,"OES_texture_float"),az(this.gl,s))this.textureHalfFloatExtension=yL(this.gl,s);else if(Qe().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(i),az(this.gl,o))this.colorBufferHalfFloatExtension=yL(this.gl,o);else if(Qe().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(i="EXT_color_buffer_float",az(this.gl,i))this.colorBufferFloatExtension=this.gl.getExtension(i);else{if(!az(this.gl,o))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(o)}this.vertexBuffer=Gz(this.gl),this.indexBuffer=Hz(this.gl),this.framebuffer=ZL(this.gl),this.textureConfig=hL(this.gl,this.textureHalfFloatExtension)}return(0,v.Z)(e,[{key:"debug",get:function(){return Qe().getBool("DEBUG")}},{key:"dispose",value:function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;dL(t,(function(){return t.finish()})),dL(t,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),dL(t,(function(){return t.deleteFramebuffer(e.framebuffer)})),dL(t,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),dL(t,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),dL(t,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}}},{key:"createFloat32MatrixTexture",value:function(e,t){return this.throwIfDisposed(),Kz(this.gl,e,t,this.textureConfig)}},{key:"createFloat16MatrixTexture",value:function(e,t){return this.throwIfDisposed(),Yz(this.gl,e,t,this.textureConfig)}},{key:"createUnsignedBytesMatrixTexture",value:function(e,t){return this.throwIfDisposed(),Qz(this.gl,e,t,this.textureConfig)}},{key:"uploadPixelDataToTexture",value:function(e,t){this.throwIfDisposed(),iP(this.gl,e,t)}},{key:"uploadDenseMatrixToTexture",value:function(e,t,n,r){this.throwIfDisposed(),aP(this.gl,e,t,n,r,this.textureConfig)}},{key:"createFloat16PackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),nP(this.gl,e,t,this.textureConfig)}},{key:"createPackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),eP(this.gl,e,t,this.textureConfig)}},{key:"deleteMatrixTexture",value:function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(VL(this.gl,this.framebuffer),this.outputTexture=null),dL(this.gl,(function(){return t.gl.deleteTexture(e)}))}},{key:"downloadByteEncodedFloatMatrixFromOutputTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return uP(r.gl,t,n,r.textureConfig)}))}},{key:"downloadPackedMatrixFromBuffer",value:function(e,t,n,r,a,i){return cP(this.gl,e,0,0,0,a,i,this.textureConfig)}},{key:"downloadFloat32MatrixFromBuffer",value:function(e,t){return sP(this.gl,e,t)}},{key:"createBufferFromTexture",value:function(e,t,n){this.bindTextureToFrameBuffer(e);var r=oP(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}},{key:"createAndWaitForFence",value:function(){var e=this.createFence(this.gl);return this.pollFence(e)}},{key:"createFence",value:function(e){var t,n,r=this;if(Qe().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,i=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=a.clientWaitSync(i,0,0);return e===a.ALREADY_SIGNALED||e===a.CONDITION_SATISFIED},t=i}else Qe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,Qe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}}},{key:"downloadMatrixFromPackedTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return lP(r.gl,t,n)}))}},{key:"createProgram",value:function(e){var t=this;this.throwIfDisposed();var n=this.gl;null==this.vertexShader&&(this.vertexShader=Uz(n));var r,a=NL(n);return dL(n,(function(){return n.attachShader(a,t.vertexShader)})),dL(n,(function(){return n.attachShader(a,e)})),TL(n,a),r=Object.assign(a,{vao:this.createVertexArray()}),this.bindVertexArray(r.vao),dL(n,(function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.indexBuffer)})),console.assert(rP(n,r,this.vertexBuffer),"gpgpu_util.bindVertexProgramAttributeStreams not fully successful."),this.debug&&CL(n,r),this.setProgram(r),r}},{key:"deleteProgram",value:function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&(dL(this.gl,(function(){return t.gl.deleteProgram(e)})),this.deleteVertexArray(e.vao))}},{key:"setProgram",value:function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&(this.bindVertexArray(this.program.vao),this.debug&&CL(this.gl,this.program)),dL(this.gl,(function(){return t.gl.useProgram(e)}))}},{key:"getUniformLocation",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?LL(this.gl,e,t):zL(this.gl,e,t)}},{key:"getAttributeLocation",value:function(e,t){var n=this;return this.throwIfDisposed(),dL(this.gl,(function(){return n.gl.getAttribLocation(e,t)}))}},{key:"getUniformLocationNoThrow",value:function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}},{key:"setInputMatrixTexture",value:function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),PL(this.gl,e,t,n)}},{key:"setOutputMatrixTexture",value:function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}},{key:"setOutputPackedMatrixTexture",value:function(e,t,n){this.throwIfDisposed();var r=pL(t,n),a=(0,h.Z)(r,2),i=a[0],o=a[1];this.setOutputMatrixTextureDriver(e,i,o)}},{key:"setOutputMatrixWriteRegion",value:function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}},{key:"setOutputPackedMatrixWriteRegion",value:function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}},{key:"debugValidate",value:function(){null!=this.program&&CL(this.gl,this.program),UL(this.gl)}},{key:"executeProgram",value:function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;if(this.debug){var t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}dL(e,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))}},{key:"blockUntilAllProgramsCompleted",value:function(){var e=this;this.throwIfDisposed(),dL(this.gl,(function(){return e.gl.finish()}))}},{key:"getQueryTimerExtension",value:function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=yL(this.gl,2===Qe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}},{key:"getQueryTimerExtensionWebGL2",value:function(){return this.getQueryTimerExtension()}},{key:"getQueryTimerExtensionWebGL1",value:function(){return this.getQueryTimerExtension()}},{key:"beginQuery",value:function(){if(2===Qe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),a=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,a),a}},{key:"endQuery",value:function(){if(2!==Qe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}}},{key:"waitForQueryAndGetTime",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Aa.repeatedTry((function(){return n.disposed||n.isQueryAvailable(t,Qe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}));case 2:return e.abrupt("return",this.getQueryTime(t,Qe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getQueryTime",value:function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}},{key:"isQueryAvailable",value:function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint}var i=this.getQueryTimerExtensionWebGL1(),o=i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}},{key:"pollFence",value:function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))}},{key:"pollItems",value:function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t){(0,this.itemsToPoll[t].resolveFn)()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}},{key:"addItemToPoll",value:function(e,t){var n,r=this;(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)||("setTimeoutCustom"in Qe().platform&&(n=Qe().platform.setTimeoutCustom.bind(Qe().platform)),Aa.repeatedTry((function(){return r.pollItems(),0===r.itemsToPoll.length}),(function(){return 0}),null,n))}},{key:"bindTextureToFrameBuffer",value:function(e){this.throwIfDisposed(),WL(this.gl,e,this.framebuffer),this.debug&&UL(this.gl)}},{key:"unbindTextureToFrameBuffer",value:function(){null!=this.outputTexture?(WL(this.gl,this.outputTexture,this.framebuffer),this.debug&&UL(this.gl)):VL(this.gl,this.framebuffer)}},{key:"downloadMatrixDriver",value:function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n}},{key:"setOutputMatrixTextureDriver",value:function(e,t,n){this.throwIfDisposed();var r=this.gl;WL(r,e,this.framebuffer),this.debug&&UL(r),this.outputTexture=e,dL(r,(function(){return r.viewport(0,0,t,n)})),dL(r,(function(){return r.scissor(0,0,t,n)}))}},{key:"setOutputMatrixWriteRegionDriver",value:function(e,t,n,r){var a=this;this.throwIfDisposed(),dL(this.gl,(function(){return a.gl.scissor(e,t,n,r)}))}},{key:"throwIfDisposed",value:function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}},{key:"throwIfNoProgram",value:function(){if(null==this.program)throw new Error("No GPU program is currently set.")}}]),e}();var hP=EA.addImpl,dP=EA.bincountImpl,fP=EA.bincountReduceImpl,mP=EA.castImpl,vP=EA.ceilImpl,gP=EA.concatImpl,yP=EA.equalImpl,bP=EA.expImpl,xP=EA.expm1Impl,kP=EA.floorImpl,wP=EA.gatherNdImpl,IP=EA.gatherV2Impl,SP=EA.greaterImpl,NP=EA.greaterEqualImpl,TP=EA.lessImpl,CP=EA.lessEqualImpl,_P=EA.linSpaceImpl,EP=EA.logImpl,AP=EA.maxImpl,RP=EA.maximumImpl,FP=EA.minimumImpl,ZP=EA.multiplyImpl,DP=EA.negImpl,MP=EA.notEqualImpl,OP=EA.prodImpl,LP=EA.raggedGatherImpl,zP=EA.raggedRangeImpl,PP=EA.raggedTensorToTensorImpl,BP=EA.rangeImpl,WP=EA.rsqrtImpl,VP=EA.scatterImpl,UP=EA.sigmoidImpl,GP=EA.simpleAbsImpl,HP=EA.sliceImpl,jP=EA.sparseFillEmptyRowsImpl,qP=EA.sparseReshapeImpl,KP=EA.sparseSegmentReductionImpl,XP=EA.sqrtImpl,YP=EA.stridedSliceImpl,JP=EA.stringNGramsImpl,QP=EA.stringSplitImpl,$P=EA.stringToHashBucketFastImpl,eB=EA.subImpl,tB=EA.tileImpl,nB=EA.topKImpl,rB=EA.transposeImpl,aB=EA.uniqueImpl;function iB(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return"".concat(e,".").concat(t)}))}function oB(e,t){return 1===t?[e]:iB(e,t)}var sB=function(){function e(t){if((0,m.Z)(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=Dz(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=oB("rc",this.rank),r=_z(this.rank),a=this.getOutOfBoundsCondition(n),i=this.getSetup(n),o=this.getOutput(n);this.userCode="\n        void main() {\n          ".concat(r," rc = getOutputCoords();\n\n          if(").concat(a,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(i,"\n\n            setOutput(vec4(").concat(o,"));\n          }\n        }\n      ")}}return(0,v.Z)(e,[{key:"getSourceCoordsArr",value:function(e){for(var t=[],n=0;n<=1;n++)for(var r=0;r<=1;r++){for(var a="".concat(0===n?"r":"rp1",", ").concat(0===r?"c":"cp1"),i=2;i<this.rank;i++)a="".concat(e[e.length-1-i],",")+a;t.push(a)}return t}},{key:"getOutOfBoundsCondition",value:function(e){if(1===this.rank)return"rc > ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]);for(var t="",n=this.rank-2;n<this.rank;n++)t+="".concat(e[n]," >= ").concat(this.enableShapeUniforms?"outShape[".concat(n,"]"):this.outputShape[n]),n<this.rank-1&&(t+="||");return t}},{key:"getSetup",value:function(e){if(1===this.rank)return"";var t=e.slice(-2),n=this.enableShapeUniforms?"outShape[".concat(this.rank," - 1]"):this.outputShape[this.rank-1],r=this.enableShapeUniforms?"outShape[".concat(this.rank," - 2]"):this.outputShape[this.rank-2];return"\n      int r = ".concat(t[0],";\n      int c = ").concat(t[1],";\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ").concat(n,";\n      bool rEdge = rp1 >= ").concat(r,";\n    ")}},{key:"getOutput",value:function(e){var t=this.getSourceCoordsArr(e);return 1===this.rank?"getA(rc), (rc + 1 >= ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]," ? 0. : getA(rc + 1)), 0, 0"):"getA(".concat(t[0],"),\n            cEdge ? 0. : getA(").concat(t[1],"),\n            rEdge ? 0. : getA(").concat(t[2],"),\n            rEdge || cEdge ? 0. : getA(").concat(t[3],")")}}]),e}(),uB=(0,v.Z)((function e(t,n){(0,m.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=Dz(this.outputShape.length);for(var r="",a=0;a<4;a++){var i="thisRC = rc;";a%2===1&&(i+="thisRC.z += 1;"),a>1&&(i+="thisRC.y += 1;"),r+="\n        ".concat(i,"\n        ").concat(a>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(a,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(a>0?"}":"","\n      ")}this.userCode="\n      ".concat(function(e,t){return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(t?mz(["r","c","d"],"inputShape"):dz(["r","c","d"],e),"\n      return ivec3(r, c, d);\n    }\n  ")}(n,this.enableShapeUniforms),"\n      ").concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":vz(t),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(this.enableShapeUniforms?"outShape[1]":t[1],";\n        int cols = ").concat(this.enableShapeUniforms?"outShape[2]":t[2],";\n\n        ").concat(r,"\n\n        setOutput(result);\n      }\n    ")}));var cB=function(){function e(t){(0,m.Z)(this,e),this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return(0,v.Z)(e,[{key:"acquireTexture",value:function(e,t,n){var r=pB(t,n),a=hB(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);var i,o=lB(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return r===aL.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===aL.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===aL.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===aL.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===aL.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),i}},{key:"releaseTexture",value:function(e,t,n,r){if(null!=this.freeTextures){var a=pB(n,r),i=hB(t,a,r);i in this.freeTextures||(this.freeTextures[i]=[]);var o=lB(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),s=Qe().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==s&&this._numBytesAllocated>s?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=o):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;var u=this.usedTextures[i],c=u.indexOf(e);if(c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u.splice(c,1),this.log()}}},{key:"log",value:function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));var t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}}},{key:"numBytesAllocated",get:function(){return this._numBytesAllocated}},{key:"numBytesFree",get:function(){return this._numBytesFree}},{key:"getNumUsedTextures",value:function(){return this.numUsedTextures}},{key:"getNumFreeTextures",value:function(){return this.numFreeTextures}},{key:"dispose",value:function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t.texture)}));for(var n in this.usedTextures)this.usedTextures[n].forEach((function(t){e.gpgpu.deleteMatrixTexture(t.texture)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}]),e}();function lB(e,t,n,r,a){var i,o=function(e,t){switch(e){case aL.PACKED_2X2_FLOAT32:return $z(t);case aL.PACKED_2X2_FLOAT16:return tP(t);case aL.UNPACKED_FLOAT32:return qz(t);case aL.UNPACKED_FLOAT16:return Xz(t);case aL.PACKED_4X1_UNSIGNED_BYTE:return Jz(t);default:throw new Error("Unknown physical texture type ".concat(e))}}(t,r);if(a){var s=pL(e[0],e[1]),u=(0,h.Z)(s,2);i=u[0]*u[1]}else{var c=cL(e[0],e[1]),l=(0,h.Z)(c,2);i=l[0]*l[1]}var p=function(e,t){var n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F||t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error("Unknown internal format ".concat(t))}(n,o);return i*p}function pB(e,t){if(e===rL.UPLOAD)return aL.PACKED_2X2_FLOAT32;if(e===rL.RENDER||null==e)return function(e){return Qe().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?aL.PACKED_2X2_FLOAT32:aL.UNPACKED_FLOAT32:e?aL.PACKED_2X2_FLOAT16:aL.UNPACKED_FLOAT16}(t);if(e===rL.DOWNLOAD||e===rL.PIXELS)return aL.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(e))}function hB(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}var dB=(0,v.Z)((function e(t,n){(0,m.Z)(this,e),this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=Dz(this.outputShape.length),this.userCode="\n      float unaryOperation(float x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")})),fB="if (isnan(x)) return x;",mB="return x;",vB="return abs(x);",gB="return (x >= 0.0) ? x : (exp(x) - 1.0);",yB=fB+"\n  return (x < 0.0) ? 0.0 : x;\n",bB=fB+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",xB="return x;",kB="return 1.0 / (1.0 + exp(-1.0 * x));",wB="return x;",IB="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",SB="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",NB="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",TB="return 1.0 / (1.0 + exp(-1.0 * x));",CB=(0,v.Z)((function e(t,n){(0,m.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=Dz(this.outputShape.length),this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")})),_B=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=Dz(this.outputShape.length);var n=t.length,r=oB("rc",n),a=_z(n),i=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(n,r),o=r.slice(-2),s=n<=1?"rc":"vec2(".concat(o.join(","),")");this.userCode="\n      void main() {\n        ".concat(a," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(i,");\n\n        setOutput(getChannel(packedInput, ").concat(s,"));\n      }\n    ")})),EB=wv.whereImpl,AB={};var RB=Qe().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),FB=600;var ZB=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r,a;if((0,m.Z)(this,n),(r=t.call(this)).pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.lastGlFlushTime=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!Qe().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null!=e){if(e instanceof pP)a=e;else{var i=uL(Qe().getNumber("WEBGL_VERSION"),e);a=new pP(i)}r.binaryCache={},r.gpgpuCreatedLocally=!1}else{var o=uL(Qe().getNumber("WEBGL_VERSION"));a=new pP(o),r.binaryCache=function(e){return e in AB||(AB[e]={}),AB[e]}(Qe().getNumber("WEBGL_VERSION")),r.gpgpuCreatedLocally=!0}return r.gpgpu=a,r.canvas=r.gpgpu.gl.canvas,r.textureManager=new cB(r.gpgpu),r.numMBBeforeWarning=null==Qe().global.screen?1024:Qe().global.screen.height*Qe().global.screen.width*window.devicePixelRatio*FB/1024/1024,r.texData=new $((0,s.Z)(r),gs()),(0,c.Z)(r)}return(0,v.Z)(n,[{key:"nextDataId",value:function(){return n.nextDataId++}},{key:"numDataIds",value:function(){return this.texData.numDataIds()-this.pendingDeletes}},{key:"writeTexture",value:function(e,t,n,r,a,i){var o=this.makeTensorInfo(t,n),s=this.texData.get(o.dataId);s.isPacked=!1,s.texture={texture:e,texShape:[r,a]},s.texShape=[r,a];var u=XL(t),c=new Bz(u,!1,i),l=this.runWebGLProgram(c,[o],n,[[r,a]]);return l.shape=t,s.texture=null,this.disposeIntermediateTensorInfo(o),l.dataId}},{key:"write",value:function(e,t,n){if((Qe().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||Qe().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:rL.UPLOAD,refCount:1}),r}},{key:"refCount",value:function(e){return this.texData.has(e)?this.texData.get(e).refCount:0}},{key:"incRef",value:function(e){this.texData.get(e).refCount++}},{key:"decRef",value:function(e){this.texData.has(e)&&this.texData.get(e).refCount--}},{key:"move",value:function(e,t,n,r,a){if(Qe().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:rL.UPLOAD,refCount:a})}},{key:"disposeIntermediateTensorInfo",value:function(e){this.disposeData(e.dataId)}},{key:"readSync",value:function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,a=t.complexTensorInfos,i=t.slice,o=t.shape,s=t.isPacked;if(null!=i){var u;u=s?new CB(o,xB):new dB(o,xB);var c=this.runWebGLProgram(u,[{dataId:e,shape:o,dtype:r}],r),l=this.readSync(c.dataId);return this.disposeIntermediateTensorInfo(c),l}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var p,h,d=null!=this.activeTimers;if(d&&(p=Aa.now()),"complex64"===r){var f=this.readSync(a.real.dataId),m=this.readSync(a.imag.dataId);h=vm.mergeRealAndImagArrays(f,m)}else h=this.getValuesFromTexture(e);return d&&(this.downloadWaitMs+=Aa.now()-p),this.convertAndCacheOnCPU(e,h)}},{key:"read",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r,a,i,o,s,u,c,l,p,h,f,m,v,y,b,x,k,w,I,S,N,T;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pendingRead.has(t)){e.next=3;break}return n=this.pendingRead.get(t),e.abrupt("return",new Promise((function(e){return n.push(e)})));case 3:if(r=this.texData.get(t),a=r.values,i=r.shape,o=r.slice,s=r.dtype,u=r.complexTensorInfos,c=r.isPacked,null==o){e.next=8;break}return l=c?new CB(i,xB):new dB(i,xB),p=this.runWebGLProgram(l,[{dataId:t,shape:i,dtype:s}],s),h=this.read(p.dataId),e.abrupt("return",(this.disposeIntermediateTensorInfo(p),h));case 8:if(null==a){e.next=10;break}return e.abrupt("return",this.convertAndCacheOnCPU(t));case 10:if(!Qe().getBool("DEBUG")||Qe().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")||2!==Qe().getNumber("WEBGL_VERSION")){e.next=12;break}throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");case 12:if(f=null,"complex64"!==s&&Qe().get("WEBGL_BUFFER_SUPPORTED")&&(m=this.decode(t),y=this.texData.get(m.dataId),f=(v=this.gpgpu).createBufferFromTexture.apply(v,[y.texture.texture].concat((0,g.Z)(lL(i))))),this.pendingRead.set(t,[]),e.t0="complex64"!==s,!e.t0){e.next=19;break}return e.next=19,this.gpgpu.createAndWaitForFence();case 19:if("complex64"!==s){e.next=28;break}return e.next=22,Promise.all([this.read(u.real.dataId),this.read(u.imag.dataId)]);case 22:x=e.sent,k=x[0],w=x[1],b=vm.mergeRealAndImagArrays(k,w),e.next=29;break;case 28:null==f?b=this.getValuesFromTexture(t):(I=Aa.sizeFromShape(i),b=this.gpgpu.downloadFloat32MatrixFromBuffer(f,I));case 29:return null!=m&&this.disposeIntermediateTensorInfo(m),null!=f&&dL(S=this.gpgpu.gl,(function(){return S.deleteBuffer(f)})),N=this.convertAndCacheOnCPU(t,b),T=this.pendingRead.get(t),e.abrupt("return",(this.pendingRead.delete(t),T.forEach((function(e){return e(N)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&gs().removeDataId(t,this),this.pendingDeletes--),N));case 32:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readToGPU",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.texData.get(e),r=n.values,a=n.shape,i=n.slice,o=n.dtype,s=n.isPacked,u=n.texture;if("complex64"===o)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=i){var c;c=s?new CB(a,xB):new dB(a,xB);var l=this.runWebGLProgram(c,[{dataId:e,shape:a,dtype:o}],o),p=this.readToGPU(l,t);return this.disposeIntermediateTensorInfo(l),p}if(null==u)throw null!=r?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");var h=this.decode(e,t.customTexShape),d=gs().makeTensorFromTensorInfo(h),f=this.texData.get(h.dataId);return Object.assign({tensorRef:d},f.texture)}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId);if("string"===e.dtype)try{var n=t.map((function(e){return Aa.decodeString(e)}));return us(e.shape,e.dtype,n)}catch(n){throw new Error("Failed to decode encoded string bytes into utf-8")}return us(e.shape,e.dtype,t)}},{key:"checkNumericalProblems",value:function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!vL(n))throw Qe().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value ".concat(n," cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'")):Error("The value ".concat(n," cannot be represented on this device."))}}},{key:"getValuesFromTexture",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.isPacked,i=Aa.sizeFromShape(n);if(Qe().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var o,s=this.decode(e),u=this.texData.get(s.dataId),c=(o=this.gpgpu).downloadMatrixFromPackedTexture.apply(o,[u.texture.texture].concat((0,g.Z)(lL(n)))).subarray(0,i);return this.disposeIntermediateTensorInfo(s),c}var l=Qe().getBool("WEBGL_PACK")&&!0===a,p=l?XL(n):n,h=l?new zz(p):new Lz(p),d=this.runWebGLProgram(h,[{shape:p,dtype:r,dataId:e}],"float32"),f=this.texData.get(d.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(f.texture.texture,f.texShape[0],f.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(d),m}},{key:"timerAvailable",value:function(){return Qe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}},{key:"time",value:function(e){var t=this,n=this.activeTimers,r=[],a=!1;null==this.programTimersStack?(this.programTimersStack=r,a=!0):this.activeTimers.push(r),this.activeTimers=r,e();var i=Aa.flatten(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),o=Aa.flatten(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e}));this.activeTimers=n,a&&(this.programTimersStack=null);var s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(0,f.Z)((0,d.Z)().mark((function e(){var n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Qe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=7;break}return e.next=3,Promise.all(i);case 3:n=e.sent,s.kernelMs=Aa.sum(n),s.getExtraProfileInfo=function(){return n.map((function(e,t){return{name:o[t],ms:e}})).map((function(e){return"".concat(e.name,": ").concat(e.ms)})).join(", ")},e.next=8;break;case 7:s.kernelMs={error:"WebGL query timers are not supported in this environment."};case 8:return e.abrupt("return",(t.uploadWaitMs=0,t.downloadWaitMs=0,s));case 9:case"end":return e.stop()}}),e)})))()}},{key:"memory",value:function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}},{key:"startTimer",value:function(){return Qe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Aa.now(),endMs:null}}},{key:"endTimer",value:function(e){return Qe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Aa.now(),e)}},{key:"getQueryTime",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Qe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=2;break}return e.abrupt("return",this.gpgpu.waitForQueryAndGetTime(t));case 2:return n=t,e.abrupt("return",n.endMs-n.startMs);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);var n=this.texData.get(e).complexTensorInfos;return null!=n&&(this.disposeData(n.real.dataId,t),this.disposeData(n.imag.dataId,t)),this.texData.delete(e),!0}},{key:"releaseGPUData",value:function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,a=t.texShape,i=t.usage,o=t.isPacked,s=t.slice,u=s&&s.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(a,r),this.textureManager.releaseTexture(n,a,i,o)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}},{key:"getTexture",value:function(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}},{key:"getDataInfo",value:function(e){return this.texData.get(e)}},{key:"shouldExecuteOnCPU",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:RB;return Qe().getBool("WEBGL_CPU_FORWARD")&&e.every((function(e){return null==t.texData.get(e.dataId).texture&&Aa.sizeFromShape(e.shape)<n}))}},{key:"getGPGPUContext",value:function(){return this.gpgpu}},{key:"where",value:function(e){vm.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return EB(e.shape,t)}},{key:"packedUnaryOp",value:function(e,t,n){var r=new CB(e.shape,t),a=this.compileAndRun(r,[e],n);return gs().makeTensorFromTensorInfo(a)}},{key:"abs",value:function(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){var t=GP(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(Qe().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,vB,e.dtype);var n=new dB(e.shape,vB),r=this.compileAndRun(n,[e]);return gs().makeTensorFromTensorInfo(r)}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&Aa.isString(n[0])){var a=n.map((function(e){return Aa.encodeString(e)}));r=this.write(a,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}},{key:"makeOutput",value:function(e,t,n){return gs().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,n),this)}},{key:"unpackTensor",value:function(e){var t=new _B(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}},{key:"packTensor",value:function(e){var t=new sB(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}},{key:"packedReshape",value:function(e,t){var n=[qL(e.shape)].concat((0,g.Z)(KL(e.shape))),r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[qL(t)].concat((0,g.Z)(KL(t))),i=new uB(a,n),o=[n],s=this.runWebGLProgram(i,[r],e.dtype,o,!0);return{dataId:s.dataId,shape:t,dtype:s.dtype}}},{key:"decode",value:function(e,t){var n=this.texData.get(e),r=n.isPacked,a=n.shape,i=n.dtype;if(null!=t){var o=Aa.sizeFromShape(a),s=t[0]*t[1]*4;Aa.assert(o<=s,(function(){return"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."}))}var u,c=XL(a);u=r?new Oz(c):new Mz(c);var l=[null!=t?t:lL(c)];return{dtype:i,shape:a,dataId:this.runWebGLProgram(u,[{shape:c,dtype:i,dataId:e}],i,l,!0,t).dataId}}},{key:"runWebGLProgram",value:function(e,t,n,r){var a=this,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0,s=this.makeTensorInfo(e.outputShape,n),u=this.texData.get(s.dataId);if(e.packedOutput&&(u.isPacked=!0),e.outPackingScheme===nL.DENSE){var c=null!=o?o:lL(e.outputShape);u.texShape=c.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(u.usage=e.outTexUsage),0===Aa.sizeFromShape(s.shape))return u.values=Aa.getTypedArrayFromDType(s.dtype,0),s;var l=[],p=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&Aa.sizeFromShape(t.shape)<=Qe().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}if(a.uploadToGPU(t.dataId),!!n.isPacked!=!!e.packedInputs)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),l.push(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!QL(n.shape,t.shape)){var r=t,i=t.shape;t.shape=n.shape,t=a.packedReshape(t,i),l.push(t),n=a.texData.get(t.dataId),r.shape=i}return{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(s.dataId);var h,d={shape:s.shape,texData:u,isUniform:!1},f=function(e,t,n){var r="";t.concat(n).forEach((function(t){var a=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){var i=t.texData.texShape,o=Ez(e.packedInputs,t.shape,i),s=o.useSqueezeShape,u=o.uniformShape,c=o.keptDims,l="",p="",h="";if(1===u.length&&e.packedInputs){var d=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];l="".concat(d[0]>1,"_").concat(d[1]>1)}else if(2!==u.length||e.packedInputs){if(u.length>2&&!e.packedInputs){var f=Aa.computeStrides(u);h="".concat(f[0]===i[1],"_").concat(f[f.length-1]===i[1])}}else p="".concat(u[0]>1,"_").concat(u[1]>1);var m=t.shape.length,v=2===u.length&&Aa.arraysEqual(t.shape,i),g=1===Aa.sizeFromShape(t.shape),y=vm.getBroadcastDims(t.shape,n.shape),b=!e.packedInputs&&m===n.shape.length&&Aa.arraysEqual(i,n.texData.texShape),x=e.packedInputs||u.length>2?"":"".concat(i[0]>1,"_").concat(i[1]>1);r+="".concat(m,"_").concat(b,"_").concat(s?c:"","_").concat(u.length,"_").concat(g,"_").concat(y,"_").concat(v,"_").concat(l,"_").concat(p,"_").concat(h,"_").concat(x,"_").concat(a)}else{var k=t.isUniform?"uniform":t.texData.texShape;r+="".concat(t.shape,"_").concat(k,"_").concat(a)}}));var a=e.userCode,i=e.constructor.name;return i+"_"+r+"_"+a+"".concat(Qe().getNumber("WEBGL_VERSION"))}(e,p,d),m=this.getAndSaveBinary(f,(function(){return function(e,t,n,r){var a=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),i=a.map((function(e){return e.shapeInfo})),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},s=bz(a,o,t),u=xL(e.gl,s),c=e.createProgram(u);return Qe().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:t,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o},Fz(e,t,c))}(a.gpgpu,e,p,d)})),v=null!=this.activeTimers;v&&(h=this.startTimer()),Qe().get("ENGINE_COMPILE_ONLY")||function(e,t,n,r,a){t.program.enableShapeUniforms||(Zz(t.inShapeInfos,n),Zz([t.outShapeInfo],[r]));var i=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):e.setOutputMatrixTexture(i.texture,o[0],o[1]),e.setProgram(t.webGLProgram),1===Qe().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((function(n,r){var a=t.program.variableNames[r],i=t.uniformLocations[a],o=t.uniformLocations["offset".concat(a)],s=t.inShapesLocations["".concat(a,"Shape")],u=t.inTexShapesLocations["".concat(a,"TexShape")];if(s){var c=Ez(t.program.packedInputs,n.shape,n.texData.texShape).uniformShape;switch(c.length){case 1:e.gl.uniform1iv(s,new Int32Array(c));break;case 2:e.gl.uniform2iv(s,new Int32Array(c));break;case 3:e.gl.uniform3iv(s,new Int32Array(c));break;case 4:e.gl.uniform4iv(s,new Int32Array(c))}}if(u&&e.gl.uniform2i(u,n.texData.texShape[0],n.texData.texShape[1]),null!=i){if(n.isUniform){if(Aa.sizeFromShape(n.shape)<2)e.gl.uniform1f(i,n.uniformValues[0]);else{var l=n.uniformValues;l instanceof Float32Array||(l=new Float32Array(l)),e.gl.uniform1fv(i,l)}return}null!=n.texData.slice&&null!=o&&e.gl.uniform1i(o,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture.texture,i,r)}}));var s=t.outShapeLocation;if(s)switch(r.shape.length){case 1:e.gl.uniform1iv(s,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(s,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(s,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(s,new Int32Array(r.shape))}if(t.outShapeStridesLocation){var u=Aa.computeStrides(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(u));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(u));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(u))}}t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&a&&t.program.customUniforms.forEach((function(n,r){var i=t.customUniformLocations[r],o=a[r];if("float"===n.type)e.gl.uniform1fv(i,o);else if("vec2"===n.type)e.gl.uniform2fv(i,o);else if("vec3"===n.type)e.gl.uniform3fv(i,o);else if("vec4"===n.type)e.gl.uniform4fv(i,o);else if("int"===n.type)e.gl.uniform1iv(i,o);else if("ivec2"===n.type)e.gl.uniform2iv(i,o);else if("ivec3"===n.type)e.gl.uniform3iv(i,o);else{if("ivec4"!==n.type)throw Error("uniform type ".concat(n.type," is not supported yet."));e.gl.uniform4iv(i,o)}})),e.executeProgram()}(this.gpgpu,m,p,d,r),l.forEach((function(e){return a.disposeIntermediateTensorInfo(e)})),v&&(h=this.endTimer(h),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(h)}));var g=Qe().get("WEBGL_FLUSH_THRESHOLD");if(g>0){var y=Aa.now();y-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!Qe().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&!1===i){var b=this.unpackTensor(s);return this.disposeIntermediateTensorInfo(s),b}return s}},{key:"compileAndRun",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return n=n||t[0].dtype,this.runWebGLProgram(e,t,n,r,a)}},{key:"getAndSaveBinary",value:function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}},{key:"getTextureManager",value:function(){return this.textureManager}},{key:"dispose",value:function(){var e=this;this.disposed||(Qe().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}},{key:"floatPrecision",value:function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=xs((function(){if(!Qe().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=Qe().getBool("DEBUG");Qe().set("DEBUG",!1);var n=e.abs(kc(1e-8)).dataSync()[0];if(Qe().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"uploadToGPU",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.values,i=t.texture,o=t.usage,s=t.isPacked;if(null==i){var u,c=null!=this.activeTimers;c&&(u=Aa.now());var l=t.texShape;if(null==l&&(l=YL(n,s),t.texShape=l),null!=a){var p,d,f,m=XL(n),v=l[1],g=l[0],y=a instanceof Uint8Array||a instanceof Uint8ClampedArray;(s||!y)&&(p=pL(l[0],l[1]),v=(d=(0,h.Z)(p,2))[0],g=d[1]),f=s?new Wz(m,y):new Bz(m,y);var b=y?[g,v]:l,x=this.makeTensorInfo(b,r),k=this.texData.get(x.dataId);k.usage=y?rL.PIXELS:rL.UPLOAD,k.texShape=b,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(x.dataId),v,g,a);var w=[[g,v]],I=this.runWebGLProgram(f,[x],r,w,!0),S=this.texData.get(I.dataId);t.texShape=S.texShape,t.isPacked=S.isPacked,t.usage=S.usage,Qe().get("ENGINE_COMPILE_ONLY")?this.disposeData(I.dataId):(t.texture=S.texture,t.values=null,this.texData.delete(I.dataId)),this.disposeIntermediateTensorInfo(x),c&&(this.uploadWaitMs+=Aa.now()-u)}else{var N=this.acquireTexture(l,o,r,s);t.texture=N}}}},{key:"convertAndCacheOnCPU",value:function(e,t){var n=this.texData.get(e),r=n.dtype;return null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype ".concat(t))}(t,r)),n.values}},{key:"acquireTexture",value:function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(a," MB, most likely due to a memory leak"))}return this.textureManager.acquireTexture(e,t,r)}},{key:"computeBytes",value:function(e,t){return e[0]*e[1]*Aa.bytesPerElement(t)}},{key:"checkCompileCompletion",value:function(){for(var e=0,t=Object.entries(this.binaryCache);e<t.length;e++){var n=(0,h.Z)(t[e],2)[1];this.checkCompletion_(n)}}},{key:"checkCompileCompletionAsync",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n,r,a,i,o,s,u,c=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],!this.gpgpu.parallelCompilationExtension){e.next=6;break}for(n=0,r=Object.entries(this.binaryCache);n<r.length;n++)a=(0,h.Z)(r[n],2),i=a[1],t.push(this.checkCompletionAsync_(i));return e.abrupt("return",Promise.all(t));case 6:o=(0,d.Z)().mark((function e(){var n,r,a;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=(0,h.Z)(u[s],2),r=n[1],a=new Promise((function(e){try{c.checkCompletion_(r),e(!0)}catch(oQ){throw oQ}})),t.push(a);case 3:case"end":return e.stop()}}),e)})),s=0,u=Object.entries(this.binaryCache);case 8:if(!(s<u.length)){e.next=13;break}return e.delegateYield(o(),"t0",10);case 10:s++,e.next=8;break;case 13:return e.abrupt("return",Promise.all(t));case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"checkCompletionAsync_",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)){e.next=4;break}e.t0=this.checkCompletion_(t),e.next=7;break;case 4:return e.next=6,fm();case 6:e.t0=this.checkCompletionAsync_(t);case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkCompletion_",value:function(e){if(!1===this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS))throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)?(SL(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}},{key:"getUniformLocations",value:function(){for(var e=0,t=Object.entries(this.binaryCache);e<t.length;e++){var n=(0,h.Z)(t[e],2)[1],r=Fz(this.gpgpu,n.program,n.webGLProgram),a=r.uniformLocations,i=r.customUniformLocations,o=r.infLoc,s=r.nanLoc,u=r.inShapesLocations,c=r.inTexShapesLocations,l=r.outShapeLocation,p=r.outShapeStridesLocation,d=r.outTexShapeLocation;n.uniformLocations=a,n.customUniformLocations=i,n.infLoc=o,n.nanLoc=s,n.inShapesLocations=u,n.inTexShapesLocations=c,n.outShapeLocation=l,n.outShapeStridesLocation=p,n.outTexShapeLocation=d}}},{key:"createTensorFromGPUData",value:function(e,t,n){e.channels=e.channels||"RGBA";var r=e.texture,a=e.height,i=e.width,o=e.channels,s=gs().backend;if(!s.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");var u=s.writeTexture(r,t,n,a,i,o);return gs().makeTensorFromDataId(u,t,n,s)}}]),n}(ee);ZB.nextDataId=0;var DB="4.2.0";function MB(){Qe().set("WEBGL_FORCE_F16_TEXTURES",!0)}Oi.isBrowser()&&As("webgl",(function(){return new ZB}),2);var OB={forceHalfFloat:MB},LB="\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n",zB=(0,v.Z)((function e(t,n,r){(0,m.Z)(this,e),this.variableNames=["A","B"],this.outputShape=vm.assertAndGetBroadcastShape(n,r),this.enableShapeUniforms=Dz(this.outputShape.length),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")})),PB="\n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n",BB=(0,v.Z)((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];(0,m.Z)(this,e),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=vm.assertAndGetBroadcastShape(n,r);var i=this.outputShape.length;this.enableShapeUniforms=Dz(i);var o="";if(a)if(0===i||1===Aa.sizeFromShape(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(o="\n          ".concat(_z(i)," coords = getOutputCoords();\n        "),1===i)this.enableShapeUniforms?o+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":o+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{var s=oB("coords",i);this.enableShapeUniforms?o+="\n            bool nextRowOutOfBounds =\n              (".concat(s[i-2]," + 1) >= outShape[").concat(i," - 2];\n            bool nextColOutOfBounds =\n              (").concat(s[i-1]," + 1) >= outShape[").concat(i," - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "):o+="\n            bool nextRowOutOfBounds =\n              (".concat(s[i-2]," + 1) >= ").concat(this.outputShape[i-2],";\n            bool nextColOutOfBounds =\n              (").concat(s[i-1]," + 1) >= ").concat(this.outputShape[i-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(o,"\n\n        setOutput(result);\n      }\n    ")}));function WB(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var VB={kernelName:yn,backendName:"webgl",kernelFunc:WB};function UB(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(i.dataId),s=WB({inputs:{x:r},backend:n}),u=WB({inputs:{x:a},backend:n});return o.complexTensorInfos={real:s,imag:u},i}var GB={kernelName:Et,backendName:"webgl",kernelFunc:UB},HB="return (a < 0.) ? b * a : a;",jB="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var qB={kernelName:Sn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.alpha,o=n.makeTensorInfo([],"float32",Aa.createScalarValue(i,"float32")),s=Qe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new BB(jB,a.shape,o.shape):new zB(HB,a.shape,o.shape),u=n.runWebGLProgram(s,[a,o],"float32");return n.disposeIntermediateTensorInfo(o),u}},KB="return (a < 0.) ? b * a : a;",XB="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var YB={kernelName:cr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha,i=Qe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new BB(XB,r.shape,a.shape):new zB(KB,r.shape,a.shape);return n.runWebGLProgram(i,[r,a],"float32")}},JB="if (isnan(x)) return x;";function QB(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.cpuKernelImpl,a=e.dtype;return function(e){var i,o=e.inputs,s=e.backend,u=o.x,c=s,l=a||u.dtype;if(c.shouldExecuteOnCPU([u])&&null!=r){var p=c.texData.get(u.dataId),h=r(p.values,l);return c.makeTensorInfo(u.shape,l,h)}return i=Qe().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=n?new CB(u.shape,n):new dB(u.shape,t),c.runWebGLProgram(i,[u],l)}}function $B(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.checkOutOfBounds,a=void 0!==r&&r,i=e.supportsComplex,o=void 0!==i&&i,s=e.cpuKernelImpl,u=e.dtype;return function(e){var r=e.inputs,i=e.backend,c=r.a,l=r.b,p=i;if(o&&"complex64"===c.dtype){var d=p.texData.get(c.dataId),f=p.texData.get(l.dataId),m=[[d.complexTensorInfos.real,f.complexTensorInfos.real],[d.complexTensorInfos.imag,f.complexTensorInfos.imag]].map((function(e){var n=(0,h.Z)(e,2),r=n[0],a=n[1],i={dataId:r.dataId,dtype:r.dtype,shape:c.shape},o={dataId:a.dataId,dtype:a.dtype,shape:l.shape},s=new zB(t,c.shape,l.shape);return p.runWebGLProgram(s,[i,o],wi(r.dtype,a.dtype))})),v=(0,h.Z)(m,2),g=v[0],y=v[1],b=UB({inputs:{real:g,imag:y},backend:p});return p.disposeIntermediateTensorInfo(g),p.disposeIntermediateTensorInfo(y),b}var x,k=u||wi(c.dtype,l.dtype);if(("string"===c.dtype||"string"===l.dtype||p.shouldExecuteOnCPU([c,l]))&&null!=s){var w=p.texData.get(c.dataId).values,I=p.texData.get(l.dataId).values,S="string"===c.dtype?vm.fromUint8ToStringArray(w):w,N="string"===c.dtype?vm.fromUint8ToStringArray(I):I,T=s(c.shape,l.shape,S,N,k),C=(0,h.Z)(T,2),_=C[0],E=C[1],A=p.makeTensorInfo(E,k);return p.texData.get(A.dataId).values=_,A}return x=Qe().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=n?new BB(n,c.shape,l.shape,a):new zB(t,c.shape,l.shape),p.runWebGLProgram(x,[c,l],k)}}function eW(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return t?wB:mB;if("relu"===e)return t?SB:yB;if("elu"===e)return t?IB:gB;if("relu6"===e)return t?NB:bB;if("prelu"===e)return t?XB:KB;if("leakyrelu"===e)return t?jB:HB;if("sigmoid"===e)return t?TB:kB;throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}var tW=(0,v.Z)((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]&&arguments[8];(0,m.Z)(this,e),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=Dz(this.outputShape.length);var l=a?t[1]:t[2],p=Math.ceil(l/2),h=a?"i * 2, rc.y":"rc.y, i * 2",d=i?"rc.z, i * 2":"i * 2, rc.z",f=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],v=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],g="",y="";s&&(g=u?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(s,"\n        }"):c?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(s,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(s,"\n        }"),y="result = activation(result);");var b=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");var x="rc.x",k="rc.x";t[0]<n[0]?x="imod(rc.x, ".concat(t[0],")"):n[0]<t[0]&&(k="imod(rc.x, ".concat(n[0],")")),this.userCode="\n      ".concat(g,"\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ").concat(p,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        int batchA = ").concat(x,";\n        int batchB = ").concat(k,";\n        for (int i = 0; i < ").concat(p,"; i++) {\n          vec4 a = getMatrixA(batchA, ").concat(h,");\n          vec4 b = getMatrixB(batchB, ").concat(d,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(f[0]," * ").concat(v[0],");\n          result += (").concat(f[1]," * ").concat(v[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(b,"\n\n        ").concat(y,"\n\n        setOutput(result);\n      }\n    ")})),nW={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},rW=(0,v.Z)((function e(t,n,r){(0,m.Z)(this,e),this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=vm.assertAndGetBroadcastShape(n,r),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")})),aW="return a * b;";function iW(e){var t,n=e.inputs,r=e.backend,a=n.a,i=n.b,o=vm.upcastType(a.dtype,i.dtype);if("complex64"===a.dtype){var s=r.texData.get(a.dataId),u=r.texData.get(i.dataId),c=new rW(nW.REAL,a.shape,i.shape),l=new rW(nW.IMAG,a.shape,i.shape),p=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:a.shape},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:a.shape},{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:i.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:i.shape}],d=r.runWebGLProgram(c,p,"float32"),f=r.runWebGLProgram(l,p,"float32"),m=UB({inputs:{real:d,imag:f},backend:r});return r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(f),m}if(r.shouldExecuteOnCPU([a,i])){var v=r.texData.get(a.dataId),g=r.texData.get(i.dataId),y=ZP(a.shape,i.shape,v.values,g.values,o),b=(0,h.Z)(y,2),x=b[0],k=b[1],w=r.makeTensorInfo(k,o);return r.texData.get(w.dataId).values=x,w}return t=Qe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new BB(aW,a.shape,i.shape):new zB(aW,a.shape,i.shape),r.runWebGLProgram(t,[a,i],o)}var oW={kernelName:Jn,backendName:"webgl",kernelFunc:iW};function sW(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,o=n,s=Aa.sizeFromShape(a.shape),u=Aa.inferFromImplicitShape(i,s),c=Aa.sizeFromShape(u);Aa.assert(s===c,(function(){return"The new shape (".concat(u,") has ").concat(c," elements and the old shape (").concat(a.shape,") has ").concat(s," elements. The new shape and old shape must have the same number of elements.")}));var l=o.texData.get(a.dataId);return!l.isPacked||QL(a.shape,u)||null!==l.texture&&QL(l.shape,u)?(o.incRef(a.dataId),{dataId:a.dataId,shape:u,dtype:a.dtype}):function(e,t,n){var r=[qL(e.shape)].concat((0,g.Z)(KL(e.shape))),a={dtype:e.dtype,shape:r,dataId:e.dataId},i=[qL(t)].concat((0,g.Z)(KL(t))),o=new uB(i,r),s=[r],u=n.runWebGLProgram(o,[a],e.dtype,s,!0);return{dataId:u.dataId,shape:t,dtype:u.dtype}}(a,u,o)}var uW={kernelName:yr,backendName:"webgl",kernelFunc:sW},cW=(0,v.Z)((function e(t,n){(0,m.Z)(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s=4*Math.floor(r/4),u=r%4,c="sumValue += dot(values, ones);";if(null!=n){var l=1/n;c="sumValue += dot(values * ".concat(Aa.isInt(l)?l.toPrecision(2):l,", ones);")}var p="";i%r>0&&(p="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return 0.0;\n        }\n      ")),this.userCode="\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ".concat(p,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(s,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(c,"\n        }\n\n        int inIdx = inOffset + ").concat(s,";\n        if (").concat(1===u,") {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(2===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(3===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ").concat(c,"\n        }\n        setOutput(sumValue);\n      }\n    ")})),lW=(0,v.Z)((function e(t,n){(0,m.Z)(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s="0.0",u="";"prod"===n?s="1.0":"min"===n?(s="1.0 / 1e-20",u="min"):"max"===n&&(s="-1.0 / 1e-20",u="max");var c="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"sum"===n?c="sumValue":"prod"===n?c="prodValue":"all"===n?c="allValue":"any"===n&&(c="anyValue");var l=4*Math.floor(r/4),p=r%4,h="\n      if (".concat("sum"===n,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===n,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(u,"(values, minMaxValue);\n        if (").concat("min"===n," || ").concat("max"===n,") {\n          minMaxValue = ").concat(u,"(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    "),d="vec4";"all"===n?(s="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===n&&(s="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");var f="";i%r>0&&(f="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(s,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(f,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        vec4 minMaxValue = vec4(").concat(s,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(l,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(h,"\n        }\n\n        int inIdx = inOffset + ").concat(l,";\n        if (").concat(1===p,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(h,"\n        } else if (").concat(2===p,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(h,"\n        } else if (").concat(3===p,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(h,"\n        }\n        setOutput(").concat(c,");\n      }\n    ")}));function pW(e,t,n,r){for(var a=function(e){for(var t=[];0===t.length||1!==t[t.length-1].outSize;){var n=t.length?t[t.length-1].outSize:e[1],r=vm.computeOptimalWindowSize(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape),i=e,o=0;o<a.length;o++){var s,u=a[o],c=u.inSize,l=u.windowSize,p=u.outSize,h=void 0;h="mean"===n?0===o?new cW({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:p},c):new cW({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:p}):new lW({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:p},n),s=i,i=r.runWebGLProgram(h,[i],t),s.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(s)}return i}var hW=(0,v.Z)((function e(t,n){(0,m.Z)(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];this.outputShape=r,this.rank=r.length;var i=_z(this.rank),o=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}(n);this.userCode="\n    void main() {\n      ".concat(i," resRC = getOutputCoords();\n      setOutput(getA(").concat(o,"));\n    }\n    ")}));var dW=(0,v.Z)((function e(t,n){(0,m.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var i=_z(this.rank),o=iB("rc",this.rank),s=new Array(this.rank),u=0;u<n.length;u++)s[n[u]]=o[u];var c="vec2(".concat(s.slice(-2).join(),")"),l="++".concat(o[this.rank-1]," < ").concat(r[this.rank-1]),p="getChannel(getA(".concat(s.join(),"), ").concat(c,")");this.userCode="\n    void main() {\n      ".concat(i," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(p,";\n      if(").concat(l,") {\n        result[1] = ").concat(p,";\n      }\n      --").concat(o[this.rank-1],";\n      if(++").concat(o[this.rank-2]," < ").concat(r[this.rank-2],") {\n        result[2] = ").concat(p,";\n        if(").concat(l,") {\n          result[3] = ").concat(p,";\n        }\n      }\n      setOutput(result);\n    }\n    ")}));function fW(e,t,n){var r=Qe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new dW(e.shape,t):new hW(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function mW(e){var t=e.inputs,n=e.backend,r=e.attrs;return function(e,t,n,r){var a=t,i=e.shape.length,o=Aa.parseAxisParam(a,e.shape),s=o,u=vm.getAxesPermutation(s,i),c=null!=u,l=e;c&&(l=fW(e,u,r),s=vm.getInnerMostAxes(s.length,i)),vm.assertAxesAreInnerMostDims("sum",s,i);var p=vm.computeOutAndReduceShapes(l.shape,s),d=(0,h.Z)(p,2),f=d[0],m=d[1],v=f;n&&(v=vm.expandShapeToKeepDim(f,o));var g=Aa.sizeFromShape(m),y=sW({inputs:{x:l},attrs:{shape:[Aa.sizeFromShape(e.shape)/g,g]},backend:r}),b=pW(y,Ii(e.dtype),"sum",r),x=sW({inputs:{x:b},attrs:{shape:v},backend:r});return r.disposeIntermediateTensorInfo(y),r.disposeIntermediateTensorInfo(b),c&&r.disposeIntermediateTensorInfo(l),x}(t.x,r.axis,r.keepDims,n)}var vW={kernelName:zr,backendName:"webgl",kernelFunc:mW};function gW(e){for(var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.perm,s=r,u=i.shape.length,c=new Array(u),l=0;l<c.length;l++)c[l]=i.shape[o[l]];if(s.shouldExecuteOnCPU([i])){var p=s.texData.get(i.dataId).values,h=rB(p,i.shape,i.dtype,o,c);t=s.makeTensorInfo(c,i.dtype),s.texData.get(t.dataId).values=h}else t=fW(i,o,s);return t}var yW={kernelName:ia,backendName:"webgl",kernelFunc:gW},bW=1e3;function xW(e){var t=e.a,n=e.b,r=e.transposeA,a=e.transposeB,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,p=void 0===l?0:l,h=e.activation,d=void 0===h?null:h,f=t.shape.length,m=n.shape.length,v=r?t.shape[f-2]:t.shape[f-1],g=a?n.shape[m-1]:n.shape[m-2],y=r?t.shape[f-1]:t.shape[f-2],b=a?n.shape[m-2]:n.shape[m-1],x=t.shape.slice(0,-2),k=n.shape.slice(0,-2),w=Aa.sizeFromShape(x),I=Aa.sizeFromShape(k),S=Qu.assertAndGetBroadcastShape(t.shape.slice(0,-2),n.shape.slice(0,-2)).concat([y,b]);Aa.assert(v===g,(function(){return"Error in matMul: inner shapes (".concat(v,") and (").concat(g,") of Tensors with shapes ").concat(t.shape," and ").concat(n.shape," and transposeA=").concat(r," and transposeB=").concat(a," must match.")}));var N,T=r?[w,v,y]:[w,y,v],C=a?[I,b,g]:[I,g,b],_=sW({inputs:{x:t},backend:i,attrs:{shape:T}}),E=sW({inputs:{x:n},backend:i,attrs:{shape:C}}),A=[_,E],R=Math.max(w,I),F=r?_.shape[1]:_.shape[2],Z=null!=s,D=null!=c,M="leakyrelu"===d,O=null!=d?eW(d,!0):null;if((1===y||1===b)&&F>bW&&!1===(Z||D||M||null!=O)){var L=_,z=E;r&&(L=gW({inputs:{x:_},backend:i,attrs:{perm:[0,2,1]}}),A.push(L)),a&&(z=gW({inputs:{x:E},backend:i,attrs:{perm:[0,2,1]}}),A.push(z));var P=1===b,B=L;1!==b&&(B=sW({inputs:{x:L},backend:i,attrs:{shape:[R,F,1]}}),A.push(B));var W=1===b?2:1,V=z;P&&(V=sW({inputs:{x:z},backend:i,attrs:{shape:[R,1,F]}}),A.push(V));var U=iW({inputs:{a:B,b:V},backend:i});N=mW({inputs:{x:U},backend:i,attrs:{axis:W,keepDims:!0}}),A.push(U)}else{var G=wi(t.dtype,n.dtype),H=new tW(T,C,[R,y,b],r,a,Z,O,D,M),j=[_,E];if(null!=s&&j.push(s),D&&j.push(c),M){var q=i.makeTensorInfo([],"float32",Aa.createScalarValue(p,"float32"));j.push(q),A.push(q)}N=i.runWebGLProgram(H,j,G)}var K=sW({inputs:{x:N},backend:i,attrs:{shape:S}});A.push(N);for(var X=0,Y=A;X<Y.length;X++){var J=Y[X];i.disposeIntermediateTensorInfo(J)}return K}var kW={kernelName:fa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=t.bias,s=t.preluActivationWeights,u=r.transposeA,c=r.transposeB,l=r.activation;return xW({a:a,b:i,transposeA:u,transposeB:c,backend:n,bias:o,preluActivationWeights:s,leakyreluAlpha:r.leakyreluAlpha,activation:l})}},wW="return abs(x);";var IW={kernelName:rt,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])&&"complex64"!==a.dtype){var i=r.texData.get(a.dataId),o=GP(i.values);return r.makeTensorInfo(a.shape,a.dtype,o)}return t=Qe().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new CB(a.shape,wW):new dB(a.shape,wW),r.runWebGLProgram(t,[a],a.dtype)}},SW=QB({opSnippet:fB+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),NW={kernelName:at,backendName:"webgl",kernelFunc:SW},TW=QB({opSnippet:fB+"\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),CW={kernelName:it,backendName:"webgl",kernelFunc:TW},_W="return a + b;",EW=$B({opSnippet:_W,packedOpSnippet:_W,supportsComplex:!0,cpuKernelImpl:hP}),AW={kernelName:ot,backendName:"webgl",kernelFunc:EW},RW=(0,v.Z)((function e(t,n){(0,m.Z)(this,e),this.outputShape=[],this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        float result = ").concat(a,";\n        setOutput(result);\n      }\n    ")})),FW=(0,v.Z)((function e(t,n){(0,m.Z)(this,e),this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        vec4 result = ").concat(a,";\n        setOutput(result);\n      }\n    ")}));var ZW={kernelName:st,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n;if(1===a.length)return WB({inputs:{x:a[0]},backend:r});if(a.length>Qe().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(a.length/2),o=e({inputs:a.slice(0,i),backend:r}),s=e({inputs:a.slice(i),backend:r});return e({inputs:[o,s],backend:r})}var u=a.map((function(e){return e.dtype})).reduce((function(e,t){return wi(e,t)})),c=a.map((function(e){return e.shape})),l=Qe().getBool("WEBGL_PACK")?new FW(a[0].shape,c):new RW(a[0].shape,c);return r.runWebGLProgram(l,a,u)}};var DW={kernelName:ut,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=Aa.parseAxisParam(i,a.shape),c=u,l=vm.getAxesPermutation(c,s),p=a;null!=l&&(p=gW({inputs:{x:a},backend:n,attrs:{perm:l}}),c=vm.getInnerMostAxes(c.length,s)),vm.assertAxesAreInnerMostDims("all",c,s);var d,f=vm.computeOutAndReduceShapes(p.shape,c),m=(0,h.Z)(f,2),v=m[0],g=m[1],y=sW({inputs:{x:p},backend:n,attrs:{shape:[-1,Aa.sizeFromShape(g)]}}),b=pW(y,y.dtype,"all",n);return d=sW(o?{inputs:{x:b},backend:n,attrs:{shape:vm.expandShapeToKeepDim(v,u)}}:{inputs:{x:b},backend:n,attrs:{shape:v}}),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(b),null!=l&&n.disposeIntermediateTensorInfo(p),d}};var MW={kernelName:ct,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=Aa.parseAxisParam(i,a.shape),c=u,l=vm.getAxesPermutation(c,s),p=a;null!=l&&(p=gW({inputs:{x:a},backend:n,attrs:{perm:l}}),c=vm.getInnerMostAxes(c.length,s)),vm.assertAxesAreInnerMostDims("any",c,s);var d,f=vm.computeOutAndReduceShapes(p.shape,c),m=(0,h.Z)(f,2),v=m[0],g=m[1],y=sW({inputs:{x:p},backend:n,attrs:{shape:[-1,Aa.sizeFromShape(g)]}}),b=pW(y,y.dtype,"any",n);return d=sW(o?{inputs:{x:b},backend:n,attrs:{shape:vm.expandShapeToKeepDim(v,u)}}:{inputs:{x:b},backend:n,attrs:{shape:v}}),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(b),null!=l&&n.disposeIntermediateTensorInfo(p),d}},OW=(0,v.Z)((function e(t,n,r){(0,m.Z)(this,e),this.variableNames=["A"];var a=t.windowSize,i=t.batchSize,o=t.outSize;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s="max"===n?">":"<",u=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(a,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          int inIdx = ").concat(u,";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat(s," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")})),LW=(0,v.Z)((function e(t,n,r,a){(0,m.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,Aa.assert(t.length>2,(function(){return"Packed arg".concat(r.charAt(0).toUpperCase()+r.slice(1)," supports only inputs with rank above 2.")}));var i=t[t.length-1],o=Math.ceil(i/n);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),a||this.variableNames.push("bestIndicesA");var s,u,c=this.outputShape,l=c.length,p=_z(l),h=oB("coords",l);if(1===o){var d=_z(u=l+1);s="\n        ".concat(d," sourceLocR = ").concat(d,"(").concat(h.join(),", 0);\n        ++").concat(h[l-1],";\n        ").concat(d," sourceLocG = ").concat(d,"(").concat(h.join(),", 0);\n        ++").concat(h[l-2],";\n        ").concat(d," sourceLocA = ").concat(d,"(").concat(h.join(),", 0);\n        --").concat(h[l-1],";\n        ").concat(d," sourceLocB = ").concat(d,"(").concat(h.join(),", 0);\n        --").concat(h[l-2],";")}else u=l,s="\n        ".concat(p," sourceLocR = coords;\n        ++").concat(h[l-1],";\n        ").concat(p," sourceLocG = coords;\n        ++").concat(h[l-2],";\n        ").concat(p," sourceLocA = coords;\n        --").concat(h[l-1],";\n        ").concat(p," sourceLocB = coords;\n        --").concat(h[l-2],";");var f=["x","y","z","w","u","v"].slice(0,u),v="."+f[u-1],g=f.map((function(e){return"int "+e})),y=oB("sourceLocR",u-1).concat("inIdx.r"),b=oB("sourceLocG",u-1).concat("inIdx.g"),x=oB("sourceLocB",u-1).concat("inIdx.b"),k=oB("sourceLocA",u-1).concat("inIdx.a"),w="max"===r?"greaterThan":"lessThan",I=a?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(y.join(),"),\n                             getBestIndicesAChannel(").concat(b.join(),"),\n                             getBestIndicesAChannel(").concat(x.join(),"),\n                             getBestIndicesAChannel(").concat(k.join(),")));"),S="vec4(\n            getAChannel(".concat(y.join(),"),\n            hasNextCol ? getAChannel(").concat(b.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(x.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(k.join(),") : 0.)"),N=a?"":"\n      float getBestIndicesAChannel(".concat(g.join(),") {\n        return getChannel(getBestIndicesA(").concat(f.join(),"),\n                                          vec2(").concat(f.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(g.join(),") {\n        return getChannel(getA(").concat(f.join(),"),\n                               vec2(").concat(f.slice(-2).join(),"));\n      }\n      ").concat(N,"\n      void main() {\n        ").concat(p," coords = getOutputCoords();\n        bool hasNextCol = ").concat(h[l-1]," < ").concat(c[l-1]-1,";\n        bool hasNextRow = ").concat(h[l-2]," < ").concat(c[l-2]-1,";\n        ").concat(s,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(v,", sourceLocG").concat(v,",\n          sourceLocB").concat(v,", sourceLocA").concat(v,") * ").concat(n,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(S,";\n\n        for (int i = 0; i < ").concat(n,"; i++) {\n          inIdx = srcIdx;\n          ").concat(I,"\n          vec4 candidate = ").concat(S,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(w,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")}));function zW(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=t.shape[0],i=t.shape[1];null!=r&&(a=r.shape[0],i=r.shape[1]);var o=vm.computeOptimalWindowSize(i),s={windowSize:o,inSize:i,batchSize:a,outSize:Math.ceil(i/o)},u=new OW(s,n,null==r),c=[t];null!=r&&c.push(r);var l=e.runWebGLProgram(u,c,"int32");if(1===l.shape[1])return l;var p=zW(e,t,n,l);return e.disposeIntermediateTensorInfo(l),p}function PW(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=null!=r?r.shape:t.shape,i=a[a.length-1],o=vm.computeOptimalWindowSize(i),s=new LW(a,o,n,null==r),u=null==r?[t]:[t,r],c=e.runWebGLProgram(s,u,"int32");if(c.shape.length===t.shape.length){var l=PW(e,t,n,c);return e.disposeIntermediateTensorInfo(c),l}return c}function BW(e,t,n,r){var a=[n];if(vm.assertAxesAreInnerMostDims("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,t.shape.length),!Qe().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){var i=[],o=e.texData.get(t.dataId),s=t;null!==o&&o.isPacked&&(s=e.unpackTensor(t),i.push(s));var u=vm.computeOutAndReduceShapes(s.shape,a),c=(0,h.Z)(u,2),l=c[0],p=c[1],d=Aa.sizeFromShape(p),f=sW({inputs:{x:s},backend:e,attrs:{shape:[-1,d]}});i.push(f);var m=zW(e,f,r);i.push(m);var v=sW({inputs:{x:m},backend:e,attrs:{shape:l}});return i.forEach((function(t){return e.disposeIntermediateTensorInfo(t)})),v}return PW(e,t,r)}var WW={kernelName:lt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=Aa.parseAxisParam(i,a.shape),s=vm.getAxesPermutation(o,a.shape.length),u=a,c=[];null!=s&&(u=gW({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=vm.getInnerMostAxes(o.length,u.shape.length)),vm.assertAxesAreInnerMostDims("argMax",[o[0]],u.shape.length);var l=BW(n,u,o[0],"max");return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),l}};var VW={kernelName:pt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=Aa.parseAxisParam(i,a.shape),s=vm.getAxesPermutation(o,a.shape.length),u=a,c=[];null!=s&&(u=gW({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=vm.getInnerMostAxes(o.length,u.shape.length)),vm.assertAxesAreInnerMostDims("argMin",[o[0]],u.shape.length);var l=BW(n,u,o[0],"min");return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),l}},UW=QB({opSnippet:fB+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),GW={kernelName:ht,backendName:"webgl",kernelFunc:UW},HW=QB({opSnippet:fB+"return log(x + sqrt(x * x + 1.0));"}),jW={kernelName:dt,backendName:"webgl",kernelFunc:HW},qW=QB({opSnippet:fB+"\n  return atan(x);\n"}),KW={kernelName:ft,backendName:"webgl",kernelFunc:qW},XW=$B({opSnippet:LB+"\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+PB+"\n  return result;\n"}),YW={kernelName:vt,backendName:"webgl",kernelFunc:XW},JW=QB({opSnippet:fB+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),QW={kernelName:mt,backendName:"webgl",kernelFunc:JW},$W=(0,v.Z)((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if((0,m.Z)(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideHeight,u=t.strideWidth,c=t.dilationHeight,l=t.dilationWidth,p=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.top,f=t.padInfo.left;this.outputShape=t.outShape;var v="avg"===n,g="((batch  * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),y="(xR * ".concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),b="0.0";if(v||(b="-1.0 / 1e-20"),r){this.userCode="\n        const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n        const ivec2 pads = ivec2(").concat(d,", ").concat(f,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(p,";\n              wR += ").concat(c,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(h,";\n                wC += ").concat(l,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ").concat(">="," currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(a?i?g:y:"wR * ".concat(h," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var x="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"avg"===n&&(x="avgValue / max(count, 1.0)");var k=4*Math.floor(o/4),w=o%4,I="\n      if (".concat(v,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat("max","(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n      const ivec2 pads = ivec2(").concat(d,", ").concat(f,");\n      const float initializationValue = ").concat(b,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(b,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(p,";\n            wR += ").concat(c,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(k,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(l,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              getValue(batch, xR, xC + 3 * ").concat(l,", d)\n            );\n\n            ").concat(I,"\n          }\n\n          int xC = xCCorner + ").concat(k,";\n          if (").concat(1===w,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(I,"\n          } else if (").concat(2===w,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(I,"\n          } else if (").concat(3===w,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              initializationValue\n            );\n\n            ").concat(I,"\n          }\n        }\n        setOutput(").concat(x,");\n      }\n    ")}})),eV=(0,v.Z)((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if((0,m.Z)(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideDepth,u=t.strideHeight,c=t.strideWidth,l=t.dilationDepth,p=t.dilationHeight,h=t.dilationWidth,d=t.effectiveFilterDepth,f=t.effectiveFilterHeight,v=t.effectiveFilterWidth,g=t.padInfo.front,y=t.padInfo.top,b=t.padInfo.left;this.outputShape=t.outShape;var x="avg"===n,k="0.0";if(x||(k="-1.0 / 1e-20"),r){this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n        const ivec3 pads = ivec3(").concat(g,", ").concat(y,", ").concat(b,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(d,";\n              wD += ").concat(l,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(f,";\n                wR += ").concat(p,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(v,";\n                  wC += ").concat(h,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ").concat(">="," currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(a?i?"(((batch * ".concat(t.inDepth," + xD) * ").concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"((xD * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"wD * ".concat(f," * ").concat(v," +\n                      wR * ").concat(v," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var w="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"avg"===n&&(w="avgValue / max(count, 1.0)");var I=4*Math.floor(o/4),S=o%4,N="\n      if (".concat(x,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat("max","(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n      const ivec3 pads = ivec3(").concat(g,", ").concat(y,", ").concat(b,");\n      const float initializationValue = ").concat(k,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(k,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(d,";\n            wD += ").concat(l,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(f,";\n            wR += ").concat(p,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(I,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(h,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(h,", ch)\n              );\n\n              ").concat(N,"\n            }\n\n            int xC = xCCorner + ").concat(I,";\n            if (").concat(1===S,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(N,"\n            } else if (").concat(2===S,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(N,"\n            } else if (").concat(3===S,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(h,", ch),\n                initializationValue\n              );\n\n              ").concat(N,"\n            }\n          }\n        }\n        setOutput(").concat(w,");\n      }\n    ")}}));var tV={kernelName:gt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;lz(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;Aa.assert(vm.eitherStridesOrDilationsAreOne(o,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(1,"'")}));var c=vm.computePool2DInfo(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&Aa.arraysEqual(c.inShape,c.outShape))return WB({inputs:{x:a},backend:n});var l=new $W(c,"avg",!1);return n.runWebGLProgram(l,[a],"float32")}};var nV={kernelName:bt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat,l=vm.computePool3DInfo(a.shape,i,o,[1,1,1],s,u,c),p=new eV(l,"avg",!1);return n.runWebGLProgram(p,[a],"float32")}},rV=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=u-1-t.padInfo.top,p=c-1-t.padInfo.left,h=1/(n*r);this.userCode="\n      const ivec2 pads = ivec2(".concat(l,", ").concat(p,");\n      const float avgMultiplier = float(").concat(h,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(u,";\n            wR += ").concat(o,") {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(c,";\n            wC+= ").concat(s,") {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),aV=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,p=t.effectiveFilterDepth,h=t.effectiveFilterHeight,d=t.effectiveFilterWidth,f=p-1-t.padInfo.front,v=h-1-t.padInfo.top,g=d-1-t.padInfo.left,y=1/(n*r*a);this.userCode="\n      const ivec3 pads = ivec3(".concat(f,", ").concat(v,", ").concat(g,");\n      const float avgMultiplier = float(").concat(y,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(p,";\n            wD += ").concat(u,") {\n          float dyD = float(dyDCorner + wD) / ").concat(i,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(h,";\n              wR += ").concat(c,") {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(d,";\n                wC += ").concat(l,") {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var iV={kernelName:xt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=vm.computePool3DInfo(i.shape,o,s,[1,1,1],u,c),p=new aV(l);return n.runWebGLProgram(p,[a],i.dtype)}};var oV={kernelName:yt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;lz([a,i],"avgPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=vm.computePool2DInfo(o.shape,s,u,1,c),p=new rV(l);return n.runWebGLProgram(p,[a],o.dtype)}};var sV={kernelName:kt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;return xW({a:t.a,b:t.b,transposeA:r.transposeA,transposeB:r.transposeB,backend:n})}},uV=(0,v.Z)((function e(t,n,r,a,i,o){(0,m.Z)(this,e),this.outputShape=[],this.variableNames=["x","mean","variance"],vm.assertAndGetBroadcastShape(t,n),vm.assertAndGetBroadcastShape(t,r);var s="0.0";null!=a&&(vm.assertAndGetBroadcastShape(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";null!=i&&(vm.assertAndGetBroadcastShape(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(s,";\n        float scale = ").concat(u,";\n        float inv = scale * inversesqrt(variance + float(").concat(o,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")})),cV=(0,v.Z)((function e(t,n,r,a,i,o){(0,m.Z)(this,e),this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],vm.assertAndGetBroadcastShape(t,n),vm.assertAndGetBroadcastShape(t,r);var s="vec4(0.0)";null!=a&&(vm.assertAndGetBroadcastShape(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";null!=i&&(vm.assertAndGetBroadcastShape(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = ".concat(s,";\n        vec4 scale = ").concat(u,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(o,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")})),lV={kernelName:dn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.mean,o=t.variance,s=t.offset,u=t.scale;Aa.assert(i.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),Aa.assert(null==s||i.shape.length===s.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),Aa.assert(null==u||i.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var c=r.varianceEpsilon;null==c&&(c=.001);var l=[a,i,o],p=null;null!=s&&(p=s.shape,l.push(s));var h=null;null!=u&&(h=u.shape,l.push(u));var d=Qe().getBool("WEBGL_PACK_NORMALIZATION")?new cV(a.shape,i.shape,o.shape,p,h,c):new uV(a.shape,i.shape,o.shape,p,h,c);return n.runWebGLProgram(d,l,l[0].dtype)}},pV=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var n=_z(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var r,a=function(e){if(1===e)return"sourceLoc";if(e<=6)return hV.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank),i=t.map((function(e,t){return"sourceLoc.".concat(hV[t]," = start[").concat(t,"] + coords.").concat(hV[t],";")}));r="\n        ".concat(n," sourceLoc;\n        ").concat(n," coords = getOutputCoords();\n        ").concat(i.join("\n"),"\n      "),this.userCode="\n      void main() {\n        ".concat(r,"\n        setOutput(getSource(").concat(a,"));\n      }\n    ")})),hV=["x","y","z","w","u","v"];var dV=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var n=_z(this.rank),r=oB("coords",this.rank),a=oB("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2(".concat(a.slice(-2).join(),")"),o="getChannel(getSource(".concat(a.join(),"), ").concat(i,")"),s="\n      result.x = ".concat(o,";\n      if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n        ++").concat(a[this.rank-1],";\n        result.y = ").concat(o,";\n        --").concat(a[this.rank-1],";\n      }\n    "),u=1===this.rank?"":"\n      --".concat(r[this.rank-1],";\n      if (++").concat(r[this.rank-2]," < ").concat(t[this.rank-2],") {\n        ++").concat(a[this.rank-2],";\n        result.z = ").concat(o,";\n        if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n          ++").concat(a[this.rank-1],";\n          result.w = ").concat(o,";\n        }\n      }\n    "),c=this.rank<=4?"sourceLoc = coords +\n            ".concat(n,"(").concat(t.map((function(e,t){return"start[".concat(t,"]")})).join(),");"):t.map((function(e,t){return"".concat(a[t]," = ").concat(r[t]," + start[").concat(t,"];")})).join("\n");this.userCode="\n      void main() {\n        ".concat(n," coords = getOutputCoords();\n        ").concat(n," sourceLoc;\n        ").concat(c,"\n        vec4 result = vec4(0.);\n        ").concat(s,"\n        ").concat(u,"\n        setOutput(result);\n      }\n    ")}));function fV(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.size,s=Gf.parseSliceParams(a,i,o),u=(0,h.Z)(s,2),c=u[0],l=u[1];if(Gf.assertParamsValid(a,c,l),0===Aa.sizeFromShape(l))return n.makeTensorInfo(l,a.dtype,[]);if(n.shouldExecuteOnCPU([a])||"string"===a.dtype){var p=n.texData.get(a.dataId),d=HP(p.values,c,l,a.shape,a.dtype);return n.makeTensorInfo(l,a.dtype,d)}var f=n.texData.get(a.dataId).isPacked,m=Gf.isSliceContinous(a.shape,c,l);if(f||!m){var v=Qe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new dV(l):new pV(l),g=[c];return n.runWebGLProgram(v,[a],a.dtype,g)}return n.uploadToGPU(a.dataId),function(e,t,n,r){var a=r.texData.get(e.dataId),i=r.makeTensorInfo(n,e.dtype),o=r.texData.get(i.dataId);Object.assign(o,a),o.refCount=1,o.shape=n,o.dtype=e.dtype;var s=Gf.computeFlatOffset(t,Aa.computeStrides(e.shape));a.slice&&(s+=a.slice.flatOffset),o.slice={flatOffset:s,origDataId:a.slice&&a.slice.origDataId||e.dataId};var u=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,u+1),i}(a,c,l,n)}var mV={kernelName:Rr,backendName:"webgl",kernelFunc:fV},vV={kernelName:wt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;Aa.assert(a.shape.length<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=vm.getReshaped(a.shape,i,s),c=vm.getPermuted(u.length,i.length),l=vm.getReshapedPermuted(a.shape,i,s),p=vm.getSliceBeginCoords(o,i.length),h=vm.getSliceSize(l,o,i.length),d=[],f=sW({inputs:{x:a},backend:n,attrs:{shape:u}}),m=gW({inputs:{x:f},backend:n,attrs:{perm:c}}),v=sW({inputs:{x:m},backend:n,attrs:{shape:l}}),g=fV({inputs:{x:v},backend:n,attrs:{begin:p,size:h}});return d.push(f),d.push(m),d.push(v),d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}};var gV={kernelName:It,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=dP(s,u,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}};var yV={kernelName:Nt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.s0,a=t.s1,i=n.readSync(r.dataId),o=n.readSync(a.dataId),s=vm.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},bV=$B({opSnippet:"return float(a != b);",cpuKernelImpl:MP,dtype:"bool"}),xV={kernelName:$n,backendName:"webgl",kernelFunc:bV};function kV(e){var t=e.inputs,n=e.backend,r=t.input;return WB({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}var wV={kernelName:mr,backendName:"webgl",kernelFunc:kV},IV="return float(int(x));";var SV={kernelName:Tt,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=t.attrs,i=n.x,o=a.dtype;if("complex64"===o){if("complex64"===i.dtype)return WB({inputs:{x:i},backend:r});var s=bl(i.shape),u=e({inputs:{x:i},backend:r,attrs:{dtype:"float32"}}),c=UB({inputs:{real:u,imag:s},backend:r});return s.dispose(),r.disposeIntermediateTensorInfo(u),c}if("complex64"===i.dtype){var l=kV({inputs:{input:i},backend:r}),p=e({inputs:{x:l},backend:r,attrs:{dtype:o}});return r.disposeIntermediateTensorInfo(l),p}if(!Aa.hasEncodingLoss(i.dtype,o)){var d=WB({inputs:{x:i},backend:r});return{dataId:d.dataId,shape:d.shape,dtype:o}}if(r.shouldExecuteOnCPU([i])){var f=r.texData.get(i.dataId).values,m=mP(f,i.shape,i.dtype,o),v=(0,h.Z)(m,3),g=v[0],y=v[1],b=v[2];return r.makeTensorInfo(g,y,b)}if("int32"===o)return function(e,t){var n=new dB(e.shape,IV),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(i,r);if("bool"===o){var x=r.makeTensorInfo([],"bool",Aa.getTypedArrayFromDType("bool",1)),k=bV({inputs:{a:i,b:x},backend:r});return r.disposeIntermediateTensorInfo(x),k}throw new Error("Error in Cast: failed to cast ".concat(i.dtype," to ").concat(o))}},NV="return ceil(x);",TV=QB({opSnippet:NV,packedOpSnippet:NV,cpuKernelImpl:vP}),CV={kernelName:Ct,backendName:"webgl",kernelFunc:TV},_V=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "})),EV=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}));var AV={kernelName:_t,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.clipValueMin,s=a.clipValueMax;t=Qe().getBool("WEBGL_PACK_CLIP")?new EV(i.shape):new _V(i.shape);var u=[[o],[s]];return r.runWebGLProgram(t,[i],i.dtype,u)}},RV=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}));function FV(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}var ZV={kernelName:At,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n.texData.get(r.dataId),i=new RV(r.shape),o=[FV(r,a.complexTensorInfos.real),FV(r,a.complexTensorInfos.imag)];return n.runWebGLProgram(i,o,o[0].dtype)}},DV=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.outputShape=[],this.outputShape=vm.computeOutShape(t,1),this.variableNames=t.map((function(e,t){return"T".concat(t)}));var n=new Array(t.length-1);n[0]=t[0][1];for(var r=1;r<n.length;r++)n[r]=n[r-1]+t[r][1];for(var a=["if (yC < ".concat(n[0],") setOutput(getT0(yR, yC));")],i=1;i<n.length;i++){var o=n[i-1];a.push("else if (yC < ".concat(n[i],") setOutput(getT").concat(i,"(yR, yC-").concat(o,"));"))}var s=n.length,u=n[n.length-1];a.push("else setOutput(getT".concat(s,"(yR, yC-").concat(u,"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(a.join("\n        "),"\n      }\n    ")})),MV=(0,v.Z)((function e(t,n){(0,m.Z)(this,e),this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=vm.computeOutShape(t,n);var r=this.outputShape,a=r.length,i=_z(a),o=oB("coords",a),s=["x","y","z","w","u","v"].slice(0,a);this.variableNames=t.map((function(e,t){return"T".concat(t)}));var u=new Array(t.length-1);u[0]=t[0][n];for(var c=1;c<u.length;c++)u[c]=u[c-1]+t[c][n];for(var l=s[n],p=s.slice(-2),h=s.join(),d="if (".concat(l," < ").concat(u[0],") {\n        return getChannel(\n            getT0(").concat(h,"), vec2(").concat(p.join(),"));\n        }"),f=1;f<u.length;f++){var v=u[f-1];d+="\n        if (".concat(l," < ").concat(u[f],"  && ").concat(l," >= ").concat(u[f-1],") {\n          return getChannel(\n            getT").concat(f,"(").concat(OV(s,l,v),"),\n            vec2(").concat(OV(p,l,v),"));\n        }")}var g=u.length,y=u[u.length-1];d+="\n        return getChannel(\n          getT".concat(g,"(").concat(OV(s,l,y),"),\n          vec2(").concat(OV(p,l,y),"));"),this.userCode="\n      float getValue(".concat(s.map((function(e){return"int "+e})),") {\n        ").concat(d,"\n      }\n\n      void main() {\n        ").concat(i," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(o,"), 0., 0., 0.);\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," + 1;\n        if (").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.g = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-2]," = ").concat(o[a-2]," + 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2],") {\n          result.a = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," - 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2]," &&\n            ").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.b = getValue(").concat(o,");\n        }\n        setOutput(result);\n      }\n    ")}));function OV(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?"".concat(e," - ").concat(n):e})).join()}function LV(e){var t=e.inputs,n=e.backend,r=t.input;return WB({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}var zV={kernelName:xn,backendName:"webgl",kernelFunc:LV};function PV(e,t,n){var r=e[0].dtype;if("complex64"===r){var a=e.map((function(e){return kV({inputs:{input:e},backend:n})})),i=e.map((function(e){return LV({inputs:{input:e},backend:n})})),o=PV(a,t,n),s=PV(i,t,n),u=UB({inputs:{real:o,imag:s},backend:n});return a.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),i.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}var c=n.shouldExecuteOnCPU(e);if("string"===r&&(c=!0),c){var l=e.map((function(e){var r=[-1,Aa.sizeFromShape(e.shape.slice(t))];return sW({inputs:{x:e},backend:n,attrs:{shape:r}})})),p=l.map((function(e){return{vals:n.readSync(e.dataId),shape:e.shape}})),h=vm.computeOutShape(l.map((function(e){return e.shape})),1),d=1===l[0].shape[0],f=gP(p,h,r,d),m=vm.computeOutShape(e.map((function(e){return e.shape})),t),v=n.makeTensorInfo(m,r,f);return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),v}var g=e.filter((function(e){return Aa.sizeFromShape(e.shape)>0})),y=Qe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&g[0].shape.length>1;if(1===g.length){var b=y?new dB(e[0].shape,xB):new CB(e[0].shape,xB);return n.runWebGLProgram(b,e,r)}var x=Qe().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(g.length>x){for(var k=[],w=0;w<g.length;w+=x){var I=g.slice(w,w+x);k.push(PV(I,t,n))}for(var S=PV(k,t,n),N=0,T=k;N<T.length;N++){var C=T[N];n.disposeIntermediateTensorInfo(C)}return S}if(y){var _=new MV(g.map((function(e){return e.shape})),t);return n.runWebGLProgram(_,g,r)}var E=function(e,t,n){var r=vm.computeOutShape(e.map((function(e){return e.shape})),t);return{tensors2D:e.map((function(e){return sW({inputs:{x:e},attrs:{shape:[-1,Aa.sizeFromShape(e.shape.slice(t))]},backend:n})})),outShape:r}}(g,t,n),A=E.tensors2D,R=E.outShape,F=new DV(A.map((function(e){return e.shape}))),Z=n.runWebGLProgram(F,A,r);A.forEach((function(e){return n.disposeIntermediateTensorInfo(e)}));var D=sW({inputs:{x:Z},attrs:{shape:R},backend:n});return n.disposeIntermediateTensorInfo(Z),D}function BV(e){var t=e.inputs,n=e.backend,r=e.attrs.axis,a=Aa.parseAxisParam(r,t[0].shape)[0],i=t.map((function(e){return e.shape}));vm.assertParamsConsistent(i,a);var o=vm.computeOutShape(t.map((function(e){return e.shape})),a);if(0===Aa.sizeFromShape(o))return n.makeTensorInfo(o,t[0].dtype,[]);var s=t.filter((function(e){return Aa.sizeFromShape(e.shape)>0}));return 1===s.length?WB({inputs:{x:s[0]},backend:n}):PV(s,a,n)}var WV={kernelName:Rt,backendName:"webgl",kernelFunc:BV},VV=(0,v.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];(0,m.Z)(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,p=t.dilationWidth,h=t.filterHeight,d=t.filterWidth,f=4*Math.floor(t.inChannels/4),v=t.inChannels%4,g="channelsLast"===t.dataFormat,y=g?1:2,b=g?2:3,x=g?3:1,k="",w="";r&&(k=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),w="result = activation(result);");var I=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(k,"\n\n      const ivec2 strides = ivec2(").concat(u,", ").concat(c,");\n      const ivec2 pads = ivec2(").concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(x,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(y,"], coords[").concat(b,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(h,"; wR++) {\n          int xR = xRCorner + wR * ").concat(l,";\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(d,"; wC++) {\n            int xC = xCCorner + wC * ").concat(p,";\n\n            if (xC < 0 || xC >= ").concat(t.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(f,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(g,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===v,") {\n\n              if (").concat(g,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(f,") *\n                    getW(wR, wC, ").concat(f,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(f,", xR, xC) *\n                    getW(wR, wC, ").concat(f,", d2);\n              }\n\n            } else if (").concat(2===v,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(f,", d2),\n                getW(wR, wC, ").concat(f," + 1, d2)\n              );\n\n              if (").concat(g,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(f,"),\n                  getX(batch, xR, xC, ").concat(f," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(f,", xR, xC),\n                  getX(batch, ").concat(f," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===v,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(f,", d2),\n                getW(wR, wC, ").concat(f," + 1, d2),\n                getW(wR, wC, ").concat(f," + 2, d2)\n              );\n\n              if (").concat(g,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(f,"),\n                  getX(batch, xR, xC, ").concat(f," + 1),\n                  getX(batch, xR, xC, ").concat(f," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(f,", xR, xC),\n                  getX(batch, ").concat(f," + 1, xR, xC),\n                  getX(batch, ").concat(f," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(I,"\n        ").concat(w,"\n        setOutput(result);\n      }\n    ")})),UV=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.padInfo.front,r=t.padInfo.top,a=t.padInfo.left,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,p=t.filterDepth,h=t.filterHeight,d=t.filterWidth,f=4*Math.floor(t.inChannels/4),v=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(i,", ").concat(o,", ").concat(s,");\n      const ivec3 pads = ivec3(").concat(n,", ").concat(r,", ").concat(a,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(p,"; wF++) {\n          int xF = xFCorner + wF * ").concat(u,";\n\n          if (xF < 0 || xF >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(h,"; wR++) {\n            int xR = xRCorner + wR * ").concat(c,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(d,"; wC++) {\n              int xC = xCCorner + wC * ").concat(l,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(f,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===v,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(f,") *\n                  getW(wF, wR, wC, ").concat(f,", d2);\n              } else if (").concat(2===v,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(f,"),\n                  getX(batch, xF, xR, xC, ").concat(f," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(f,", d2),\n                  getW(wF, wR, wC, ").concat(f," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===v,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(f,"),\n                  getX(batch, xF, xR, xC, ").concat(f," + 1),\n                  getX(batch, xF, xR, xC, ").concat(f," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(f,", d2),\n                  getW(wF, wR, wC, ").concat(f," + 1, d2),\n                  getW(wF, wR, wC, ").concat(f," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),GV=(0,v.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];(0,m.Z)(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Dz(this.outputShape.length);for(var o=t.padInfo.left,s=t.strideWidth,u=t.dilationWidth,c=t.filterHeight,l=t.filterWidth,p=l,h="\n       int xR; int xC; int xCOffset;\n       vec4 wTexel; vec4 previous; vec4 final;",d=0;d<l;d++)h+="\n           vec4 xTexelC".concat(2*d,";\n           int xTexelC").concat(2*d,"Ready;\n           vec4 xTexelC").concat(2*d+1,";\n           int xTexelC").concat(2*d+1,"Ready;\n           vec4 xC").concat(d,";");h+="\n     for (int r = 0; r < ".concat(c,"; r++) {\n      for (int d1 = 0; d1 < ").concat(t.inChannels,"; d1 += 2) {\n       ");for(var f=0;f<l;f++)h+="\n           xTexelC".concat(2*f," = vec4(0.0);\n           xTexelC").concat(2*f,"Ready = 0;\n           xTexelC").concat(2*f+1," = vec4(0.0);\n           xTexelC").concat(2*f+1,"Ready = 0;\n           xC").concat(f," = vec4(0.0);");h+="\n         xR = xRCorner + r * dilations[0];\n         if (xR >=0 && xR < inDims[0]) {\n       ";for(var v=0;v<(p+1)/2;v++){var g=2*v;if(h+="\n           xC = xCCorner + ".concat(g*u,";\n           "),1===s){if(g<l&&(o%2===1?(h+="\n                 xCOffset = xC + 1;\n                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                   xTexelC").concat(g," = getX(batch, xR, xCOffset, d1);\n\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(g,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(g,"Ready = 1;\n                 }\n               "),h+=1===u&&g>0?"\n                 xC".concat(g," = vec4(xTexelC").concat(g-2,".zw, xTexelC").concat(g,".xy);\n                 "):"\n                   xCOffset = xC + 1 - 2;\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       previous.zw = vec2(0.0);\n                     }\n\n                     xC".concat(g," = vec4(previous.zw, xTexelC").concat(g,".xy);\n                   } else {\n                     xC").concat(g," = vec4(0.0, 0.0, xTexelC").concat(g,".xy);\n                   }\n                   ")):h+="\n                 if (xC >= 0 && xC < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                   xTexelC").concat(g," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(g,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(g,"Ready = 1;\n                 }\n\n                 xC").concat(g," = xTexelC").concat(g,";\n                 "),g+1<l)){var y=o%2===0?Aa.nearestLargerEven(u):u;u%2===0&&o%2===1||u%2!==0&&o%2!==1?(h+="\n                   xCOffset = xC + imod(pads[1], 2) + ".concat(y,";\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                     xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       xTexelC").concat(g+1,".zw = vec2(0.0);\n                     }\n                     xTexelC").concat(g+1,"Ready = 1;\n                   }\n                   "),h+=u>1?"\n                     xCOffset -= 2;\n                     if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                      previous = getX(batch, xR, xCOffset, d1);\n                      xC".concat(g+1," = vec4(previous.zw, xTexelC").concat(g+1,".xy);\n                     } else {\n                      xC").concat(g+1," = vec4(0.0, 0.0, xTexelC").concat(g+1,".xy);\n                     }\n                     "):"\n                     xC".concat(g+1," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".xy);\n                     ")):h+=1===y?"\n                     xC".concat(g+1," = xTexelC").concat(g,";\n                     "):"\n                     xCOffset = xC + ".concat(y,";\n\n                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                       xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n                       if (xCOffset + 1 >= inDims[1]) {\n                         xTexelC").concat(g+1,".zw = vec2(0.0);\n                       }\n                       xTexelC").concat(g+1,"Ready = 1;\n                     }\n\n                     xC").concat(g+1," = xTexelC").concat(g+1,";\n                     ")}}else g<l&&(o%2===1?(h+="\n                 xCOffset = xC + 1 - strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                   xTexelC").concat(g," = getX(batch, xR, xCOffset, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(g,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(g,"Ready = 1;\n                 }\n\n                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                   xTexelC").concat(g+1," = getX(batch, xR, xC + 1, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xC + 2 >= inDims[1]) {\n                     xTexelC").concat(g+1,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(g+1,"Ready = 1;\n                 }\n\n                 xC").concat(g," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".zw);\n               "),g+1<l&&(h+="\n                   final = vec4(0.0);\n                   xCOffset = xC + 1 + strides[1];\n                   if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                     final = getX(batch, xR, xCOffset, d1);\n                   }\n                   xC".concat(g+1," = vec4(xTexelC").concat(g+1,".xy, final.xy);\n                 "))):(h+="\n                 if(xC >= 0 && xC < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                   xTexelC").concat(g," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(g,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(g,"Ready = 1;\n                 }\n\n                 xCOffset = xC + strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                   xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(g+1,".zw = vec2(0.);\n                   }\n                   xTexelC").concat(g+1,"Ready = 1;\n                 }\n\n                 xC").concat(g," = vec4(\n                   xTexelC").concat(g,".xy, xTexelC").concat(g+1,".xy);\n               "),g+1<l&&(h+="\n                   xC".concat(g+1," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".zw);\n                 "))));g<l&&(h+="\n             wTexel = getW(r, ".concat(g,", d1, d2);\n             dotProd += xC").concat(g,".xxzz * vec4(wTexel.xy, wTexel.xy);\n             if(d1 + 1 < ").concat(t.inChannels,") {\n               dotProd += xC").concat(g,".yyww * vec4(wTexel.zw, wTexel.zw);\n             }\n           "),g+1<l&&(h+="\n               wTexel = getW(r, ".concat(g+1,", d1, d2);\n               dotProd += xC").concat(g+1,".xxzz * vec4(wTexel.xy, wTexel.xy);\n               if(d1 + 1 < ").concat(t.inChannels,") {\n                 dotProd += xC").concat(g+1,".yyww * vec4(wTexel.zw, wTexel.zw);\n               }\n             ")))}h+="\n     }\n   ",h+="\n     }\n   ",h+="\n     }\n   ";var b="",x="";r&&(b=a?"vec4 activation(vec4 a) {\n           vec4 b = getPreluActivationWeightsAtOutCoords();\n           ".concat(r,"\n         }"):i?"vec4 activation(vec4 a) {\n           vec4 b = getLeakyreluAlphaAtOutCoords();\n           ".concat(r,"\n         }"):"vec4 activation(vec4 x) {\n           ".concat(r,"\n         }"),x="result = activation(result);");var k=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n       ".concat(b,"\n\n       void main() {\n         ivec4 coords = getOutputCoords();\n         int batch = coords.x;\n         ivec2 xRCCorner = coords.yz * strides - pads;\n         int d2 = coords.w;\n         int xRCorner = xRCCorner.x;\n         int xCCorner = xRCCorner.y;\n\n         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n         vec4 dotProd = vec4(0.000000000000001);\n\n         ").concat(h,"\n\n         vec4 result = dotProd - vec4(0.000000000000001);\n         ").concat(k,"\n         ").concat(x,"\n         setOutput(result);\n       }\n     ")})),HV=(0,v.Z)((function e(t,n){(0,m.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=Dz(this.outputShape.length);for(var r=n.dataFormat,a=hz(),i="channelsLast"===r,o=i?1:2,s=i?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":"if(blockIndex < ".concat(t[2]," && pos < ").concat(t[1],") {"),c="",l=0;l<=1;l++)for(var p=0;p<=1;p++)c+="\n          blockIndex = rc.z + ".concat(p,";\n          pos = rc.y + ").concat(l,";\n\n          ").concat(u,"\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[").concat(o,"] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[").concat(s,"] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (").concat(i,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*l+p,"] = getChannel(\n                    getA(rc.x, d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*l+p,"] = getChannel(\n                    getA(rc.x, ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(c,"\n\n        ").concat(a.output," = result;\n      }\n    ")}));function jV(e,t){var n=e.length;return n>=3?[].concat((0,g.Z)(e.slice(0,-3)),t?[e[n-3]*e[n-2],e[n-1]]:[e[n-3],e[n-2]*e[n-1]]):!t&&1===n&&e[0]>1?[e[0],1]:null}function qV(e){var t,n=e.x,r=e.filter,a=e.convInfo,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,p=void 0===l?0:l,h=e.activation,d=void 0===h?null:h,f=n.shape,m=i.texData.get(n.dataId),v=a.inChannels,g=f[0]*f[1]*f[2],y=a.outChannels,b="channelsLast"===a.dataFormat,x=[];if(null!=c){var k=jV(c.shape,b);null!=k&&(c=sW({inputs:{x:c},backend:i,attrs:{shape:k}}),x.push(c))}if(null!=s){var w=jV(s.shape,b);null!=w&&(s=sW({inputs:{x:s},backend:i,attrs:{shape:w}}),x.push(s))}if((1!==g&&1!==y||!(v>bW))&&m.isPacked&&b&&null!=m.texture&&f[2]%2!==0&&Aa.arraysEqual(m.shape.slice(-3),f.slice(-3))){var I=f[0]*f[1]*(f[2]+1),S={dataId:n.dataId,shape:[1,I,a.inChannels],dtype:n.dtype},N=m.shape;m.shape=m.shape.slice(),m.shape[m.shape.length-2]++,Aa.assert(QL(m.shape,S.shape),(function(){return"packed reshape ".concat(m.shape," to ").concat(S.shape," isn't free")}));var T=sW({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}});x.push(T);var C=xW({a:S,b:T,backend:i,transposeA:!1,transposeB:false,bias:s,activation:d,preluActivationWeights:c,leakyreluAlpha:p}),_=i.texData.get(C.dataId);Aa.assert(_.isPacked,(function(){return"batchMatMul result is expected to be packed"})),m.shape=N,_.shape=a.outShape,(t=WB({inputs:{x:C},backend:i})).shape=a.outShape,x.push(C)}else{var E=a.outHeight*a.outWidth,A=sW({inputs:{x:n},backend:i,attrs:{shape:b?[a.batchSize,E,a.inChannels]:[a.batchSize,a.inChannels,E]}}),R=sW({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}}),F=xW({a:b?A:R,b:b?R:A,transposeA:!b,transposeB:false,backend:i,bias:s,activation:d,preluActivationWeights:c,leakyreluAlpha:p});t=sW({inputs:{x:F},backend:i,attrs:{shape:a.outShape}}),x.push(A),x.push(R),x.push(F)}for(var Z=0,D=x;Z<D.length;Z++){var M=D[Z];i.disposeIntermediateTensorInfo(M)}return t}function KV(e){var t=e.x,n=e.filter,r=e.convInfo,a=e.backend,i=e.bias,o=void 0===i?null:i,s=e.preluActivationWeights,u=void 0===s?null:s,c=e.leakyreluAlpha,l=void 0===c?0:c,p=e.activation,h=void 0===p?null:p,d=r.filterWidth,f=r.filterHeight,m=r.inChannels,v=r.outWidth,g=r.outHeight,y="channelsLast"===r.dataFormat,b=d*f*m,x=g*v,k=[r.batchSize,b,x],w=[];if(null!=u){var I=jV(u.shape,y);null!=I&&(u=sW({inputs:{x:u},backend:a,attrs:{shape:I}}),w.push(u))}if(null!=o){var S=jV(o.shape,y);null!=S&&(o=sW({inputs:{x:o},backend:a,attrs:{shape:S}}),w.push(o))}var N=sW({inputs:{x:n},backend:a,attrs:{shape:[1,b,Aa.sizeFromShape(n.shape)/b]}});w.push(N);var T=new HV(k,r),C=[t.shape,[r.padInfo.top,r.padInfo.left],[r.strideHeight,r.strideWidth],[r.dilationHeight,r.dilationWidth],[r.inChannels],[r.filterWidth*r.inChannels],[r.outWidth]],_=a.runWebGLProgram(T,[t],"float32",C),E=sW({inputs:{x:_},backend:a,attrs:{shape:k}});w.push(_),w.push(E);var A=null!=o,R=null!=u,F="leakyrelu"===h,Z=h?eW(h,!0):null,D=new tW(y?E.shape:N.shape,y?N.shape:E.shape,y?[r.batchSize,x,r.outChannels]:[r.batchSize,r.outChannels,x],!0,!1,A,Z,R,F),M=y?[E,N]:[N,E];if(o&&M.push(o),R&&M.push(u),F){var O=a.makeTensorInfo([],"float32",Aa.createScalarValue(l,"float32"));M.push(O),w.push(O)}var L=a.runWebGLProgram(D,M,"float32"),z=sW({inputs:{x:L},backend:a,attrs:{shape:r.outShape}});w.push(L);for(var P=0,B=w;P<B.length;P++){var W=B[P];a.disposeIntermediateTensorInfo(W)}return z}var XV={kernelName:Ft,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dataFormat,l=a.dilations,p=a.dimRoundingMode,h=vm.convertConv2DDataFormat(c),d=vm.computeConv2DInfo(i.shape,o.shape,s,l,u,p,!1,h);if(1!==d.filterHeight||1!==d.filterWidth||1!==d.dilationHeight||1!==d.dilationWidth||1!==d.strideHeight||1!==d.strideWidth||"SAME"!==d.padInfo.type&&"VALID"!==d.padInfo.type)if(d.strideWidth<=2&&"channelsLast"===h&&Qe().getBool("WEBGL_EXP_CONV")){var f=new GV(d),m=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];t=r.runWebGLProgram(f,[i,o],"float32",m)}else if(Qe().getBool("WEBGL_CONV_IM2COL"))t=KV({x:i,filter:o,convInfo:d,backend:r});else{var v=new VV(d);t=r.runWebGLProgram(v,[i,o],"float32")}else t=qV({x:i,filter:o,convInfo:d,backend:r});var g=sW({inputs:{x:t},backend:r,attrs:{shape:d.outShape}});return r.disposeIntermediateTensorInfo(t),g}},YV=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o="channelsLast"===t.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              if (").concat(o,") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),JV=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o="channelsLast"===t.dataFormat,s=n-1-t.padInfo.top,u=r-1-t.padInfo.left,c=o?1:2,l=o?2:3,p=o?3:1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(p,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(c,"], coords[").concat(l,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n\n              if (").concat(o,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),QV=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.padInfo.front,o=t.padInfo.top,s=t.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(t.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(n," - ").concat(i,";\n\n            if (xF < 0 || xF >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(r," - ").concat(o,";\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(a," - ").concat(s,";\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),$V=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=n-1-t.padInfo.front,c=r-1-t.padInfo.top,l=a-1-t.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3(".concat(u,", ").concat(c,", ").concat(l,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(n,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(i,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(t.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(n," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(r,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(r," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(a,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(a," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var eU={kernelName:Zt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape,p=vm.convertConv2DDataFormat(u),h=vm.computeConv2DInfo(a.shape,l,o,1,s,c,!1,p),d=new YV(h);return n.runWebGLProgram(d,[a,i],"float32")}};var tU={kernelName:Dt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode,p=vm.convertConv2DDataFormat(c),h=vm.computeConv2DInfo(o,i.shape,s,1,u,l,!1,p),d=new JV(h);return n.runWebGLProgram(d,[a,i],"float32")}};var nU={kernelName:Mt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=vm.computeConv3DInfo(a.shape,i.shape,o,u,s),l=new UV(c);return n.runWebGLProgram(l,[a,i],"float32")}};var rU={kernelName:Ot,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.filterShape,c=vm.computeConv3DInfo(a.shape,u,o,1,s),l=new QV(c);return n.runWebGLProgram(l,[a,i],"float32")}};var aU,iU={kernelName:Lt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.pad,s=r.strides,u=r.inputShape,c=vm.computeConv3DInfo(u,i.shape,s,1,o),l=new $V(c);return n.runWebGLProgram(l,[a,i],"float32")}},oU=QB({opSnippet:JB+"\n  return cos(x);\n"}),sU={kernelName:zt,backendName:"webgl",kernelFunc:oU},uU=QB({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),cU={kernelName:Pt,backendName:"webgl",kernelFunc:uU},lU=(0,v.Z)((function e(t,n,r,a,i){(0,m.Z)(this,e),this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=(0,h.Z)(t,4),s=o[0],u=o[1],c=o[2],l=o[3],p=(0,h.Z)(n,1)[0],d=(0,h.Z)(r,2),f=d[0],v=d[1];this.outputShape=[p,f,v,l];var g="bilinear"===a?1:0,y="".concat(u-1,".0"),b="".concat(c-1,".0"),x=f>1?["".concat((u-1)/(f-1)),"(y2-y1) * height_ratio","y1*".concat(y," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(y)],k=(0,h.Z)(x,3),w=k[0],I=k[1],S=k[2],N=v>1?["".concat((c-1)/(v-1)),"(x2-x1) * width_ratio","x1*".concat(b," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(b)],T=(0,h.Z)(N,3),C=T[0],_=T[1],E=T[2];this.userCode="\n      const float height_ratio = float(".concat(w,");\n      const float width_ratio = float(").concat(C,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(s,") {\n          return;\n        }\n\n        float height_scale = ").concat(I,";\n        float width_scale = ").concat(_,";\n\n        float in_y = ").concat(S,";\n        if( in_y < 0.0 || in_y > ").concat(y," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n        float in_x = ").concat(E,";\n        if( in_x < 0.0 || in_x > ").concat(b," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(g," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")})),pU={kernelName:Vt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,o=t.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=new lU(a.shape,i.shape,s,u,c);return n.runWebGLProgram(l,[a,i,o],"float32")}};!function(e){e.Prod="*",e.Sum="+"}(aU||(aU={}));var hU=(0,v.Z)((function e(t,n,r,a){(0,m.Z)(this,e),this.op=t,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];var i=this.outputShape.length,o=this.op===aU.Prod?"1.0":"0.0",s=r?o:"getX(".concat(dU(i,"coords",this.op),")"),u=this.outputShape[this.outputShape.length-1],c="",l="";r?(c=a?"end != ".concat(u-1):"end != 0",l=a?"end + 1":"end - 1"):(c=a?"end + pow2 < ".concat(u):"end >= pow2",l=a?"end + pow2":"end - pow2"),this.userCode="\n      void main() {\n        ".concat(_z(i)," coords = getOutputCoords();\n        int end = ").concat(fU(i,"coords",this.op),";\n        float val = ").concat(s,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(c,") {\n          int idx = ").concat(l,";\n          ").concat(fU(i,"coords",this.op)," = idx;\n          val ").concat(this.op,"= getX(").concat(dU(i,"coords",this.op),");\n        }\n        setOutput(val);\n      }\n    ")}));function dU(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function fU(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".y");if(3===e)return"".concat(t,".z");if(4===e)return"".concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function mU(e,t,n,r,a,i){var o=t.shape.length,s=vm.getAxesPermutation([r],o),u=t;null!=s&&(u=gW({inputs:{x:t},backend:n,attrs:{perm:s}}));var c=vm.getInnerMostAxes(1,o)[0];if(c!==o-1)throw new Error("WebGL cumprod shader expects an inner-most axis=".concat(t.shape.length-1," but got axis=").concat(r));for(var l=u.shape[c],p=WB({inputs:{x:u},backend:n}),h=0;h<=Math.ceil(Math.log2(l))-1;h++){var d=new hU(e,u.shape,!1,i),f=[[h]],m=p;p=n.runWebGLProgram(d,[p],p.dtype,f),n.disposeIntermediateTensorInfo(m)}if(a){var v=new hU(e,u.shape,a,i),g=p;p=n.runWebGLProgram(v,[p],p.dtype),n.disposeIntermediateTensorInfo(g)}if(null!=s){var y=gW({inputs:{x:p},backend:n,attrs:{perm:vm.getUndoAxesPermutation(s)}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(u),y}return p}var vU={kernelName:Bt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;return mU(aU.Prod,a,n,i,o,s)}};var gU={kernelName:Wt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;return mU(aU.Sum,a,n,i,o,s)}};var yU={kernelName:Ut,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=n.readSync(a.dataId),c=n.readSync(i.dataId),l=dP(u,c,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,l)}if(2===a.shape.length){var p=n.bufferSync(a),h=n.bufferSync(i),d=fP(p,h,o,s);return n.makeTensorInfo(d.shape,i.dtype,d.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank".concat(a.shape.length,"."))}},bU=function(){function e(t,n,r){(0,m.Z)(this,e),this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(n,";\n      int offset_h = imod(h, ").concat(n,");\n      int in_w = w / ").concat(n,";\n      int offset_w = imod(w, ").concat(n,");\n      int offset_d = (offset_h * ").concat(n," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}return(0,v.Z)(e,[{key:"getHeightCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}},{key:"getWidthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}},{key:"getDepthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}},{key:"getOutputDepthSize",value:function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}},{key:"getInputSamplingString",value:function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}]),e}();var xU={kernelName:Gt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat,s=a.shape[0],u=("NHWC"===o?a.shape[1]:a.shape[2])*i,c=("NHWC"===o?a.shape[2]:a.shape[3])*i,l=("NHWC"===o?a.shape[3]:a.shape[1])/(i*i),p=new bU("NHWC"===o?[s,u,c,l]:[s,l,u,c],i,o);return n.runWebGLProgram(p,[a],a.dtype)}},kU=(0,v.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];(0,m.Z)(this,e),this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Dz(this.outputShape.length);var o=t.filterHeight,s=t.filterWidth,u=t.outChannels/t.inChannels,c="",l="";r&&(c=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),l="result = activation(result);");var p=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(c,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(u,";\n        int q = d2 - d1 * ").concat(u,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(o,"; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(s,"; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(p,"\n        ").concat(l,"\n        setOutput(result);\n      }\n    ")})),wU=(0,v.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];(0,m.Z)(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Dz(this.outputShape.length);for(var o=t.outChannels/t.inChannels,s=t.padInfo.left,u=t.strideWidth,c=t.dilationWidth,l=t.filterHeight,p=t.filterWidth,h=p,d="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;",f=0;f<p;f++)d+="\n          vec4 xTexelC".concat(2*f,";\n          int xTexelC").concat(2*f,"Ready;\n          vec4 xTexelC").concat(2*f+1,";\n          int xTexelC").concat(2*f+1,"Ready;\n          vec4 xC").concat(f,";");d+="\n    for (int r = 0; r < ".concat(l,"; r++) {\n      ");for(var v=0;v<p;v++)d+="\n          xTexelC".concat(2*v," = vec4(0.0);\n          xTexelC").concat(2*v,"Ready = 0;\n          xTexelC").concat(2*v+1," = vec4(0.0);\n          xTexelC").concat(2*v+1,"Ready = 0;\n          xC").concat(v," = vec4(0.0);");d+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(var g=0;g<(h+1)/2;g++){var y=2*g;if(d+="\n          xC = xCCorner + ".concat(y*c,";\n          "),1===u){if(y<p&&(s%2===1?(d+="\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(y,"Ready == 0) {\n                  xTexelC").concat(y," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(y,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(y,"Ready = 1;\n                }\n              "),d+=1===c&&y>0?"\n                xC".concat(y," = vec4(xTexelC").concat(y-2,".zw, xTexelC").concat(y,".xy);\n                "):"\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC".concat(y," = vec4(previous.zw, xTexelC").concat(y,".xy);\n                  } else {\n                    xC").concat(y," = vec4(0.0, 0.0, xTexelC").concat(y,".xy);\n                  }\n                  ")):d+="\n                if (xC >= 0 && xC < inDims[1] && xTexelC".concat(y,"Ready == 0) {\n                  xTexelC").concat(y," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(y,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(y,"Ready = 1;\n                }\n\n                xC").concat(y," = xTexelC").concat(y,";\n                "),y+1<p)){var b=s%2===0?Aa.nearestLargerEven(c):c;c%2===0&&s%2===1||c%2!==0&&s%2!==1?(d+="\n                  xCOffset = xC + imod(pads[1], 2) + ".concat(b,";\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(y+1,"Ready == 0) {\n                    xTexelC").concat(y+1," = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC").concat(y+1,".zw = vec2(0.0);\n                    }\n                    xTexelC").concat(y+1,"Ready = 1;\n                  }\n                  "),d+=c>1?"\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n                     xC".concat(y+1," = vec4(previous.zw, xTexelC").concat(y+1,".xy);\n                    } else {\n                     xC").concat(y+1," = vec4(0.0, 0.0, xTexelC").concat(y+1,".xy);\n                    }\n                    "):"\n                    xC".concat(y+1," = vec4(xTexelC").concat(y,".zw, xTexelC").concat(y+1,".xy);\n                    ")):d+=1===b?"\n                    xC".concat(y+1," = xTexelC").concat(y,";\n                    "):"\n                    xCOffset = xC + ".concat(b,";\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(y+1,"Ready == 0) {\n                      xTexelC").concat(y+1," = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC").concat(y+1,".zw = vec2(0.0);\n                      }\n                      xTexelC").concat(y+1,"Ready = 1;\n                    }\n\n                    xC").concat(y+1," = xTexelC").concat(y+1,";\n                    ")}}else y<p&&(s%2===1?(d+="\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(y,"Ready == 0) {\n                  xTexelC").concat(y," = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(y,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(y,"Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(y+1,"Ready == 0) {\n                  xTexelC").concat(y+1," = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC").concat(y+1,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(y+1,"Ready = 1;\n                }\n\n                xC").concat(y," = vec4(xTexelC").concat(y,".zw, xTexelC").concat(y+1,".zw);\n              "),y+1<p&&(d+="\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC".concat(y+1," = vec4(xTexelC").concat(y+1,".xy, final.xy);\n                "))):(d+="\n                if(xC >= 0 && xC < inDims[1] && xTexelC".concat(y,"Ready == 0) {\n                  xTexelC").concat(y," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(y,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(y,"Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(y+1,"Ready == 0) {\n                  xTexelC").concat(y+1," = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(y+1,".zw = vec2(0.);\n                  }\n                  xTexelC").concat(y+1,"Ready = 1;\n                }\n\n                xC").concat(y," = vec4(\n                  xTexelC").concat(y,".xy, xTexelC").concat(y+1,".xy);\n              "),y+1<p&&(d+="\n                  xC".concat(y+1," = vec4(xTexelC").concat(y,".zw, xTexelC").concat(y+1,".zw);\n                "))));y<p&&(d+="\n            wTexel = getW(r, ".concat(y,", d1, q);\n            dotProd += xC").concat(y," * vec4(wTexel.xz, wTexel.xz);\n          "),y+1<p&&(d+="\n              wTexel = getW(r, ".concat(y+1,", d1, q);\n              dotProd += xC").concat(y+1," * vec4(wTexel.xz, wTexel.xz);\n            ")))}d+="\n    }\n  ",d+="\n      }\n    ";var x="",k="";r&&(x=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(r,"\n        }"),k="result = activation(result);");var w=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(x,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(o,";\n        int q = d2 - d1 * ").concat(o,";\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ").concat(d,"\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ").concat(w,"\n        ").concat(k,"\n        setOutput(result);\n      }\n    ")}));var IU={kernelName:Ht,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode,l=u;null==l&&(l=[1,1]),Aa.assert(vm.eitherStridesOrDilationsAreOne(o,l),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(l,"'")}));var p,h=vm.computeConv2DInfo(a.shape,i.shape,o,l,s,c,!0);p=Qe().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?new wU(h):new kU(h);var d=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return n.runWebGLProgram(p,[a,i],"float32",d)}},SU=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(o," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),NU=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=n-1-t.padInfo.top,s=r-1-t.padInfo.left,u=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(u,"; dm++) {\n              int d2 = d1 * ").concat(u," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var TU={kernelName:jt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape,p=vm.computeConv2DInfo(a.shape,l,o,s,u,c,!0),h=new SU(p);return n.runWebGLProgram(h,[a,i],"float32")}};var CU={kernelName:qt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.inputShape,p=vm.computeConv2DInfo(l,i.shape,o,s,u,c,!0),h=new NU(p);return n.runWebGLProgram(h,[a,i],"float32")}},_U=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}));var EU={kernelName:Kt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=[].concat((0,g.Z)(r.shape),(0,g.Z)(r.shape)),i=Aa.sizeFromShape(r.shape),o=sW({inputs:{x:r},backend:n,attrs:{shape:[i]}}),s=new _U(i),u=n.runWebGLProgram(s,[o],o.dtype),c=sW({inputs:{x:u},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),c}},AU=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.inHeight,r=t.inWidth,a=t.padInfo,i=t.strideHeight,o=t.strideWidth,s=t.filterHeight,u=t.filterWidth,c=t.dilationHeight,l=t.dilationWidth,p=a.top,h=a.left;this.userCode="\n      const ivec2 strides = ivec2(".concat(i,", ").concat(o,");\n      const ivec2 pads = ivec2(").concat(p,", ").concat(h,");\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ").concat(s,"; h++) {\n          int hIn = hBeg + h * ").concat(c,";\n\n          if (hIn >= 0 && hIn < ").concat(n,") {\n            for (int w = 0; w < ").concat(u,"; w++) {\n              int wIn = wBeg + w * ").concat(l,";\n\n              if (wIn >= 0 && wIn < ").concat(r,") {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    ")}));var RU={kernelName:Xt,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dilations,l=vm.computeDilation2DInfo(i.shape,o.shape,s,u,"NHWC",c),p=new AU(l),h=sW({inputs:{x:t=r.runWebGLProgram(p,[i,o],"float32")},backend:r,attrs:{shape:l.outShape}});return r.disposeIntermediateTensorInfo(t),h}};var FU={kernelName:$t,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.equation,a=t,i=vm.decodeEinsumEquation(r,a.length),o=i.allDims,s=i.summedDims,u=i.idDims;vm.checkEinsumDimSizes(o.length,u,a);for(var c=vm.getEinsumComputePath(s,u),l=c.path,p=c.steps,h=p.length,d=null,f=o.length,m=[],v=0;v<h;++v){var g,b=(0,y.Z)(p[v]);try{for(b.s();!(g=b.n()).done;){var x=g.value,k=vm.getEinsumPermutation(f,u[x]),w=k.permutationIndices,I=k.expandDims,S=void 0;vm.isIdentityPermutation(w)?S=a[x]:(S=gW({inputs:{x:a[x]},backend:n,attrs:{perm:w}}),m.push(S));for(var N=S.shape.slice(),T=0;T<I.length;++T)N.splice(I[T],0,1);Aa.arraysEqual(S.shape,N)||(S=sW({inputs:{x:S},backend:n,attrs:{shape:N}}),m.push(S)),null===d?d=S:(d=iW({inputs:{a:S,b:d},backend:n}),m.push(d))}}catch(A){b.e(A)}finally{b.f()}v<h-1&&(l[v]>=0&&(d=mW({inputs:{x:d},backend:n,attrs:{axis:l[v]-(o.length-f),keepDims:!1}}),m.push(d)),f--)}for(var C=0,_=m;C<_.length;C++){var E=_[C];E!==d&&n.disposeIntermediateTensorInfo(E)}return d}},ZU=QB({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),DU={kernelName:en,backendName:"webgl",kernelFunc:ZU},MU={kernelName:tn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y,i=Qe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new BB("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,a.shape):new zB("return (b >= 1.0) ? a : a * (b + 1.0);",r.shape,a.shape);return n.runWebGLProgram(i,[r,a],r.dtype)}},OU=$B({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:yP}),LU={kernelName:rn,backendName:"webgl",kernelFunc:OU},zU=QB({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '.concat(vm.ERF_P,";\n  float a1 = ").concat(vm.ERF_A1,";\n  float a2 = ").concat(vm.ERF_A2,";\n  float a3 = ").concat(vm.ERF_A3,";\n  float a4 = ").concat(vm.ERF_A4,";\n  float a5 = ").concat(vm.ERF_A5,";\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n")}),PU={kernelName:nn,backendName:"webgl",kernelFunc:zU},BU=QB({opSnippet:JB+"\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:bP,dtype:"float32"}),WU={kernelName:an,backendName:"webgl",kernelFunc:BU};function VU(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.dim,i=t.input,o=i.shape.length,s=i.shape.slice(),u=a;return a<0&&(Aa.assert(-(o+1)<=a,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+a+1),s.splice(u,0,1),sW({inputs:{x:i},backend:r,attrs:{shape:s}})}var UU={kernelName:on,backendName:"webgl",kernelFunc:VU},GU="return exp(x) - 1.0;",HU=QB({opSnippet:GU,packedOpSnippet:GU,cpuKernelImpl:xP}),jU={kernelName:sn,backendName:"webgl",kernelFunc:HU},qU=(0,v.Z)((function e(t,n,r){(0,m.Z)(this,e),this.variableNames=["real","imag"];var a=n[1];this.outputShape=n;var i,o=r?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),s=r?"".concat(a,".0"):"1.0";if("real"===t)i="return real * expR - imag * expI;";else{if("imag"!==t)throw new Error('FFT component must be either "real" or "imag", got '.concat(t,"."));i="return real * expI + imag * expR;"}this.userCode="\n      const float exponentMultiplier = ".concat(o,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(i,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(a,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(s,";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")}));function KU(e,t,n){var r=n.texData.get(e.dataId),a=Aa.sizeFromShape(e.shape),i=e.shape[e.shape.length-1],o=sW({inputs:{x:e},backend:n,attrs:{shape:[a/i,i]}}),s=o.shape,u=new qU("real",s,t),c=new qU("imag",s,t),l=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:s},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:s}],p=n.runWebGLProgram(u,l,"float32"),h=n.runWebGLProgram(c,l,"float32"),d=UB({inputs:{real:p,imag:h},backend:n});n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(h);var f=sW({inputs:{x:d},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(d),f}var XU={kernelName:un,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return KU(t.input,!1,n)}},YU=(0,v.Z)((function e(t,n){(0,m.Z)(this,e),this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}));function JU(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype;if("string"===(i=i||Aa.inferDtype(a))){var o=Aa.getArrayFromDType(i,Aa.sizeFromShape(r));return o.fill(a),t.makeTensorInfo(r,i,o)}var s=new YU(r,a),u=[[a]];return t.runWebGLProgram(s,[],i,u)}var QU,$U={kernelName:cn,backendName:"webgl",kernelFunc:JU},eG=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.variableNames=["Image"],this.outputShape=[];var n=t[2];this.outputShape=t,this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ".concat(n," - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ").concat(n,") {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")})),tG={kernelName:ln,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.image,a=n,i=new eG(r.shape);return a.runWebGLProgram(i,[r],r.dtype)}},nG="return floor(x);",rG=QB({opSnippet:nG,packedOpSnippet:nG,cpuKernelImpl:kP}),aG={kernelName:pn,backendName:"webgl",kernelFunc:rG},iG=$B({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),oG={kernelName:hn,backendName:"webgl",kernelFunc:iG},sG=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.variableNames=["A"];var n=hz(),r=(0,h.Z)(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(i,".0, ").concat(a,".0);\n\n        vec4 values = ").concat(n.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")})),uG=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=hz(),r=(0,h.Z)(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(i,".0, ").concat(a,".0);\n            vec4 values = ").concat(n.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),cG={kernelName:ha,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.pixels,i=r.numChannels,o="undefined"!=typeof HTMLVideoElement&&a instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&a instanceof HTMLImageElement,u=o?[a.videoWidth,a.videoHeight]:[a.width,a.height],c=(0,h.Z)(u,2),l=c[0],p=c[1],d=[p,l],f=[p,l,i];if(s||o){var m=Qe().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(null==QU||m!==lG)&&(lG=m,QU=document.createElement("canvas").getContext("2d",{willReadFrequently:lG})),QU.canvas.width=l,QU.canvas.height=p,QU.drawImage(a,0,0,l,p),a=QU.canvas}var v=n.makeTensorInfo(d,"int32");n.texData.get(v.dataId).usage=rL.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(v.dataId),a);var g=Qe().getBool("WEBGL_PACK")?new uG(f):new sG(f),y=n.runWebGLProgram(g,[v],"int32");return n.disposeData(v.dataId),y}},lG=Qe().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");var pG={kernelName:ma,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=n.bias,u=n.preluActivationWeights,c=a.strides,l=a.pad,p=a.dataFormat,h=a.dilations,d=a.dimRoundingMode,f=a.activation,m=a.leakyreluAlpha,v=vm.convertConv2DDataFormat(p),g=vm.computeConv2DInfo(i.shape,o.shape,c,h,l,d,!1,v),y=[],b=null!=s,x=null!=u,k="leakyrelu"===f,w=function(){var e=[i,o],t=function(e,t){if("NCHW"===t&&1===e.shape.length&&1!==e.shape[0]){var n=sW({inputs:{x:e},backend:r,attrs:{shape:[e.shape[0],1,1]}});return y.push(n),n}return e};if(b&&e.push(t(s,p)),x&&e.push(t(u,p)),k){var n=r.makeTensorInfo([],"float32",Aa.createScalarValue(m,"float32"));e.push(n),y.push(n)}return e};if(1!==g.filterHeight||1!==g.filterWidth||1!==g.dilationHeight||1!==g.dilationWidth||1!==g.strideHeight||1!==g.strideWidth||"SAME"!==g.padInfo.type&&"VALID"!==g.padInfo.type)if(g.strideWidth<=2&&"channelsLast"===v&&Qe().getBool("WEBGL_EXP_CONV")){var I=f?eW(f,!0):null,S=new GV(g,b,I,x,k),N=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],T=w();t=r.runWebGLProgram(S,T,"float32",N)}else if(Qe().getBool("WEBGL_CONV_IM2COL"))t=KV({x:i,filter:o,convInfo:g,backend:r,bias:s,activation:f,preluActivationWeights:u,leakyreluAlpha:m});else{var C=f?eW(f,!1):null,_=new VV(g,b,C,x,k),E=w();t=r.runWebGLProgram(_,E,"float32")}else t=qV({x:i,filter:o,convInfo:g,backend:r,bias:s,activation:f,preluActivationWeights:u,leakyreluAlpha:m});var A=sW({inputs:{x:t},backend:r,attrs:{shape:g.outShape}});return y.push(t),y.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),A}};var hG={kernelName:va,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dilations,p=r.dimRoundingMode,h=r.activation,d=r.leakyreluAlpha,f=[],m=l;null==m&&(m=[1,1]),Aa.assert(vm.eitherStridesOrDilationsAreOne(u,m),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(u," and dilations '").concat(m,"'")}));var v,g=vm.computeConv2DInfo(a.shape,i.shape,u,m,c,p,!0),y=Qe().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,b=h?eW(h,y):null,x=[a,i],k=null!=o,w=null!=s,I="leakyrelu"===h;if(k&&x.push(o),w&&x.push(s),I){var S=n.makeTensorInfo([],"float32",Aa.createScalarValue(d,"float32"));x.push(S),f.push(S)}v=y?new wU(g,k,b,w,I):new kU(g,k,b,w,I);var N=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],T=n.runWebGLProgram(v,x,"float32",N);return f.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),T}},dG=(0,v.Z)((function e(t,n,r,a){(0,m.Z)(this,e),this.sliceDim=t,this.strides=n,this.paramsShape=a,this.variableNames=["x","indices"],this.outputShape=r;for(var i=_z(r.length),o="\n    int index;",s=0;s<this.sliceDim;s++)o+="\n          index = round(getIndices(coords[0], ".concat(s,"));\n          out_of_bounds = out_of_bounds || index < 0;\n          out_of_bounds = out_of_bounds || index >= ").concat(this.paramsShape[s],";\n          flattenIndex += index * ").concat(this.strides[s],";");this.userCode="\n         void main() {\n          ".concat(i," coords = getOutputCoords();\n          int flattenIndex = 0;\n          bool out_of_bounds = false;\n\n          ").concat(o,"\n\n          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));\n        }\n      ")}));var fG={kernelName:mn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,i=a.shape,o=i[i.length-1],s=Aa.sizeFromShape(r.shape),u=vm.prepareAndValidate(r,a),c=(0,h.Z)(u,4),l=c[0],p=c[1],d=c[2],f=c[3],m=sW({inputs:{x:a},backend:n,attrs:{shape:[p,o]}}),v=sW({inputs:{x:r},backend:n,attrs:{shape:[Aa.sizeFromShape(r.shape)/d,d]}});if(n.shouldExecuteOnCPU([r,a])||"string"===r.dtype){var g=n.readSync(a.dataId),y=n.bufferSync(r),b=wP(g,y,r.dtype,p,o,d,f,r.shape,s);return n.makeTensorInfo(l,r.dtype,b.values)}var x=new dG(o,f,[p,d],r.shape),k=n.runWebGLProgram(x,[v,m],v.dtype),w=sW({inputs:{x:k},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(k),w}},mG=(0,v.Z)((function e(t,n){(0,m.Z)(this,e),this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;var r=_z(this.rank),a=function(e,t){for(var n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],a=0;a<e.length;a++)2===a?r.push("index"):r.push("".concat(n[a]));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(r," resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ").concat(t[2],") ? 1.0 : 0.0;\n        setOutput(inBounds * getA(").concat(a,"));\n      }\n    ")}));function vG(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims,u=Aa.parseAxisParam(o,a.shape)[0];if(Qe().get("DEBUG"))for(var c=n.readSync(i.dataId),l=a.shape[u],p=function(){var e=c[h];Aa.assert(e<=l-1&&e>=0,(function(){return"GatherV2: the index value ".concat(e," is not in [0, ").concat(l-1,"]")}))},h=0;h<c.length;++h)p();var d=vm.segment_util.collectGatherOpShapeInfo(a,i,u,s),f=Aa.sizeFromShape(i.shape),m=[],v=sW({inputs:{x:a},backend:n,attrs:{shape:[d.batchSize,d.outerSize,d.dimSize,d.sliceSize]}}),g=sW({inputs:{x:i},backend:n,attrs:{shape:[d.batchSize,f/d.batchSize]}});m.push(v),m.push(g);var y=[d.batchSize,d.outerSize,f/d.batchSize,d.sliceSize];if(n.shouldExecuteOnCPU([a,i])||"string"===a.dtype){var b=n.bufferSync(g),x=n.bufferSync(v),k=IP(x,b,y);return m.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(d.outputShape,k.dtype,k.values)}var w=new mG(v.shape,y),I=n.runWebGLProgram(w,[v,g],v.dtype);m.push(I);var S=sW({inputs:{x:I},backend:n,attrs:{shape:d.outputShape}});return m.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),S}var gG={kernelName:fn,backendName:"webgl",kernelFunc:vG},yG=$B({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:SP,dtype:"bool"}),bG={kernelName:vn,backendName:"webgl",kernelFunc:yG},xG=$B({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:NP}),kG={kernelName:gn,backendName:"webgl",kernelFunc:xG};var wG={kernelName:bn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return KU(t.input,!0,n)}},IG=QB({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),SG={kernelName:kn,backendName:"webgl",kernelFunc:IG},NG=QB({opSnippet:"return float(isinf(x));",dtype:"bool"}),TG={kernelName:wn,backendName:"webgl",kernelFunc:NG},CG=QB({opSnippet:"return float(isnan(x));",dtype:"bool"}),_G={kernelName:In,backendName:"webgl",kernelFunc:CG},EG=$B({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:TP,dtype:"bool"}),AG={kernelName:Nn,backendName:"webgl",kernelFunc:EG},RG=$B({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:CP,dtype:"bool"}),FG={kernelName:Tn,backendName:"webgl",kernelFunc:RG};var ZG={kernelName:Cn,backendName:"webgl",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.num,o=_P(r,a,i);return t.makeTensorInfo([o.length],"float32",o)}},DG=QB({opSnippet:JB+"\n  return x < 0.0 ? 0./0. : log(x);\n",packedOpSnippet:"\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",cpuKernelImpl:EP}),MG={kernelName:_n,backendName:"webgl",kernelFunc:DG},OG=QB({opSnippet:JB+"\n  return log(1.0 + x);\n"}),LG={kernelName:En,backendName:"webgl",kernelFunc:OG},zG=$B({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),PG={kernelName:An,backendName:"webgl",kernelFunc:zG},BG=QB({opSnippet:"return float(!(x >= 1.0));"}),WG={kernelName:Rn,backendName:"webgl",kernelFunc:BG},VG=$B({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),UG={kernelName:Fn,backendName:"webgl",kernelFunc:VG},GG=(0,v.Z)((function e(t,n,r,a,i){(0,m.Z)(this,e),this.variableNames=["x"],this.outputShape=[];var o=n,s=t[3]-1;this.outputShape=t;var u,c="float(".concat(r,") + float(").concat(a,") * sum");u=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(o,"; j <= ").concat(o,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(s,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(u,";\n        setOutput(val);\n      }\n    ")})),HG=(0,v.Z)((function e(t,n,r,a,i){(0,m.Z)(this,e),this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o=n,s=t[3]-1;this.outputShape=t;var u,c="float(".concat(r,") + float(").concat(a,") * sum");u=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(o,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(o,"; j <= ").concat(o,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(s,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(u,";\n        setOutput(result);\n      }\n    ")})),jG={kernelName:On,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta,c=Qe().getBool("WEBGL_PACK_NORMALIZATION")?new HG(a.shape,i,o,s,u):new GG(a.shape,i,o,s,u);return n.runWebGLProgram(c,[a],a.dtype)}},qG=(0,v.Z)((function e(t,n,r,a,i){(0,m.Z)(this,e),this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=r,this.alpha=a,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(n,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(n," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(a,") * norm + float(").concat(r,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(a,")\n                * float(").concat(i,")\n                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(i,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")})),KG={kernelName:Ln,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta,p=new qG(a.shape,s,u,c,l);return n.runWebGLProgram(p,[a,i,o],a.dtype)}};function XG(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reductionIndices,o=r.keepDims,s=a.shape.length,u=Aa.parseAxisParam(i,a.shape),c=u,l=vm.getAxesPermutation(c,s),p=null!=l,d=n.shouldExecuteOnCPU([a]),f=a;if(p){if(d){for(var m=n.texData.get(f.dataId).values,v=new Array(s),g=0;g<v.length;g++)v[g]=a.shape[l[g]];var y=rB(m,a.shape,a.dtype,l,v);f=n.makeTensorInfo(v,a.dtype),n.texData.get(f.dataId).values=y}else f=fW(a,l,n);c=vm.getInnerMostAxes(c.length,s)}vm.assertAxesAreInnerMostDims("max",c,s);var b,x=vm.computeOutAndReduceShapes(f.shape,c),k=(0,h.Z)(x,2),w=k[0],I=k[1],S=w;if(o&&(S=vm.expandShapeToKeepDim(w,u)),d){var N=n.texData.get(f.dataId).values,T=AP(N,Aa.sizeFromShape(I),S,a.dtype);b=n.makeTensorInfo(S,a.dtype),n.texData.get(b.dataId).values=T}else b=function(e,t,n,r){var a=Aa.sizeFromShape(t),i=sW({inputs:{x:e},attrs:{shape:[Aa.sizeFromShape(e.shape)/a,a]},backend:r}),o=pW(i,e.dtype,"max",r),s=sW({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(f,I,S,n);return p&&n.disposeIntermediateTensorInfo(f),b}var YG={kernelName:zn,backendName:"webgl",kernelFunc:XG},JG=$B({opSnippet:LB+"\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+PB+"\n  return result;\n",cpuKernelImpl:RP}),QG={kernelName:Pn,backendName:"webgl",kernelFunc:JG};var $G={kernelName:Bn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;lz(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;Aa.assert(vm.eitherStridesOrDilationsAreOne(o,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(1,"'")}));var c=vm.computePool2DInfo(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&Aa.arraysEqual(c.inShape,c.outShape))return WB({inputs:{x:a},backend:n});var l=new $W(c,"max",!1);return n.runWebGLProgram(l,[a],a.dtype)}};var eH={kernelName:Vn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=vm.computePool3DInfo(a.shape,i,o,[1,1,1],s,c,u),p=new eV(l,"max",!1);return n.runWebGLProgram(p,[a],a.dtype)}},tH=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideHeight,r=t.strideWidth,a=t.dilationHeight,i=t.effectiveFilterHeight,o=t.effectiveFilterWidth,s=i-1-t.padInfo.top,u=o-1-t.padInfo.left,c=i*o-1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(i,";\n          wR += ").concat(a,") {\n          float dyR = float(dyRCorner + wR) / ").concat(n,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(o,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(r,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(c," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(o," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),nH=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.dilationDepth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterDepth,c=t.effectiveFilterHeight,l=t.effectiveFilterWidth,p=u-1-t.padInfo.front,h=c-1-t.padInfo.top,d=l-1-t.padInfo.left,f=u*c*l-1;this.userCode="\n      const ivec3 pads = ivec3(".concat(p,", ").concat(h,", ").concat(d,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(u,";\n           wD += ").concat(i,") {\n          float dyD = float(dyDCorner + wD) / ").concat(n,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(c,";\n              wR += ").concat(o,") {\n            float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(l,";\n                wC += ").concat(s,") {\n              float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(f," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(c," * ").concat(l," +\n                  wR * ").concat(l," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var rH={kernelName:Un,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=vm.computePool3DInfo(i.shape,o,s,[1,1,1],u,c),p=new eV(l,"max",!0),h=n.runWebGLProgram(p,[i],i.dtype),d=new nH(l),f=n.runWebGLProgram(d,[a,h],i.dtype);return n.disposeIntermediateTensorInfo(h),f}};var aH={kernelName:Wn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;lz([i,t.output],"maxPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,p=vm.computePool2DInfo(o.shape,s,u,1,c,l),h=new $W(p,"max",!0),d=n.runWebGLProgram(h,[o],o.dtype),f=new tH(p),m=n.runWebGLProgram(f,[a,d],o.dtype);return n.disposeIntermediateTensorInfo(d),m}};var iH={kernelName:Gn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.includeBatchInIndex,c=r;Aa.assert(4===a.shape.length,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(a.shape.length,".")}));var l=[1,1];Aa.assert(vm.eitherStridesOrDilationsAreOne(o,l),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(l,"'")}));var p=vm.computePool2DInfo(a.shape,i,o,l,s),d=function(e,t,n,r){var a=new $W(n,"max",!1),i=r.runWebGLProgram(a,[e],"float32");return a=new $W(n,"max",!0,!0,t),[i,r.runWebGLProgram(a,[e],"float32")]}(a,u,p,c),f=(0,h.Z)(d,2);return[f[0],f[1]]}};var oH={kernelName:Hn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.keepDims,o=n.axis,s=r,u=a.shape.length,c=Aa.parseAxisParam(o,a.shape),l=c,p=vm.getAxesPermutation(l,u),d=null!=p,f=s.shouldExecuteOnCPU([a]),m=[],v=a;if(d){if(f){for(var g=s.texData.get(v.dataId).values,y=new Array(u),b=0;b<y.length;b++)y[b]=a.shape[p[b]];var x=rB(g,a.shape,a.dtype,p,y);v=s.makeTensorInfo(y,a.dtype),s.texData.get(v.dataId).values=x}else v=fW(a,p,s);m.push(v),l=vm.getInnerMostAxes(l.length,u)}vm.assertAxesAreInnerMostDims("sum",l,u);var k=vm.computeOutAndReduceShapes(v.shape,l),w=(0,h.Z)(k,2),I=w[0],S=w[1],N=I;i&&(N=vm.expandShapeToKeepDim(I,c));for(var T=function(e,t,n,r){var a=Aa.sizeFromShape(t),i=sW({inputs:{x:e},attrs:{shape:[Aa.sizeFromShape(e.shape)/a,a]},backend:r}),o=pW(i,"float32","mean",r),s=sW({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(v,S,N,s),C=0,_=m;C<_.length;C++){var E=_[C];s.disposeIntermediateTensorInfo(E)}return T}};var sH={kernelName:jn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=Aa.parseAxisParam(i,a.shape),c=u,l=vm.getAxesPermutation(c,s),p=a;null!=l&&(p=gW({inputs:{x:a},backend:n,attrs:{perm:l}}),c=vm.getInnerMostAxes(c.length,a.shape.length)),vm.assertAxesAreInnerMostDims("min",c,s);var d,f=vm.computeOutAndReduceShapes(p.shape,c),m=(0,h.Z)(f,2),v=m[0],g=m[1],y=sW({inputs:{x:p},backend:n,attrs:{shape:[-1,Aa.sizeFromShape(g)]}}),b=pW(y,y.dtype,"min",n);return d=sW(o?{inputs:{x:b},backend:n,attrs:{shape:vm.expandShapeToKeepDim(v,u)}}:{inputs:{x:b},backend:n,attrs:{shape:v}}),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(b),null!=l&&n.disposeIntermediateTensorInfo(p),d}},uH=$B({opSnippet:LB+"\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+PB+"\n  return result;\n",cpuKernelImpl:FP}),cH={kernelName:qn,backendName:"webgl",kernelFunc:uH},lH=(0,v.Z)((function e(t,n,r){(0,m.Z)(this,e),this.variableNames=["x"],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=_z(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),c="reflect"===r?0:1;this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        for (int i = 0; i < ").concat(a,"; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ").concat(c,";\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ").concat(c,";\n          }\n        }\n        ").concat(i," coords = outC - start;\n        setOutput(getX(").concat(u,"));\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ").concat(c,";\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ").concat(c,";\n          }\n          setOutput(getX(outC - start));\n        }\n      ")})),pH=(0,v.Z)((function e(t,n,r){(0,m.Z)(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=_z(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=oB("rc",a),c=oB("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),p=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),h="reflect"===r?0:1,d="";if(1===a){var f="\n        ".concat(i," source = rc;\n        if (source < start) {\n          source = start * 2 - source - ").concat(h,";\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ").concat(h,";\n        }\n        source -= start;\n      ");d="\n        ".concat(i," rc = outputLoc;\n        ").concat(f,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(f,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        }\n      ")}else{var v="\n        ".concat(i," source = rc;\n        ").concat(i," lt = ").concat(i,"(lessThan(source, start));\n        ").concat(i," gte = ").concat(i,"(greaterThanEqual(source, end));\n        ").concat(i," orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ").concat(h,") +\n                gte * ((end - 1) * 2 - source + ").concat(h,");\n        source -= start;\n      ");d="\n        ".concat(i," rc = outputLoc;\n        ").concat(v,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(v,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        }\n        rc = outputLoc;\n        ").concat(u[a-2]," += 1;\n        if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {\n          ").concat(v,"\n          result[2] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n          ").concat(u[a-1]," += 1;\n          if(").concat(l,") {\n            ").concat(v,"\n            result[3] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n          }\n        }\n      ")}this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(d,"\n        setOutput(result);\n      }\n    ")})),hH={kernelName:Kn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode,s=Qe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new pH(a.shape,i,o):new lH(a.shape,i,o);return n.runWebGLProgram(s,[a],a.dtype)}},dH=$B({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  bvec4 isNaN = equal(b, vec4(0.0));\n  "+PB+"\n  return result;\n"}),fH={kernelName:Xn,backendName:"webgl",kernelFunc:dH},mH=(0,v.Z)((function e(t,n,r){(0,m.Z)(this,e),this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,r],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(n-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(n-1,"));\n      }\n    ")})),vH=$B({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),gH={kernelName:Qt,backendName:"webgl",kernelFunc:vH},yH="return a - b;",bH=$B({opSnippet:yH,packedOpSnippet:yH,supportsComplex:!0,cpuKernelImpl:eB}),xH={kernelName:$r,backendName:"webgl",kernelFunc:bH};function kH(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.dim,o=Aa.parseAxisParam([i],a.shape),s=XG({inputs:{x:a},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),u=vm.expandShapeToKeepDim(s.shape,o),c=sW({inputs:{x:s},backend:n,attrs:{shape:u}}),l=bH({inputs:{a:a,b:c},backend:n}),p=BU({inputs:{x:l},backend:n}),h=mW({inputs:{x:p},backend:n,attrs:{axis:o,keepDims:!1}}),d=sW({inputs:{x:h},backend:n,attrs:{shape:u}}),f=vH({inputs:{a:p,b:d},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),f}var wH={kernelName:Wr,backendName:"webgl",kernelFunc:kH};var IH={kernelName:Yn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized,u=s?a:kH({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),c=u.shape[0],l=u.shape[1],p=new mH(c,l,i),h=[[o]],d=n.runWebGLProgram(p,[u],"int32",h);return s||n.disposeIntermediateTensorInfo(u),d}},SH=fB+"\n  return -x;\n",NH="\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n";var TH={kernelName:Qn,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])){var i=r.texData.get(a.dataId),o=DP(i.values,a.shape,a.dtype),s=(0,h.Z)(o,2),u=s[0],c=s[1];return r.makeTensorInfo(c,a.dtype,u)}return t=Qe().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new CB(a.shape,NH):new dB(a.shape,SH),r.runWebGLProgram(t,[a],a.dtype)}},CH=wv.nonMaxSuppressionV3Impl;var _H={kernelName:er,backendName:"webgl",kernelFunc:function(e){vm.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=n.readSync(a.dataId),l=n.readSync(i.dataId),p=CH(c,l,o,s,u).selectedIndices;return n.makeTensorInfo([p.length],"int32",new Int32Array(p))}},EH=wv.nonMaxSuppressionV4Impl;var AH={kernelName:tr,backendName:"webgl",kernelFunc:function(e){vm.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize,l=n.readSync(a.dataId),p=n.readSync(i.dataId),h=EH(l,p,o,s,u,c),d=h.selectedIndices,f=h.validOutputs;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}},RH=wv.nonMaxSuppressionV5Impl;var FH={kernelName:nr,backendName:"webgl",kernelFunc:function(e){vm.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma,l=n.readSync(a.dataId),p=n.readSync(i.dataId),h=RH(l,p,o,s,u,c),d=h.selectedIndices,f=h.selectedScores;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([f.length],"float32",new Float32Array(f))]}},ZH=(0,v.Z)((function e(t,n,r,a){(0,m.Z)(this,e),this.variableNames=["indices"],this.outputShape=[t,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(a,"), float(").concat(r,"),\n                      float(index == coords.y)));\n      }\n    ")})),DH={kernelName:ar,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.dtype,o=r.depth,s=r.onValue,u=r.offValue,c=Aa.sizeFromShape(a.shape),l=new ZH(c,o,s,u),p=sW({inputs:{x:a},backend:n,attrs:{shape:[c]}}),h=n.runWebGLProgram(l,[p],i);n.disposeIntermediateTensorInfo(p);var d=sW({inputs:{x:h},backend:n,attrs:{shape:[].concat((0,g.Z)(a.shape),[o])}});return n.disposeIntermediateTensorInfo(h),d}};function MH(e){var t=e.inputs,n=e.backend,r=t.x;if("complex64"===r.dtype){var a=kV({inputs:{input:r},backend:n}),i=MH({inputs:{x:a},backend:n}),o=LV({inputs:{input:r},backend:n}),s=MH({inputs:{x:o},backend:n}),u=UB({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return JU({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}var OH={kernelName:la,backendName:"webgl",kernelFunc:MH};var LH={kernelName:rr,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===a.dtype){var i=kV({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=LV({inputs:{input:a},backend:r}),u=MH({inputs:{x:s},backend:r}),c=UB({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return JU({attrs:{shape:a.shape,dtype:a.dtype,value:1},backend:r})}};var zH={kernelName:ir,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return VU({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){Aa.assertShapesMatch(a,e.shape,"All tensors passed to stack must have matching shapes"),Aa.assert(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=BV({inputs:t.map((function(e){var t=VU({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),s}},PH=(0,v.Z)((function e(t,n,r){(0,m.Z)(this,e),this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=_z(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ").concat(i," coords = outC - start;\n          setOutput(getX(").concat(u,"));\n        }\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")})),BH=(0,v.Z)((function e(t,n,r){(0,m.Z)(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));for(var a=t.length,i=_z(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=oB("rc",a),c=oB("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),p=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),h=["".concat(i," rc = outputLoc;"),"".concat(u[a-1]," += 1;\n       if(").concat(l,") {\n      "),1===a?"":"}\n       rc = outputLoc;\n       ".concat(u[a-2]," += 1;\n       if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {"),1===a?"":"  ".concat(u[a-1]," += 1;\n         if(").concat(l,") {")],d=1===a?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",f="",v=0,g=1===a?2:4;v<g;v++)f+="\n        ".concat(h[v],"\n        if (").concat(d,") {\n          result[").concat(v,"] = float(value);\n        } else {\n          ").concat(i," source = rc - start;\n          result[").concat(v,"] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        }\n      ");f+=1===a?"} ":"}}",this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(f,"\n        setOutput(result);\n      }\n    ")})),WH=function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue;if(0===Aa.sizeFromShape(a.shape))return JU({backend:n,attrs:{shape:i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),value:o,dtype:a.dtype}});var s=Qe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new BH(a.shape,i,o):new PH(a.shape,i,o),u=[[o]];return n.runWebGLProgram(s,[a],a.dtype,u)},VH={kernelName:or,backendName:"webgl",kernelFunc:WH},UH=$B({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  bvec4 isNaN1 = lessThan(a, vec4(0.0));\n  bvec4 isNaN2 = lessThan(floor(b), b);\n  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);\n  "+PB+"\n  return result;\n"}),GH={kernelName:ur,backendName:"webgl",kernelFunc:UH};var HH={kernelName:lr,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.axis,s=a.keepDims,u=i.shape.length,c=[],l=Aa.parseAxisParam(o,i.shape),p=l,d=vm.getAxesPermutation(p,u),f=i;if(null!=d&&(f=gW({inputs:{x:i},backend:r,attrs:{perm:d}}),p=vm.getInnerMostAxes(p.length,u),c.push(f)),vm.assertAxesAreInnerMostDims("prod",p,u),r.shouldExecuteOnCPU([f])){var m=r.texData.get(f.dataId).values,v=OP(f.shape,f.dtype,m,p),g=v.outVals,y=v.outShape,b=v.outDtype;t=r.makeTensorInfo(y,b,g)}else{var x=vm.computeOutAndReduceShapes(f.shape,p),k=(0,h.Z)(x,2),w=k[0],I=k[1],S=Aa.sizeFromShape(I),N=sW({inputs:{x:f},backend:r,attrs:{shape:[-1,S]}}),T=pW(N,Ii(i.dtype),"prod",r);t=sW({inputs:{x:T},backend:r,attrs:{shape:w}}),c.push(N),c.push(T)}if(s){c.push(t);var C=vm.expandShapeToKeepDim(t.shape,l);t=sW({inputs:{x:t},backend:r,attrs:{shape:C}})}return c.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),t}};var jH={kernelName:pr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.paramsNestedSplits,i=t.paramsDenseValues,o=t.indices,s=r.outputRaggedRank,u=a.map((function(e){return n.readSync(e.dataId)})),c=a.map((function(e){return e.shape})),l=n.readSync(i.dataId),p=n.readSync(o.dataId),d=LP(u,c,l,i.shape,i.dtype,p,o.shape,s),f=(0,h.Z)(d,3),m=f[0],v=f[1],g=f[2],y=m.map((function(e){return n.makeTensorInfo([e.length],"int32",e)})),b=n.makeTensorInfo(g,i.dtype,v);return y.concat([b])}};var qH={kernelName:hr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.starts,a=t.limits,i=t.deltas,o=n.readSync(r.dataId),s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=zP(o,r.shape,r.dtype,s,a.shape,u,i.shape),l=(0,h.Z)(c,2),p=l[0],d=l[1];return[n.makeTensorInfo([p.length],"int32",p),n.makeTensorInfo([d.length],r.dtype,d)]}};var KH={kernelName:dr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.shape,i=t.values,o=t.defaultValue,s=t.rowPartitionTensors,u=r.rowPartitionTypes,c=n.readSync(a.dataId),l=n.readSync(i.dataId),p=n.readSync(o.dataId),d=s.map((function(e){return n.readSync(e.dataId)})),f=s.map((function(e){return e.shape})),m=PP(c,a.shape,l,i.shape,i.dtype,p,o.shape,d,f,u),v=(0,h.Z)(m,2),g=v[0],y=v[1];return n.makeTensorInfo(g,i.dtype,y)}},XH=function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.step,o=n.dtype,s=BP(r,a,i,o);return t.makeTensorInfo([s.length],o,s)},YH={kernelName:fr,backendName:"webgl",kernelFunc:XH},JH=QB({opSnippet:"return 1.0 / x;"}),QH={kernelName:vr,backendName:"webgl",kernelFunc:JH},$H=QB({opSnippet:fB+"\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),ej={kernelName:gr,backendName:"webgl",kernelFunc:$H},tj=QB({opSnippet:fB+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),nj={kernelName:Ir,backendName:"webgl",kernelFunc:tj},rj=(0,v.Z)((function e(t,n,r,a,i){(0,m.Z)(this,e),this.variableNames=["A"],this.outputShape=[];var o=(0,h.Z)(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var p,d=[a&&n>1?u-1:u,a&&r>1?c-1:c],f=[a&&n>1?n-1:n,a&&r>1?r-1:r];p=i?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(d[0]/f[0],",\n          ").concat(d[1]/f[1],");\n      const vec2 inputShapeRC = vec2(").concat(u,".0, ").concat(c,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(p,";\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")})),aj=(0,v.Z)((function e(t,n,r,a,i){(0,m.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=(0,h.Z)(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var p,d=[a&&n>1?u-1:u,a&&r>1?c-1:c],f=[a&&n>1?n-1:n,a&&r>1?r-1:r];p=i?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(d[0]/f[0],",\n          ").concat(d[1]/f[1],",\n          ").concat(d[1]/f[1],");\n      const vec3 inputShapeRC = vec3(").concat(u,".0, ").concat(c,".0,\n                                     ").concat(c,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(p,";\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(l-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")}));var ij={kernelName:kr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size,u=(0,h.Z)(s,2),c=u[0],l=u[1],p=Qe().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new aj(a.shape,c,l,i,o):new rj(a.shape,c,l,i,o);return n.runWebGLProgram(p,[a],"float32")}},oj=(0,v.Z)((function e(t,n,r){(0,m.Z)(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=(0,h.Z)(n,3),i=a[1],o=a[2],s=(0,h.Z)(t,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],p=[r&&u>1?u-1:u,r&&c>1?c-1:c],d=l[0]/p[0],f=l[1]/p[1],v=1/d,g=1/f,y=2*Math.ceil(v)+2,b=2*Math.ceil(g)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(d,");\n        const float widthScale = float(").concat(f,");\n\n        const float invHeightScale = float(").concat(v,");\n        const float invWidthScale = float(").concat(g,");\n\n        const int winHeight = int(").concat(y,");\n        const int winWidth = int(").concat(b,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(i-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(o-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}));var sj={kernelName:wr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new oj(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},uj=(0,v.Z)((function e(t,n,r,a,i){(0,m.Z)(this,e),this.variableNames=["A"],this.outputShape=[];var o=(0,h.Z)(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var p,d=[a&&n>1?u-1:u,a&&r>1?c-1:c],f=[a&&n>1?n-1:n,a&&r>1?r-1:r],v=a?"0.5":"0.0";p=i?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(d[0]/f[0],",\n          ").concat(d[1]/f[1],");\n      const vec2 inputShapeRC = vec2(").concat(u,".0, ").concat(c,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(p,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(v,")));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")})),cj=(0,v.Z)((function e(t,n,r,a,i){(0,m.Z)(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=(0,h.Z)(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var p,d=[a&&n>1?u-1:u,a&&r>1?c-1:c],f=[a&&n>1?n-1:n,a&&r>1?r-1:r],v=a?"0.5":"0.0";p=i?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(d[0]/f[0],",\n          ").concat(d[1]/f[1],",\n          ").concat(d[1]/f[1],");\n      const vec3 inputShapeRC = vec3(").concat(u,".0, ").concat(c,".0,\n                                     ").concat(c,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(p,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(v,")));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(l-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    ")}));var lj={kernelName:br,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size,u=(0,h.Z)(s,2),c=u[0],l=u[1],p=Qe().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new cj(a.shape,c,l,i,o):new uj(a.shape,c,l,i,o);return n.runWebGLProgram(p,[a],a.dtype)}},pj=(0,v.Z)((function e(t,n,r){(0,m.Z)(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=(0,h.Z)(n,3),i=a[1],o=a[2],s=(0,h.Z)(t,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],p=[r&&u>1?u-1:u,r&&c>1?c-1:c],d=l[0]/p[0],f=l[1]/p[1],v=1/d,g=1/f,y=2*Math.ceil(v)+2,b=2*Math.ceil(g)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(d,");\n        const float widthScale = float(").concat(f,");\n\n        const float invHeightScale = float(").concat(v,");\n        const float invWidthScale = float(").concat(g,");\n\n        const int winHeight = int(").concat(y,");\n        const int winWidth = int(").concat(b,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(l[0],") *\n                (float(dyR) / float(").concat(p[0],"));\n\n            float sourceFracCol =\n                float(").concat(l[1],") *\n                  (float(dyC) / float(").concat(p[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(i,") - 1),\n                ").concat(r," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(o,") - 1),\n                ").concat(r," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}));var hj={kernelName:xr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new pj(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},dj=(0,v.Z)((function e(t,n){(0,m.Z)(this,e),this.variableNames=["x"];var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));if(this.outputShape=t,1!==r){var a=t.map((function(e,r){return function(e){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - coords[").concat(e,"] - 1"):"coords[".concat(e,"]")}(r)})).join(","),i=_z(r);this.userCode="\n      void main() {\n        ".concat(i," coords = getOutputCoords();\n        setOutput(getX(").concat(a,"));\n      }\n    ")}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(t[0]," - coord - 1));\n        }\n      ")})),fj=(0,v.Z)((function e(t,n){(0,m.Z)(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));this.outputShape=t;var a,i=oB("rc",r),o="".concat(i[r-1]," + 1 < ").concat(this.outputShape[r-1]),s="".concat(i[r-2]," + 1 < ").concat(this.outputShape[r-2]),u=_z(r);function c(e){var r=t.map((function(r,a){return function(e,r){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - ").concat(r[e]," - 1"):"".concat(r[e])}(a,e)})),a=r.join(","),i=r.slice(-2).join(",");return"getChannel(getX(".concat(a,"), vec2(").concat(i,"))")}this.userCode=1===r?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(t[0]," - rc - 1),\n            ").concat(t[0]," - rc - 1);\n          if(").concat(o,"){\n              result.g = getChannel(getX(").concat(t[0]," - (rc  + 1) - 1),\n                ").concat(t[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(u," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat((a=i.slice(),c(a)),";\n          if(").concat(o,"){\n            result.g = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",c(e)}(i.slice()),";\n          }\n          if(").concat(s,") {\n            result.b = ").concat(function(e){return e[r-2]="("+e[r-2]+" + 1)",c(e)}(i.slice()),";\n            if(").concat(o,") {\n              result.a = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",e[r-2]="("+e[r-2]+" + 1)",c(e)}(i.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")}));var mj={kernelName:Sr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims,o=a.shape.length,s=Aa.parseAxisParam(i,a.shape);if(0===o)return WB({inputs:{x:a},backend:n});var u=Qe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new fj(a.shape,s):new dj(a.shape,s);return n.runWebGLProgram(u,[a],a.dtype)}},vj=(0,v.Z)((function e(t,n){(0,m.Z)(this,e),this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];var r=t[1],a=t[2];this.outputShape=t;var i="";i="number"==typeof n?"float outputValue = ".concat(n.toFixed(2),";"):"\n        vec3 fill = vec3(".concat(n.join(","),");\n        float outputValue = fill[coords[3]];"),this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ".concat(i,"\n          if(coordX >= 0 && coordX < ").concat(a," && coordY >= 0 && coordY < ").concat(r,") {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")})),gj={kernelName:da,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=n.radians,o=n.fillValue,s=n.center,u=r,c=new vj(a.shape,o),l=vm.getImageCenter(s,a.shape[1],a.shape[2]),p=(0,h.Z)(l,2),d=[[p[0],p[1],Math.sin(i),Math.cos(i)]];return u.runWebGLProgram(c,[a],a.dtype,d)}},yj=QB({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),bj={kernelName:Nr,backendName:"webgl",kernelFunc:yj},xj=QB({opSnippet:"return inversesqrt(x);",cpuKernelImpl:WP}),kj={kernelName:Tr,backendName:"webgl",kernelFunc:xj},wj=(0,v.Z)((function e(t,n,r,a,i,o){(0,m.Z)(this,e),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=_z(i.length),u=_z(o.length),c="";1===r?c="i":2===r&&(c="i, j");var l="getIndices(".concat(c,")"),p="";1===a?p="i":2===a&&(p="i, coords[1]");var h="getUpdates(".concat(p,")"),d=n>1?"strides[j]":"strides";this.userCode="\n        ".concat(s," strides = ").concat(s,"(").concat(i,");\n\n        void main() {\n          ").concat(u," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(t,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(n,"; j++) {\n              int index = round(").concat(l,");\n              flattenedIndex += index * ").concat(d,";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ").concat(h,";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      ")}));var Ij={kernelName:Cr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=vm.calculateShapes(i,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,p=s.strides,h=s.outputSize,d=[h/l,l];if(0===h)return n.makeTensorInfo(o,a.dtype);var f=sW({inputs:{x:a},backend:n,attrs:{shape:[c,u]}}),m=sW({inputs:{x:i},backend:n,attrs:{shape:[c,l]}}),v=n.makeTensorInfo([],"float32",new Float32Array([0])),g=new wj(c,u,f.shape.length,m.shape.length,p,d),y=n.runWebGLProgram(g,[m,f,v],m.dtype),b=sW({inputs:{x:y},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(v),b}},Sj=(0,v.Z)((function e(t,n,r,a){(0,m.Z)(this,e),this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,r];var i="for (int i = 0; i < ".concat(Math.ceil(Math.log2(n+1)),"; ++i) { if (left >= right) break;"),o=2===Qe().getNumber("WEBGL_VERSION")?"while (left < right) {":i,s="left"===a?"<":"<=";this.userCode="\n       int findBound(int batch, float value) {\n         int left = 0;\n         int right = numInputs;\n         int mid;\n         ".concat(o,"\n           mid = (left + right) / 2;\n           if (getSortedSequence(batch, mid) ").concat(s," value) {\n             left = mid + 1;\n           } else {\n             right = mid;\n           }\n         }\n         return right;\n       }\n\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int valueIndex = coords[1];\n\n         float value = getValues(batch, valueIndex);\n\n         setOutput(float(findBound(batch, value)));\n       }\n     ")}));var Nj={kernelName:_r,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sortedSequence,i=t.values,o=r.side,s=new Sj(a.shape[0],a.shape[1],i.shape[1],o),u=[[a.shape[1]]];return n.runWebGLProgram(s,[a,i],"int32",u)}},Tj=(0,v.Z)((function e(t,n,r){var a,i;if((0,m.Z)(this,e),this.variableNames=["c","a","b"],this.outputShape=n,r>4)throw Error("Where for rank ".concat(r," is not yet supported"));if(1===r)i="resRC",a="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<n.length;c++)u.push("".concat(o[c])),c<t&&s.push("".concat(o[c]));a=s.join(),i=u.join()}var l=_z(r);this.userCode="\n      void main() {\n        ".concat(l," resRC = getOutputCoords();\n        float cVal = getC(").concat(a,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(i,"));\n        } else {\n          setOutput(getB(").concat(i,"));\n        }\n      }\n    ")}));var Cj={kernelName:Er,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e,o=new Tj(r.shape.length,a.shape,a.shape.length);return n.runWebGLProgram(o,[r,a,i],wi(a.dtype,i.dtype))}},_j=QB({opSnippet:"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ".concat(vm.SELU_SCALEALPHA,";\n  float scale = ").concat(vm.SELU_SCALE,";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n")}),Ej={kernelName:Ar,backendName:"webgl",kernelFunc:_j},Aj=QB({opSnippet:JB+"\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:UP}),Rj={kernelName:Mr,backendName:"webgl",kernelFunc:Aj},Fj=QB({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),Zj={kernelName:Dr,backendName:"webgl",kernelFunc:Fj},Dj=QB({opSnippet:JB+"\n  return sin(x);\n"}),Mj={kernelName:Fr,backendName:"webgl",kernelFunc:Dj},Oj=QB({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),Lj={kernelName:Zr,backendName:"webgl",kernelFunc:Oj},zj=QB({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),Pj={kernelName:Or,backendName:"webgl",kernelFunc:zj},Bj={kernelName:Pr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings;Aa.assert(a.shape.length<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=[[0,0]];u.push.apply(u,(0,g.Z)(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=[],p=WH({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),h=vm.getReshaped(p.shape,i,s,!1),d=vm.getPermuted(h.length,i.length,!1),f=vm.getReshapedPermuted(p.shape,i,s,!1),m=sW({inputs:{x:p},backend:n,attrs:{shape:h}}),v=gW({inputs:{x:m},backend:n,attrs:{perm:d}}),y=sW({inputs:{x:v},backend:n,attrs:{shape:f}});return l.push(p),l.push(m),l.push(v),l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),y}};var Wj={kernelName:Vr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.indices,a=t.values,i=t.denseShape,o=t.defaultValue;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n         ".concat(i.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n         ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n         ".concat(a.shape));if(0!==o.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(o.shape));var s=n.readSync(r.dataId),u=n.readSync(a.dataId),c=n.readSync(i.dataId),l=n.readSync(o.dataId)[0],p=jP(s,r.shape,r.dtype,u,a.dtype,c,l),d=(0,h.Z)(p,5),f=d[0],m=d[1],v=d[2],g=d[3],y=d[4];return[n.makeTensorInfo(m,r.dtype,f),n.makeTensorInfo([m[0]],a.dtype,v),n.makeTensorInfo([g.length],"bool",new Uint8Array(g.map((function(e){return Number(e)})))),n.makeTensorInfo([y.length],r.dtype,new Int32Array(y))]}};var Vj={kernelName:Ur,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.inputIndices,a=t.inputShape,i=t.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(n.readSync(a.dataId)),s=n.readSync(r.dataId),u=Array.from(n.readSync(i.dataId)),c=qP(s,r.shape,r.dtype,o,u),l=(0,h.Z)(c,3),p=l[0],d=l[1],f=l[2];return[n.makeTensorInfo(d,r.dtype,p),n.makeTensorInfo([f.length],i.dtype,new Int32Array(f))]}};var Uj={kernelName:Gr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n              ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n              ".concat(i.shape));var o=n.readSync(r.dataId),s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=KP(o,r.shape,r.dtype,s,u,!0),l=(0,h.Z)(c,2),p=l[0],d=l[1];return n.makeTensorInfo(d,r.dtype,p)}};var Gj={kernelName:Hr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n             ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n             ".concat(i.shape));var o=n.readSync(r.dataId),s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=KP(o,r.shape,r.dtype,s,u),l=(0,h.Z)(c,2),p=l[0],d=l[1];return n.makeTensorInfo(d,r.dtype,p)}};var Hj={kernelName:jr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sparseIndices,i=t.sparseValues,o=t.defaultValue,s=r.outputShape,u=vm.calculateShapes(i,a,s),c=u.sliceRank,l=u.numUpdates,p=u.sliceSize,h=u.strides,d=u.outputSize;if("string"===i.dtype){var f=n.bufferSync(a),m=n.bufferSync(i),v=Aa.decodeString(n.readSync(o.dataId)[0]),g=VP(f,m,s,d,p,l,c,h,v,false);return n.makeTensorInfo(s,g.dtype,g.values)}var y=new wj(l,c,a.shape.length,i.shape.length,h,[d,1],false),b=n.runWebGLProgram(y,[i,a,o],i.dtype),x=sW({inputs:{x:b},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(b),x}};var jj={kernelName:Br,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.numOrSizeSplits,o=r.axis,s=Aa.parseAxisParam(o,a.shape)[0],u=vm.prepareSplitSize(a,i,s),c=a.shape.length,l=new Array(c).fill(0),p=a.shape.slice();return u.map((function(e){var t=(0,g.Z)(p);t[s]=e;var r=fV({inputs:{x:a},backend:n,attrs:{begin:l,size:t}});return l[s]+=e,r}))}},qj="return sqrt(x);",Kj=QB({opSnippet:qj,packedOpSnippet:qj,cpuKernelImpl:XP}),Xj={kernelName:Lr,backendName:"webgl",kernelFunc:Kj},Yj=QB({opSnippet:"return x * x;"}),Jj={kernelName:Kr,backendName:"webgl",kernelFunc:Yj},Qj="return (a - b) * (a - b);",$j=$B({opSnippet:Qj,packedOpSnippet:Qj}),eq={kernelName:qr,backendName:"webgl",kernelFunc:$j};var tq={kernelName:pa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=fB+"\n    return x > 0.0 ? 1.0 : float(".concat(n.alpha,");\n  "),o=new dB(a.shape,i);return r.runWebGLProgram(o,[a],a.dtype)}},nq=(0,v.Z)((function e(t,n,r){(0,m.Z)(this,e),this.variableNames=["x"],this.outputShape=r;var a=r.length,i=_z(r.length),o=_z(r.length),s="";if(1===a)s="coords * strides + begin";else{var u=0;s=r.map((function(e,t){return u++,1===r.length?"coords * strides[".concat(t,"] + begin[").concat(t,"]"):"coords[".concat(u-1,"] * strides[").concat(t,"] + begin[").concat(t,"]")})).join(",")}this.userCode="\n      ".concat(i," begin = ").concat(i,"(").concat(t,");\n      ").concat(i," strides = ").concat(i,"(").concat(n,");\n\n      void main() {\n        ").concat(o," coords = getOutputCoords();\n        setOutput(getX(").concat(s,"));\n      }\n    ")}));var rq={kernelName:Xr,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.begin,s=a.end,u=a.strides,c=a.beginMask,l=a.endMask,p=a.ellipsisMask,h=a.newAxisMask,d=a.shrinkAxisMask,f=Gf.sliceInfo(i.shape,o,s,u,c,l,p,h,d),m=f.finalShapeSparse,v=f.finalShape,g=f.isIdentity,y=f.sliceDim0,b=f.isSimpleSlice,x=f.begin,k=f.end,w=f.strides;if(g)t=sW({inputs:{x:i},backend:r,attrs:{shape:v}});else if(y||b){Aa.assert(i.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(i.shape.length)}));var I=Gf.computeOutShape(x,k,w),S=fV({inputs:{x:i},backend:r,attrs:{begin:x,size:I}});t=sW({inputs:{x:S},backend:r,attrs:{shape:v}}),r.disposeIntermediateTensorInfo(S)}else if(r.shouldExecuteOnCPU([i])){var N=r.readSync(i.dataId),T=us(i.shape,i.dtype,N),C=YP(m,T,w,x);t=r.makeTensorInfo(v,i.dtype,C.values)}else{var _=new nq(x,w,m);t=r.runWebGLProgram(_,[i],i.dtype)}var E=sW({inputs:{x:t},backend:r,attrs:{shape:v}});return r.disposeIntermediateTensorInfo(t),E}};var aq={kernelName:Yr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=r.separator,i=r.nGramWidths,o=r.leftPad,s=r.rightPad,u=r.padWidth,c=r.preserveShortSequences,l=t.data,p=t.dataSplits,d=n.readSync(l.dataId),f=n.readSync(p.dataId),m=JP(d,f,a,i,o,s,u,c),v=(0,h.Z)(m,2),g=v[0],y=v[1];return[n.makeTensorInfo([g.length],"string",g),n.makeTensorInfo(p.shape,"int32",y)]}};var iq={kernelName:Jr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.skipEmpty,a=t.input,i=t.delimiter;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error("Input must be a vector, got shape: ".concat(a.shape));if(0!==i.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(i.shape));var o=n.readSync(a.dataId),s=n.readSync(i.dataId)[0],u=QP(o,s,r),c=(0,h.Z)(u,3),l=c[0],p=c[1],d=c[2],f=p.length;return[n.makeTensorInfo([f,2],"int32",l),n.makeTensorInfo([f],"string",p),n.makeTensorInfo([2],"int32",new Int32Array(d))]}};var oq={kernelName:Qr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.numBuckets,a=t.input;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");var i=n.readSync(a.dataId),o=$P(i,r);return n.makeTensorInfo(a.shape,"int32",o)}},sq=QB({opSnippet:"return tan(x);"}),uq={kernelName:ea,backendName:"webgl",kernelFunc:sq},cq=QB({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"}),lq={kernelName:ta,backendName:"webgl",kernelFunc:cq},pq=(0,v.Z)((function e(t,n){(0,m.Z)(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[a]*n[a];this.outputShape=r,this.rank=r.length;var i=_z(this.rank),o=function(e){var t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],a=0;a<e.length;a++)r.push("imod(".concat(n[a],", ").concat(e[a],")"));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(i," resRC = getOutputCoords();\n        setOutput(getA(").concat(o,"));\n      }\n    ")}));function hq(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;if("string"===a.dtype||a.shape.length>5){var o=n.readSync(a.dataId),s="string"===a.dtype?o.map((function(e){return Aa.decodeString(e)})):o,u=us(a.shape,a.dtype,s),c=tB(u,i);return n.makeTensorInfo(c.shape,c.dtype,c.values)}var l=new pq(a.shape,i);return n.runWebGLProgram(l,[a],a.dtype)}var dq={kernelName:na,backendName:"webgl",kernelFunc:hq},fq=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "})),mq=(0,v.Z)((function e(t){(0,m.Z)(this,e),this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "}));function vq(e,t){null!==t&&e.disposeIntermediateTensorInfo(t)}function gq(e){for(var t=1;t<e;)t*=2;return t}var yq={kernelName:ra,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,o=r.sorted,s=Qe().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=Qe().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=a.shape,l=c[c.length-1];if(n.shouldExecuteOnCPU([a])||l<s||i>u){var p=n.readSync(a.dataId),d=nB(p,c,a.dtype,i,o),f=(0,h.Z)(d,2),m=f[0],v=f[1];return[n.makeTensorInfo(m.shape,m.dtype,m.values),n.makeTensorInfo(v.shape,v.dtype,v.values)]}if(0===i)return c[c.length-1]=0,[n.makeTensorInfo(c,a.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(1===l)return[a,JU({attrs:{shape:c,dtype:"int32",value:0},backend:n})];var g=n.texData.get(a.dataId),y=null!==g&&g.isPacked,b=y?n.unpackTensor(a):a,x=Aa.sizeFromShape(c)/l,k=sW({inputs:{x:b},attrs:{shape:[x,l]},backend:n});y&&vq(n,b);for(var w=gq(i),I=gq(l),S=null,N=function(){return null===S?[k,k]:[k,S]},T=function(e,t,r){var a=N(),i=new fq(r),o=[[l],[null===S?1:0],[Number.NEGATIVE_INFINITY],[e],[t]],s=S;S=n.runWebGLProgram(i,a,"int32",o),vq(n,s)},C=1;C<w;C*=2)for(var _=2*C,E=C;E>=1;E/=2)T(_,E,[x,I]);for(var A=I;A>w;A/=2){var R=N(),F=new mq([x,A/2]),Z=[[l],[null===S?1:0],[w]],D=S;S=n.runWebGLProgram(F,R,"int32",Z),vq(n,D);for(var M=w/2,O=2*M,L=M;L>=1;L/=2)T(O,L,S.shape)}var z=S;S=fV({inputs:{x:S},backend:n,attrs:{begin:0,size:[x,i]}}),vq(n,z);var P=vG({inputs:{x:k,indices:S},backend:n,attrs:{axis:1,batchDims:1}});vq(n,k);var B=c.slice(0,-1);B.push(i),z=S,S=sW({inputs:{x:S},attrs:{shape:B},backend:n}),vq(n,z);var W=P;return P=sW({inputs:{x:P},attrs:{shape:B},backend:n}),vq(n,W),[P,S]}},bq=(0,v.Z)((function e(t,n,r,a,i,o){(0,m.Z)(this,e),this.variableNames=["Image","Transforms"],this.outputShape=o;var s,u="nearest"===r?1:2;switch(a){case"constant":default:s=1;break;case"reflect":s=2;break;case"wrap":s=3;break;case"nearest":s=4}this.userCode="\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(".concat(s," == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ").concat(t," && 0 <= coordX && coordX < ").concat(n,") {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(").concat(i,");\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(").concat(i,");\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(").concat(n,"));\n                float mapY = mapCoord(inY, float(").concat(t,"));\n\n                if (").concat(u," == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        ")}));var xq={kernelName:aa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.transforms,o=r.interpolation,s=r.fillMode,u=r.fillValue,c=r.outputShape,l=(0,h.Z)(a.shape,4),p=l[0],d=l[1],f=l[2],m=l[3],v=null!=c?c:[d,f],g=(0,h.Z)(v,2),y=g[0],b=g[1],x=new bq(d,f,o,s,u,[p,y,b,m]);return n.runWebGLProgram(x,[a,i],"float32")}};var kq={kernelName:oa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;lz(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var o=r.readSync(i.dataId),s=aB(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[r.makeTensorInfo(c,i.dtype,u),r.makeTensorInfo([l.length],"int32",l)]}};var wq={kernelName:sa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a,s=o.shape.length,u=a.shape[i],c=new Array(s-1),l=0,p=0;p<s;p++)p!==i&&(c[l++]=o.shape[p]);var h=[],d=new Array(s).fill(0),f=o.shape.slice();f[i]=1;for(var m=new Array(u),v=0;v<m.length;v++){d[i]=v;var g=fV({inputs:{x:o},backend:n,attrs:{begin:d,size:f}}),y=sW({inputs:{x:g},backend:n,attrs:{shape:c}});m[v]=y,h.push(g)}return h.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),m}},Iq=(0,v.Z)((function e(t,n){(0,m.Z)(this,e),this.variableNames=["x","segmentIds"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.numSegments,s=o*Math.ceil(i/r);this.outputShape=[a,s];var u=4*Math.floor(r/4),c=r%4,l="\n        sumValue += dot(values, segFilter);\n    ",p="";i%r>0&&(p="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      "));var h="";i%r>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat("0.0",";\n\n      float getValue(int batch, int inIdx) {\n        ").concat(p,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(h,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(o,")) * float(").concat(r,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(o,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(u,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(u,";\n        if (").concat(1===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(l,"\n        } else if (").concat(2===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(l,"\n        } else if (").concat(3===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(l,"\n        }\n        setOutput(").concat("sumValue",");\n      }\n    ")}));for(var Sq,Nq,Tq,Cq={kernelName:ua,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.segmentIds,o=r.numSegments,s=a.shape.length,u=[],c=0,l=vm.getAxesPermutation([c],s),p=a;null!=l&&(p=gW({inputs:{x:a},backend:n,attrs:{perm:l}}),u.push(p),c=vm.getInnerMostAxes(1,s)[0]);var h=vm.segment_util.computeOutShape(p.shape,c,o),d=Aa.sizeFromShape([p.shape[c]]),f=sW({inputs:{x:p},backend:n,attrs:{shape:[-1,d]}});u.push(f);var m=sW({inputs:{x:function e(t,r,a,i,o){var s=t.shape[0],c=t.shape[1],l=vm.segment_util.segOpComputeOptimalWindowSize(c,o),p=new Iq({windowSize:l,inSize:c,batchSize:s,numSegments:o},r),h=n.compileAndRun(p,[t,a],i);if(u.push(h),h.shape[1]===o)return h;var d=XH({backend:n,attrs:{start:0,stop:o,step:1,dtype:"float32"}}),f=hq({inputs:{x:d},backend:n,attrs:{reps:[c/l]}});return u.push(d),u.push(f),e(h,r,f,i,o)}(f,"unsortedSegmentSum",i,Ii(a.dtype),o)},backend:n,attrs:{shape:h}}),v=m;if(null!=l){u.push(m);var g=vm.getUndoAxesPermutation(l);v=gW({inputs:{x:v},backend:n,attrs:{perm:g}})}return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),v}},_q=0,Eq=[kW,IW,NW,CW,AW,ZW,DW,MW,WW,VW,GW,jW,KW,YW,QW,tV,nV,iV,oV,sV,lV,vV,gV,yV,SV,CV,AV,GB,ZV,WV,XV,eU,tU,nU,rU,iU,sU,cU,pU,vU,gU,yU,xU,IU,TU,CU,EU,RU,FU,DU,MU,LU,PU,WU,UU,jU,XU,$U,tG,aG,oG,cG,pG,hG,fG,gG,bG,kG,VB,wG,zV,SG,TG,_G,qB,AG,FG,ZG,MG,LG,PG,WG,UG,jG,KG,YG,QG,$G,eH,rH,aH,iH,oH,sH,cH,hH,fH,IH,oW,TH,_H,AH,FH,xV,DH,LH,zH,VH,GH,YB,HH,jH,qH,KH,YH,wV,gH,QH,ej,nj,uW,ij,sj,lj,hj,mj,gj,bj,kj,Ij,Nj,Cj,Ej,Rj,Zj,Mj,Lj,mV,wH,Pj,Bj,Wj,Vj,Uj,Gj,Hj,jj,Xj,Jj,eq,tq,rq,aq,iq,oq,xH,vW,uq,lq,dq,yq,xq,yW,kq,wq,Cq,OH];_q<Eq.length;_q++){Sa(Eq[_q])}!function(e){e[e.float32=0]="float32",e[e.int32=1]="int32",e[e.bool=2]="bool",e[e.string=3]="string",e[e.complex64=4]="complex64"}(Sq||(Sq={})),function(e){e[e.linear=0]="linear",e[e.relu=1]="relu",e[e.relu6=2]="relu6",e[e.prelu=3]="prelu",e[e.leakyrelu=4]="leakyrelu",e[e.sigmoid=5]="sigmoid",e[e.elu=6]="elu"}(Nq||(Nq={}));var Aq={kernelName:fa,backendName:"wasm",setupFunc:function(e){Tq=e.wasm.cwrap(fa,null,["number","array","number","number","array","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=t.bias,s=t.preluActivationWeights;if("float32"!==a.dtype||"float32"!==i.dtype)throw new Error("_FusedMatMul for non non-float32 tensors not yet supported.");var u=r.transposeA,c=r.transposeB,l=r.activation,p=r.leakyreluAlpha,h=n.dataIdMap.get(a.dataId).id,d=n.dataIdMap.get(i.dataId).id,f=0;if(null!=o){var m=n.dataIdMap.get(o.dataId);if(1!==m.shape.length)throw new Error("_FusedMatMul only supports rank-1 bias but got rank ".concat(m.shape.length,"."));f=m.id}var v=null==s?0:n.dataIdMap.get(s.dataId).id,y=Nq[l];if(null==y)throw new Error("".concat(l," activation not yet supported for FusedConv2D in the wasm backend."));var b=u?a.shape[2]:a.shape[1],x=c?i.shape[1]:i.shape[2],k=Qu.assertAndGetBroadcastShape(a.shape.slice(0,-2),i.shape.slice(0,-2)),w=n.makeOutput([].concat((0,g.Z)(k),[b,x]),a.dtype),I=n.dataIdMap.get(w.dataId).id,S=new Uint8Array(new Int32Array(a.shape).buffer),N=new Uint8Array(new Int32Array(i.shape).buffer);return Tq(h,S,a.shape.length,d,N,i.shape.length,u,c,y,f,v,p||0,I),w}};function Rq(e,t){var n;return{kernelName:e,backendName:"wasm",setupFunc:function(t){n=t.wasm.cwrap(e,null,["number","number","number"])},kernelFunc:function(e){var r=e.backend,a=e.inputs.x,i=r.dataIdMap.get(a.dataId).id,o=r.makeOutput(a.shape,t||a.dtype),s=r.dataIdMap.get(o.dataId).id;return 0===Aa.sizeFromShape(o.shape)||n(i,Sq[a.dtype],s),o}}}var Fq=Rq(rt);function Zq(e,t,n){var r;return{kernelName:e,backendName:"wasm",setupFunc:function(t){r=t.wasm.cwrap(e,null,["number","array","number","number","array","number","number","number"])},kernelFunc:function(e){var t=e.backend,a=e.inputs,i=a.a,o=a.b,s=t.dataIdMap.get(i.dataId).id,u=t.dataIdMap.get(o.dataId).id,c=null!=n?n:i.dtype,l=vm.assertAndGetBroadcastShape(i.shape,o.shape),p=t.makeOutput(l,c);if(0===Aa.sizeFromShape(l))return p;var h=new Uint8Array(new Int32Array(i.shape).buffer),d=new Uint8Array(new Int32Array(o.shape).buffer),f=t.dataIdMap.get(p.dataId).id;return r(s,h,i.shape.length,u,d,o.shape.length,Sq[i.dtype],f),p}}}var Dq,Mq=Zq(ot);var Oq={kernelName:st,backendName:"wasm",setupFunc:function(e){Dq=e.wasm.cwrap(st,null,["array","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=n.makeOutput(t[0].shape,t[0].dtype);if(0===Aa.sizeFromShape(r.shape))return r;var a=t.map((function(e){return n.dataIdMap.get(e.dataId).id})),i=new Uint8Array(new Int32Array(a).buffer),o=n.dataIdMap.get(r.dataId).id;return Dq(i,a.length,Sq[r.dtype],o),r}};function Lq(e){var t=e.inputs.x,n=e.backend;if("string"===t.dtype)return Yi(n.readSync(t.dataId),t.shape,t.dtype);var r=n.makeOutput(t.shape,t.dtype),a=n.typedArrayFromHeap(t);return n.typedArrayFromHeap(r).set(a),r}var zq,Pq={kernelName:yn,backendName:"wasm",kernelFunc:Lq};function Bq(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=function(e,t){for(var n=[],r=[],a=0;a<e.length;++a)1!==e[a]&&n.push(e[a]),1!==e[t[a]]&&r.push(t[a]);for(var i=0;i<r.length;++i){for(var o=-1,s=0;s<r.length;++s)r[s]>=i&&(-1===o||r[o]>r[s])&&(o=s);r[o]=i}return[n,r]}(t.x.shape,r.perm),i=(0,h.Z)(a,2),o=i[0],s=i[1],u=!0,c=0;c<s.length;c++)s[c]!==c&&(u=!1);var l=function(e,t){for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];return n}(t.x.shape,r.perm),p={dataId:t.x.dataId,shape:o,dtype:t.x.dtype};if(u){var d=Lq({inputs:t,backend:n});return d.shape=l,d}var f=n.makeOutput(l,p.dtype),m=n.dataIdMap.get(p.dataId).id,v=n.dataIdMap.get(f.dataId).id,g=new Uint8Array(new Int32Array(s).buffer),y=new Uint8Array(new Int32Array(p.shape).buffer);return zq(m,y,p.shape.length,Sq[p.dtype],v,g,s.length),f}var Wq,Vq={kernelName:ia,backendName:"wasm",kernelFunc:Bq,setupFunc:function(e){zq=e.wasm.cwrap(ia,null,["number","array","number","number","number","array","number"])}};function Uq(e,t,n){var r=e.shape,a=e.shape.length,i=Aa.parseAxisParam(t,r),o=i,s=vm.getAxesPermutation(o,a),u=null,c=!1;if(null!=s){for(var l=new Array(a),p=0;p<l.length;p++)l[p]=r[s[p]];o=vm.getInnerMostAxes(o.length,a),u=Bq({inputs:{x:e},attrs:{perm:s},backend:n});var h=n.dataIdMap.get(e.dataId).id;n.dataIdMap.get(u.dataId).id!==h&&(c=!0)}return{transposed:u,originalAxes:i,axes:o,inputWasTransposed:c}}var Gq,Hq={kernelName:ut,backendName:"wasm",setupFunc:function(e){Wq=e.wasm.cwrap(ut,null,["number, number, number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,o=n.x,s=t.dataIdMap.get(o.dataId).id,u=o,c=Uq(o,a,t),l=c.transposed,p=c.axes,d=c.originalAxes,f=c.inputWasTransposed;f&&(u=l,s=t.dataIdMap.get(l.dataId).id);var m=u.shape.length;vm.assertAxesAreInnerMostDims("all",p,m);var v=vm.computeOutAndReduceShapes(u.shape,p),g=(0,h.Z)(v,2),y=g[0],b=g[1],x=Aa.sizeFromShape(b),k=t.makeOutput(y,o.dtype);if(0!==Aa.sizeFromShape(u.shape)){var w=t.dataIdMap.get(k.dataId).id;Wq(s,x,w)}if(f&&t.disposeData(l.dataId),i){var I=vm.expandShapeToKeepDim(k.shape,d);k.shape=I}return k}};var jq,qq={kernelName:ct,backendName:"wasm",setupFunc:function(e){Gq=e.wasm.cwrap(ct,null,["number, number, number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,o=n.x,s=t.dataIdMap.get(o.dataId).id,u=o,c=Uq(o,a,t),l=c.transposed,p=c.axes,d=c.originalAxes,f=c.inputWasTransposed;f&&(u=l,s=t.dataIdMap.get(l.dataId).id);var m=u.shape.length;vm.assertAxesAreInnerMostDims("any",p,m);var v=vm.computeOutAndReduceShapes(u.shape,p),g=(0,h.Z)(v,2),y=g[0],b=g[1],x=Aa.sizeFromShape(b),k=t.makeOutput(y,o.dtype);if(0!==Aa.sizeFromShape(u.shape)){var w=t.dataIdMap.get(k.dataId).id;Gq(s,x,w)}if(f&&t.disposeData(l.dataId),i){var I=vm.expandShapeToKeepDim(k.shape,d);k.shape=I}return k}};var Kq,Xq={kernelName:lt,backendName:"wasm",kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs.axis,a=n.x,i=t.dataIdMap.get(a.dataId).id,o=i,s=a,u=Uq(a,r,t),c=u.transposed,l=u.axes,p=u.inputWasTransposed;if(p){var h=t.dataIdMap.get(c.dataId).id;h!==i&&(s=c,o=h)}var d=s.shape.slice(0,-1),f=t.makeOutput(d,"int32"),m=t.dataIdMap.get(f.dataId).id,v=Aa.sizeFromShape(f.shape),g=s.shape[l[0]];return jq(o,Sq[s.dtype],v,g,m),p&&t.disposeData(c.dataId),f},setupFunc:function(e){jq=e.wasm.cwrap(lt,null,["number","number","number","number","number"])}};var Yq={kernelName:gt,backendName:"wasm",setupFunc:function(e){Kq=e.wasm.cwrap(gt,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=r.dataIdMap.get(a.dataId).id,o=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode,l=vm.computePool2DInfo(a.shape,o,s,1,u,c),p=l.filterHeight,h=l.filterWidth,d=l.padInfo.top,f=l.padInfo.right,m=l.padInfo.bottom,v=l.padInfo.left,g=l.strideHeight,y=l.strideWidth,b=l.inChannels;if("channelsLast"!==l.dataFormat)throw new Error("wasm backend does not support dataFormat:'".concat(l.dataFormat,"'. Please use 'channelsLast'."));if(1!==l.dilationWidth||1!==l.dilationHeight)throw new Error("was backend only supports average pooling with dilation = [1, 1], got [".concat(l.dilationHeight,", ").concat(l.dilationWidth,"]."));var x=r.makeOutput(l.outShape,"float32"),k=r.dataIdMap.get(x.dataId).id;return Kq(i,a.shape[0],a.shape[1],a.shape[2],p,h,d,f,m,v,g,y,b,k),x}};function Jq(e){var t=e.inputs,n=e.attrs,r=t.x,a=n.shape,i=Aa.sizeFromShape(r.shape),o=Aa.inferFromImplicitShape(a,i);return Aa.assert(i===Aa.sizeFromShape(o),(function(){return"new shape: ".concat(o,", old shape: ").concat(r.shape,". New shape and old shape must have the same number of elements.")})),e.backend.incRef(r.dataId),{dataId:r.dataId,shape:o,dtype:r.dtype}}var Qq,$q={kernelName:yr,backendName:"wasm",kernelFunc:Jq};var eK={kernelName:kt,backendName:"wasm",setupFunc:function(e){Qq=e.wasm.cwrap(kt,null,["number","array","number","number","array","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=r.transposeA,s=r.transposeB;if("float32"!==a.dtype||"float32"!==i.dtype)throw new Error("BatchMatMul for non non-float32 tensors not yet supported.");var u=a.shape.length,c=i.shape.length,l=o?a.shape[u-2]:a.shape[u-1],p=s?i.shape[c-1]:i.shape[c-2],h=o?a.shape[u-1]:a.shape[u-2],d=s?i.shape[c-2]:i.shape[c-1],f=a.shape.slice(0,-2),m=i.shape.slice(0,-2),v=Aa.sizeFromShape(f),g=Aa.sizeFromShape(m),y=Qu.assertAndGetBroadcastShape(a.shape.slice(0,-2),i.shape.slice(0,-2)).concat([h,d]);Aa.assert(l===p,(function(){return"Error in matMul: inner shapes (".concat(l,") and (").concat(p,") of Tensors with shapes ").concat(a.shape," and ").concat(i.shape," and transposeA=").concat(o," and transposeB=").concat(s," must match.")}));var b=s?[g,d,p]:[g,p,d],x=Jq({inputs:{x:a},backend:n,attrs:{shape:o?[v,l,h]:[v,h,l]}}),k=Jq({inputs:{x:i},backend:n,attrs:{shape:b}}),w=n.dataIdMap.get(x.dataId).id,I=n.dataIdMap.get(k.dataId).id,S=o?x.shape[2]:x.shape[1],N=s?k.shape[1]:k.shape[2],T=Math.max(v,g),C=n.makeOutput([T,S,N],x.dtype),_=n.dataIdMap.get(C.dataId).id,E=new Uint8Array(new Int32Array(x.shape).buffer),A=new Uint8Array(new Int32Array(k.shape).buffer);return Qq(w,E,x.shape.length,I,A,k.shape.length,o,s,_),n.disposeData(x.dataId),n.disposeData(k.dataId),C.shape=y,C}};function tK(e){var t=e.inputs.x,n=e.attrs,r=n.begin,a=n.size,i=e.backend,o=Gf.parseSliceParams(t,r,a),s=(0,h.Z)(o,2),u=s[0],c=s[1],l=Gf.isSliceContinous(t.shape,u,c),p=i.readSync(t.dataId),d=i.makeOutput(c,t.dtype),f=Aa.computeStrides(t.shape),m=i.dataIdMap.get(d.dataId);if(l){var v=Gf.computeFlatOffset(u,f);return"string"===t.dtype?m.stringBytes=p.slice(v,v+Aa.sizeFromShape(c)):i.typedArrayFromHeap(d).set(p.subarray(v,v+Aa.sizeFromShape(c))),d}if("string"===t.dtype){var g=xF(p,u,c,t.shape,t.dtype);return m.stringBytes=g,d}var y=i.typedArrayFromHeap(d),b=t.shape.length;if(2===b)!function(e,t,n,r,a){for(var i=0,o=r[0],s=r[1],u=o+a[0],c=o;c<u;c++){var l=c*t+s;n.set(e.subarray(l,l+a[1]),i),i+=a[1]}}(p,f[0],y,u,c);else if(3===b)!function(e,t,n,r,a,i){for(var o=0,s=a[0],u=a[1],c=a[2],l=s+i[0],p=u+i[1],h=s;h<l;h++)for(var d=u;d<p;d++){var f=h*t+d*n+c;r.set(e.subarray(f,f+i[2]),o),o+=i[2]}}(p,f[0],f[1],y,u,c);else if(4===b)!function(e,t,n,r,a,i,o){for(var s=0,u=i[0],c=i[1],l=i[2],p=u+o[0],h=c+o[1],d=l+o[2],f=i[3],m=u;m<p;m++)for(var v=c;v<h;v++)for(var g=l;g<d;g++){var y=m*t+v*n+g*r+f;a.set(e.subarray(y,y+o[3]),s),s+=o[3]}}(p,f[0],f[1],f[2],y,u,c);else{var x=xF(p,u,c,t.shape,t.dtype);y.set(x)}return d}var nK={kernelName:Rr,backendName:"wasm",kernelFunc:tK};var rK={kernelName:wt,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops,s=i.reduce((function(e,t){return e*t})),u=vm.getReshaped(a.shape,i,s),c=vm.getPermuted(u.length,i.length),l=vm.getReshapedPermuted(a.shape,i,s),p=vm.getSliceBeginCoords(o,i.length),h=vm.getSliceSize(l,o,i.length),d=Jq({inputs:{x:a},backend:n,attrs:{shape:u}}),f=Bq({inputs:{x:d},backend:n,attrs:{perm:c}}),m=tK({inputs:{x:Jq({inputs:{x:f},backend:n,attrs:{shape:l}})},backend:n,attrs:{begin:p,size:h}});return n.disposeData(d.dataId),n.disposeData(f.dataId),n.disposeData(d.dataId),m}};function aK(e){var t=e.inputs.x,n=e.attrs.dtype,r=e.backend,a=r.makeOutput(t.shape,n),i=r.typedArrayFromHeap(t);return r.typedArrayFromHeap(a).set(i),a}var iK,oK={kernelName:Tt,backendName:"wasm",kernelFunc:aK},sK=Rq(Ct);var uK={kernelName:_t,backendName:"wasm",setupFunc:function(e){iK=e.wasm.cwrap(_t,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.clipValueMin,o=r.clipValueMax,s=n.dataIdMap.get(a.dataId).id,u=n.makeOutput(a.shape,a.dtype),c=n.dataIdMap.get(u.dataId).id;return iK(s,i,o,c),u}};function cK(e){var t=e.inputs,n=e.backend,r=Aa.parseAxisParam(e.attrs.axis,t[0].shape)[0],a=t.map((function(e){return e.shape}));vm.assertParamsConsistent(a,r);var i=vm.computeOutShape(t.map((function(e){return e.shape})),r),o=t.filter((function(e){return Aa.sizeFromShape(e.shape)>0}));if(1===o.length)return Lq({inputs:{x:o[0]},backend:n});var s=n.makeOutput(i,t[0].dtype);if(0===Aa.sizeFromShape(i))return s;if("string"===o[0].dtype){var u=o.map((function(e){var t=[-1,Aa.sizeFromShape(e.shape.slice(r))];return Jq({inputs:{x:e},backend:n,attrs:{shape:t}})})),c=u.map((function(e){return{vals:n.readSync(e.dataId),shape:e.shape}}));i=vm.computeOutShape(u.map((function(e){return e.shape})),1);var l=1===u[0].shape[0],p=rR(c,i,t[0].dtype,l),h=vm.computeOutShape(o.map((function(e){return e.shape})),r);return s.shape=h,n.dataIdMap.get(s.dataId).stringBytes=vm.fromStringArrayToUint8(p),u.forEach((function(e){return n.disposeData(e.dataId)})),s}for(var d=Aa.sizeFromShape(o[0].shape.slice(0,r)),f=0,m=o.map((function(e){var t=Aa.sizeFromShape(e.shape.slice(r));return f+=t,t})),v=o.map((function(e){return n.typedArrayFromHeap(e)})),g=n.typedArrayFromHeap(s),y=0;y<d;y++)for(var b=y*f,x=0;x<v.length;x++){var k=m[x],w=y*k,I=v[x].subarray(w,w+k);g.set(I,b),b+=k}return s}var lK,pK={kernelName:Rt,backendName:"wasm",kernelFunc:cK};var hK,dK={kernelName:Ft,backendName:"wasm",setupFunc:function(e){lK=e.wasm.cwrap(Ft,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=t.filter,o=r.dataIdMap.get(a.dataId).id,s=r.dataIdMap.get(i.dataId).id,u=n.strides,c=n.dilations,l=n.pad,p=n.dimRoundingMode,h=n.dataFormat,d=vm.convertConv2DDataFormat(h),f=vm.computeConv2DInfo(a.shape,i.shape,u,c,l,p,!1,d),m=f.filterHeight,v=f.filterWidth,g=f.padInfo.top,y=f.padInfo.right,b=f.padInfo.bottom,x=f.padInfo.left,k=f.dilationHeight,w=f.dilationWidth,I=f.strideHeight,S=f.strideWidth,N=f.inChannels,T=f.outChannels,C="SAME"===f.padInfo.type?1:0;if("channelsLast"!==f.dataFormat)throw new Error("wasm backend Conv2D does not support dataFormat:'".concat(f.dataFormat,"'. Please use 'channelsLast'."));var _=r.makeOutput(f.outShape,"float32"),E=r.dataIdMap.get(_.dataId).id;return lK(o,a.shape[0],a.shape[1],a.shape[2],s,m,v,g,y,b,x,C,k,w,I,S,N,T,E),_}};var fK,mK,vK={kernelName:Dt,backendName:"wasm",setupFunc:function(e){hK=e.wasm.cwrap(Dt,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.dy,i=n.filter,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.inputShape,p=vm.convertConv2DDataFormat(u),d=vm.computeConv2DInfo(l,i.shape,o,1,s,c,!1,p),f=d.batchSize,m=d.filterHeight,v=d.filterWidth,g=d.inChannels,y=d.inHeight,b=d.inWidth,x=d.outChannels,k=d.outHeight,w=d.outWidth,I=d.strideHeight,S=d.strideWidth,N=m-1-d.padInfo.top,T=v-1-d.padInfo.left,C="channelsLast"===d.dataFormat,_=Aa.computeStrides(d.inShape),E=Aa.computeStrides(a.shape),A=Aa.computeStrides(i.shape),R=(0,h.Z)(A,3),F=R[0],Z=R[1],D=R[2],M=_[0],O=C?_[1]:_[2],L=C?_[2]:1,z=C?1:_[1],P=E[0],B=C?E[1]:E[2],W=C?E[2]:1,V=C?1:E[1],U=t.makeOutput(d.inShape,"float32"),G=t.dataIdMap.get(U.dataId).id,H=t.dataIdMap.get(a.dataId).id,j=t.dataIdMap.get(i.dataId).id;return hK(H,j,f,m,v,y,b,g,k,w,x,I,S,N,T,F,Z,D,M,O,L,z,P,B,W,V,G),U}},gK=Rq(zt),yK=Rq(Pt);!function(e){e[e.bilinear=0]="bilinear",e[e.nearest=1]="nearest"}(fK||(fK={}));var bK,xK={kernelName:Vt,backendName:"wasm",setupFunc:function(e){mK=e.wasm.cwrap(Vt,null,["number","number","number","number","array","number","number","number","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=e.attrs,i=a.method,o=a.extrapolationValue,s=a.cropSize,u=r.image,c=r.boxes,l=r.boxInd,p=c.shape[0],d=(0,h.Z)(s,2),f=d[0],m=d[1],v=[p,f,m,u.shape[3]],g=n.dataIdMap.get(u.dataId);"float32"!==u.dtype&&(t=aK({backend:n,inputs:{x:u},attrs:{dtype:"float32"}}),g=n.dataIdMap.get(t.dataId));var y=g.id,b=n.dataIdMap.get(c.dataId).id,x=n.dataIdMap.get(l.dataId).id,k=n.makeOutput(v,"float32"),w=n.dataIdMap.get(k.dataId).id,I=new Uint8Array(new Int32Array(u.shape).buffer);return mK(y,b,x,p,I,f,m,fK[i],o,w),null!=t&&n.disposeData(t.dataId),k}};var kK,wK={kernelName:Bt,backendName:"wasm",setupFunc:function(e){bK=e.wasm.cwrap(Bt,null,["number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse,u=a.shape.length;Aa.assert("float32"===a.dtype||"int32"===a.dtype,(function(){return"cumprod does not support ".concat(a.dtype," tensors in the WASM backend")}));var c=vm.getAxesPermutation([i],u),l=a;null!==c&&(l=Bq({inputs:{x:a},attrs:{perm:c},backend:n}));var p=vm.getInnerMostAxes(1,u)[0];vm.assertAxesAreInnerMostDims("cumprod",[p],u);var h=n.makeOutput(l.shape,l.dtype),d=l.shape[p],f=n.dataIdMap.get(l.dataId).id,m=n.dataIdMap.get(h.dataId).id;bK(f,o?1:0,s?1:0,d,m,Sq[a.dtype]);var v=h;return null!==c&&(v=Bq({inputs:{x:h},attrs:{perm:vm.getUndoAxesPermutation(c)},backend:n}),n.disposeData(l.dataId),n.disposeData(h.dataId)),v}};var IK,SK={kernelName:Wt,backendName:"wasm",setupFunc:function(e){kK=e.wasm.cwrap(Wt,null,["number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse,u=a.shape.length;Aa.assert("float32"===a.dtype||"int32"===a.dtype,(function(){return"cumsum does not support ".concat(a.dtype," tensors in the WASM backend")}));var c=vm.getAxesPermutation([i],u),l=a;null!==c&&(l=Bq({inputs:{x:a},attrs:{perm:c},backend:n}));var p=vm.getInnerMostAxes(1,u)[0];vm.assertAxesAreInnerMostDims("cumsum",[p],u);var h=n.makeOutput(l.shape,l.dtype),d=l.shape[p],f=n.dataIdMap.get(l.dataId).id,m=n.dataIdMap.get(h.dataId).id;kK(f,o?1:0,s?1:0,d,m,Sq[a.dtype]);var v=h;return null!==c&&(v=Bq({inputs:{x:h},attrs:{perm:vm.getUndoAxesPermutation(c)},backend:n}),n.disposeData(l.dataId),n.disposeData(h.dataId)),v}};var NK,TK={kernelName:Gt,backendName:"wasm",setupFunc:function(e){IK=e.wasm.cwrap(Gt,null,["number","number","number","array","number","array","array","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.x,i=r.blockSize,o=r.dataFormat,s=a.shape[0],u=("NHWC"===o?a.shape[1]:a.shape[2])*i,c=("NHWC"===o?a.shape[2]:a.shape[3])*i,l=("NHWC"===o?a.shape[3]:a.shape[1])/(i*i),p="NHWC"===o?[s,u,c,l]:[s,l,u,c],h=t.makeOutput(p,"float32"),d=t.dataIdMap.get(a.dataId).id,f=new Uint8Array(new Int32Array(Aa.computeStrides(a.shape)).buffer),m=new Uint8Array(new Int32Array(p).buffer),v=new Uint8Array(new Int32Array(Aa.computeStrides(p)).buffer),g=t.dataIdMap.get(h.dataId).id;return IK(d,i,"NHWC"===o?1:0,f,a.shape.length-1,m,v,p.length,g),h}};var CK={kernelName:Ht,backendName:"wasm",setupFunc:function(e){NK=e.wasm.cwrap(Ht,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=t.filter,o=r.dataIdMap.get(a.dataId).id,s=r.dataIdMap.get(i.dataId).id,u=n.strides,c=n.dilations,l=n.pad,p=n.dimRoundingMode,h=null==c?[1,1]:c,d=vm.computeConv2DInfo(a.shape,i.shape,u,h,l,p,!0),f=d.filterHeight,m=d.filterWidth,v=d.padInfo.top,g=d.padInfo.right,y=d.padInfo.bottom,b=d.padInfo.left,x=d.dilationHeight,k=d.dilationWidth,w=d.strideHeight,I=d.strideWidth,S=d.inChannels,N=d.outChannels,T="SAME"===d.padInfo.type?1:0;if("channelsLast"!==d.dataFormat)throw new Error("wasm backend DepthwiseConv2dNative does not support dataFormat:'".concat(d.dataFormat,"'. Please use 'channelsLast'."));var C=r.makeOutput(d.outShape,"float32"),_=r.dataIdMap.get(C.dataId).id;return NK(o,a.shape[0],a.shape[1],a.shape[2],s,f,m,v,g,y,b,T,x,k,w,I,S,N,_),C}},_K=Rq(en),EK=Zq(rn,0,"bool"),AK=Rq(an,"float32");function RK(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.input,i=n.dim,o=a.shape.length,s=a.shape.slice(),u=i;return i<0&&(Aa.assert(-(o+1)<=i,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+i+1),s.splice(u,0,1),Jq({inputs:{x:a},backend:r,attrs:{shape:s}})}var FK={kernelName:on,backendName:"wasm",kernelFunc:RK};function ZK(e){var t=e.attrs,n=t.shape,r=t.value,a=t.dtype,i=e.backend,o=i.makeOutput(n,a);return i.typedArrayFromHeap(o).fill(r),o}var DK,MK={kernelName:cn,backendName:"wasm",kernelFunc:ZK};var OK,LK={kernelName:ln,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.image,a=n.makeOutput(r.shape,r.dtype),i=n.dataIdMap.get(r.dataId).id,o=n.dataIdMap.get(a.dataId).id,s=(0,h.Z)(r.shape,4),u=s[0],c=s[1],l=s[2],p=s[3];return DK(i,u,c,l,p,o),a},setupFunc:function(e){DK=e.wasm.cwrap(ln,null,["number","number","number","number","number","number"])}},zK=Rq(pn),PK=Zq(hn);var BK,WK={kernelName:dn,backendName:"wasm",setupFunc:function(e){OK=e.wasm.cwrap(dn,null,["number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs.varianceEpsilon,a=n.x,i=n.mean,o=n.variance,s=n.offset,u=n.scale,c=t.dataIdMap.get(a.dataId).id,l=t.dataIdMap.get(i.dataId).id,p=t.dataIdMap.get(o.dataId).id,h=null!=s?t.dataIdMap.get(s.dataId).id:0,d=null!=u?t.dataIdMap.get(u.dataId).id:0,f=t.makeOutput(a.shape,a.dtype);if(0===Aa.sizeFromShape(a.shape))return f;var m=t.dataIdMap.get(f.dataId).id;return OK(c,l,p,h,d,r,m),f}};var VK,UK={kernelName:ma,backendName:"wasm",setupFunc:function(e){BK=e.wasm.cwrap(ma,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=n.strides,c=n.pad,l=n.dilations,p=n.dataFormat,h=n.dimRoundingMode,d=n.activation,f=n.leakyreluAlpha,m=vm.computeConv2DInfo(a.shape,i.shape,u,l,c,h),v=Nq[d];if(null==v)throw new Error("".concat(d," activation not yet supported for FusedConv2D in the wasm backend."));var g=r.dataIdMap.get(a.dataId).id,y=r.dataIdMap.get(i.dataId).id,b=m.outChannels,x=0;if(null!=o){var k=r.dataIdMap.get(o.dataId);if(1!==k.shape.length)throw new Error("FusedConv2D only supports rank-1 bias but got rank ".concat(k.shape.length,"."));if(k.shape[0]!==b)throw new Error("FusedConv2D bias shape (".concat(k.shape,") does not match the number of output channels (").concat(b,")"));x=k.id}var w=m.filterHeight,I=m.filterWidth,S=m.padInfo.top,N=m.padInfo.right,T=m.padInfo.bottom,C=m.padInfo.left,_=m.dilationHeight,E=m.dilationWidth,A=m.strideHeight,R=m.strideWidth,F=m.inChannels,Z="SAME"===m.padInfo.type?1:0,D=m.batchSize,M=m.inHeight,O=m.inWidth;if("NHWC"!==p)throw new Error("wasm backend FusedConv2D does not support dataFormat:'".concat(p,"'. Please use 'NHWC'."));var L=r.makeOutput(m.outShape,"float32"),z=r.dataIdMap.get(L.dataId).id,P=null==s?0:r.dataIdMap.get(s.dataId).id;return BK(g,D,M,O,y,w,I,x,S,N,T,C,Z,_,E,A,R,F,b,v,P,f||0,z),L}};var GK,HK={kernelName:va,backendName:"wasm",setupFunc:function(e){VK=e.wasm.cwrap(va,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=n.strides,c=n.pad,l=n.dilations,p=n.dataFormat,h=n.dimRoundingMode,d=n.activation,f=n.leakyreluAlpha,m=vm.computeConv2DInfo(a.shape,i.shape,u,l,c,h,!0),v=Nq[d];if(null==v)throw new Error("".concat(d," activation not yet supported for FusedDepthwiseConv2D in the wasm backend."));var g=r.dataIdMap.get(a.dataId).id,y=r.dataIdMap.get(i.dataId).id,b=m.outChannels,x=0;if(null!=o){var k=r.dataIdMap.get(o.dataId);if(1!==k.shape.length)throw new Error("FusedDepthwiseConv2D only supports rank-1 bias but got rank ".concat(k.shape.length,"."));if(k.shape[0]!==b)throw new Error("FusedDepthwiseConv2D bias shape (".concat(k.shape,") does not match the number of output channels (").concat(b,")"));x=k.id}var w=m.filterHeight,I=m.filterWidth,S=m.padInfo.top,N=m.padInfo.right,T=m.padInfo.bottom,C=m.padInfo.left,_=m.dilationHeight,E=m.dilationWidth,A=m.strideHeight,R=m.strideWidth,F=m.inChannels,Z="SAME"===m.padInfo.type?1:0,D=m.batchSize,M=m.inHeight,O=m.inWidth;if("NHWC"!==p)throw new Error("wasm backend FusedDepthwiseConv2D does not support dataFormat:'".concat(p,"'. Please use 'NHWC'."));var L=r.makeOutput(m.outShape,"float32"),z=r.dataIdMap.get(L.dataId).id,P=null==s?0:r.dataIdMap.get(s.dataId).id;return VK(g,D,M,O,y,w,I,x,S,N,T,C,Z,_,E,A,R,F,b,v,P,f||0,z),L}};var jK,qK={kernelName:mn,backendName:"wasm",setupFunc:function(e){GK=e.wasm.cwrap(mn,null,["number","number","number","number","number","number","array","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=n.params,a=n.indices,i=Vf.prepareAndValidate(r,a),o=(0,h.Z)(i,4),s=o[0],u=o[1],c=o[2],l=o[3],p=t.makeOutput(s,r.dtype);if(0===u)return p;var d=a.shape,f=d[d.length-1],m=t.dataIdMap.get(r.dataId).id,v=t.dataIdMap.get(a.dataId).id,g=new Uint8Array(new Int32Array(l).buffer),y=t.dataIdMap.get(p.dataId).id;return GK(m,Sq[r.dtype],v,u,f,c,g,y),p}};var KK,XK={kernelName:fn,backendName:"wasm",setupFunc:function(e){jK=e.wasm.cwrap("Gather",null,["number","number","array","number","number","number","array","number"])},kernelFunc:function(e){for(var t=e.backend,n=e.inputs,r=e.attrs,a=n.x,i=n.indices,o=r.axis,s=r.batchDims,u=Aa.parseAxisParam(o,a.shape)[0],c=t.readSync(i.dataId),l=a.shape[u],p=function(){var e=c[h];Aa.assert(e<=l-1&&e>=0,(function(){return"GatherV2: the index value ".concat(e," is not in [0, ").concat(l-1,"]")}))},h=0;h<c.length;++h)p();var d=vm.segment_util.collectGatherOpShapeInfo(a,i,u,s),f=Jq({inputs:{x:a},attrs:{shape:[d.batchSize,d.outerSize,d.dimSize,d.sliceSize]},backend:t}),m=Aa.sizeFromShape(i.shape),v=Jq({inputs:{x:i},attrs:{shape:[d.batchSize,m/d.batchSize]},backend:t}),g=[d.batchSize,d.outerSize,m/d.batchSize,d.sliceSize],y=t.makeOutput(g,a.dtype);if(0===Aa.sizeFromShape(a.shape))return y;var b=f.shape.length-1,x=t.dataIdMap.get(f.dataId).id,k=t.dataIdMap.get(v.dataId).id,w=t.dataIdMap.get(y.dataId).id,I=new Uint8Array(new Int32Array(Aa.computeStrides(f.shape)).buffer),S=new Uint8Array(new Int32Array(Aa.computeStrides(g)).buffer);return jK(x,Sq[a.dtype],I,b,k,d.batchSize,S,w),t.disposeData(f.dataId),t.disposeData(v.dataId),y.shape=d.outputShape,y}},YK=Zq(vn,0,"bool"),JK=Zq(gn,0,"bool"),QK=Rq(In,"bool");var $K,eX={kernelName:Sn,backendName:"wasm",setupFunc:function(e){KK=e.wasm.cwrap(Sn,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.inputs.x,n=e.attrs.alpha,r=e.backend,a=r.dataIdMap.get(t.dataId).id,i=r.makeOutput(t.shape,"float32");if(0!==Aa.sizeFromShape(t.shape)){var o=r.dataIdMap.get(i.dataId).id;KK(a,Sq[t.dtype],n,o)}return i}},tX=Zq(Nn,0,"bool"),nX=Zq(Tn,0,"bool"),rX=Rq(_n),aX=Zq(An,0,"bool"),iX=Rq(Rn),oX=Zq(Fn,0,"bool"),sX=Zq(Zn,0,"bool");var uX,cX={kernelName:zn,backendName:"wasm",setupFunc:function(e){$K=e.wasm.cwrap(zn,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.reductionIndices,i=r.keepDims,o=n.x,s=t.dataIdMap.get(o.dataId).id,u=o,c=Uq(o,a,t),l=c.transposed,p=c.axes,d=c.originalAxes,f=c.inputWasTransposed;f&&(u=l,s=t.dataIdMap.get(l.dataId).id);var m=u.shape.length;vm.assertAxesAreInnerMostDims("max",p,m);var v=vm.computeOutAndReduceShapes(u.shape,p),g=(0,h.Z)(v,2),y=g[0],b=g[1],x=Aa.sizeFromShape(b),k=t.makeOutput(y,o.dtype);if(0!==Aa.sizeFromShape(u.shape)){var w=t.dataIdMap.get(k.dataId).id;$K(s,Sq[o.dtype],x,w)}if(f&&t.disposeData(l.dataId),i){var I=vm.expandShapeToKeepDim(k.shape,d);k.shape=I}return k}},lX=Zq(Pn);var pX,hX={kernelName:Bn,backendName:"wasm",setupFunc:function(e){uX=e.wasm.cwrap(Bn,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=r.dataIdMap.get(a.dataId).id;Aa.assert("float32"===a.dtype,(function(){return"Error in MaxPool: only float32 input is supported. Got ".concat(a.dtype,".")}));var o=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode,l=vm.computePool2DInfo(a.shape,o,s,1,u,c),p=l.filterHeight,h=l.filterWidth,d=l.padInfo.top,f=l.padInfo.right,m=l.padInfo.bottom,v=l.padInfo.left,g=l.dilationHeight,y=l.dilationWidth,b=l.strideHeight,x=l.strideWidth,k=l.inChannels,w=l.outChannels;if("channelsLast"!==l.dataFormat)throw new Error("wasm backend does not support dataFormat:'".concat(l.dataFormat,"'. Please use 'channelsLast'."));var I=r.makeOutput(l.outShape,"float32"),S=r.dataIdMap.get(I.dataId).id;return uX(i,a.shape[0],a.shape[1],a.shape[2],p,h,d,f,m,v,g,y,b,x,k,w,S),I}};var dX,fX={kernelName:Hn,backendName:"wasm",setupFunc:function(e){pX=e.wasm.cwrap(Hn,null,["number, number, number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,o=n.x,s=t.dataIdMap.get(o.dataId).id,u=s,c=o,l=Uq(o,a,t),p=l.transposed,d=l.axes,f=l.originalAxes,m=l.inputWasTransposed,v=d;if(m){var g=t.dataIdMap.get(p.dataId).id;g!==s&&(c=p,u=g,v=vm.getInnerMostAxes(v.length,c.shape.length))}vm.assertAxesAreInnerMostDims("mean",v,c.shape.length);var y=vm.computeOutAndReduceShapes(c.shape,v),b=(0,h.Z)(y,2),x=b[0],k=b[1],w=Aa.sizeFromShape(k),I=c;"float32"!==c.dtype&&(I=aK({backend:t,inputs:{x:c},attrs:{dtype:"float32"}}),u=t.dataIdMap.get(I.dataId).id);var S=t.makeOutput(x,"float32");if(0!==Aa.sizeFromShape(c.shape)){var N=t.dataIdMap.get(S.dataId).id;pX(u,w,N)}if(m&&t.disposeData(p.dataId),i){var T=vm.expandShapeToKeepDim(S.shape,f);S.shape=T}return"float32"!==c.dtype&&t.disposeData(I.dataId),S}};var mX,vX,gX={kernelName:jn,backendName:"wasm",setupFunc:function(e){dX=e.wasm.cwrap(jn,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,o=n.x,s=t.dataIdMap.get(o.dataId).id,u=s,c=o,l=Uq(o,a,t),p=l.transposed,d=l.axes,f=l.originalAxes,m=l.inputWasTransposed;if(m){var v=t.dataIdMap.get(p.dataId).id;v!==s&&(c=p,u=v)}var g=c.shape.length;vm.assertAxesAreInnerMostDims("min",d,g);var y=vm.computeOutAndReduceShapes(c.shape,d),b=(0,h.Z)(y,2),x=b[0],k=b[1],w=Aa.sizeFromShape(k),I=t.makeOutput(x,c.dtype);if(0!==Aa.sizeFromShape(c.shape)){var S=t.dataIdMap.get(I.dataId).id;dX(u,Sq[o.dtype],w,S)}if(m&&t.disposeData(p.dataId),i){var N=vm.expandShapeToKeepDim(I.shape,f);I.shape=N}return I}},yX=Zq(qn);!function(e){e[e.reflect=0]="reflect",e[e.symmetric=1]="symmetric"}(mX||(mX={}));var bX,xX={kernelName:Kn,backendName:"wasm",kernelFunc:function(e){var t=e.inputs.x,n=e.backend,r=e.attrs,a=r.paddings,i=r.mode,o=a.map((function(e,n){return e[0]+t.shape[n]+e[1]})),s=n.dataIdMap.get(t.dataId).id,u=n.makeOutput(o,t.dtype),c=n.dataIdMap.get(u.dataId).id,l=new Uint8Array(new Int32Array(t.shape).buffer),p=a.map((function(e){return e[0]})),h=a.map((function(e){return e[1]})),d=new Uint8Array(new Int32Array(p).buffer),f=new Uint8Array(new Int32Array(h).buffer);return vX(s,l,t.shape.length,Sq[t.dtype],d,f,mX[i],c),u},setupFunc:function(e){vX=e.wasm.cwrap(Kn,null,["number","array","number","number","array","array","number","number"])}},kX=Zq(Jn),wX=Rq(Qn);function IX(e,t){var n=new Int32Array(e.wasm.HEAPU8.buffer,t,4),r=n[0],a=n[1],i=n[2],o=n[3];return e.wasm._free(t),{pSelectedIndices:r,selectedSize:a,pSelectedScores:i,pValidOutputs:o}}var SX,NX={kernelName:er,backendName:"wasm",setupFunc:function(e){bX=e.wasm.cwrap(er,"number",["number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.iouThreshold,i=r.maxOutputSize,o=r.scoreThreshold,s=n.boxes,u=n.scores,c=t.dataIdMap.get(s.dataId).id,l=t.dataIdMap.get(u.dataId).id,p=IX(t,bX(c,l,i,a,o)),h=p.pSelectedIndices,d=p.selectedSize,f=p.pSelectedScores,m=p.pValidOutputs;return t.wasm._free(f),t.wasm._free(m),t.makeOutput([d],"int32",h)}};var TX,CX={kernelName:tr,backendName:"wasm",setupFunc:function(e){SX=e.wasm.cwrap(tr,"number",["number","number","number","number","number","bool"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.iouThreshold,i=r.maxOutputSize,o=r.scoreThreshold,s=r.padToMaxOutputSize,u=n.boxes,c=n.scores,l=t.dataIdMap.get(u.dataId).id,p=t.dataIdMap.get(c.dataId).id,h=IX(t,SX(l,p,i,a,o,s)),d=h.pSelectedIndices,f=h.selectedSize,m=h.pSelectedScores,v=h.pValidOutputs;return t.wasm._free(m),[t.makeOutput([f],"int32",d),t.makeOutput([],"int32",v)]}};var _X,EX={kernelName:nr,backendName:"wasm",setupFunc:function(e){TX=e.wasm.cwrap(nr,"number",["number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.iouThreshold,i=r.maxOutputSize,o=r.scoreThreshold,s=r.softNmsSigma,u=n.boxes,c=n.scores,l=t.dataIdMap.get(u.dataId).id,p=t.dataIdMap.get(c.dataId).id,h=IX(t,TX(l,p,i,a,o,s)),d=h.pSelectedIndices,f=h.selectedSize,m=h.pSelectedScores,v=h.pValidOutputs;return t.wasm._free(v),[t.makeOutput([f],"int32",d),t.makeOutput([f],"float32",m)]}},AX=Zq($n,0,"bool");var RX={kernelName:ar,backendName:"wasm",setupFunc:function(e){_X=e.wasm.cwrap(ar,null,["number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.dtype,o=r.depth,s=r.onValue,u=r.offValue,c=n.makeOutput([].concat((0,g.Z)(a.shape),[o]),i),l=n.dataIdMap.get(c.dataId).id,p=n.dataIdMap.get(a.dataId).id;return _X(p,o,s,u,l),c}};var FX={kernelName:rr,backendName:"wasm",kernelFunc:function(e){var t=e.inputs.x,n=e.backend,r=n.makeOutput(t.shape,t.dtype);return n.typedArrayFromHeap(r).fill(1),r}};var ZX,DX={kernelName:ir,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return RK({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){Aa.assertShapesMatch(a,e.shape,"All tensors passed to stack must have matching shapes"),Aa.assert(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=cK({inputs:t.map((function(e){var t=RK({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeData(e.dataId)})),s}};var MX,OX={kernelName:or,backendName:"wasm",kernelFunc:function(e){var t=e.inputs.x,n=e.backend,r=e.attrs,a=r.paddings,i=r.constantValue,o=a.map((function(e,n){return e[0]+t.shape[n]+e[1]}));if(0===Aa.sizeFromShape(t.shape))return ZK({backend:n,attrs:{shape:o,value:i,dtype:t.dtype}});var s=n.dataIdMap.get(t.dataId).id,u=n.makeOutput(o,t.dtype),c=n.dataIdMap.get(u.dataId).id,l=new Uint8Array(new Int32Array(t.shape).buffer),p=a.map((function(e){return e[0]})),h=a.map((function(e){return e[1]})),d=new Uint8Array(new Int32Array(p).buffer),f=new Uint8Array(new Int32Array(h).buffer);return ZX(s,l,t.shape.length,Sq[t.dtype],d,f,i,c),u},setupFunc:function(e){ZX=e.wasm.cwrap(or,null,["number","array","number","number","array","array","number","number"])}},LX=Zq(ur);var zX,PX={kernelName:cr,backendName:"wasm",setupFunc:function(e){MX=e.wasm.cwrap(cr,null,["number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha,i=n.dataIdMap.get(r.dataId).id,o=n.dataIdMap.get(a.dataId).id,s=i,u=r,c=u;"float32"!==u.dtype&&(c=aK({backend:n,inputs:{x:r},attrs:{dtype:"float32"}}),s=n.dataIdMap.get(c.dataId).id);var l=n.makeOutput(r.shape,"float32"),p=n.dataIdMap.get(l.dataId).id;return MX(s,o,p),"float32"!==u.dtype&&n.disposeData(c.dataId),l}};var BX,WX={kernelName:lr,backendName:"wasm",setupFunc:function(e){zX=e.wasm.cwrap(lr,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,o=n.x,s=t.dataIdMap.get(o.dataId).id,u=s,c=o,l=Uq(o,a,t),p=l.transposed,d=l.axes,f=l.originalAxes,m=l.inputWasTransposed,v=d;if(m){var g=t.dataIdMap.get(p.dataId).id;g!==s&&(c=p,u=g,v=vm.getInnerMostAxes(v.length,c.shape.length))}vm.assertAxesAreInnerMostDims("prod",v,c.shape.length);var y=vm.computeOutAndReduceShapes(c.shape,v),b=(0,h.Z)(y,2),x=b[0],k=b[1],w=Aa.sizeFromShape(k),I=t.makeOutput(x,c.dtype);if(0!==Aa.sizeFromShape(c.shape)){var S=t.dataIdMap.get(I.dataId).id;zX(u,w,Sq[I.dtype],S)}if(m&&t.disposeData(p.dataId),i){var N=vm.expandShapeToKeepDim(I.shape,f);I.shape=N}return I}},VX={kernelName:fr,backendName:"wasm",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.step,o=n.dtype,s=hF(r,a,i,o),u=t.makeOutput([s.length],o);return t.typedArrayFromHeap(u).set(s),u}},UX=Zq(Qt),GX=Rq(vr),HX=Rq(gr),jX=Rq(Ir);var qX,KX={kernelName:kr,backendName:"wasm",setupFunc:function(e){BX=e.wasm.cwrap(kr,null,["number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=e.attrs,i=r.images,o=a.alignCorners,s=a.halfPixelCenters,u=a.size,c=(0,h.Z)(u,2),l=c[0],p=c[1],d=(0,h.Z)(i.shape,4),f=d[0],m=d[1],v=d[2],g=d[3],y=[f,l,p,g],b=n.dataIdMap.get(i.dataId);"float32"!==b.dtype&&(t=aK({backend:n,inputs:{x:i},attrs:{dtype:"float32"}}),b=n.dataIdMap.get(t.dataId));var x=b.id,k=n.makeOutput(y,"float32");if(0===Aa.sizeFromShape(i.shape))return k;var w=n.dataIdMap.get(k.dataId).id;return BX(x,f,m,v,g,l,p,o?1:0,s?1:0,w),null!=t&&n.disposeData(t.dataId),k}};var XX,YX={kernelName:br,backendName:"wasm",setupFunc:function(e){qX=e.wasm.cwrap(br,null,["number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size,u=(0,h.Z)(s,2),c=u[0],l=u[1],p=(0,h.Z)(a.shape,4),d=p[0],f=p[1],m=p[2],v=p[3],g=[d,c,l,v],y=t.makeOutput(g,"float32");if(0===Aa.sizeFromShape(a.shape))return y;var b,x=t.dataIdMap.get(a.dataId);"float32"!==x.dtype&&(b=aK({backend:t,inputs:{x:a},attrs:{dtype:"float32"}}),x=t.dataIdMap.get(b.dataId));var k=x.id,w=t.dataIdMap.get(y.dataId).id;return qX(k,d,f,m,v,c,l,i?1:0,o?1:0,w),null!=b&&t.disposeData(b.dataId),y}};var JX,QX={kernelName:Sr,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims,o=Aa.parseAxisParam(i,a.shape);if(0===a.shape.length)return Lq({inputs:{x:a},backend:n});var s=n.makeOutput(a.shape,a.dtype),u=n.dataIdMap.get(a.dataId).id,c=n.dataIdMap.get(s.dataId).id,l=new Uint8Array(new Int32Array(o).buffer),p=new Uint8Array(new Int32Array(a.shape).buffer);XX(u,l,o.length,p,a.shape.length,c);var h=Jq({inputs:{x:s},attrs:{shape:a.shape},backend:n});return n.disposeData(s.dataId),h},setupFunc:function(e){XX=e.wasm.cwrap(Sr,null,["number","array","number","array","number","number"])}};var $X,eY={kernelName:da,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=r.radians,o=r.fillValue,s=r.center,u=n.makeOutput(a.shape,a.dtype),c=n.dataIdMap.get(a.dataId).id,l=n.dataIdMap.get(u.dataId).id,p=(0,h.Z)(a.shape,4),d=p[0],f=p[1],m=p[2],v=p[3],y=vm.getImageCenter(s,f,m),b=(0,h.Z)(y,2),x=b[0],k=b[1],w="number"==typeof o?[o,o,o,0===o?0:255]:[].concat((0,g.Z)(o),[255]),I=new Uint8Array(new Int32Array(w).buffer);return JX(c,d,f,m,v,i,x,k,I,w.length,l),u},setupFunc:function(e){JX=e.wasm.cwrap(da,null,["number","number","number","number","number","number","number","number","array","number","number"])}},tY=Rq(Nr),nY=Rq(Tr);var rY,aY={kernelName:Cr,backendName:"wasm",setupFunc:function(e){$X=e.wasm.cwrap(Cr,null,["number","number","number","number","number","number","array","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.indices,i=n.updates,o=r.shape,s=t.makeOutput(o,i.dtype);if(0===Aa.sizeFromShape(o))return s;var u=vh.calculateShapes(i,a,o),c=u.sliceRank,l=u.numUpdates,p=u.sliceSize,h=u.strides,d=u.outputSize,f=t.dataIdMap.get(a.dataId).id,m=t.dataIdMap.get(i.dataId).id,v=new Uint8Array(new Int32Array(h).buffer),g=t.dataIdMap.get(s.dataId).id;return $X(f,m,Sq[i.dtype],c,l,p,v,d,g),s}};var iY,oY={kernelName:Er,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e,o=n.dataIdMap.get(r.dataId).id,s=n.dataIdMap.get(a.dataId).id,u=n.dataIdMap.get(i.dataId).id,c=n.makeOutput(a.shape,a.dtype),l=n.dataIdMap.get(c.dataId).id,p=r.shape.length,h=a.shape.length,d=0===p||p>1||1===h?1:Aa.sizeFromShape(a.shape.slice(1));return rY(o,s,u,d,l),c},setupFunc:function(e){rY=e.wasm.cwrap("SelectV2",null,["number","number","number","number","number"])}};var sY,uY={kernelName:"Sigmoid",backendName:"wasm",setupFunc:function(e){iY=e.wasm.cwrap(Mr,null,["number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs.x,r=t.dataIdMap.get(n.dataId).id,a=t.makeOutput(n.shape,n.dtype),i=t.dataIdMap.get(a.dataId).id;return 0===Aa.sizeFromShape(a.shape)||iY(r,i),a}},cY=Rq(Fr);var lY={kernelName:Wr,backendName:"wasm",setupFunc:function(e){sY=e.wasm.cwrap(Wr,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs.logits,r=e.attrs.dim,a=t.dataIdMap.get(n.dataId).id,i=t.makeOutput(n.shape,n.dtype),o=t.dataIdMap.get(i.dataId).id,s=n.shape[r],u=Aa.sizeFromShape(n.shape)/s;return 0===Aa.sizeFromShape(i.shape)||sY(a,o,s,u),i}};var pY,hY={kernelName:Pr,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings,s=Aa.sizeFromShape(i),u=[[0,0]];u.push.apply(u,(0,g.Z)(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=OX.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),p=vm.getReshaped(l.shape,i,s,!1),h=vm.getPermuted(p.length,i.length,!1),d=vm.getReshapedPermuted(l.shape,i,s,!1),f=Jq({inputs:{x:l},backend:n,attrs:{shape:p}}),m=Bq({inputs:{x:f},backend:n,attrs:{perm:h}}),v=Jq({inputs:{x:m},backend:n,attrs:{shape:d}});return n.disposeData(l.dataId),n.disposeData(f.dataId),n.disposeData(m.dataId),v}};var dY,fY={kernelName:Vr,backendName:"wasm",setupFunc:function(e){pY=e.wasm.cwrap("SparseFillEmptyRows","number",["number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=r.indices,i=r.values,o=r.denseShape,s=r.defaultValue,u=a.shape[0],c=a.shape[1],l=n.readSync(o.dataId)[0],p=[u+l,c],h=n.dataIdMap.get(a.dataId).id,d=n.dataIdMap.get(i.dataId).id,f=n.dataIdMap.get(s.dataId).id,m=n.makeOutput(p,a.dtype),v=n.dataIdMap.get(m.dataId).id,g=n.makeOutput(p.slice(0,1),i.dtype),y=n.dataIdMap.get(g.dataId).id,b=n.makeOutput([l],"bool"),x=n.dataIdMap.get(b.dataId).id,k=n.makeOutput([u],a.dtype),w=n.dataIdMap.get(k.dataId).id,I=n.makeOutput([4],"int32"),S=n.dataIdMap.get(I.dataId).id,N=pY(h,d,Sq[i.dtype],u,l,c,f,v,y,x,w,S),T=n.readSync(I.dataId);switch(T[0]){case 1:t=vm.getSparseFillEmptyRowsIndicesDenseShapeMismatch(T[1]);break;case 2:t=vm.getSparseFillEmptyRowsNegativeIndexErrorMessage(T[1],T[2]);break;case 3:t=vm.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(T[1],T[2],T[3]);break;default:t=""}if(n.disposeData(I.dataId),t)throw n.disposeData(m.dataId),n.disposeData(g.dataId),n.disposeData(b.dataId),n.disposeData(k.dataId),new Error(t);var C=m,_=g;return N!==p[0]&&(C=tK({inputs:{x:m},attrs:{begin:0,size:[N,c]},backend:n}),_=tK({inputs:{x:g},attrs:{begin:0,size:N},backend:n}),n.disposeData(m.dataId),n.disposeData(g.dataId)),[C,_,b,k]}};var mY,vY={kernelName:Ur,backendName:"wasm",setupFunc:function(e){dY=e.wasm.cwrap(Ur,null,["number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=n.inputIndices,a=n.inputShape,i=n.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape\n        ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=t.dataIdMap.get(r.dataId).id,s=t.dataIdMap.get(a.dataId).id,u=t.dataIdMap.get(i.dataId).id,c=r.shape[0],l=Aa.sizeFromShape(i.shape),p=t.makeOutput([c,l],r.dtype),h=t.dataIdMap.get(p.dataId).id,d=t.makeOutput([l],i.dtype),f=t.dataIdMap.get(d.dataId).id,m=t.makeOutput([3],"int32"),v=t.dataIdMap.get(m.dataId).id;dY(o,s,u,c,h,f,v);var g,y=t.readSync(m.dataId);switch(y[0]){case 0:g=vm.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(y[1],y[2]);break;case 1:g=vm.getSparseReshapeNegativeOutputDimErrorMessage(y[1],y[2]);break;case 2:g=vm.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage();break;case 3:var b=Array.from(t.readSync(a.dataId)),x=Array.from(t.readSync(d.dataId));g=vm.getSparseReshapeInputOutputMultipleErrorMessage(b,x);break;case 4:var k=Array.from(t.readSync(a.dataId)),w=Array.from(t.readSync(d.dataId));g=vm.getSparseReshapeInputOutputMismatchErrorMessage(k,w);break;default:g=""}if(t.disposeData(m.dataId),g)throw t.disposeData(p.dataId),t.disposeData(d.dataId),new Error(g);return[p,d]}};function gY(e){mY=e.wasm.cwrap("SparseSegmentReduction",null,["number","number","number","number","number","number","number","number","number"])}function yY(e,t){var n=e.backend,r=e.inputs,a=r.data,i=r.indices,o=r.segmentIds,s=i.shape[0],u=n.readSync(o.dataId,s-1,s)[0],c=s>0?u+1:0;if(c<0)throw new Error(vm.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var l=a.shape.slice();l[0]=c;var p=n.dataIdMap.get(a.dataId).id,h=n.dataIdMap.get(i.dataId).id,d=n.dataIdMap.get(o.dataId).id,f=n.makeOutput(l,a.dtype),m=n.dataIdMap.get(f.dataId).id,v=n.makeOutput([4],"int32"),g=n.dataIdMap.get(v.dataId).id;mY(p,Sq[a.dtype],a.shape[0],h,d,m,g,t,0);var y,b=n.readSync(v.dataId);switch(b[0]){case 0:y=vm.getSparseSegmentReductionNegativeSegmentIdsErrorMessage();break;case 1:y=vm.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage();break;case 2:y=vm.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(b[1],b[2]);break;case 3:y=vm.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(b[1],b[2],b[3]);break;default:y=""}if(n.disposeData(v.dataId),y)throw n.disposeData(f.dataId),new Error(y);return f}var bY={kernelName:Gr,backendName:"wasm",setupFunc:gY,kernelFunc:function(e){return yY(e,!0)}};var xY={kernelName:Hr,backendName:"wasm",setupFunc:gY,kernelFunc:function(e){return yY(e,!1)}};var kY,wY={kernelName:Br,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.numOrSizeSplits,o=n.axis,s=Aa.parseAxisParam(o,a.shape)[0],u=vm.prepareSplitSize(a,i,s),c=new Array(a.shape.length).fill(0),l=a.shape.slice();return u.map((function(e){var t=(0,g.Z)(l);t[s]=e;var n=tK({inputs:{x:a},attrs:{begin:c,size:t},backend:r});return c[s]+=e,n}))}},IY=Rq(Lr),SY=Rq(Kr),NY=Zq(qr);var TY,CY={kernelName:pa,backendName:"wasm",setupFunc:function(e){kY=e.wasm.cwrap(pa,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs.alpha,a=n.x,i=t.dataIdMap.get(a.dataId).id,o=t.makeOutput(a.shape,a.dtype),s=t.dataIdMap.get(o.dataId).id;return kY(i,r,Sq[a.dtype],s),o}};var _Y={kernelName:Xr,backendName:"wasm",setupFunc:function(e){TY=e.wasm.cwrap(Xr,null,["number","array","number","array","array","array","array","array","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=e.attrs,i=r.x,o=a.begin,s=a.end,u=a.strides,c=a.beginMask,l=a.endMask,p=a.ellipsisMask,h=a.newAxisMask,d=a.shrinkAxisMask,f=Gf.sliceInfo(i.shape,o,s,u,c,l,p,h,d),m=f.finalShapeSparse,v=f.finalShape,g=f.isIdentity,y=f.sliceDim0,b=f.isSimpleSlice,x=f.begin,k=f.end,w=f.strides;if(g)t=Jq({inputs:{x:i},backend:n,attrs:{shape:v}});else if(y||b){Aa.assert(i.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(i.shape.length)}));var I=Gf.computeOutShape(x,k,w),S=tK({inputs:{x:i},backend:n,attrs:{begin:x,size:I}});t=Jq({inputs:{x:S},backend:n,attrs:{shape:v}}),n.disposeData(S.dataId)}else{var N=n.makeOutput(m,"float32"),T=n.dataIdMap.get(i.dataId).id,C=new Uint8Array(new Int32Array(Aa.computeStrides(i.shape)).buffer),_=new Uint8Array(new Int32Array(x).buffer),E=new Uint8Array(new Int32Array(k).buffer),A=new Uint8Array(new Int32Array(w).buffer),R=new Uint8Array(new Int32Array(m).buffer),F=new Uint8Array(new Int32Array(Aa.computeStrides(m)).buffer),Z=n.dataIdMap.get(N.dataId).id;TY(T,C,i.shape.length,_,E,A,R,F,m.length,Z),t=Jq({inputs:{x:N},backend:n,attrs:{shape:v}}),n.disposeData(N.dataId)}return t}};var EY={kernelName:Yr,backendName:"wasm",kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.data,i=n.dataSplits,o=r.separator,s=r.nGramWidths,u=r.leftPad,c=r.rightPad,l=r.padWidth,p=r.preserveShortSequences,d=DF(t.readSync(a.dataId),t.readSync(i.dataId),o,s,u,c,l,p),f=(0,h.Z)(d,2),m=f[0],v=f[1],g=t.makeOutput([m.length],"string");t.dataIdMap.get(g.dataId).stringBytes=m;var y=t.makeOutput(i.shape,"int32");return t.typedArrayFromHeap(y).set(v),[g,y]}};var AY={kernelName:Jr,backendName:"wasm",kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.input,i=n.delimiter,o=r.skipEmpty,s=OF(t.readSync(a.dataId),t.readSync(i.dataId)[0],o),u=(0,h.Z)(s,3),c=u[0],l=u[1],p=u[2],d=l.length,f=t.makeOutput([d,2],"int32");t.typedArrayFromHeap(f).set(c);var m=t.makeOutput([d],"string");t.dataIdMap.get(m.dataId).stringBytes=l;var v=t.makeOutput([2],"int32");return t.typedArrayFromHeap(v).set(p),[f,m,v]}};var RY,FY={kernelName:Qr,backendName:"wasm",kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.input,i=r.numBuckets,o=LF(t.readSync(a.dataId),i),s=t.makeOutput(a.shape,"int32");return t.typedArrayFromHeap(s).set(o),s}},ZY=Zq($r);var DY,MY={kernelName:zr,backendName:"wasm",setupFunc:function(e){RY=e.wasm.cwrap(zr,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,o=n.x,s=t.dataIdMap.get(o.dataId).id,u=s,c=o,l=Uq(o,a,t),p=l.transposed,d=l.axes,f=l.originalAxes,m=l.inputWasTransposed,v=d;if(m){var g=t.dataIdMap.get(p.dataId).id;g!==s&&(c=p,u=g,v=vm.getInnerMostAxes(v.length,c.shape.length))}vm.assertAxesAreInnerMostDims("sum",v,c.shape.length);var y=vm.computeOutAndReduceShapes(c.shape,v),b=(0,h.Z)(y,2),x=b[0],k=b[1],w=Aa.sizeFromShape(k),I=t.makeOutput(x,c.dtype);if(0!==Aa.sizeFromShape(c.shape)){var S=t.dataIdMap.get(I.dataId).id;RY(u,w,Sq[I.dtype],S)}if(m&&t.disposeData(p.dataId),i){var N=vm.expandShapeToKeepDim(I.shape,f);I.shape=N}return I}},OY=Rq(ea),LY=Rq(ta);var zY,PY={kernelName:na,backendName:"wasm",setupFunc:function(e){DY=e.wasm.cwrap(na,null,["number","array","number","array","number","number"])},kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=n.dataIdMap.get(a.dataId).id,o=r.reps,s=new Array(a.shape.length),u=0;u<s.length;u++)s[u]=a.shape[u]*o[u];var c=new Uint8Array(new Int32Array(a.shape).buffer),l=new Uint8Array(new Int32Array(s).buffer),p=n.makeOutput(s,a.dtype),h=n.dataIdMap.get(p.dataId).id;return DY(i,c,a.shape.length,l,s.length,Sq[p.dtype],h),p}};var BY,WY={kernelName:ra,backendName:"wasm",setupFunc:function(e){zY=e.wasm.cwrap(ra,null,["number","array","number","number","number","bool","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,o=r.sorted,s=n.dataIdMap.get(a.dataId).id,u=new Uint8Array(new Int32Array(a.shape).buffer),c=a.shape.slice();c[c.length-1]=i;var l=n.makeOutput(c,a.dtype),p=n.dataIdMap.get(l.dataId).id,h=n.makeOutput(c,"int32"),d=n.dataIdMap.get(h.dataId).id;return zY(s,u,a.shape.length,Sq[a.dtype],i,o,p,d),[l,h]}};var VY={kernelName:aa,backendName:"wasm",setupFunc:function(e){BY=e.wasm.cwrap(aa,null,["number","number","bool","number","number","number","number","number","number","array","number","array","number","number","number","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=e.attrs,i=r.image,o=r.transforms,s=a.interpolation,u=a.fillMode,c=a.fillValue,l=a.outputShape,p=(0,h.Z)(i.shape,4),d=p[0],f=p[1],m=p[2],v=p[3],g=null!=l?l:[f,m],y=(0,h.Z)(g,2),b=y[0],x=y[1],k=[d,b,x,v],w=new Uint8Array(new Int32Array(Aa.computeStrides(i.shape)).buffer),I=new Uint8Array(new Int32Array(Aa.computeStrides(k)).buffer),S=n.makeOutput(k,i.dtype),N=n.dataIdMap.get(S.dataId).id,T=n.dataIdMap.get(i.dataId).id,C=n.dataIdMap.get(o.dataId).id,_="nearest"===s?1:2;switch(u){case"constant":default:t=1;break;case"reflect":t=2;break;case"wrap":t=3;break;case"nearest":t=4}return BY(T,C,o.shape[0]>1,d,b,x,v,m,f,w,i.shape.length-1,I,k.length-1,_,t,c,N),S}};var UY={kernelName:sa,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a.shape[i],s=a.shape.length,u=new Array(s-1),c=0,l=0;l<s;l++)l!==i&&(u[c++]=a.shape[l]);var p=new Array(o),h=new Array(s).fill(0),d=a.shape.slice();d[i]=1;for(var f=0;f<p.length;f++)h[i]=f,p[f]=tK({inputs:{x:a},attrs:{begin:h,size:d},backend:n});return p.map((function(e){return{dataId:e.dataId,dtype:e.dtype,shape:u}}))}};for(var GY={kernelName:la,backendName:"wasm",kernelFunc:function(e){var t=e.inputs.x,n=e.backend,r=n.makeOutput(t.shape,t.dtype);return n.typedArrayFromHeap(r).fill(0),r}},HY=0,jY=[Aq,Fq,Mq,Oq,Hq,qq,Xq,Yq,eK,rK,oK,sK,uK,pK,dK,vK,gK,yK,xK,wK,SK,TK,CK,_K,EK,AK,FK,MK,LK,zK,PK,WK,UK,HK,qK,XK,YK,JK,Pq,QK,eX,tX,nX,rX,aX,iX,oX,sX,cX,lX,hX,fX,gX,yX,xX,kX,wX,NX,CX,EX,AX,RX,FX,DX,OX,LX,PX,WX,VX,UX,GX,HX,jX,$q,KX,YX,QX,eY,tY,nY,aY,oY,uY,cY,nK,lY,hY,fY,vY,bY,xY,wY,IY,SY,NY,CY,_Y,EY,AY,FY,ZY,MY,OY,LY,PY,WY,VY,Vq,UY,GY];HY<jY.length;HY++){Sa(jY[HY])}var qY=Qe();qY.registerFlag("WASM_HAS_SIMD_SUPPORT",(0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11])));case 4:return e.prev=4,e.t0=e.catch(0),e.abrupt("return",!1);case 7:case"end":return e.stop()}}),e,null,[[0,4]])})))),qY.registerFlag("WASM_HAS_MULTITHREAD_SUPPORT",(0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!qY.get("IS_NODE")){e.next=2;break}return e.abrupt("return",!1);case 2:return e.prev=2,e.abrupt("return",((new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))));case 6:return e.prev=6,e.t0=e.catch(2),e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e,null,[[2,6]])}))));var KY=R(Y()),XY=R(J()),YY=R(Q()),JY=KY.default||KY,QY=YY.default||YY,$Y=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this)).wasm=e,r.dataIdNextNumber=1,r.wasm.tfjs.initWithThreadsCount(hJ),dJ=r.wasm.tfjs.getThreadsCount(),r.dataIdMap=new $((0,s.Z)(r),gs()),r}return(0,v.Z)(n,[{key:"write",value:function(e,t,n){var r={id:this.dataIdNextNumber++};return this.move(r,e,t,n,1),r}},{key:"numDataIds",value:function(){return this.dataIdMap.numDataIds()}},{key:"time",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Aa.now(),e.abrupt("return",(t(),{kernelMs:Aa.now()-n}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"move",value:function(e,t,n,r,a){var i=this.dataIdNextNumber++;if("string"!==r){var o=Aa.sizeFromShape(n),s=o*Aa.bytesPerElement(r),u=this.wasm._malloc(s);this.dataIdMap.set(e,{id:i,memoryOffset:u,shape:n,dtype:r,refCount:a}),this.wasm.tfjs.registerTensor(i,o,u),null!=t&&this.wasm.HEAPU8.set(new Uint8Array(t.buffer,t.byteOffset,s),u)}else{var c=t;this.dataIdMap.set(e,{id:i,stringBytes:c,shape:n,dtype:r,memoryOffset:null,refCount:a})}}},{key:"read",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readSync(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readSync",value:function(e,t,n){var r=this.dataIdMap.get(e),a=r.memoryOffset,i=r.dtype,o=r.shape,s=r.stringBytes;if("string"===i)return null!=t&&0!==t||!(null==n||n>=s.length)?s.slice(t,n):s;t=t||0,n=n||Aa.sizeFromShape(o);var u=Aa.bytesPerElement(i);return function(e,t){switch(t){case"float32":return new Float32Array(e);case"int32":return new Int32Array(e);case"bool":return new Uint8Array(e);default:throw new Error("Unknown dtype ".concat(t))}}(this.wasm.HEAPU8.slice(a+t*u,a+n*u).buffer,i)}},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.dataIdMap.has(e)){var n=this.dataIdMap.get(e);if(n.refCount--,!t&&n.refCount>0)return!1;this.wasm._free(n.memoryOffset),this.wasm.tfjs.disposeData(n.id),this.dataIdMap.delete(e)}return!0}},{key:"refCount",value:function(e){return this.dataIdMap.has(e)?this.dataIdMap.get(e).refCount:0}},{key:"incRef",value:function(e){var t=this.dataIdMap.get(e);null!=t&&t.refCount++}},{key:"floatPrecision",value:function(){return 32}},{key:"getMemoryOffset",value:function(e){return this.dataIdMap.get(e).memoryOffset}},{key:"dispose",value:function(){this.wasm.tfjs.dispose(),"PThread"in this.wasm&&this.wasm.PThread.terminateAllThreads(),this.wasm=null}},{key:"memory",value:function(){return{unreliable:!1}}},{key:"makeOutput",value:function(e,t,n){var r;if(null==n)r=this.write(null,e,t);else{var a=this.dataIdNextNumber++;r={id:a},this.dataIdMap.set(r,{id:a,memoryOffset:n,shape:e,dtype:t,refCount:1});var i=Aa.sizeFromShape(e);this.wasm.tfjs.registerTensor(a,i,n)}return{dataId:r,shape:e,dtype:t}}},{key:"typedArrayFromHeap",value:function(e){var t=e.shape,n=e.dtype,r=e.dataId,a=this.wasm.HEAPU8.buffer,i=this.dataIdMap.get(r).memoryOffset,o=Aa.sizeFromShape(t);switch(n){case"float32":return new Float32Array(a,i,o);case"int32":return new Int32Array(a,i,o);case"bool":return new Uint8Array(a,i,o);default:throw new Error("Unknown dtype ".concat(n))}}}]),n}(ee);function eJ(e){return function(t,n){return Aa.fetch(e,{credentials:"same-origin"}).then((function(r){r.ok||t.env.a("failed to load wasm binary file at '".concat(e,"'")),r.arrayBuffer().then((function(e){WebAssembly.instantiate(e,t).then((function(e){n(e.instance,e.module)}))}))})),{}}}function tJ(e,t,n){if(null!=iJ)return iJ;var r="tfjs-backend-wasm.wasm";return e&&t?r="tfjs-backend-wasm-threaded-simd.wasm":e&&(r="tfjs-backend-wasm-simd.wasm"),null!=sJ&&null!=sJ[r]?sJ[r]:n+r}function nJ(){return rJ.apply(this,arguments)}function rJ(){return rJ=(0,f.Z)((0,d.Z)().mark((function e(){var t,n,r,a;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([Qe().getAsync("WASM_HAS_SIMD_SUPPORT"),Qe().getAsync("WASM_HAS_MULTITHREAD_SUPPORT")]);case 2:return t=e.sent,n=(0,h.Z)(t,2),r=n[0],a=n[1],e.abrupt("return",new Promise((function(e,t){var n={locateFile:function(e,t){if(e.endsWith(".worker.js")){var n=XY.wasmWorkerContents.replace(/\n/g,"\\n"),i=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(i)}return e.endsWith(".wasm")?tJ(r,a,null!=oJ?oJ:t):t+e}};cJ&&(n.instantiateWasm=eJ(tJ(r,a,null!=oJ?oJ:"")));var i,o=!1;n.onAbort=function(){o||uJ||(uJ=!0,t({message:"Make sure the server can serve the `.wasm` file relative to the bundled js file. For more details see https://github.com/tensorflow/tfjs/blob/master/tfjs-backend-wasm/README.md#using-bundlers"}))},a&&r&&null==iJ?(n.mainScriptUrlOrBlob=new Blob(["var WasmBackendModuleThreadedSimd = "+JY.toString()],{type:"text/javascript"}),i=JY(n)):i=QY(n),i.then((function(t){o=!0,uJ=!1;t.tfjs={init:t.cwrap("init",null,[]),initWithThreadsCount:t.cwrap("init_with_threads_count",null,["number"]),getThreadsCount:t.cwrap("get_threads_count","number",[]),registerTensor:t.cwrap("register_tensor",null,["number","number","number"]),disposeData:t.cwrap("dispose_data",null,["number"]),dispose:t.cwrap("dispose",null,[])},e({wasm:t})})).catch(t)})));case 7:case"end":return e.stop()}}),e)}))),rJ.apply(this,arguments)}var aJ=["tfjs-backend-wasm.wasm","tfjs-backend-wasm-simd.wasm","tfjs-backend-wasm-threaded-simd.wasm"],iJ=null,oJ=null,sJ={},uJ=!1,cJ=!1;function lJ(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(ms("setWasmPath has been deprecated in favor of setWasmPaths and will be removed in a future release."),uJ)throw new Error("The WASM backend was already initialized. Make sure you call `setWasmPath()` before you call `tf.setBackend()` or `tf.ready()`");iJ=e,cJ=t}function pJ(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(uJ)throw new Error("The WASM backend was already initialized. Make sure you call `setWasmPaths()` before you call `tf.setBackend()` or `tf.ready()`");if("string"==typeof e)oJ=e;else{sJ=e;var n=aJ.filter((function(e){return null==sJ[e]}));if(n.length>0)throw new Error("There were no entries found for the following binaries: ".concat(n.join(","),". Please either call setWasmPaths with a map providing a path for each binary, or with a string indicating the directory where all the binaries can be found."))}cJ=t}var hJ=-1,dJ=-1;function fJ(e){hJ=e}function mJ(){if(-1===dJ)throw new Error("WASM backend not initialized.");return dJ}var vJ="4.2.0";As("wasm",(0,f.Z)((0,d.Z)().mark((function e(){var t,n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nJ();case 2:return t=e.sent,n=t.wasm,e.abrupt("return",new $Y(n));case 5:case"end":return e.stop()}}),e)}))),2);var gJ="4.2.0",yJ={tfjs:gJ,"tfjs-core":gJ,"tfjs-converter":"4.2.0","tfjs-backend-cpu":"4.2.0","tfjs-backend-webgl":"4.2.0","tfjs-backend-wasm":"4.2.0"};function bJ(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.beginPath(),t.slice(1).forEach((function(n,r){var a=n.x,i=n.y,o=t[r];e.moveTo(o.x,o.y),e.lineTo(a,i)})),n){var r=t[t.length-1],a=t[0];if(!r||!a)return;e.moveTo(r.x,r.y),e.lineTo(a.x,a.y)}e.stroke()}w({},{AnchorPosition:function(){return sQ},DrawBox:function(){return pQ},DrawBoxOptions:function(){return lQ},DrawFaceLandmarks:function(){return c$},DrawFaceLandmarksOptions:function(){return u$},DrawTextField:function(){return cQ},DrawTextFieldOptions:function(){return uQ},drawContour:function(){return bJ},drawDetections:function(){return hQ},drawFaceExpressions:function(){return i$},drawFaceLandmarks:function(){return l$}});w({},{computeReshapedDimensions:function(){return AJ},getCenterPoint:function(){return RJ},isDimensions:function(){return EJ},isEven:function(){return CJ},isFloat:function(){return TJ},isTensor:function(){return kJ},isTensor1D:function(){return wJ},isTensor2D:function(){return IJ},isTensor3D:function(){return SJ},isTensor4D:function(){return NJ},isValidNumber:function(){return ZJ},isValidProbablitiy:function(){return DJ},range:function(){return FJ},round:function(){return _J}});var xJ=function(){function e(t,n){if((0,m.Z)(this,e),!ZJ(t)||!ZJ(n))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have ".concat(JSON.stringify({width:t,height:n})));this._width=t,this._height=n}return(0,v.Z)(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"reverse",value:function(){return new e(1/this.width,1/this.height)}}]),e}();function kJ(e,t){return e instanceof hi&&e.shape.length===t}function wJ(e){return kJ(e,1)}function IJ(e){return kJ(e,2)}function SJ(e){return kJ(e,3)}function NJ(e){return kJ(e,4)}function TJ(e){return e%1!==0}function CJ(e){return e%2===0}function _J(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=Math.pow(10,t);return Math.floor(e*n)/n}function EJ(e){return e&&e.width&&e.height}function AJ(e,t){var n=e.width,r=e.height,a=t/Math.max(r,n);return new xJ(Math.round(n*a),Math.round(r*a))}function RJ(e){return e.reduce((function(e,t){return e.add(t)}),new MJ(0,0)).div(new MJ(e.length,e.length))}function FJ(e,t,n){return Array(e).fill(0).map((function(e,r){return t+r*n}))}function ZJ(e){return!!e&&e!==1/0&&e!==-1/0&&!Number.isNaN(e)||0===e}function DJ(e){return ZJ(e)&&e>=0&&e<=1}var MJ=function(){function e(t,n){(0,m.Z)(this,e),this._x=t,this._y=n}return(0,v.Z)(e,[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"add",value:function(t){return new e(this.x+t.x,this.y+t.y)}},{key:"sub",value:function(t){return new e(this.x-t.x,this.y-t.y)}},{key:"mul",value:function(t){return new e(this.x*t.x,this.y*t.y)}},{key:"div",value:function(t){return new e(this.x/t.x,this.y/t.y)}},{key:"abs",value:function(){return new e(Math.abs(this.x),Math.abs(this.y))}},{key:"magnitude",value:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}},{key:"floor",value:function(){return new e(Math.floor(this.x),Math.floor(this.y))}}]),e}(),OJ=function(){function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(0,m.Z)(this,e);var r=t||{},a=[r.left,r.top,r.right,r.bottom].every(ZJ),i=[r.x,r.y,r.width,r.height].every(ZJ);if(!i&&!a)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have ".concat(JSON.stringify(r)));var o=i?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=(0,h.Z)(o,4),u=s[0],c=s[1],l=s[2],p=s[3];e.assertIsValidBox({x:u,y:c,width:l,height:p},"Box.constructor",n),this._x=u,this._y=c,this._width=l,this._height=p}return(0,v.Z)(e,[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"left",get:function(){return this.x}},{key:"top",get:function(){return this.y}},{key:"right",get:function(){return this.x+this.width}},{key:"bottom",get:function(){return this.y+this.height}},{key:"area",get:function(){return this.width*this.height}},{key:"topLeft",get:function(){return new MJ(this.left,this.top)}},{key:"topRight",get:function(){return new MJ(this.right,this.top)}},{key:"bottomLeft",get:function(){return new MJ(this.left,this.bottom)}},{key:"bottomRight",get:function(){return new MJ(this.right,this.bottom)}},{key:"round",value:function(){var t=[this.x,this.y,this.width,this.height].map((function(e){return Math.round(e)})),n=(0,h.Z)(t,4);return new e({x:n[0],y:n[1],width:n[2],height:n[3]})}},{key:"floor",value:function(){var t=[this.x,this.y,this.width,this.height].map((function(e){return Math.floor(e)})),n=(0,h.Z)(t,4);return new e({x:n[0],y:n[1],width:n[2],height:n[3]})}},{key:"toSquare",value:function(){var t=this.x,n=this.y,r=this.width,a=this.height,i=Math.abs(r-a);return r<a&&(t-=i/2,r+=i),a<r&&(n-=i/2,a+=i),new e({x:t,y:n,width:r,height:a})}},{key:"rescale",value:function(t){var n=EJ(t)?t.width:t,r=EJ(t)?t.height:t;return new e({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})}},{key:"pad",value:function(t,n){return new e({x:this.x-t/2,y:this.y-n/2,width:this.width+t,height:this.height+n})}},{key:"clipAtImageBorders",value:function(t,n){var r=this.x,a=this.y,i=this.right,o=this.bottom,s=Math.max(r,0),u=Math.max(a,0),c=i-s,l=o-u;return new e({x:s,y:u,width:Math.min(c,t-s),height:Math.min(l,n-u)}).floor()}},{key:"shift",value:function(t,n){var r=this.width,a=this.height;return new e({x:this.x+t,y:this.y+n,width:r,height:a})}},{key:"padAtBorders",value:function(e,t){var n=this.width+1,r=this.height+1,a=n,i=r,o=this.left,s=this.top,u=this.right,c=this.bottom;return u>t&&(a=-u+t+n,u=t),c>e&&(i=-c+e+r,c=e),o<1&&(i=2-o,o=1),s<1&&(i=2-s,s=1),{dy:1,edy:i,dx:1,edx:a,y:s,ey:c,x:o,ex:u,w:n,h:r}}},{key:"calibrate",value:function(t){return new e({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()}}],[{key:"isRect",value:function(e){return!!e&&[e.x,e.y,e.width,e.height].every(ZJ)}},{key:"assertIsValidBox",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e.isRect(t))throw new Error("".concat(n," - invalid box: ").concat(JSON.stringify(t),", expected object with properties x, y, width, height"));if(!r&&(t.width<0||t.height<0))throw new Error("".concat(n," - width (").concat(t.width,") and height (").concat(t.height,") must be positive numbers"))}}]),e}(),LJ=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r,a,i){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return(0,m.Z)(this,n),t.call(this,{left:e,top:r,right:a,bottom:i},o)}return(0,v.Z)(n)}(OJ),zJ=function(){function e(t,n,r,a,i){(0,m.Z)(this,e),this._imageDims=new xJ(i.width,i.height),this._score=t,this._classScore=n,this._className=r,this._box=new OJ(a).rescale(this._imageDims)}return(0,v.Z)(e,[{key:"score",get:function(){return this._score}},{key:"classScore",get:function(){return this._classScore}},{key:"className",get:function(){return this._className}},{key:"box",get:function(){return this._box}},{key:"imageDims",get:function(){return this._imageDims}},{key:"imageWidth",get:function(){return this.imageDims.width}},{key:"imageHeight",get:function(){return this.imageDims.height}},{key:"relativeBox",get:function(){return new OJ(this._box).rescale(this.imageDims.reverse())}},{key:"forSize",value:function(t,n){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:n})}}]),e}(),PJ=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r,a){return(0,m.Z)(this,n),t.call(this,e,e,"",r,a)}return(0,v.Z)(n,[{key:"forSize",value:function(e,t){var r=o((0,i.Z)(n.prototype),"forSize",this).call(this,e,t);return new n(r.score,r.relativeBox,r.imageDims)}}]),n}(zJ);function BJ(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left))*Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top));return n?r/(e.area+t.area-r):r/Math.min(e.area,t.area)}function WJ(e,t,n){for(var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=t.map((function(e,t){return{score:e,boxIndex:t}})).sort((function(e,t){return e.score-t.score})).map((function(e){return e.boxIndex})),i=[],o=function(){var t=a.pop();i.push(t);for(var o=a,s=[],u=0;u<o.length;u++){var c=o[u],l=e[t],p=e[c];s.push(BJ(l,p,r))}a=a.filter((function(e,t){return s[t]<=n}))};a.length>0;)o();return i}function VJ(e,t){return xs((function(){var n=(0,h.Z)(t,3),r=n[0],a=n[1],i=n[2],o=Au([].concat((0,g.Z)(e.shape.slice(0,3)),[1]),r,"float32"),s=Au([].concat((0,g.Z)(e.shape.slice(0,3)),[1]),a,"float32"),u=Au([].concat((0,g.Z)(e.shape.slice(0,3)),[1]),i,"float32"),c=fu([o,s,u],3);return al(e,c)}))}function UJ(e){return 1/(1+Math.exp(-e))}var GJ,HJ=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r,a,i){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return(0,m.Z)(this,n),t.call(this,{x:e,y:r,width:a,height:i},o)}return(0,v.Z)(n)}(OJ),jJ=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new MJ(0,0);(0,m.Z)(this,e);var a=n.width,i=n.height;this._imgDims=new xJ(a,i),this._shift=r,this._positions=t.map((function(e){return e.mul(new MJ(a,i)).add(r)}))}return(0,v.Z)(e,[{key:"shift",get:function(){return new MJ(this._shift.x,this._shift.y)}},{key:"imageWidth",get:function(){return this._imgDims.width}},{key:"imageHeight",get:function(){return this._imgDims.height}},{key:"positions",get:function(){return this._positions}},{key:"relativePositions",get:function(){var e=this;return this._positions.map((function(t){return t.sub(e._shift).div(new MJ(e.imageWidth,e.imageHeight))}))}},{key:"forSize",value:function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})}},{key:"shiftBy",value:function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new MJ(e,t))}},{key:"shiftByPoint",value:function(e){return this.shiftBy(e.x,e.y)}},{key:"align",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e){var n=e instanceof PJ?e.box.floor():new OJ(e);return this.shiftBy(n.x,n.y).align(null,t)}var a=(0,r.Z)({useDlibAlignment:!1,minBoxPadding:.2},t),i=a.useDlibAlignment,o=a.minBoxPadding;return i?this.alignDlib():this.alignMinBbox(o)}},{key:"alignDlib",value:function(){var e=this.getRefPointsForAlignment(),t=(0,h.Z)(e,3),n=t[0],r=t[1],a=t[2],i=function(e){return a.sub(e).magnitude()},o=(i(n)+i(r))/2,s=Math.floor(o/.45),u=RJ(e),c=Math.floor(Math.max(0,u.x-.5*s)),l=Math.floor(Math.max(0,u.y-.43*s));return new HJ(c,l,Math.min(s,this.imageWidth+c),Math.min(s,this.imageHeight+l))}},{key:"alignMinBbox",value:function(e){var t=function(e){var t=e.map((function(e){return e.x})),n=e.map((function(e){return e.y})),r=t.reduce((function(e,t){return t<e?t:e}),1/0),a=n.reduce((function(e,t){return t<e?t:e}),1/0),i=t.reduce((function(e,t){return e<t?t:e}),0),o=n.reduce((function(e,t){return e<t?t:e}),0);return new LJ(r,a,i,o)}(this.positions);return t.pad(t.width*e,t.height*e)}},{key:"getRefPointsForAlignment",value:function(){throw new Error("getRefPointsForAlignment not implemented by base class")}}]),e}(),qJ=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"getJawOutline",value:function(){return this.positions.slice(0,17)}},{key:"getLeftEyeBrow",value:function(){return this.positions.slice(17,22)}},{key:"getRightEyeBrow",value:function(){return this.positions.slice(22,27)}},{key:"getNose",value:function(){return this.positions.slice(27,36)}},{key:"getLeftEye",value:function(){return this.positions.slice(36,42)}},{key:"getRightEye",value:function(){return this.positions.slice(42,48)}},{key:"getMouth",value:function(){return this.positions.slice(48,68)}},{key:"getRefPointsForAlignment",value:function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(RJ)}}]),n}(jJ);function KJ(e){return e.detection instanceof PJ}function XJ(e,t){return(0,r.Z)((0,r.Z)({},e),{detection:t})}function YJ(){var e=window.fetch;if(!e)throw new Error("fetch - missing fetch implementation for browser environment");return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},createVideoElement:function(){return document.createElement("video")},fetch:e,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function JJ(){return"object"==typeof n.g&&"undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node}function QJ(e){var t="";if(!e&&JJ())try{e=k("fs")}catch(n){t=n.toString()}return{readFile:e?function(t){return new Promise((function(n,r){e.readFile(t,(function(e,t){return e?r(e):n(t)}))}))}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: ".concat(t))}}}function $J(){var e=n.g.Canvas||n.g.HTMLCanvasElement,t=n.g.Image||n.g.HTMLImageElement,a=n.g.Video||n.g.HTMLVideoElement,i=n.g.fetch,o=QJ();return(0,r.Z)({Canvas:e||function(){return(0,v.Z)((function e(){(0,m.Z)(this,e)}))}(),CanvasRenderingContext2D:n.g.CanvasRenderingContext2D||function(){return(0,v.Z)((function e(){(0,m.Z)(this,e)}))}(),Image:t||function(){return(0,v.Z)((function e(){(0,m.Z)(this,e)}))}(),ImageData:n.g.ImageData||function(){return(0,v.Z)((function e(){(0,m.Z)(this,e)}))}(),Video:n.g.HTMLVideoElement||function(){return(0,v.Z)((function e(){(0,m.Z)(this,e)}))}(),createCanvasElement:function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},createVideoElement:function(){if(a)return new a;throw new Error("createVideoElement - missing Video implementation for nodejs environment")},fetch:i},o)}function eQ(){return"object"==typeof window&&"undefined"!=typeof document&&"undefined"!=typeof HTMLImageElement&&"undefined"!=typeof HTMLCanvasElement&&"undefined"!=typeof HTMLVideoElement&&"undefined"!=typeof ImageData&&"undefined"!=typeof CanvasRenderingContext2D}function tQ(e){GJ=e}function nQ(){return eQ()?tQ(YJ()):JJ()?tQ($J()):null}var rQ={getEnv:function(){if(!GJ)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return GJ},setEnv:tQ,initialize:nQ,createBrowserEnv:YJ,createFileSystem:QJ,createNodejsEnv:$J,monkeyPatch:function(e){if(GJ||nQ(),!GJ)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=e.Canvas,n=void 0===t?GJ.Canvas:t,r=e.Image,a=void 0===r?GJ.Image:r;GJ.Canvas=n,GJ.Image=a,GJ.createCanvasElement=e.createCanvasElement||function(){return new n},GJ.createImageElement=e.createImageElement||function(){return new a},GJ.ImageData=e.ImageData||GJ.ImageData,GJ.Video=e.Video||GJ.Video,GJ.fetch=e.fetch||GJ.fetch,GJ.readFile=e.readFile||GJ.readFile},isBrowser:eQ,isNodejs:JJ};function aQ(e){return rQ.isNodejs()||"string"!=typeof e?e:document.getElementById(e)}function iQ(e){var t=rQ.getEnv(),n=t.Canvas;if(e instanceof t.CanvasRenderingContext2D)return e;var r=aQ(e);if(!(r instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var a=r.getContext("2d");if(!a)throw new Error("resolveContext2d - canvas 2d context is null");return a}nQ();var oQ,sQ=((oQ=sQ||{}).TOP_LEFT="TOP_LEFT",oQ.TOP_RIGHT="TOP_RIGHT",oQ.BOTTOM_LEFT="BOTTOM_LEFT",oQ.BOTTOM_RIGHT="BOTTOM_RIGHT",oQ),uQ=(0,v.Z)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,m.Z)(this,e);var n=t.anchorPosition,r=t.backgroundColor,a=t.fontColor,i=t.fontSize,o=t.fontStyle,s=t.padding;this.anchorPosition=n||"TOP_LEFT",this.backgroundColor=r||"rgba(0, 0, 0, 0.5)",this.fontColor=a||"rgba(255, 255, 255, 1)",this.fontSize=i||14,this.fontStyle=o||"Georgia",this.padding=s||4})),cQ=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,m.Z)(this,e),this.text="string"==typeof t?[t]:t instanceof e?t.text:t,this.anchor=n,this.options=new uQ(r)}return(0,v.Z)(e,[{key:"measureWidth",value:function(e){var t=this.options.padding;return this.text.map((function(t){return e.measureText(t).width})).reduce((function(e,t){return e<t?t:e}),0)+2*t}},{key:"measureHeight",value:function(){var e=this.options,t=e.fontSize,n=e.padding;return this.text.length*t+2*n}},{key:"getUpperLeft",value:function(e,t){var n=this.options.anchorPosition,r="BOTTOM_RIGHT"===n||"TOP_RIGHT"===n,a="BOTTOM_LEFT"===n||"BOTTOM_RIGHT"===n,i=this.measureWidth(e),o=this.measureHeight(),s=r?this.anchor.x-i:this.anchor.x,u=a?this.anchor.y-o:this.anchor.y;if(t){var c=t.width,l=t.height;return{x:Math.max(Math.min(s,c-i),0),y:Math.max(Math.min(u,l-o),0)}}return{x:s,y:u}}},{key:"draw",value:function(e){var t=aQ(e),n=iQ(t),r=this.options,a=r.backgroundColor,i=r.fontColor,o=r.fontSize,s=r.fontStyle,u=r.padding;n.font="".concat(o,"px ").concat(s);var c=this.measureWidth(n),l=this.measureHeight();n.fillStyle=a;var p=this.getUpperLeft(n,t);n.fillRect(p.x,p.y,c,l),n.fillStyle=i,this.text.forEach((function(e,t){var r=u+p.x,a=u+p.y+(t+1)*o;n.fillText(e,r,a)}))}}]),e}(),lQ=(0,v.Z)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,m.Z)(this,e);var n=t.boxColor,a=t.lineWidth,i=t.label,o=t.drawLabelOptions;this.boxColor=n||"rgba(0, 0, 255, 1)",this.lineWidth=a||2,this.label=i;var s={anchorPosition:"BOTTOM_LEFT",backgroundColor:this.boxColor};this.drawLabelOptions=new uQ((0,r.Z)((0,r.Z)({},s),o))})),pQ=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,m.Z)(this,e),this.box=new OJ(t),this.options=new lQ(n)}return(0,v.Z)(e,[{key:"draw",value:function(e){var t=iQ(e),n=this.options,r=n.boxColor,a=n.lineWidth,i=this.box,o=i.x,s=i.y,u=i.width,c=i.height;t.strokeStyle=r,t.lineWidth=a,t.strokeRect(o,s,u,c);var l=this.options.label;l&&new cQ([l],{x:o-a/2,y:s},this.options.drawLabelOptions).draw(e)}}]),e}();function hQ(e,t){(Array.isArray(t)?t:[t]).forEach((function(t){var n=t instanceof PJ?t.score:KJ(t)?t.detection.score:void 0,r=t instanceof PJ?t.box:KJ(t)?t.detection.box:new OJ(t),a=n?"".concat(_J(n)):void 0;new pQ(r,{label:a}).draw(e)}))}function dQ(e){var t=rQ.getEnv(),n=t.Image,r=t.Video;return e instanceof n&&e.complete||e instanceof r&&e.readyState>=3}function fQ(e){return new Promise((function(t,n){function r(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",a),e.currentTarget.removeEventListener("error",r),n(e))}function a(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",a),e.currentTarget.removeEventListener("error",r),t(e))}(e instanceof rQ.getEnv().Canvas||dQ(e))&&t(null),e.addEventListener("load",a),e.addEventListener("error",r)}))}function mQ(e){var t=rQ.getEnv(),n=t.Image,r=t.Video;return e instanceof n?new xJ(e.naturalWidth,e.naturalHeight):e instanceof r?new xJ(e.videoWidth,e.videoHeight):new xJ(e.width,e.height)}function vQ(e){var t=e.width,n=e.height,r=(0,rQ.getEnv().createCanvasElement)();return r.width=t,r.height=n,r}function gQ(e,t){var n=rQ.getEnv().ImageData;if(!(e instanceof n)&&!dQ(e))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=t||mQ(e),a=r.width,i=r.height,o=vQ({width:a,height:i});return e instanceof n?iQ(o).putImageData(e,0,0):iQ(o).drawImage(e,0,0,a,i),o}function yQ(e,t){return bQ.apply(this,arguments)}function bQ(){return bQ=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i,o,s,u,c;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n||rQ.getEnv().createCanvasElement(),a=t.shape.slice(NJ(t)?1:0),i=(0,h.Z)(a,3),o=i[0],s=i[1],u=i[2],c=xs((function(){return t.as3D(o,s,u).toInt()})),e.next=3,Df.toPixels(c,r);case 3:return c.dispose(),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)}))),bQ.apply(this,arguments)}function xQ(e){var t=rQ.getEnv(),n=t.Image,r=t.Canvas,a=t.Video;return e instanceof n||e instanceof r||e instanceof a}var kQ=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if((0,m.Z)(this,e),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],this._inputSize=0,!Array.isArray(t))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have ".concat(t));this._treatAsBatchInput=r,this._batchSize=t.length,t.forEach((function(e,t){if(SJ(e))return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape);if(NJ(e)){var r=e.shape[0];if(1!==r)throw new Error("NetInput - tf.Tensor4D with batchSize ".concat(r," passed, but not supported in input array"));return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape.slice(1))}var a=e instanceof rQ.getEnv().Canvas?e:gQ(e);n._canvases[t]=a,n._inputDimensions[t]=[a.height,a.width,3]}))}return(0,v.Z)(e,[{key:"imageTensors",get:function(){return this._imageTensors}},{key:"canvases",get:function(){return this._canvases}},{key:"isBatchInput",get:function(){return this.batchSize>1||this._treatAsBatchInput}},{key:"batchSize",get:function(){return this._batchSize}},{key:"inputDimensions",get:function(){return this._inputDimensions}},{key:"inputSize",get:function(){return this._inputSize}},{key:"reshapedInputDimensions",get:function(){var e=this;return FJ(this.batchSize,0,1).map((function(t,n){return e.getReshapedInputDimensions(n)}))}},{key:"getInput",value:function(e){return this.canvases[e]||this.imageTensors[e]}},{key:"getInputDimensions",value:function(e){return this._inputDimensions[e]}},{key:"getInputHeight",value:function(e){return this._inputDimensions[e][0]}},{key:"getInputWidth",value:function(e){return this._inputDimensions[e][1]}},{key:"getReshapedInputDimensions",value:function(e){if("number"!=typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return AJ({width:this.getInputWidth(e),height:this.getInputHeight(e)},this.inputSize)}},{key:"toBatchTensor",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._inputSize=e,xs((function(){var r=FJ(t.batchSize,0,1).map((function(r){var a=t.getInput(r);if(a instanceof hi){var i=NJ(a)?a:Ec(a);return i=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return xs((function(){var n=e.shape.slice(1),r=(0,h.Z)(n,2),a=r[0],i=r[1];if(a===i)return e;var o=Math.abs(a-i),s=Math.round(o*(t?.5:1)),u=a>i?2:1,c=function(t){var n=e.shape.slice();return n[u]=t,Au(n,0,"float32")},l=c(s),p=o-l.shape[u],d=[t&&p?c(p):null,e,l].filter((function(e){return!!e})).map((function(e){return cs(e,"float32")}));return fu(d,u)}))}(i,n),(i.shape[1]!==e||i.shape[2]!==e)&&(i=Pd.resizeBilinear(i,[e,e],!1,!1)),i.as3D(e,e,3)}if(a instanceof rQ.getEnv().Canvas)return Df.fromPixels(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=rQ.getEnv(),a=r.Image,i=r.Canvas;if(!(e instanceof a||e instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");if(t<=0)return vQ({width:1,height:1});var o=mQ(e),s=t/Math.max(o.height,o.width),u=s*o.width,c=s*o.height,l=vQ({width:t,height:t}),p=e instanceof i?e:gQ(e),h=Math.abs(u-c)/2,d=n&&u<c?h:0,f=n&&c<u?h:0;return p.width>0&&p.height>0&&iQ(l).drawImage(p,d,f,u,c),l}(a,e,n));throw new Error("toBatchTensor - at batchIdx ".concat(r,", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have ").concat(a))}));return jp(r.map((function(e){return cs(e,"float32")}))).as4D(t.batchSize,e,e,3)}))}}]),e}();function wQ(e){return IQ.apply(this,arguments)}function IQ(){return IQ=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r,a;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t instanceof kQ)){e.next=2;break}return e.abrupt("return",t);case 2:if((n=Array.isArray(t)?t:[t]).length){e.next=5;break}throw new Error("toNetInput - empty array passed as input");case 5:return r=function(e){return Array.isArray(t)?" at input index ".concat(e,":"):""},(a=n.map(aQ)).forEach((function(e,t){if(!xQ(e)&&!SJ(e)&&!NJ(e))throw"string"==typeof n[t]?new Error("toNetInput -".concat(r(t)," string passed, but could not resolve HTMLElement for element id ").concat(n[t])):new Error("toNetInput -".concat(r(t)," expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id"));if(NJ(e)){var a=e.shape[0];if(1!==a)throw new Error("toNetInput -".concat(r(t)," tf.Tensor4D with batchSize ").concat(a," passed, but not supported in input array"))}})),e.next=9,Promise.all(a.map((function(e){return xQ(e)&&fQ(e)})));case 9:return e.abrupt("return",new kQ(a,Array.isArray(t)));case 10:case"end":return e.stop()}}),e)}))),IQ.apply(this,arguments)}function SQ(e,t){return NQ.apply(this,arguments)}function NQ(){return NQ=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i,o,s,u;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=rQ.getEnv(),a=r.Canvas,i=t,t instanceof a){e.next=16;break}return e.next=4,wQ(t);case 4:if(!((o=e.sent).batchSize>1)){e.next=7;break}throw new Error("extractFaces - batchSize > 1 not supported");case 7:if(!((s=o.getInput(0))instanceof a)){e.next=12;break}e.t0=s,e.next=15;break;case 12:return e.next=14,yQ(s);case 14:e.t0=e.sent;case 15:i=e.t0;case 16:return u=iQ(i),e.abrupt("return",n.map((function(e){return e instanceof PJ?e.forSize(i.width,i.height).box.floor():e})).map((function(e){return e.clipAtImageBorders(i.width,i.height)})).map((function(e){var t=e.x,n=e.y,r=e.width,a=e.height,i=vQ({width:r,height:a});return r>0&&a>0&&iQ(i).putImageData(u.getImageData(t,n,r,a),0,0),i})));case 18:case"end":return e.stop()}}),e)}))),NQ.apply(this,arguments)}function TQ(e,t){return CQ.apply(this,arguments)}function CQ(){return CQ=(0,f.Z)((0,d.Z)().mark((function e(t,n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(SJ(t)||NJ(t)){e.next=2;break}throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");case 2:if(!(NJ(t)&&t.shape[0]>1)){e.next=4;break}throw new Error("extractFaceTensors - batchSize > 1 not supported");case 4:return e.abrupt("return",xs((function(){var e=t.shape.slice(NJ(t)?1:0),r=(0,h.Z)(e,3),a=r[0],i=r[1],o=r[2];return n.map((function(e){return e instanceof PJ?e.forSize(i,a).box:e})).map((function(e){return e.clipAtImageBorders(i,a)})).filter((function(e){return e.width>0&&e.height>0})).map((function(e){var n=e.x,r=e.y,s=e.width,u=e.height;return Op(t.as3D(a,i,o),[r,n,0],[u,s,o])}))})));case 5:case"end":return e.stop()}}),e)}))),CQ.apply(this,arguments)}function _Q(e,t){return EQ.apply(this,arguments)}function EQ(){return EQ=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=rQ.getEnv(),a=r.fetch,e.next=4,a(t,n);case 4:if((i=e.sent).status<400){e.next=7;break}throw new Error("failed to fetch: (".concat(i.status,") ").concat(i.statusText,", from url: ").concat(i.url));case 7:return e.abrupt("return",i);case 8:case"end":return e.stop()}}),e)}))),EQ.apply(this,arguments)}function AQ(e){return RQ.apply(this,arguments)}function RQ(){return RQ=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_Q(t);case 2:return e.abrupt("return",e.sent.json());case 3:case"end":return e.stop()}}),e)}))),RQ.apply(this,arguments)}function FQ(e,t){var n="".concat(t,"-weights_manifest.json");if(!e)return{modelBaseUri:"",manifestUri:n};if("/"===e)return{modelBaseUri:"/",manifestUri:"/".concat(n)};var r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"",a=(e=e.replace(r,"")).split("/").filter((function(e){return e})),i=e.endsWith(".json")?a[a.length-1]:n,o=r+(e.endsWith(".json")?a.slice(0,a.length-1):a).join("/");return{modelBaseUri:o=e.startsWith("/")?"/".concat(o):o,manifestUri:"/"===o?"/".concat(i):"".concat(o,"/").concat(i)}}function ZQ(e,t){return DQ.apply(this,arguments)}function DQ(){return DQ=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i,o;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=FQ(t,n),a=r.manifestUri,i=r.modelBaseUri,e.next=5,AQ(a);case 5:return o=e.sent,e.abrupt("return",rf.loadWeights(o,i));case 7:case"end":return e.stop()}}),e)}))),DQ.apply(this,arguments)}var MQ=function(){function e(t){(0,m.Z)(this,e),this._params=void 0,this._paramMappings=[],this._name=t}return(0,v.Z)(e,[{key:"params",get:function(){return this._params}},{key:"paramMappings",get:function(){return this._paramMappings}},{key:"isLoaded",get:function(){return!!this.params}},{key:"getParamFromPath",value:function(e){var t=this.traversePropertyPath(e);return t.obj[t.objProp]}},{key:"reassignParamFromPath",value:function(e,t){var n=this.traversePropertyPath(e),r=n.obj,a=n.objProp;r[a].dispose(),r[a]=t}},{key:"getParamList",value:function(){var e=this;return this._paramMappings.map((function(t){var n=t.paramPath;return{path:n,tensor:e.getParamFromPath(n)}}))}},{key:"getTrainableParams",value:function(){return this.getParamList().filter((function(e){return e.tensor instanceof fi}))}},{key:"getFrozenParams",value:function(){return this.getParamList().filter((function(e){return!(e.tensor instanceof fi)}))}},{key:"variable",value:function(){var e=this;this.getFrozenParams().forEach((function(t){var n=t.path,r=t.tensor;e.reassignParamFromPath(n,r.variable())}))}},{key:"freeze",value:function(){var e=this;this.getTrainableParams().forEach((function(t){var n=t.path,r=t.tensor,a=Yi(r.dataSync());r.dispose(),e.reassignParamFromPath(n,a)}))}},{key:"dispose",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.getParamList().forEach((function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path ".concat(t.path));t.tensor.dispose()})),this._params=void 0}},{key:"serializeParams",value:function(){return new Float32Array(this.getParamList().map((function(e){var t=e.tensor;return Array.from(t.dataSync())})).reduce((function(e,t){return e.concat(t)})))}},{key:"load",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t instanceof Float32Array)){e.next=3;break}return this.extractWeights(t),e.abrupt("return");case 3:return e.next=5,this.loadFromUri(t);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadFromUri",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||"string"==typeof t){e.next=2;break}throw new Error("".concat(this._name,".loadFromUri - expected model uri"));case 2:return e.next=4,ZQ(t,this.getDefaultModelName());case 4:n=e.sent,this.loadFromWeightMap(n);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadFromDisk",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r,a,i,o,s,u,c,l;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||"string"==typeof t){e.next=2;break}throw new Error("".concat(this._name,".loadFromDisk - expected model file path"));case 2:return n=rQ.getEnv(),r=n.readFile,a=FQ(t,this.getDefaultModelName()),i=a.manifestUri,o=a.modelBaseUri,s=function(e){return Promise.all(e.map((function(e){return r(e).then((function(e){return e.buffer}))})))},u=rf.weightsLoaderFactory(s),e.t0=JSON,e.next=12,r(i);case 12:return e.t1=e.sent.toString(),c=e.t0.parse.call(e.t0,e.t1),e.next=16,u(c,o);case 16:l=e.sent,this.loadFromWeightMap(l);case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadFromWeightMap",value:function(e){var t=this.extractParamsFromWeightMap(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r}},{key:"extractWeights",value:function(e){var t=this.extractParams(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r}},{key:"traversePropertyPath",value:function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce((function(t,n){if(!t.nextObj.hasOwnProperty(n))throw new Error("traversePropertyPath - object does not have property ".concat(n,", for path ").concat(e));return{obj:t.nextObj,objProp:n,nextObj:t.nextObj[n]}}),{nextObj:this.params}),n=t.obj,r=t.objProp;if(!n||!r||!(n[r]instanceof hi))throw new Error("traversePropertyPath - parameter is not a tensor, for path ".concat(e));return{obj:n,objProp:r}}}]),e}();function OQ(e,t,n){return xs((function(){var r=_p(e,t.depthwise_filter,t.pointwise_filter,n,"same");return r=Zs(r,t.bias)}))}function LQ(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return xs((function(){var r=yp(n?Zs(Ou(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):OQ(e,t.conv0,[2,2])),a=OQ(r,t.conv1,[1,1]),i=OQ(yp(Zs(r,a)),t.conv2,[1,1]);return yp(Zs(r,Zs(a,i)))}))}function zQ(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return xs((function(){var a=yp(n?Zs(Ou(e,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):OQ(e,t.conv0,r?[2,2]:[1,1])),i=OQ(a,t.conv1,[1,1]),o=OQ(yp(Zs(a,i)),t.conv2,[1,1]),s=OQ(yp(Zs(a,Zs(i,o))),t.conv3,[1,1]);return yp(Zs(a,Zs(i,Zs(o,s))))}))}function PQ(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"same",r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return xs((function(){var a=Zs(Ou(e,t.filters,[1,1],n),t.bias);return r?yp(a):a}))}function BQ(e,t){Object.keys(e).forEach((function(n){t.some((function(e){return e.originalPath===n}))||e[n].dispose()}))}function WQ(e,t){return function(n,r,a,i){var o=$p(e(n*r*a*a),[a,a,n,r]),s=Yp(e(r));return t.push({paramPath:"".concat(i,"/filters")},{paramPath:"".concat(i,"/bias")}),{filters:o,bias:s}}}function VQ(e,t){return function(n,r,a){var i=Jp(e(n*r),[n,r]),o=Yp(e(r));return t.push({paramPath:"".concat(a,"/weights")},{paramPath:"".concat(a,"/bias")}),{weights:i,bias:o}}}var UQ=(0,v.Z)((function e(t,n,r){(0,m.Z)(this,e),this.depthwise_filter=t,this.pointwise_filter=n,this.bias=r}));function GQ(e,t){return function(n,r,a){var i=$p(e(9*n),[3,3,n,1]),o=$p(e(n*r),[1,1,n,r]),s=Yp(e(r));return t.push({paramPath:"".concat(a,"/depthwise_filter")},{paramPath:"".concat(a,"/pointwise_filter")},{paramPath:"".concat(a,"/bias")}),new UQ(i,o,s)}}function HQ(e){return function(t){var n=e("".concat(t,"/depthwise_filter"),4),r=e("".concat(t,"/pointwise_filter"),4),a=e("".concat(t,"/bias"),1);return new UQ(n,r,a)}}function jQ(e,t){return function(n,r,a){var i=e[n];if(!kJ(i,r))throw new Error("expected weightMap[".concat(n,"] to be a Tensor").concat(r,"D, instead have ").concat(i));return t.push({originalPath:n,paramPath:a||n}),i}}function qQ(e){var t=e;return{extractWeights:function(e){var n=t.slice(0,e);return t=t.slice(e),n},getRemainingWeights:function(){return t}}}function KQ(e,t){var n=WQ(e,t),r=GQ(e,t);function a(e,t,a){return{conv0:arguments.length>3&&void 0!==arguments[3]&&arguments[3]?n(e,t,3,"".concat(a,"/conv0")):r(e,t,"".concat(a,"/conv0")),conv1:r(t,t,"".concat(a,"/conv1")),conv2:r(t,t,"".concat(a,"/conv2"))}}return{extractDenseBlock3Params:a,extractDenseBlock4Params:function(e,t,n){var i=a(e,t,n,arguments.length>3&&void 0!==arguments[3]&&arguments[3]);return{conv0:i.conv0,conv1:i.conv1,conv2:i.conv2,conv3:r(t,t,"".concat(n,"/conv3"))}}}}function XQ(e){return function(t){return{filters:e("".concat(t,"/filters"),4),bias:e("".concat(t,"/bias"),1)}}}function YQ(e,t){var n=jQ(e,t),r=XQ(n),a=HQ(n);return{extractDenseBlock3Params:function(e){return{conv0:arguments.length>1&&void 0!==arguments[1]&&arguments[1]?r("".concat(e,"/conv0")):a("".concat(e,"/conv0")),conv1:a("".concat(e,"/conv1")),conv2:a("".concat(e,"/conv2"))}},extractDenseBlock4Params:function(e){return{conv0:arguments.length>1&&void 0!==arguments[1]&&arguments[1]?r("".concat(e,"/conv0")):a("".concat(e,"/conv0")),conv1:a("".concat(e,"/conv1")),conv2:a("".concat(e,"/conv2")),conv3:a("".concat(e,"/conv3"))}}}}var JQ=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.call(this,"FaceFeatureExtractor")}return(0,v.Z)(n,[{key:"forwardInput",value:function(e){var t=this.params;if(!t)throw new Error("FaceFeatureExtractor - load model before inference");return xs((function(){var n=zQ(VJ(cs(e.toBatchTensor(112,!0),"float32"),[122.782,117.001,104.298]).div(255),t.dense0,!0);return n=zQ(n,t.dense1),n=zQ(n,t.dense2),n=zQ(n,t.dense3),n=hu(n,[7,7],[2,2],"valid")}))}},{key:"forward",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,wQ(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"face_feature_extractor_model"}},{key:"extractParamsFromWeightMap",value:function(e){return function(e){var t=[],n=YQ(e,t).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return BQ(e,t),{params:r,paramMappings:t}}(e)}},{key:"extractParams",value:function(e){return function(e){var t=[],n=qQ(e),r=n.extractWeights,a=n.getRemainingWeights,i=KQ(r,t).extractDenseBlock4Params,o=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2"),c=i(128,256,"dense3");if(0!==a().length)throw new Error("weights remaing after extract: ".concat(a().length));return{paramMappings:t,params:{dense0:o,dense1:s,dense2:u,dense3:c}}}(e)}}]),n}(MQ);function QQ(e,t){return xs((function(){return Zs(mu(e,t.weights),t.bias)}))}function $Q(e){var t={},n={};return Object.keys(e).forEach((function(r){(r.startsWith("fc")?n:t)[r]=e[r]})),{featureExtractorMap:t,classifierMap:n}}var e$=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var a;return(0,m.Z)(this,n),(a=t.call(this,e))._faceFeatureExtractor=r,a}return(0,v.Z)(n,[{key:"faceFeatureExtractor",get:function(){return this._faceFeatureExtractor}},{key:"runNet",value:function(e){var t=this,n=this.params;if(!n)throw new Error("".concat(this._name," - load model before inference"));return xs((function(){var r=e instanceof kQ?t.faceFeatureExtractor.forwardInput(e):e;return QQ(r.as2D(r.shape[0],-1),n.fc)}))}},{key:"dispose",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.faceFeatureExtractor.dispose(e),o((0,i.Z)(n.prototype),"dispose",this).call(this,e)}},{key:"loadClassifierParams",value:function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r}},{key:"extractClassifierParams",value:function(e){return function(e,t,n){var r=[],a=qQ(e),i=a.extractWeights,o=a.getRemainingWeights,s=VQ(i,r)(t,n,"fc");if(0!==o().length)throw new Error("weights remaing after extract: ".concat(o().length));return{paramMappings:r,params:{fc:s}}}(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())}},{key:"extractParamsFromWeightMap",value:function(e){var t=$Q(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t,n=[],r=jQ(e,n),a={fc:(t="fc",{weights:r("".concat(t,"/weights"),2),bias:r("".concat(t,"/bias"),1)})};return BQ(e,n),{params:a,paramMappings:n}}(r)}},{key:"extractParams",value:function(e){var t=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*t+n,a=e.slice(0,e.length-r),i=e.slice(e.length-r);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(i)}}]),n}(MQ),t$=["neutral","happy","sad","angry","fearful","disgusted","surprised"],n$=function(){function e(t){var n=this;if((0,m.Z)(this,e),this.neutral=0,this.happy=0,this.sad=0,this.angry=0,this.fearful=0,this.disgusted=0,this.surprised=0,7!==t.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: ".concat(t.length));t$.forEach((function(e,r){n[e]=t[r]}))}return(0,v.Z)(e,[{key:"asSortedArray",value:function(){var e=this;return t$.map((function(t){return{expression:t,probability:e[t]}})).sort((function(e,t){return t.probability-e.probability}))}}]),e}(),r$=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new JQ;return(0,m.Z)(this,n),t.call(this,"FaceExpressionNet",e)}return(0,v.Z)(n,[{key:"forwardInput",value:function(e){var t=this;return xs((function(){return zp(t.runNet(e))}))}},{key:"forward",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,wQ(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"predictExpressions",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r,a,i;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,wQ(t);case 2:return n=e.sent,e.next=5,this.forwardInput(n);case 5:return r=e.sent,e.next=8,Promise.all(oh(r).map(function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.dataSync(),e.abrupt("return",(t.dispose(),n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:return a=e.sent,r.dispose(),i=a.map((function(e){return new n$(e)})),e.abrupt("return",n.isBatchInput?i:i[0]);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"face_expression_model"}},{key:"getClassifierChannelsIn",value:function(){return 256}},{key:"getClassifierChannelsOut",value:function(){return 7}}]),n}(e$);function a$(e,t){return(0,r.Z)((0,r.Z)({},e),{expressions:t})}function i$(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3?arguments[3]:void 0;(Array.isArray(t)?t:[t]).forEach((function(t){var a=t instanceof n$?t:function(e){return e.expressions instanceof n$}(t)?t.expressions:void 0;if(!a)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var i=a.asSortedArray().filter((function(e){return e.probability>n})),o=KJ(t)?t.detection.box.bottomLeft:r||new MJ(0,0);new cQ(i.map((function(e){return"".concat(e.expression," (").concat(_J(e.probability),")")})),o).draw(e)}))}function o$(e){return KJ(e)&&e.landmarks instanceof jJ&&e.unshiftedLandmarks instanceof jJ&&e.alignedRect instanceof PJ}function s$(e,t){var n=e.detection.box,a=t.shiftBy(n.x,n.y),i=a.align(),o=e.detection.imageDims,s=new PJ(e.detection.score,i.rescale(o.reverse()),o),u=function(e){var t=function(e){return 180*e/Math.PI},n=function(e,t){return Math.sqrt(Math.pow(e._x-t._x,2)+Math.pow(e._y-t._y,2))},r={roll:void 0,pitch:void 0,yaw:void 0};if(!e||!e._positions||68!==e._positions.length)return r;var a,i,o,s=e._positions;return r.roll=function(e,n){var r=Math.hypot(n._x-e._x,n._y-e._y),a=n._y-e._y,i=Math.asin(a/r),o=t(i);return Math.floor(90-o)*(n._x-e._x<0?-1:1)}(s[27],s[66]),r.pitch=function(e,r,a){var i=n(e,a),o={_x:(e._x+a._x)/2,_y:(e._y+a._y)/2},s=n(r,o),u=Math.atan(s/i);return Math.floor(t(u))*(o._y-r._y<0?-1:1)}(s[14],s[30],s[2]),r.yaw=(a=s[14],i=s[33],o=s[2],Math.floor(a._x-i._x)-Math.floor(i._x-o._x)),r}(t);return(0,r.Z)((0,r.Z)({},e),{landmarks:a,unshiftedLandmarks:t,alignedRect:s,angle:u})}var u$=(0,v.Z)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,m.Z)(this,e);var n=t.drawLines,r=void 0===n||n,a=t.drawPoints,i=void 0===a||a,o=t.lineWidth,s=t.lineColor,u=t.pointSize,c=t.pointColor;this.drawLines=r,this.drawPoints=i,this.lineWidth=o||1,this.pointSize=u||2,this.lineColor=s||"rgba(0, 255, 255, 1)",this.pointColor=c||"rgba(255, 0, 255, 1)"})),c$=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,m.Z)(this,e),this.faceLandmarks=t,this.options=new u$(n)}return(0,v.Z)(e,[{key:"draw",value:function(e){var t=iQ(e),n=this.options,r=n.drawLines,a=n.drawPoints,i=n.lineWidth,o=n.lineColor,s=n.pointSize,u=n.pointColor;if(r&&this.faceLandmarks instanceof qJ&&(t.strokeStyle=o,t.lineWidth=i,bJ(t,this.faceLandmarks.getJawOutline()),bJ(t,this.faceLandmarks.getLeftEyeBrow()),bJ(t,this.faceLandmarks.getRightEyeBrow()),bJ(t,this.faceLandmarks.getNose()),bJ(t,this.faceLandmarks.getLeftEye(),!0),bJ(t,this.faceLandmarks.getRightEye(),!0),bJ(t,this.faceLandmarks.getMouth(),!0)),a){t.strokeStyle=u,t.fillStyle=u;this.faceLandmarks.positions.forEach((function(e){t.beginPath(),t.arc(e.x,e.y,s,0,2*Math.PI),t.fill()}))}}}]),e}();function l$(e,t){(Array.isArray(t)?t:[t]).forEach((function(t){var n=t instanceof jJ?t:o$(t)?t.landmarks:void 0;if(!n)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new c$(n).draw(e)}))}function p$(e,t){var n=[],r=qQ(e),a=r.extractWeights,i=r.getRemainingWeights,o=function(e,t){var n=WQ(e,t),r=GQ(e,t);return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:function(e,t,a){return{separable_conv0:r(e,t,"".concat(a,"/separable_conv0")),separable_conv1:r(t,t,"".concat(a,"/separable_conv1")),expansion_conv:n(e,t,1,"".concat(a,"/expansion_conv"))}},extractMainBlockParams:function(e,t){return{separable_conv0:r(e,e,"".concat(t,"/separable_conv0")),separable_conv1:r(e,e,"".concat(t,"/separable_conv1")),separable_conv2:r(e,e,"".concat(t,"/separable_conv2"))}}}}(a,n),s=o.extractConvParams,u=o.extractSeparableConvParams,c=o.extractReductionBlockParams,l=o.extractMainBlockParams,p={conv_in:s(3,32,3,"entry_flow/conv_in"),reduction_block_0:c(32,64,"entry_flow/reduction_block_0"),reduction_block_1:c(64,128,"entry_flow/reduction_block_1")},h={};FJ(t,0,1).forEach((function(e){h["main_block_".concat(e)]=l(128,"middle_flow/main_block_".concat(e))}));var d={reduction_block:c(128,256,"exit_flow/reduction_block"),separable_conv:u(256,512,"exit_flow/separable_conv")};if(0!==i().length)throw new Error("weights remaing after extract: ".concat(i().length));return{paramMappings:n,params:{entry_flow:p,middle_flow:h,exit_flow:d}}}function h$(e,t){var n=[],r=function(e,t){var n=jQ(e,t),r=XQ(n),a=HQ(n);return{extractConvParams:r,extractSeparableConvParams:a,extractReductionBlockParams:function(e){return{separable_conv0:a("".concat(e,"/separable_conv0")),separable_conv1:a("".concat(e,"/separable_conv1")),expansion_conv:r("".concat(e,"/expansion_conv"))}},extractMainBlockParams:function(e){return{separable_conv0:a("".concat(e,"/separable_conv0")),separable_conv1:a("".concat(e,"/separable_conv1")),separable_conv2:a("".concat(e,"/separable_conv2"))}}}}(e,n),a=r.extractConvParams,i=r.extractSeparableConvParams,o=r.extractReductionBlockParams,s=r.extractMainBlockParams,u={conv_in:a("entry_flow/conv_in"),reduction_block_0:o("entry_flow/reduction_block_0"),reduction_block_1:o("entry_flow/reduction_block_1")},c={};FJ(t,0,1).forEach((function(e){c["main_block_".concat(e)]=s("middle_flow/main_block_".concat(e))}));var l={reduction_block:o("exit_flow/reduction_block"),separable_conv:i("exit_flow/separable_conv")};return BQ(e,n),{params:{entry_flow:u,middle_flow:c,exit_flow:l},paramMappings:n}}function d$(e,t,n){return Zs(Ou(e,t.filters,n,"same"),t.bias)}function f$(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2]?yp(e):e;return n=OQ(n,t.separable_conv0,[1,1]),n=OQ(yp(n),t.separable_conv1,[1,1]),n=fl(n,[3,3],[2,2],"same"),n=Zs(n,d$(e,t.expansion_conv,[2,2]))}var m$=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),(r=t.call(this,"TinyXception"))._numMainBlocks=e,r}return(0,v.Z)(n,[{key:"forwardInput",value:function(e){var t=this,n=this.params;if(!n)throw new Error("TinyXception - load model before inference");return xs((function(){var r=VJ(cs(e.toBatchTensor(112,!0),"float32"),[122.782,117.001,104.298]).div(255),a=yp(d$(r,n.entry_flow.conv_in,[2,2]));return a=f$(a,n.entry_flow.reduction_block_0,!1),a=f$(a,n.entry_flow.reduction_block_1),FJ(t._numMainBlocks,0,1).forEach((function(e){a=function(e,t){var n=OQ(yp(e),t.separable_conv0,[1,1]);return n=OQ(yp(n),t.separable_conv1,[1,1]),n=OQ(yp(n),t.separable_conv2,[1,1]),Zs(n,e)}(a,n.middle_flow["main_block_".concat(e)])})),a=f$(a,n.exit_flow.reduction_block),a=yp(OQ(a,n.exit_flow.separable_conv,[1,1]))}))}},{key:"forward",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,wQ(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"tiny_xception_model"}},{key:"extractParamsFromWeightMap",value:function(e){return h$(e,this._numMainBlocks)}},{key:"extractParams",value:function(e){return p$(e,this._numMainBlocks)}}]),n}(MQ);var v$,g$=((v$=g$||{}).FEMALE="female",v$.MALE="male",v$),y$=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new m$(2);return(0,m.Z)(this,n),(e=t.call(this,"AgeGenderNet"))._faceFeatureExtractor=r,e}return(0,v.Z)(n,[{key:"faceFeatureExtractor",get:function(){return this._faceFeatureExtractor}},{key:"runNet",value:function(e){var t=this,n=this.params;if(!n)throw new Error("".concat(this._name," - load model before inference"));return xs((function(){var r=e instanceof kQ?t.faceFeatureExtractor.forwardInput(e):e,a=hu(r,[7,7],[2,2],"valid").as2D(r.shape[0],-1);return{age:QQ(a,n.fc.age).as1D(),gender:QQ(a,n.fc.gender)}}))}},{key:"forwardInput",value:function(e){var t=this;return xs((function(){var n=t.runNet(e),r=n.age,a=n.gender;return{age:r,gender:zp(a)}}))}},{key:"forward",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,wQ(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"predictAgeAndGender",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r,a,i,o,s;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,wQ(t);case 2:return n=e.sent,e.next=5,this.forwardInput(n);case 5:return r=e.sent,a=oh(r.age),i=oh(r.gender),o=a.map((function(e,t){return{ageTensor:e,genderTensor:i[t]}})),e.next=11,Promise.all(o.map(function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r,a,i,o,s,u;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.ageTensor,r=t.genderTensor,a=n.dataSync()[0],i=r.dataSync()[0],s=(o=i>.5)?"male":"female",u=o?i:1-i,e.abrupt("return",(n.dispose(),r.dispose(),{age:a,gender:s,genderProbability:u}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 11:return s=e.sent,e.abrupt("return",(r.age.dispose(),r.gender.dispose(),n.isBatchInput?s:s[0]));case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"age_gender_model"}},{key:"dispose",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.faceFeatureExtractor.dispose(e),o((0,i.Z)(n.prototype),"dispose",this).call(this,e)}},{key:"loadClassifierParams",value:function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r}},{key:"extractClassifierParams",value:function(e){return function(e){var t=[],n=qQ(e),r=n.extractWeights,a=n.getRemainingWeights,i=VQ(r,t),o=i(512,1,"fc/age"),s=i(512,2,"fc/gender");if(0!==a().length)throw new Error("weights remaing after extract: ".concat(a().length));return{paramMappings:t,params:{fc:{age:o,gender:s}}}}(e)}},{key:"extractParamsFromWeightMap",value:function(e){var t=$Q(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t=[],n=jQ(e,t);function r(e){return{weights:n("".concat(e,"/weights"),2),bias:n("".concat(e,"/bias"),1)}}var a={fc:{age:r("fc/age"),gender:r("fc/gender")}};return BQ(e,t),{params:a,paramMappings:t}}(r)}},{key:"extractParams",value:function(e){var t=e.slice(0,e.length-1539),n=e.slice(e.length-1539);return this.faceFeatureExtractor.extractWeights(t),this.extractClassifierParams(n)}}]),n}(MQ),b$=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"postProcess",value:function(e,t,n){var r=n.map((function(e){var n=e.width,r=e.height,a=t/Math.max(r,n);return{width:n*a,height:r*a}})),a=r.length;return xs((function(){var n=function(e,t){return jp([Au([68],e,"float32"),Au([68],t,"float32")],1).as2D(1,136).as1D()},i=function(e,t){var n=r[e],a=n.width,i=n.height;return t(a,i)?Math.abs(a-i)/2:0};return e.mul(Au([a,136],t,"float32")).sub(jp(Array.from(Array(a),(function(e,t){return n(function(e){return i(e,(function(e,t){return e<t}))}(t),function(e){return i(e,(function(e,t){return t<e}))}(t))})))).div(jp(Array.from(Array(a),(function(e,t){return n(r[t].width,r[t].height)}))))}))}},{key:"forwardInput",value:function(e){var t=this;return xs((function(){var n=t.runNet(e);return t.postProcess(n,e.inputSize,e.inputDimensions.map((function(e){var t=(0,h.Z)(e,2);return{height:t[0],width:t[1]}})))}))}},{key:"forward",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,wQ(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"detectLandmarks",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r,a,i=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,wQ(t);case 2:return n=e.sent,r=xs((function(){return oh(i.forwardInput(n))})),e.next=6,Promise.all(r.map(function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,r){var a,i,o;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Array.from(t.dataSync()),i=a.filter((function(e,t){return CJ(t)})),o=a.filter((function(e,t){return!CJ(t)})),e.abrupt("return",new qJ(Array(68).fill(0).map((function(e,t){return new MJ(i[t],o[t])})),{height:n.getInputHeight(r),width:n.getInputWidth(r)}));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 6:return a=e.sent,e.abrupt("return",(r.forEach((function(e){return e.dispose()})),n.isBatchInput?a:a[0]));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getClassifierChannelsOut",value:function(){return 136}}]),n}(e$),x$=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new JQ;return(0,m.Z)(this,n),t.call(this,"FaceLandmark68Net",e)}return(0,v.Z)(n,[{key:"getDefaultModelName",value:function(){return"face_landmark_68_model"}},{key:"getClassifierChannelsIn",value:function(){return 256}}]),n}(b$);var k$=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.call(this,"TinyFaceFeatureExtractor")}return(0,v.Z)(n,[{key:"forwardInput",value:function(e){var t=this.params;if(!t)throw new Error("TinyFaceFeatureExtractor - load model before inference");return xs((function(){var n=LQ(VJ(cs(e.toBatchTensor(112,!0),"float32"),[122.782,117.001,104.298]).div(255),t.dense0,!0);return n=LQ(n,t.dense1),n=LQ(n,t.dense2),n=hu(n,[14,14],[2,2],"valid")}))}},{key:"forward",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,wQ(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"face_feature_extractor_tiny_model"}},{key:"extractParamsFromWeightMap",value:function(e){return function(e){var t=[],n=YQ(e,t).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return BQ(e,t),{params:r,paramMappings:t}}(e)}},{key:"extractParams",value:function(e){return function(e){var t=[],n=qQ(e),r=n.extractWeights,a=n.getRemainingWeights,i=KQ(r,t).extractDenseBlock3Params,o=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2");if(0!==a().length)throw new Error("weights remaing after extract: ".concat(a().length));return{paramMappings:t,params:{dense0:o,dense1:s,dense2:u}}}(e)}}]),n}(MQ),w$=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new k$;return(0,m.Z)(this,n),t.call(this,"FaceLandmark68TinyNet",e)}return(0,v.Z)(n,[{key:"getDefaultModelName",value:function(){return"face_landmark_68_tiny_model"}},{key:"getClassifierChannelsIn",value:function(){return 128}}]),n}(b$);function I$(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"same",i=t.conv,o=i.filters,s=i.bias,u=Ou(e,o,n,a);return u=function(e,t){return Zs(Os(e,t.weights),t.biases)}(u=Zs(u,s),t.scale),r?yp(u):u}function S$(e,t){return I$(e,t,[1,1],!1)}function N$(e,t){return I$(e,t,[2,2],!0,"valid")}function T$(e,t){function n(n,r,a,i){var o=function(t,n,r){var a=e(t),i=a.length/(n*r*r);if(TJ(i))throw new Error("depth has to be an integer: ".concat(i,", weights.length: ").concat(a.length,", numFilters: ").concat(n,", filterSize: ").concat(r));return xs((function(){return fh($p(a,[n,i,r,r]),[2,3,1,0])}))}(n,r,a),s=Yp(e(r));return t.push({paramPath:"".concat(i,"/filters")},{paramPath:"".concat(i,"/bias")}),{filters:o,bias:s}}function r(r,a,i,o){var s=n(r,a,i,"".concat(o,"/conv")),u=function(n,r){var a=Yp(e(n)),i=Yp(e(n));return t.push({paramPath:"".concat(r,"/weights")},{paramPath:"".concat(r,"/biases")}),{weights:a,biases:i}}(a,"".concat(o,"/scale"));return{conv:s,scale:u}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e,t,n,a){return{conv1:r((arguments.length>4&&void 0!==arguments[4]&&arguments[4]?.5:1)*e,t,n,"".concat(a,"/conv1")),conv2:r(e,t,n,"".concat(a,"/conv2"))}}}}function C$(e,t){var n=jQ(e,t);function r(e){var t=n("".concat(e,"/conv/filters"),4),r=n("".concat(e,"/conv/bias"),1),a=function(e){return{weights:n("".concat(e,"/scale/weights"),1),biases:n("".concat(e,"/scale/biases"),1)}}(e);return{conv:{filters:t,bias:r},scale:a}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e){return{conv1:r("".concat(e,"/conv1")),conv2:r("".concat(e,"/conv2"))}}}}function _$(e,t){var n=function(e,t){return I$(e,t,[1,1],!0)}(e,t.conv1);return n=S$(n,t.conv2),n=Zs(n,e),n=yp(n)}function E$(e,t){var n=N$(e,t.conv1);n=S$(n,t.conv2);var r=hu(e,2,2,"valid"),a=bl(r.shape),i=r.shape[3]!==n.shape[3];if(r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2]){var o=(0,g.Z)(n.shape);o[1]=1;var s=bl(o);n=fu([n,s],1);var u=(0,g.Z)(n.shape);u[2]=1;var c=bl(u);n=fu([n,c],2)}return r=i?fu([r,a],3):r,n=Zs(r,n),n=yp(n)}var A$=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.call(this,"FaceRecognitionNet")}return(0,v.Z)(n,[{key:"forwardInput",value:function(e){var t=this.params;if(!t)throw new Error("FaceRecognitionNet - load model before inference");return xs((function(){var n=N$(VJ(cs(e.toBatchTensor(150,!0),"float32"),[122.782,117.001,104.298]).div(255),t.conv32_down);n=_$(n=fl(n,3,2,"valid"),t.conv32_1),n=_$(n,t.conv32_2),n=_$(n,t.conv32_3),n=_$(n=E$(n,t.conv64_down),t.conv64_1),n=_$(n,t.conv64_2),n=_$(n,t.conv64_3),n=_$(n=E$(n,t.conv128_down),t.conv128_1),n=_$(n,t.conv128_2),n=_$(n=E$(n,t.conv256_down),t.conv256_1);var r=(n=E$(n=_$(n,t.conv256_2),t.conv256_down_out)).mean([1,2]);return mu(r,t.fc)}))}},{key:"forward",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,wQ(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"computeFaceDescriptor",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r,a,i,o=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(n=null==t?void 0:t.shape)||!n.some((function(e){return e<=0}))){e.next=2;break}return e.abrupt("return",new Float32Array(128));case 2:return e.next=4,wQ(t);case 4:return r=e.sent,a=xs((function(){return oh(o.forwardInput(r))})),e.next=8,Promise.all(a.map((function(e){return e.data()})));case 8:return i=e.sent,e.abrupt("return",(a.forEach((function(e){return e.dispose()})),r.isBatchInput?i:i[0]));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"face_recognition_model"}},{key:"extractParamsFromWeightMap",value:function(e){return function(e){var t=[],n=C$(e,t),r=n.extractConvLayerParams,a=n.extractResidualLayerParams,i=r("conv32_down"),o=a("conv32_1"),s=a("conv32_2"),u=a("conv32_3"),c=a("conv64_down"),l=a("conv64_1"),p=a("conv64_2"),h=a("conv64_3"),d=a("conv128_down"),f=a("conv128_1"),m=a("conv128_2"),v=a("conv256_down"),g=a("conv256_1"),y=a("conv256_2"),b=a("conv256_down_out"),x=e.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!IJ(x))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have ".concat(x));var k={conv32_down:i,conv32_1:o,conv32_2:s,conv32_3:u,conv64_down:c,conv64_1:l,conv64_2:p,conv64_3:h,conv128_down:d,conv128_1:f,conv128_2:m,conv256_down:v,conv256_1:g,conv256_2:y,conv256_down_out:b,fc:x};return BQ(e,t),{params:k,paramMappings:t}}(e)}},{key:"extractParams",value:function(e){return function(e){var t=qQ(e),n=t.extractWeights,r=t.getRemainingWeights,a=[],i=T$(n,a),o=i.extractConvLayerParams,s=i.extractResidualLayerParams,u=o(4704,32,7,"conv32_down"),c=s(9216,32,3,"conv32_1"),l=s(9216,32,3,"conv32_2"),p=s(9216,32,3,"conv32_3"),h=s(36864,64,3,"conv64_down",!0),d=s(36864,64,3,"conv64_1"),f=s(36864,64,3,"conv64_2"),m=s(36864,64,3,"conv64_3"),v=s(147456,128,3,"conv128_down",!0),g=s(147456,128,3,"conv128_1"),y=s(147456,128,3,"conv128_2"),b=s(589824,256,3,"conv256_down",!0),x=s(589824,256,3,"conv256_1"),k=s(589824,256,3,"conv256_2"),w=s(589824,256,3,"conv256_down_out"),I=xs((function(){return fh(Jp(n(32768),[128,256]),[1,0])}));if(a.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: ".concat(r().length));return{params:{conv32_down:u,conv32_1:c,conv32_2:l,conv32_3:p,conv64_down:h,conv64_1:d,conv64_2:f,conv64_3:m,conv128_down:v,conv128_1:g,conv128_2:y,conv256_down:b,conv256_1:x,conv256_2:k,conv256_down_out:w,fc:I},paramMappings:a}}(e)}}]),n}(MQ);function R$(e,t){return(0,r.Z)((0,r.Z)({},e),{descriptor:t})}function F$(e,t){return(0,r.Z)((0,r.Z)({},e),{age:t})}function Z$(e,t,n){return(0,r.Z)((0,r.Z)({},e),{gender:t,genderProbability:n})}function D$(e,t){function n(n,r,a,i,o){var s=$p(e(n*r*a*a),[a,a,n,r]),u=Yp(e(r));return t.push({paramPath:"".concat(i,"/filters")},{paramPath:"".concat(i,"/").concat(o?"batch_norm_offset":"bias")}),{filters:s,bias:u}}function r(e,t,r,a){var i=n(e,t,r,a,!0);return{filters:i.filters,batch_norm_offset:i.bias}}function a(n,a,i){var o=function(n,r){var a=$p(e(9*n),[3,3,n,1]),i=Yp(e(n)),o=Yp(e(n)),s=Yp(e(n)),u=Yp(e(n));return t.push({paramPath:"".concat(r,"/filters")},{paramPath:"".concat(r,"/batch_norm_scale")},{paramPath:"".concat(r,"/batch_norm_offset")},{paramPath:"".concat(r,"/batch_norm_mean")},{paramPath:"".concat(r,"/batch_norm_variance")}),{filters:a,batch_norm_scale:i,batch_norm_offset:o,batch_norm_mean:s,batch_norm_variance:u}}(n,"".concat(i,"/depthwise_conv"));return{depthwise_conv:o,pointwise_conv:r(n,a,1,"".concat(i,"/pointwise_conv"))}}return{extractMobilenetV1Params:function(){return{conv_0:r(3,32,3,"mobilenetv1/conv_0"),conv_1:a(32,64,"mobilenetv1/conv_1"),conv_2:a(64,128,"mobilenetv1/conv_2"),conv_3:a(128,128,"mobilenetv1/conv_3"),conv_4:a(128,256,"mobilenetv1/conv_4"),conv_5:a(256,256,"mobilenetv1/conv_5"),conv_6:a(256,512,"mobilenetv1/conv_6"),conv_7:a(512,512,"mobilenetv1/conv_7"),conv_8:a(512,512,"mobilenetv1/conv_8"),conv_9:a(512,512,"mobilenetv1/conv_9"),conv_10:a(512,512,"mobilenetv1/conv_10"),conv_11:a(512,512,"mobilenetv1/conv_11"),conv_12:a(512,1024,"mobilenetv1/conv_12"),conv_13:a(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:r(1024,256,1,"prediction_layer/conv_0"),conv_1:r(256,512,3,"prediction_layer/conv_1"),conv_2:r(512,128,1,"prediction_layer/conv_2"),conv_3:r(128,256,3,"prediction_layer/conv_3"),conv_4:r(256,128,1,"prediction_layer/conv_4"),conv_5:r(128,256,3,"prediction_layer/conv_5"),conv_6:r(256,64,1,"prediction_layer/conv_6"),conv_7:r(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:n(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:n(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:n(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}function M$(e){var t=[],n=function(e,t){var n=jQ(e,t);function r(e,t,r){return{filters:n("".concat(e,"/Conv2d_").concat(t,"_pointwise/weights"),4,"".concat(r,"/filters")),batch_norm_offset:n("".concat(e,"/Conv2d_").concat(t,"_pointwise/convolution_bn_offset"),1,"".concat(r,"/batch_norm_offset"))}}function a(e){var t="mobilenetv1/conv_".concat(e),a="MobilenetV1/Conv2d_".concat(e,"_depthwise"),i="".concat(t,"/depthwise_conv"),o="".concat(t,"/pointwise_conv");return{depthwise_conv:{filters:n("".concat(a,"/depthwise_weights"),4,"".concat(i,"/filters")),batch_norm_scale:n("".concat(a,"/BatchNorm/gamma"),1,"".concat(i,"/batch_norm_scale")),batch_norm_offset:n("".concat(a,"/BatchNorm/beta"),1,"".concat(i,"/batch_norm_offset")),batch_norm_mean:n("".concat(a,"/BatchNorm/moving_mean"),1,"".concat(i,"/batch_norm_mean")),batch_norm_variance:n("".concat(a,"/BatchNorm/moving_variance"),1,"".concat(i,"/batch_norm_variance"))},pointwise_conv:r("MobilenetV1",e,o)}}function i(e,t){return{filters:n("".concat(e,"/weights"),4,"".concat(t,"/filters")),bias:n("".concat(e,"/biases"),1,"".concat(t,"/bias"))}}function o(e){return{box_encoding_predictor:i("Prediction/BoxPredictor_".concat(e,"/BoxEncodingPredictor"),"prediction_layer/box_predictor_".concat(e,"/box_encoding_predictor")),class_predictor:i("Prediction/BoxPredictor_".concat(e,"/ClassPredictor"),"prediction_layer/box_predictor_".concat(e,"/class_predictor"))}}return{extractMobilenetV1Params:function(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:a(1),conv_2:a(2),conv_3:a(3),conv_4:a(4),conv_5:a(5),conv_6:a(6),conv_7:a(7),conv_8:a(8),conv_9:a(9),conv_10:a(10),conv_11:a(11),conv_12:a(12),conv_13:a(13)}},extractPredictionLayerParams:function(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:o(0),box_predictor_1:o(1),box_predictor_2:o(2),box_predictor_3:o(3),box_predictor_4:o(4),box_predictor_5:o(5)}}}}(e,t),r=n.extractMobilenetV1Params,a=n.extractPredictionLayerParams,i=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!SJ(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have ".concat(i));var o={mobilenetv1:r(),prediction_layer:a(),output_layer:{extra_dim:i}};return BQ(e,t),{params:o,paramMappings:t}}function O$(e,t,n){return xs((function(){var r=Ou(e,t.filters,n,"same");return r=Zs(r,t.batch_norm_offset),Ru(r,0,6)}))}var L$=.0010000000474974513;function z$(e,t){return xs((function(){var n,r=O$(e,t.conv_0,[2,2]);if([t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13].forEach((function(e,t){var a=t+1,i=function(e){return[2,4,6,12].some((function(t){return t===e}))?[2,2]:[1,1]}(a);r=function(e,t,n){return xs((function(){var r=Xu(e,t.filters,n,"same");return r=wu(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,L$),Ru(r,0,6)}))}(r,e.depthwise_conv,i),r=O$(r,e.pointwise_conv,[1,1]),11===a&&(n=r)})),null===n)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}}))}function P$(e,t,n){var r=e.arraySync(),a=Math.min(r[t][0],r[t][2]),i=Math.min(r[t][1],r[t][3]),o=Math.max(r[t][0],r[t][2]),s=Math.max(r[t][1],r[t][3]),u=Math.min(r[n][0],r[n][2]),c=Math.min(r[n][1],r[n][3]),l=Math.max(r[n][0],r[n][2]),p=Math.max(r[n][1],r[n][3]),h=(o-a)*(s-i),d=(l-u)*(p-c);if(h<=0||d<=0)return 0;var f=Math.max(a,u),m=Math.max(i,c),v=Math.min(o,l),g=Math.min(s,p),y=Math.max(v-f,0)*Math.max(g-m,0);return y/(h+d-y)}function B$(e,t,n,r,a){var i=e.shape[0],o=Math.min(n,i),s=t.map((function(e,t){return{score:e,boxIndex:t}})).filter((function(e){return e.score>a})).sort((function(e,t){return t.score-e.score})),u=function(e){return e<=r?1:0},c=[];return s.forEach((function(t){if(!(c.length>=o)){for(var n=t.score,r=c.length-1;r>=0;--r){var i=P$(e,t.boxIndex,c[r]);if(0!==i&&(t.score*=u(i),t.score<=a))break}n===t.score&&c.push(t.boxIndex)}})),c}function W$(e,t){var n=function(e){var t=oh(fh(e,[1,0])),n=[al(t[2],t[0]),al(t[3],t[1])];return{sizes:n,centers:[Zs(t[0],Ms(n[0],2)),Zs(t[1],Ms(n[1],2))]}}(e),r=n.sizes,a=n.centers,i=oh(fh(t,[1,0])),o=Ms(Os(_c(Ms(i[2],5)),r[0]),2),s=Zs(Os(Ms(i[0],10),r[0]),a[0]),u=Ms(Os(_c(Ms(i[3],5)),r[1]),2),c=Zs(Os(Ms(i[1],10),r[1]),a[1]);return fh(jp([al(s,o),al(c,u),Zs(s,o),Zs(c,u)]),[1,0])}function V$(e,t){return xs((function(){var n=e.shape[0];return{boxPredictionEncoding:pu(PQ(e,t.box_encoding_predictor),[n,-1,1,4]),classPrediction:pu(PQ(e,t.class_predictor),[n,-1,3])}}))}var U$=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.minConfidence,r=t.maxResults;if((0,m.Z)(this,e),this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=r||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error("".concat(this._name," - expected minConfidence to be a number between 0 and 1"));if("number"!=typeof this._maxResults)throw new Error("".concat(this._name," - expected maxResults to be a number"))}return(0,v.Z)(e,[{key:"minConfidence",get:function(){return this._minConfidence}},{key:"maxResults",get:function(){return this._maxResults}}]),e}(),G$=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.call(this,"SsdMobilenetv1")}return(0,v.Z)(n,[{key:"forwardInput",value:function(e){var t=this.params;if(!t)throw new Error("SsdMobilenetv1 - load model before inference");return xs((function(){var n=cs(e.toBatchTensor(512,!1),"float32"),r=z$(al(Ms(n,127.5),1),t.mobilenetv1),a=function(e,t,n){return xs((function(){var r=O$(e,n.conv_0,[1,1]),a=O$(r,n.conv_1,[2,2]),i=O$(a,n.conv_2,[1,1]),o=O$(i,n.conv_3,[2,2]),s=O$(o,n.conv_4,[1,1]),u=O$(s,n.conv_5,[2,2]),c=O$(u,n.conv_6,[1,1]),l=O$(c,n.conv_7,[2,2]),p=V$(t,n.box_predictor_0),h=V$(e,n.box_predictor_1),d=V$(a,n.box_predictor_2),f=V$(o,n.box_predictor_3),m=V$(u,n.box_predictor_4),v=V$(l,n.box_predictor_5);return{boxPredictions:fu([p.boxPredictionEncoding,h.boxPredictionEncoding,d.boxPredictionEncoding,f.boxPredictionEncoding,m.boxPredictionEncoding,v.boxPredictionEncoding],1),classPredictions:fu([p.classPrediction,h.classPrediction,d.classPrediction,f.classPrediction,m.classPrediction,v.classPrediction],1)}}))}(r.out,r.conv11,t.prediction_layer);return function(e,t,n){return xs((function(){var r=e.shape[0],a=W$(pu(Rc(n.extra_dim,[r,1,1]),[-1,4]),pu(e,[-1,4]));a=pu(a,[r,a.shape[0]/r,4]);var i=vu(gu(t,[0,0,1],[-1,-1,-1])),o=gu(i,[0,0,0],[-1,-1,1]);return o=pu(o,[r,o.shape[1]]),{boxes:oh(a),scores:oh(o)}}))}(a.boxPredictions,a.classPredictions,t.output_layer)}))}},{key:"forward",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,wQ(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"locateFaces",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r,a,i,o,s,u,c,l,p,f,m,v,g,y,b,x,k,w=arguments;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new U$(w.length>1&&void 0!==w[1]?w[1]:{}),r=n.maxResults,a=n.minConfidence,e.next=6,wQ(t);case 6:for(i=e.sent,o=this.forwardInput(i),s=o.boxes,u=o.scores,c=s[0],l=u[0],p=1;p<s.length;p++)s[p].dispose(),u[p].dispose();return f=Array.from(l.dataSync()),m=B$(c,f,r,.5,a),v=i.getReshapedInputDimensions(0),g=i.inputSize,y=g/v.width,b=g/v.height,x=c.arraySync(),k=m.map((function(e){var t=[Math.max(0,x[e][0]),Math.min(1,x[e][2])].map((function(e){return e*b})),n=(0,h.Z)(t,2),r=n[0],a=n[1],o=[Math.max(0,x[e][1]),Math.min(1,x[e][3])].map((function(e){return e*y})),s=(0,h.Z)(o,2),u=s[0],c=s[1];return new PJ(f[e],new HJ(u,r,c-u,a-r),{height:i.getInputHeight(0),width:i.getInputWidth(0)})})),e.abrupt("return",(c.dispose(),l.dispose(),k));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"ssd_mobilenetv1_model"}},{key:"extractParamsFromWeightMap",value:function(e){return M$(e)}},{key:"extractParams",value:function(e){return function(e){var t=[],n=qQ(e),r=n.extractWeights,a=n.getRemainingWeights,i=D$(r,t),o=i.extractMobilenetV1Params,s=i.extractPredictionLayerParams,u=o(),c=s(),l={extra_dim:Qp(r(20472),[1,5118,4])};if(t.push({paramPath:"output_layer/extra_dim"}),0!==a().length)throw new Error("weights remaing after extract: ".concat(a().length));return{params:{mobilenetv1:u,prediction_layer:c,output_layer:l},paramMappings:t}}(e)}}]),n}(MQ);var H$=.4,j$=[new MJ(.738768,.874946),new MJ(2.42204,2.65704),new MJ(4.30971,7.04493),new MJ(10.246,4.59428),new MJ(12.6868,11.8741)],q$=[new MJ(1.603231,2.094468),new MJ(6.041143,7.080126),new MJ(2.882459,3.518061),new MJ(4.266906,5.178857),new MJ(9.041765,10.66308)],K$=[117.001,114.697,97.404],X$=function(e){return"number"==typeof e};function Y$(e){return xs((function(){var t=Os(e,kc(.10000000149011612));return Zs(yp(al(e,t)),t)}))}function J$(e,t){return xs((function(){var n=Fl(e,[[0,0],[1,1],[1,1],[0,0]]);return n=Ou(n,t.conv.filters,[1,1],"valid"),n=al(n,t.bn.sub),n=Os(n,t.bn.truediv),Y$(n=Zs(n,t.conv.bias))}))}function Q$(e,t){return xs((function(){var n=Fl(e,[[0,0],[1,1],[1,1],[0,0]]);return n=_p(n,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),Y$(n=Zs(n,t.bias))}))}function $$(e,t){var n=WQ(e,t);var r=GQ(e,t);return{extractConvParams:n,extractConvWithBatchNormParams:function(r,a,i){var o=n(r,a,3,"".concat(i,"/conv")),s=function(n,r){var a=Yp(e(n)),i=Yp(e(n));return t.push({paramPath:"".concat(r,"/sub")},{paramPath:"".concat(r,"/truediv")}),{sub:a,truediv:i}}(a,"".concat(i,"/bn"));return{conv:o,bn:s}},extractSeparableConvParams:r}}function e0(e,t){var n=jQ(e,t);function r(e){return{filters:n("".concat(e,"/filters"),4),bias:n("".concat(e,"/bias"),1)}}return{extractConvParams:r,extractConvWithBatchNormParams:function(e){var t=r("".concat(e,"/conv")),a=function(e){return{sub:n("".concat(e,"/sub"),1),truediv:n("".concat(e,"/truediv"),1)}}("".concat(e,"/bn"));return{conv:t,bn:a}},extractSeparableConvParams:HQ(n)}}var t0=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.inputSize,r=t.scoreThreshold;if((0,m.Z)(this,e),this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=r||.5,"number"!=typeof this._inputSize||this._inputSize%32!==0)throw new Error("".concat(this._name," - expected inputSize to be a number divisible by 32"));if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error("".concat(this._name," - expected scoreThreshold to be a number between 0 and 1"))}return(0,v.Z)(e,[{key:"inputSize",get:function(){return this._inputSize}},{key:"scoreThreshold",get:function(){return this._scoreThreshold}}]),e}(),n0=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,m.Z)(this,n),r=t.call(this,"TinyYolov2"),function(e){if(!e)throw new Error("invalid config: ".concat(e));if("boolean"!=typeof e.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: ".concat(e.withSeparableConvs));if(!X$(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: ".concat(e.iouThreshold));if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every((function(e){return"string"==typeof e})))throw new Error("config.classes has to be an array class names: string[], have: ".concat(JSON.stringify(e.classes)));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map((function(e){return e||{}})).every((function(e){return X$(e.x)&&X$(e.y)})))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: ".concat(JSON.stringify(e.anchors)));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||3!==e.meanRgb.length||!e.meanRgb.every(X$)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: ".concat(JSON.stringify(e.meanRgb)))}(e),r._config=e,r}return(0,v.Z)(n,[{key:"config",get:function(){return this._config}},{key:"withClassScores",get:function(){return this.config.withClassScores||this.config.classes.length>1}},{key:"boxEncodingSize",get:function(){return 5+(this.withClassScores?this.config.classes.length:0)}},{key:"runTinyYolov2",value:function(e,t){var n=J$(e,t.conv0);return n=J$(n=fl(n,[2,2],[2,2],"same"),t.conv1),n=J$(n=fl(n,[2,2],[2,2],"same"),t.conv2),n=J$(n=fl(n,[2,2],[2,2],"same"),t.conv3),n=J$(n=fl(n,[2,2],[2,2],"same"),t.conv4),n=J$(n=fl(n,[2,2],[2,2],"same"),t.conv5),n=J$(n=fl(n,[2,2],[1,1],"same"),t.conv6),PQ(n=J$(n,t.conv7),t.conv8,"valid",!1)}},{key:"runMobilenet",value:function(e,t){var n=this.config.isFirstLayerConv2d?Y$(PQ(e,t.conv0,"valid",!1)):Q$(e,t.conv0);return n=Q$(n=fl(n,[2,2],[2,2],"same"),t.conv1),n=Q$(n=fl(n,[2,2],[2,2],"same"),t.conv2),n=Q$(n=fl(n,[2,2],[2,2],"same"),t.conv3),n=Q$(n=fl(n,[2,2],[2,2],"same"),t.conv4),n=Q$(n=fl(n,[2,2],[2,2],"same"),t.conv5),n=fl(n,[2,2],[1,1],"same"),n=t.conv6?Q$(n,t.conv6):n,PQ(n=t.conv7?Q$(n,t.conv7):n,t.conv8,"valid",!1)}},{key:"forwardInput",value:function(e,t){var n=this,r=this.params;if(!r)throw new Error("TinyYolov2 - load model before inference");return xs((function(){var a=cs(e.toBatchTensor(t,!1),"float32");return a=(a=n.config.meanRgb?VJ(a,n.config.meanRgb):a).div(255),n.config.withSeparableConvs?n.runMobilenet(a,r):n.runTinyYolov2(a,r)}))}},{key:"forward",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,wQ(t);case 3:return e.t1=e.sent,e.t2=n,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1,e.t2));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"detect",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){var n,r,a,i,o,s,u,c,l,p,h,f,m=this,v=arguments;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new t0(v.length>1&&void 0!==v[1]?v[1]:{}),r=n.inputSize,a=n.scoreThreshold,e.next=6,wQ(t);case 6:return i=e.sent,e.next=9,this.forwardInput(i,r);case 9:return o=e.sent,s=xs((function(){return oh(o)[0].expandDims()})),u={width:i.getInputWidth(0),height:i.getInputHeight(0)},e.next=14,this.extractBoxes(s,i.getReshapedInputDimensions(0),a);case 14:return c=e.sent,o.dispose(),s.dispose(),l=c.map((function(e){return e.box})),p=c.map((function(e){return e.score})),h=c.map((function(e){return e.classScore})),f=c.map((function(e){return m.config.classes[e.label]})),e.abrupt("return",WJ(l.map((function(e){return e.rescale(r)})),p,this.config.iouThreshold,!0).map((function(e){return new zJ(p[e],h[e],f[e],l[e],u)})));case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return""}},{key:"extractParamsFromWeightMap",value:function(e){return function(e,t){var n,r=[],a=e0(e,r),i=a.extractConvParams,o=a.extractConvWithBatchNormParams,s=a.extractSeparableConvParams;if(t.withSeparableConvs){var u=t.filterSizes&&t.filterSizes.length||9;n={conv0:t.isFirstLayerConv2d?i("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:u>7?s("conv6"):void 0,conv7:u>8?s("conv7"):void 0,conv8:i("conv8")}}else n={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:i("conv8")};return BQ(e,r),{params:n,paramMappings:r}}(e,this.config)}},{key:"extractParams",value:function(e){var t=this.config.filterSizes||n.DEFAULT_FILTER_SIZES,r=t?t.length:void 0;if(7!==r&&8!==r&&9!==r)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found ".concat(r," filterSizes in config"));return function(e,t,n,r){var a,i=qQ(e),o=i.extractWeights,s=i.getRemainingWeights,u=[],c=$$(o,u),l=c.extractConvParams,p=c.extractConvWithBatchNormParams,d=c.extractSeparableConvParams;if(t.withSeparableConvs){var f=(0,h.Z)(r,9),m=f[0],v=f[1],g=f[2],y=f[3],b=f[4],x=f[5],k=f[6],w=f[7],I=f[8];a={conv0:t.isFirstLayerConv2d?l(m,v,3,"conv0"):d(m,v,"conv0"),conv1:d(v,g,"conv1"),conv2:d(g,y,"conv2"),conv3:d(y,b,"conv3"),conv4:d(b,x,"conv4"),conv5:d(x,k,"conv5"),conv6:w?d(k,w,"conv6"):void 0,conv7:I?d(w,I,"conv7"):void 0,conv8:l(I||w||k,5*n,1,"conv8")}}else{var S=(0,h.Z)(r,9),N=S[0],T=S[1],C=S[2],_=S[3],E=S[4],A=S[5],R=S[6],F=S[7],Z=S[8];a={conv0:p(N,T,"conv0"),conv1:p(T,C,"conv1"),conv2:p(C,_,"conv2"),conv3:p(_,E,"conv3"),conv4:p(E,A,"conv4"),conv5:p(A,R,"conv5"),conv6:p(R,F,"conv6"),conv7:p(F,Z,"conv7"),conv8:l(Z,5*n,1,"conv8")}}if(0!==s().length)throw new Error("weights remaing after extract: ".concat(s().length));return{params:a,paramMappings:u}}(e,this.config,this.boxEncodingSize,t)}},{key:"extractBoxes",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n,a){var i,o,s,u,c,l,p,f,m,v,g,y,b,x,k,w,I,S,N,T,C,_,E,A,R,F,Z,D,M,O=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.width,o=n.height,s=Math.max(i,o),u=s/i,c=s/o,l=t.shape[1],p=this.config.anchors.length,f=xs((function(){var e=t.reshape([l,l,p,O.boxEncodingSize]);return[e.slice([0,0,0,0],[l,l,p,4]),e.slice([0,0,0,4],[l,l,p,1]),O.withClassScores?zp(e.slice([0,0,0,5],[l,l,p,O.config.classes.length]),3):kc(0)]})),m=(0,h.Z)(f,3),v=m[0],g=m[1],y=m[2],b=[],e.next=15,g.array();case 15:return x=e.sent,e.next=18,v.array();case 18:k=e.sent,w=0;case 20:if(!(w<l)){e.next=54;break}I=0;case 22:if(!(I<l)){e.next=51;break}S=0;case 24:if(!(S<p)){e.next=48;break}if(N=UJ(x[w][I][S][0]),a&&!(N>a)){e.next=45;break}if(T=(I+UJ(k[w][I][S][0]))/l*u,C=(w+UJ(k[w][I][S][1]))/l*c,_=Math.exp(k[w][I][S][2])*this.config.anchors[S].x/l*u,E=Math.exp(k[w][I][S][3])*this.config.anchors[S].y/l*c,A=T-_/2,R=C-E/2,F={row:w,col:I,anchor:S},!this.withClassScores){e.next=40;break}return e.next=37,this.extractPredictedClass(y,F);case 37:e.t0=e.sent,e.next=41;break;case 40:e.t0={classScore:1,label:0};case 41:Z=e.t0,D=Z.classScore,M=Z.label,b.push((0,r.Z)({box:new LJ(A,R,A+_,R+E),score:N,classScore:N*D,label:M},F));case 45:S++,e.next=24;break;case 48:I++,e.next=22;break;case 51:w++,e.next=20;break;case 54:return e.abrupt("return",(v.dispose(),g.dispose(),y.dispose(),b));case 55:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"extractPredictedClass",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){var r,a,i,o;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.row,a=n.col,i=n.anchor,e.next=5,t.array();case 5:return o=e.sent,e.abrupt("return",Array(this.config.classes.length).fill(0).map((function(e,t){return o[r][a][i][t]})).map((function(e,t){return{classScore:e,label:t}})).reduce((function(e,t){return e.classScore>t.classScore?e:t})));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(MQ),r0=n0;r0.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024];var a0=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,m.Z)(this,n);var a=(0,r.Z)({withSeparableConvs:e,iouThreshold:H$,classes:["face"]},e?{anchors:q$,meanRgb:K$}:{anchors:j$,withClassScores:!0});return t.call(this,a)}return(0,v.Z)(n,[{key:"withSeparableConvs",get:function(){return this.config.withSeparableConvs}},{key:"anchors",get:function(){return this.config.anchors}},{key:"locateFaces",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.detect(t,n);case 2:return e.abrupt("return",e.sent.map((function(e){return new PJ(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"}},{key:"extractParamsFromWeightMap",value:function(e){return o((0,i.Z)(n.prototype),"extractParamsFromWeightMap",this).call(this,e)}}]),n}(r0);var i0=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){var e;return(0,m.Z)(this,n),(e=t.apply(this,arguments))._name="TinyFaceDetectorOptions",e}return(0,v.Z)(n)}(t0),o0=function(){function e(){(0,m.Z)(this,e)}return(0,v.Z)(e,[{key:"then",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t,e.next=3,this.run();case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"run",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("ComposableTask - run is not implemented");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}();function s0(e,t,n,r){return u0.apply(this,arguments)}function u0(){return u0=(0,f.Z)((0,d.Z)().mark((function e(t,n,r,a){var i,o,s,u,c=arguments;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=c.length>4&&void 0!==c[4]?c[4]:function(e){return e.alignedRect},o=t.map((function(e){return o$(e)?i(e):e.detection})),e.t0=a,e.t0){e.next=14;break}if(!(n instanceof hi)){e.next=10;break}return e.next=7,TQ(n,o);case 7:e.t1=e.sent,e.next=13;break;case 10:return e.next=12,SQ(n,o);case 12:e.t1=e.sent;case 13:e.t0=e.t1;case 14:return s=e.t0,e.next=17,r(s);case 17:return u=e.sent,e.abrupt("return",(s.forEach((function(e){return e instanceof hi&&e.dispose()})),u));case 19:case"end":return e.stop()}}),e)}))),u0.apply(this,arguments)}var c0=.4,l0=[new MJ(1.603231,2.094468),new MJ(6.041143,7.080126),new MJ(2.882459,3.518061),new MJ(4.266906,5.178857),new MJ(9.041765,10.66308)],p0=[117.001,114.697,97.404],h0=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){(0,m.Z)(this,n);var e={withSeparableConvs:!0,iouThreshold:c0,classes:["face"],anchors:l0,meanRgb:p0,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t.call(this,e)}return(0,v.Z)(n,[{key:"anchors",get:function(){return this.config.anchors}},{key:"locateFaces",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t,n){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.detect(t,n);case 2:return e.abrupt("return",e.sent.map((function(e){return new PJ(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"tiny_face_detector_model"}},{key:"extractParamsFromWeightMap",value:function(e){return o((0,i.Z)(n.prototype),"extractParamsFromWeightMap",this).call(this,e)}}]),n}(r0),d0={ssdMobilenetv1:new G$,tinyFaceDetector:new h0,tinyYolov2:new a0,faceLandmark68Net:new x$,faceLandmark68TinyNet:new w$,faceRecognitionNet:new A$,faceExpressionNet:new r$,ageGenderNet:new y$},f0=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r,a){var i;return(0,m.Z)(this,n),(i=t.call(this)).parentTask=e,i.input=r,i.extractedFaces=a,i}return(0,v.Z)(n)}(o0),m0=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"run",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentTask;case 2:return t=e.sent,e.next=5,s0(t,this.input,function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map((function(e){return d0.faceExpressionNet.predictExpressions(e)}))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.extractedFaces);case 5:return n=e.sent,e.abrupt("return",t.map((function(e,t){return a$(e,n[t])})));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"withAgeAndGender",value:function(){return new y0(this,this.input)}}]),n}(f0),v0=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"withAgeAndGender",value:function(){return new b0(this,this.input)}},{key:"withFaceDescriptors",value:function(){return new k0(this,this.input)}}]),n}(m0),g0=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r,a){var i;return(0,m.Z)(this,n),(i=t.call(this)).parentTask=e,i.input=r,i.extractedFaces=a,i}return(0,v.Z)(n)}(o0),y0=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"run",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentTask;case 2:return t=e.sent,e.next=5,s0(t,this.input,function(){var e=(0,f.Z)((0,d.Z)().mark((function e(t){return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map((function(e){return d0.ageGenderNet.predictAgeAndGender(e)}))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.extractedFaces);case 5:return n=e.sent,e.abrupt("return",t.map((function(e,t){var r=n[t],a=r.age;return F$(Z$(e,r.gender,r.genderProbability),a)})));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"withFaceExpressions",value:function(){return new m0(this,this.input)}}]),n}(g0),b0=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"withFaceExpressions",value:function(){return new v0(this,this.input)}},{key:"withFaceDescriptors",value:function(){return new k0(this,this.input)}}]),n}(y0),x0=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r){var a;return(0,m.Z)(this,n),(a=t.call(this)).parentTask=e,a.input=r,a}return(0,v.Z)(n)}(o0),k0=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"run",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentTask;case 2:return t=e.sent,e.next=5,s0(t,this.input,(function(e){return Promise.all(e.map((function(e){return d0.faceRecognitionNet.computeFaceDescriptor(e)})))}),null,(function(e){return e.landmarks.align(null,{useDlibAlignment:!0})}));case 5:return e.abrupt("return",e.sent.map((function(e,n){return R$(t[n],e)})));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"withFaceExpressions",value:function(){return new v0(this,this.input)}},{key:"withAgeAndGender",value:function(){return new b0(this,this.input)}}]),n}(x0),w0=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e,r,a){var i;return(0,m.Z)(this,n),(i=t.call(this)).parentTask=e,i.input=r,i.useTinyLandmarkNet=a,i}return(0,v.Z)(n,[{key:"landmarkNet",get:function(){return this.useTinyLandmarkNet?d0.faceLandmark68TinyNet:d0.faceLandmark68Net}}]),n}(o0),I0=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"run",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n,r,a,i=this;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentTask;case 2:if(t=e.sent,n=t.map((function(e){return e.detection})),!(this.input instanceof hi)){e.next=10;break}return e.next=7,TQ(this.input,n);case 7:e.t0=e.sent,e.next=13;break;case 10:return e.next=12,SQ(this.input,n);case 12:e.t0=e.sent;case 13:return r=e.t0,e.next=16,Promise.all(r.map((function(e){return i.landmarkNet.detectLandmarks(e)})));case 16:return a=e.sent,e.abrupt("return",(r.forEach((function(e){return e instanceof hi&&e.dispose()})),t.filter((function(e,t){return a[t]})).map((function(e,t){return s$(e,a[t])}))));case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"withFaceExpressions",value:function(){return new v0(this,this.input)}},{key:"withAgeAndGender",value:function(){return new b0(this,this.input)}},{key:"withFaceDescriptors",value:function(){return new k0(this,this.input)}}]),n}(w0),S0=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new U$;return(0,m.Z)(this,n),(r=t.call(this)).input=e,r.options=a,r}return(0,v.Z)(n)}(o0),N0=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){return(0,m.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"run",value:function(){var e=(0,f.Z)((0,d.Z)().mark((function e(){var t,n,r;return(0,d.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.input,!((n=this.options)instanceof i0)){e.next=5;break}r=d0.tinyFaceDetector.locateFaces(t,n),e.next=14;break;case 5:if(!(n instanceof U$)){e.next=9;break}r=d0.ssdMobilenetv1.locateFaces(t,n),e.next=14;break;case 9:if(!(n instanceof t0)){e.next=13;break}r=d0.tinyYolov2.locateFaces(t,n),e.next=14;break;case 13:throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | TinyYolov2Options");case 14:return e.abrupt("return",r);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"runAndExtendWithFaceDetections",value:function(){var e=this;return new Promise((function(t,n){e.run().then((function(e){return t(e.map((function(e){return XJ({},e)})))})).catch((function(e){return n(e)}))}))}},{key:"withFaceLandmarks",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new I0(this.runAndExtendWithFaceDetections(),this.input,e)}},{key:"withFaceExpressions",value:function(){return new m0(this.runAndExtendWithFaceDetections(),this.input)}},{key:"withAgeAndGender",value:function(){return new y0(this.runAndExtendWithFaceDetections(),this.input)}}]),n}(S0);function T0(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new U$;return new N0(e,t)}}}]);